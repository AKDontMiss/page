!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).firebase=t()}(this,function(){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function e(r,n){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function d(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function v(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)t.hasOwnProperty(r)&&(e[r]=v(e[r],t[r]));return e}var i=(t.prototype.wrapCallback=function(r){var n=this;return function(e,t){e?n.reject(e):n.resolve(t),"function"==typeof r&&(n.promise.catch(function(){}),1===r.length?r(e):r(e,t))}},t);function t(){var r=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,t){r.resolve=e,r.reject=t})}var n,o,s,f=(s=Error,r(n=l,o=s),void(n.prototype=null===o?Object.create(o):(c.prototype=o.prototype,new c)),l);function c(){this.constructor=n}function l(e,t){var r=s.call(this,t)||this;return r.code=e,r.name="FirebaseError",Object.setPrototypeOf(r,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,u.prototype.create),r}var u=(h.prototype.create=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=t[0]||{},i=this.service+"/"+e,o=this.errors[e],a=o?function(e,n){return e.replace(m,function(e,t){var r=n[t];return null!=r?r.toString():"<"+t+"?>"})}(o,n):"Error",s=this.serviceName+": "+a+" ("+i+").",c=new f(i,s),l=0,p=Object.keys(n);l<p.length;l++){var u=p[l];"_"!==u.slice(-1)&&(u in c&&console.warn('Overwriting FirebaseError base field "'+u+'" can cause unexpected behavior.'),c[u]=n[u])}return c},h);function h(e,t,r){this.service=e,this.serviceName=t,this.errors=r}var m=/\{\$([^}]+)}/g;function y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function b(e,t){var r=new g(e,t);return r.subscribe.bind(r)}var g=(w.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},w.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},w.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},w.prototype.subscribe=function(e,t,r){var n,i=this;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");void 0===(n=function(e,t){if("object"!=typeof e||null===e)return!1;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=O),void 0===n.error&&(n.error=O),void 0===n.complete&&(n.complete=O);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?n.error(i.finalError):n.complete()}catch(e){}}),this.observers.push(n),o},w.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},w.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},w.prototype.sendOne=function(e,t){var r=this;this.task.then(function(){if(void 0!==r.observers&&void 0!==r.observers[e])try{t(r.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},w.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},w);function w(e,t){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(r)}).catch(function(e){r.error(e)})}function O(){}var E=(I.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},I.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},I.prototype.setServiceProps=function(e){return this.serviceProps=e,this},I);function I(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var _="[DEFAULT]",N=(P.prototype.get=function(e){void 0===e&&(e=_);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var r=new i;this.instancesDeferred.set(t,r);try{var n=this.getOrInitializeService(t);n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise},P.prototype.getImmediate=function(e){var t=a({identifier:_,optional:!1},e),r=t.identifier,n=t.optional,i=this.normalizeInstanceIdentifier(r);try{var o=this.getOrInitializeService(i);if(o)return o;if(n)return null;throw Error("Service "+this.name+" is not available")}catch(e){if(n)return null;throw e}},P.prototype.getComponent=function(){return this.component},P.prototype.setComponent=function(e){var t,r;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(function(e){return"EAGER"===e.instantiationMode}(this.component=e))try{this.getOrInitializeService(_)}catch(e){}try{for(var n=d(this.instancesDeferred.entries()),i=n.next();!i.done;i=n.next()){var o=p(i.value,2),a=o[0],s=o[1],c=this.normalizeInstanceIdentifier(a);try{var l=this.getOrInitializeService(c);s.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},P.prototype.clearInstance=function(e){void 0===e&&(e=_),this.instancesDeferred.delete(e),this.instances.delete(e)},P.prototype.delete=function(){return function(o,a,s,c){return new(s=s||Promise)(function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}i((c=c.apply(o,a||[])).next())})}(this,void 0,void 0,function(){var t;return e(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))];case 1:return e.sent(),[2]}})})},P.prototype.isComponentSet=function(){return null!=this.component},P.prototype.getOrInitializeService=function(e){var t=this.instances.get(e);return!t&&this.component&&(t=this.component.instanceFactory(this.container,function(e){return e===_?void 0:e}(e)),this.instances.set(e,t)),t||null},P.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:_:e},P);function P(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var S,A,C=(R.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},R.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},R.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new N(e,this);return this.providers.set(e,t),t},R.prototype.getProviders=function(){return Array.from(this.providers.values())},R);function R(e){this.name=e,this.providers=new Map}function j(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}(A=S=S||{})[A.DEBUG=0]="DEBUG",A[A.VERBOSE=1]="VERBOSE",A[A.INFO=2]="INFO",A[A.WARN=3]="WARN",A[A.ERROR=4]="ERROR",A[A.SILENT=5]="SILENT";function k(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!(t<e.logLevel)){var i=(new Date).toISOString();switch(t){case S.DEBUG:case S.VERBOSE:console.log.apply(console,j(["["+i+"]  "+e.name+":"],r));break;case S.INFO:console.info.apply(console,j(["["+i+"]  "+e.name+":"],r));break;case S.WARN:console.warn.apply(console,j(["["+i+"]  "+e.name+":"],r));break;case S.ERROR:console.error.apply(console,j(["["+i+"]  "+e.name+":"],r));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}}}var D,F=S.INFO,x=(Object.defineProperty(L.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in S))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(L.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),L.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,j([this,S.DEBUG],e))},L.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,j([this,S.VERBOSE],e))},L.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,j([this,S.INFO],e))},L.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,j([this,S.WARN],e))},L.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,j([this,S.ERROR],e))},L);function L(e){this.name=e,this._logLevel=F,this._logHandler=k}var T,z=((D={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",D["bad-app-name"]="Illegal App name: '{$appName}",D["duplicate-app"]="Firebase App named '{$appName}' already exists",D["app-deleted"]="Firebase App named '{$appName}' already deleted",D["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",D),V=new u("app","Firebase",z),B="@firebase/app",M="[DEFAULT]",U=((T={})[B]="fire-core",T["@firebase/analytics"]="fire-analytics",T["@firebase/auth"]="fire-auth",T["@firebase/database"]="fire-rtdb",T["@firebase/functions"]="fire-fn",T["@firebase/installations"]="fire-iid",T["@firebase/messaging"]="fire-fcm",T["@firebase/performance"]="fire-perf",T["@firebase/remote-config"]="fire-rc",T["@firebase/storage"]="fire-gcs",T["@firebase/firestore"]="fire-fst",T["fire-js"]="fire-js",T["firebase-wrapper"]="fire-js-all",T),H=new x("@firebase/app"),W=(Object.defineProperty(G.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),G.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(e){return e.delete()}))}).then(function(){t.isDeleted_=!0})},G.prototype._getService=function(e,t){return void 0===t&&(t=M),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},G.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=M),this.container.getProvider(e).clearInstance(t)},G.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){H.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},G.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},G.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw V.create("app-deleted",{appName:this.name_})},G);function G(e,t,r){var n,i,o=this;this.firebase_=r,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=function(e){return v(void 0,e)}(e),this.container=new C(t.name),this._addComponent(new E("app",function(){return o},"PUBLIC"));try{for(var a=d(this.firebase_.INTERNAL.components.values()),s=a.next();!s.done;s=a.next()){var c=s.value;this._addComponent(c)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}W.prototype.name&&W.prototype.options||W.prototype.delete||console.log("dc");var $="7.8.2";function Y(c){var l={},p=new Map,u={__esModule:!0,initializeApp:function(e,t){void 0===t&&(t={});if("object"!=typeof t||null===t){t={name:t}}var r=t;void 0===r.name&&(r.name=M);var n=r.name;if("string"!=typeof n||!n)throw V.create("bad-app-name",{appName:String(n)});if(y(l,n))throw V.create("duplicate-app",{appName:n});var i=new c(e,r,u);return l[n]=i},app:f,registerVersion:function(e,t,r){var n,i=null!==(n=U[e])&&void 0!==n?n:e;r&&(i+="-"+r);var o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){var s=['Unable to register library "'+i+'" with version "'+t+'":'];return o&&s.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&s.push("and"),a&&s.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void H.warn(s.join(" "))}h(new E(i+"-version",function(){return{library:i,version:t}},"VERSION"))},apps:null,SDK_VERSION:$,INTERNAL:{registerComponent:h,removeApp:function(e){delete l[e]},components:p,useAsService:function(e,t){return"serverAuth"!==t?t:null}}};function f(e){if(!y(l,e=e||M))throw V.create("no-app",{appName:e});return l[e]}function h(r){var t,e,n=r.name;if(p.has(n))return H.debug("There were multiple attempts to register component "+n+"."),"PUBLIC"===r.type?u[n]:null;if(p.set(n,r),"PUBLIC"===r.type){var i=function(e){if(void 0===e&&(e=f()),"function"!=typeof e[n])throw V.create("invalid-app-argument",{appName:n});return e[n]()};void 0!==r.serviceProps&&v(i,r.serviceProps),u[n]=i,c.prototype[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,n).apply(this,r.multipleInstances?e:[])}}try{for(var o=d(Object.keys(l)),a=o.next();!a.done;a=o.next()){var s=a.value;l[s]._addComponent(r)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return"PUBLIC"===r.type?u[n]:null}return u.default=u,Object.defineProperty(u,"apps",{get:function(){return Object.keys(l).map(function(e){return l[e]})}}),f.App=c,u}var K=function e(){var t=Y(W);return t.INTERNAL=a(a({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){v(t,e)},createSubscribe:b,ErrorFactory:u,deepExtend:v}),t}(),Z=(q.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(e){if(function(e){var t,r=e.getComponent();return"VERSION"===(null===(t=r)||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null}).filter(function(e){return e}).join(" ")},q);function q(e){this.container=e}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){H.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var J=self.firebase.SDK_VERSION;J&&0<=J.indexOf("LITE")&&H.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Q=K.initializeApp;K.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}()&&H.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),Q.apply(void 0,e)};var X,ee,te=K;(X=te).INTERNAL.registerComponent(new E("platform-logger",function(e){return new Z(e)},"PRIVATE")),X.registerVersion(B,"0.5.4",ee),X.registerVersion("fire-js","");return te.registerVersion("firebase","7.8.2","app"),te});
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(fl){"use strict";try{(function(){fl=fl&&fl.hasOwnProperty("default")?fl.default:fl,function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};var a=function(t){t=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,t];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}return globalThis}(this);function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var i=0;i<t.length-1;i++){var r=t[i];r in n||(n[r]={}),n=n[r]}(e=e(i=n[t=t[t.length-1]]))!=i&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){i||(i=!0,e.call(n,t))}}var n=this,i=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)r.b(this.a[t]);this.a=null}};var r=new e;return s.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(t){r(t)}}:t}var i,r,o=new s(function(t,e){i=t,r=e});return this.La(n(t,i),n(e,r)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.La=function(t,e){function n(){switch(i.b){case 1:t(i.c);break;case 2:e(i.c);break;default:throw Error("Unexpected state: "+i.b)}}var i=this;null==this.a?r.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(r){return new s(function(t,e){for(var n=c(r),i=n.next();!i.done;i=n.next())u(i.value).La(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){i[e]=t,0==--r&&n(i)}}for(var i=[],r=0;i.push(void 0),r++,u(a.value).La(e(i.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function d(){}function i(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function r(t){return null===t}function p(t){return"array"==i(t)}function v(t){var e=i(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==i(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),b=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,i),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function I(t,e,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function T(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var E=Date.now||function(){return+new Date};function k(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t}function A(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function S(t){if(Error.captureStackTrace)Error.captureStackTrace(this,S);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",i=(t=t.split("%s")).length-1,r=0;r<i;r++)n+=t[r]+(r<e.length?e[r]:"%s");S.call(this,n+t[i])}function O(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function _(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function P(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}k(S,Error),S.prototype.name="CustomError",k(N,S),N.prototype.name="AssertionError",_.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var C=new _(function(){return new D},function(t){t.reset()});function D(){this.next=this.b=this.a=null}function L(t,e){t:{try{var n=t&&t.ownerDocument,i=n&&(n.defaultView||n.parentWindow);if((i=i||l).Element&&i.Location){var r=i;break t}}catch(t){}r=null}if(r&&void 0!==r[e]&&(!t||!(t instanceof r[e])&&(t instanceof r.Location||t instanceof r.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;O("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=C.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},D.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},D.prototype.reset=function(){this.next=this.b=this.a=null};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,r=h(t)?t.split(""):t,o=0;o<i;o++)o in r&&e.call(n,r[o],o,t)};var j=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),r=h(t)?t.split(""):t,o=0;o<n;o++)o in r&&(i[o]=e.call(void 0,r[o],o,t));return i},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=h(t)?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t))return!0;return!1};function V(t,e){return 0<=x(t,e)}function F(t,e){var n;return(n=0<=(e=x(t,e)))&&Array.prototype.splice.call(t,e,1),n}function K(n,i){!function(t,e){for(var n=h(t)?t.split(""):t,i=t.length-1;0<=i;--i)i in n&&e.call(void 0,n[i],i,t)}(n,function(t,e){i.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function q(t){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),i=0;i<e;i++)n[i]=t[i];return n}return[]}function B(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function G(t){for(var e in t)return!1;return!0}function W(t){var e,n={};for(e in t)n[e]=t[e];return n}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])t[n]=i[n];for(var o=0;o<X.length;o++)n=X[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Y(t,e){this.a=t===Z&&e||"",this.b=$}function z(t){return t instanceof Y&&t.constructor===Y&&t.b===$?t.a:(O("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var $={},Z={},Q=new Y(Z,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(O("expected object of type TrustedResourceUrl, got '"+t+"' of type "+i(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var i=z(t);if(!rt.test(i))throw Error("Invalid TrustedResourceUrl format: "+i);return at(t=i.replace(it,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+i+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?z(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var it=/%{(\w+)}/g,rt=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,dt=/\x00/g,pt=/[\x00&<>"']/;function vt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function bt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(O("expected object of type SafeUrl, got '"+t+"' of type "+i(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var yt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),yt.test(t)||(t="about:invalid#zClosurez"),Et(t))}var It,Tt={};function Et(t){var e=new gt;return e.a=t,e}Et("about:blank");t:{var kt=l.navigator;if(kt){var At=kt.userAgent;if(At){It=At;break t}}It=""}function St(t){return vt(It,t)}function Nt(){this.a="",this.b=_t}function Ot(t){return t instanceof Nt&&t.constructor===Nt&&t.b===_t?t.a:(O("expected object of type SafeHtml, got '"+t+"' of type "+i(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var _t={};function Pt(t){var e=new Nt;return e.a=t,e}Pt("<!DOCTYPE html>");var Rt,Ct,Dt=Pt("");function Lt(t,e){for(var n=t.split("%s"),i="",r=Array.prototype.slice.call(arguments,1);r.length&&1<n.length;)i+=n.shift()+r.shift();return i+n.join("%s")}function xt(t){return pt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(dt,"&#0;"))),t}function Mt(t){l.setTimeout(function(){throw t},0)}function jt(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!St("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(z(Q));L(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(Ot(Dt)),t.close();var n="callImmediate"+Math.random(),i="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=I(function(t){"*"!=i&&t.origin!=i||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,i)}}}),void 0===t||St("Trident")||St("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},i=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){i.next={yb:t},i=i.next,e.port2.postMessage(0)}}function Ut(t,e){Ct||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ct=function(){t.then(Kt)}}else Ct=function(){var t=Kt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!St("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||jt())(t):l.setImmediate(t)}}(),Vt||(Ct(),Vt=!0),Ft.add(t,e)}Pt("<br>");var Vt=!1,Ft=new R;function Kt(){for(var t;n=e=void 0,n=null,(e=Ft).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Mt(t)}P(C,t)}var e,n;Vt=!1}function qt(t,e){if(this.a=Ht,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=d)try{var n=this;t.call(e,function(t){ee(n,Bt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Gt,t)})}catch(t){ee(this,Gt,t)}}var Ht=0,Bt=2,Gt=3;function Wt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Wt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Xt=new _(function(){return new Wt},function(t){t.reset()});function Jt(t,e,n){var i=Xt.get();return i.g=t,i.b=e,i.f=n,i}function Yt(t){if(t instanceof qt)return t;var e=new qt(d);return ee(e,Bt,t),e}function zt(n){return new qt(function(t,e){e(n)})}function $t(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function Zt(n){return new qt(function(i){var r=n.length,o=[];if(r)for(var t=function(t,e,n){r--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==r&&i(o)},e=0;e<n.length;e++)$t(n[e],T(t,e,!0),T(t,e,!1));else i(o)})}function Qt(t,e){t.b||t.a!=Bt&&t.a!=Gt||ie(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,r,o,a){var e=Jt(null,null,null);return e.a=new qt(function(n,i){e.g=r?function(t){try{var e=r.call(a,t);n(e)}catch(t){i(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?i(t):n(e)}catch(t){i(t)}}:i}),Qt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Ht&&(t===n&&(e=Gt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,ie(t),e!=Gt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,i){if(t instanceof qt)return Qt(t,Jt(e||d,n||null,i)),!0;if(A(t))return t.then(e,n,i),!0;if(g(t))try{var r=t.then;if(m(r))return function(t,e,n,i,r){function o(t){a||(a=!0,i.call(r,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(r,t))},o)}catch(t){o(t)}}(t,r,e,n,i),!0}catch(t){return n.call(i,t),!0}return!1}function ie(t){t.h||(t.h=!0,Ut(t.Zb,t))}function re(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,i){if(n==Gt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,i);else try{e.c?e.g.call(e.f):ae(e,n,i)}catch(t){se.call(null,t)}P(Xt,e)}function ae(t,e,n){e==Bt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}qt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},qt.prototype.$goog_Thenable=!0,(t=qt.prototype).ka=function(t,e){return(t=Jt(t,t,e)).c=!0,Qt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Ht&&Ut(function(){!function t(e,n){if(e.a==Ht)if(e.c){var i=e.c;if(i.b){for(var r=0,o=null,a=null,s=i.b;s&&(s.c||(r++,s.a==e&&(o=s),!(o&&1<r)));s=s.next)o||(a=s);o&&(i.a==Ht&&1==r?t(i,n):(a?((r=a).next==i.f&&(i.f=r),r.next=r.next.next):re(i),oe(i,o,Gt,n)))}e.c=null}else ee(e,Gt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Ht,ee(this,Bt,t)},t.Pc=function(t){this.a=Ht,ee(this,Gt,t)},t.Zb=function(){for(var t;t=re(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Mt;function ue(t){S.call(this,t)}function ce(){this.va=this.va,this.la=this.la}k(ue,S);var he=0;function le(t){if(!t.va&&(t.va=!0,t.za(),0!=he))t[e]||(t[e]=++b)}function fe(t){return fe[" "](t),t}ce.prototype.va=!(ue.prototype.name="cancel"),ce.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=d;var de,pe,ve=St("Opera"),me=St("Trident")||St("MSIE"),ge=St("Edge"),be=ge||me,ye=St("Gecko")&&!(vt(It.toLowerCase(),"webkit")&&!St("Edge"))&&!(St("Trident")||St("MSIE"))&&!St("Edge"),we=vt(It.toLowerCase(),"webkit")&&!St("Edge");function Ie(){var t=l.document;return t?t.documentMode:void 0}t:{var Te="",Ee=(pe=It,ye?/rv:([^\);]+)(\)|;)/.exec(pe):ge?/Edge\/([\d\.]+)/.exec(pe):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(pe):we?/WebKit\/(\S+)/.exec(pe):ve?/(?:Version)[ \/]?(\S+)/.exec(pe):void 0);if(Ee&&(Te=Ee?Ee[1]:""),me){var ke=Ie();if(null!=ke&&ke>parseFloat(Te)){de=String(ke);break t}}de=Te}var Ae,Se={};function Ne(s){return function(t,e){var n=Se;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(de)).split("."),n=st(String(s)).split("."),i=Math.max(e.length,n.length),r=0;0==t&&r<i;r++){var o=e[r]||"",a=n[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ae=l.document&&me?Ie():void 0;var Oe=Object.freeze||function(t){return t},_e=!me||9<=Number(Ae),Pe=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",d,e),l.removeEventListener("test",d,e)}catch(t){}return t}();function Ce(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function De(t,e){if(Ce.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(ye){t:{try{fe(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Le[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Ce.prototype.preventDefault=function(){this.Mb=!1},k(De,Ce);var Le=Oe({2:"touch",3:"pen",4:"mouse"});De.prototype.preventDefault=function(){De.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Pe)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},De.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Me=0;function je(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.Pa=r,this.key=++Me,this.ta=this.Ka=!1}function Ue(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function Ve(t){this.src=t,this.a={},this.b=0}function Fe(t,e){var n=e.type;n in t.a&&F(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Ke(t,e,n,i){for(var r=0;r<t.length;++r){var o=t[r];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==i)return r}return-1}Ve.prototype.add=function(t,e,n,i,r){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ke(t,e,i,r);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new je(e,this.src,o,!!i,r)).Ka=n,t.push(e)),e};var qe="closure_lm_"+(1e6*Math.random()|0),He={};function Be(t,e,n,i,r){if(i&&i.once)We(t,e,n,i,r);else if(p(e))for(var o=0;o<e.length;o++)Be(t,e[o],n,i,r);else n=en(n),t&&t[xe]?rn(t,e,n,g(i)?!!i.capture:!!i,r):Ge(t,e,n,!1,i,r)}function Ge(t,e,n,i,r,o){if(!e)throw Error("Invalid event type");var a=g(r)?!!r.capture:!!r,s=Qe(t);if(s||(t[qe]=s=new Ve(t)),!(n=s.add(e,n,i,a,o)).proxy)if(i=function(){var e=Ze,n=_e?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=i).src=t,i.listener=n,t.addEventListener)Re||(r=a),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}}function We(t,e,n,i,r){if(p(e))for(var o=0;o<e.length;o++)We(t,e[o],n,i,r);else n=en(n),t&&t[xe]?on(t,e,n,g(i)?!!i.capture:!!i,r):Ge(t,e,n,!0,i,r)}function Xe(t,e,n,i,r){if(p(e))for(var o=0;o<e.length;o++)Xe(t,e[o],n,i,r);else i=g(i)?!!i.capture:!!i,n=en(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Ke(o=t.a[e],n,i,r))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Qe(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ke(e,n,i,r)),(n=-1<t?e[t]:null)&&Je(n))}function Je(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[xe])Fe(e.u,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Ye(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=Qe(e))?(Fe(n,t),0==n.b&&(n.src=null,e[qe]=null)):Ue(t)}}}function Ye(t){return t in He?He[t]:He[t]="on"+t}function ze(t,e,n,i){var r=!0;if((t=Qe(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=$e(o,i),r=r&&!1!==o)}return r}function $e(t,e){var n=t.listener,i=t.Pa||t.src;return t.Ka&&Je(t),n.call(i,e)}function Ze(t,e){if(t.ta)return!0;if(_e)return $e(t,new De(e,this));if(!e)t:{e=["window","event"];for(var n=l,i=0;i<e.length;i++)if(null==(n=n[e[i]])){e=null;break t}e=n}if(e=new De(i=e,this),n=!0,!(i.keyCode<0||null!=i.returnValue)){t:{var r=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){r=!0}!r&&null!=i.returnValue||(i.returnValue=!0)}for(i=[],r=e.b;r;r=r.parentNode)i.push(r);for(t=t.type,r=i.length-1;0<=r;r--){e.b=i[r];var o=ze(i[r],t,!0,e);n=n&&o}for(r=0;r<i.length;r++)e.b=i[r],o=ze(i[r],t,!1,e),n=n&&o}return n}function Qe(t){return(t=t[qe])instanceof Ve?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new Ve(this),(this.Sb=this).Xa=null}function rn(t,e,n,i,r){t.u.add(String(e),n,!1,i,r)}function on(t,e,n,i,r){t.u.add(String(e),n,!0,i,r)}function an(t,e,n,i){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&Fe(t.u,a),r=!1!==s.call(u,i)&&r}}return r&&0!=i.Mb}function sn(t,e,n){if(m(t))n&&(t=I(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=I(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var i=null;return new qt(function(t,e){-1==(i=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(i),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(v(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(v(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof ln)for(n=t.X(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var i=t.a[e];dn(t.b,i)&&(t.a[n++]=i),e++}t.a.length=n}if(t.c!=t.a.length){var r={};for(n=e=0;e<t.a.length;)dn(r,i=t.a[e])||(r[t.a[n++]=i]=1),e++;t.a.length=n}}function dn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}k(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,i){Be(this,t,e,n,i)},nn.prototype.removeEventListener=function(t,e,n,i){Xe(this,t,e,n,i)},nn.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var i=t.type||t;if(h(t))t=new Ce(t,n);else if(t instanceof Ce)t.target=t.target||n;else{var r=t;J(t=new Ce(i,n),r)}if(r=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];r=an(a,i,!0,t)&&r}if(r=an(a=t.b=n,i,!0,t)&&r,r=an(a,i,!1,t)&&r,e)for(o=0;o<e.length;o++)r=an(a=t.b=e[o],i,!1,t)&&r;return r},nn.prototype.za=function(){if(nn.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],i=0;i<n.length;i++)Ue(n[i]);delete e.a[t],e.b--}}this.Xa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return dn(this.b,t)?this.b[t]:e},t.set=function(t,e){dn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),i=0;i<n.length;i++){var r=n[i],o=this.get(r);t.call(e,o,r,this)}};var pn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function vn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof vn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,gn(this,t.l),this.c=t.c,bn(this,jn(t.a)),this.g=t.g):t&&(n=String(t).match(pn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=En(n[2]||""),this.b=En(n[3]||"",!0),gn(this,n[4]),this.c=En(n[5]||"",!0),bn(this,n[6]||"",!0),this.g=En(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?En(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function bn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(Cn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Ln(this,e),Mn(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=kn(e,_n)),t.a=new Rn(e,t.h))}function yn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function In(t){return t instanceof vn?new vn(t):new vn(t,void 0)}function Tn(t,e){var n=new vn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function kn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,An),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function An(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}vn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(kn(e,Sn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(kn(e,Sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(kn(n,"/"==n.charAt(0)?On:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",kn(n,Pn)),t.join("")},vn.prototype.resolve=function(t){var e=new vn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var i=t.c;if(n)gn(e,t.l);else if(n=!!t.c){if("/"!=i.charAt(0))if(this.b&&!this.c)i="/"+i;else{var r=e.c.lastIndexOf("/");-1!=r&&(i=e.c.substr(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if(vt(r,"./")||vt(r,"/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var o=[],a=0;a<r.length;){var s=r[a++];"."==s?i&&a==r.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),i&&a==r.length&&o.push("")):(o.push(s),i=!0)}i=o.join("/")}else i=r}return n?e.c=i:n=""!==t.a.toString(),n?bn(e,jn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Sn=/[#\/\?@]/g,Nn=/[#\?:]/g,On=/[#\?]/g,_n=/[#\?@]/g,Pn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Cn(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var o=t[n].substring(0,i);r=t[n].substring(i+1)}else o=t[n];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Dn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var i=0;i<e.length;i++){var r=e[i],o=t[i];p(o)?Mn(n,r,o):n.add(r,o)}return n}function Ln(t,e){Cn(t),e=Un(t,e),dn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,dn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return Cn(t),e=Un(t,e),dn(t.a.b,e)}function Mn(t,e,n){Ln(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),H(n)),t.b+=n.length)}function jn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){Cn(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,i){Cn(this),this.a.forEach(function(t,e){M(t,function(t){n.call(i,t,e,this)},this)},this)},t.X=function(){Cn(this);for(var t=this.a.U(),e=this.a.X(),n=[],i=0;i<e.length;i++)for(var r=t[i],o=0;o<r.length;o++)n.push(e[i]);return n},t.U=function(t){Cn(this);var e=[];if(h(t))xn(this,t)&&(e=q(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=q(e,t[n])}return e},t.set=function(t,e){return Cn(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var i=e[n],r=encodeURIComponent(String(i));i=this.U(i);for(var o=0;o<i.length;o++){var a=r;""!==i[o]&&(a+="="+encodeURIComponent(String(i[o]))),t.push(a)}}return this.c=t.join("&")};var Vn=!me||9<=Number(Ae);function Fn(t){var e=document;return h(t)?e.getElementById(t):t}function Kn(n,t){B(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:qn.hasOwnProperty(e)?n.setAttribute(qn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var qn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Hn(t,e,n){var i=arguments,r=document,o=String(i[0]),a=i[1];if(!Vn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',xt(a.name),'"'),a.type){o.push(' type="',xt(a.type),'"');var s={};J(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=r.createElement(o),a&&(h(a)?o.className=a:p(a)?o.className=a.join(" "):Kn(o,a)),2<i.length&&function(e,n,t){function i(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var r=2;r<t.length;r++){var o=t[r];!v(o)||g(o)&&0<o.nodeType?i(o):M(Bn(o)?H(o):o,i)}}(r,o,i),o}function Bn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Gn(t){var e=[];return function t(e,n,i){if(null==n)i.push("null");else{if("object"==typeof n){if(p(n)){var r=n;n=r.length,i.push("[");for(var o="",a=0;a<n;a++)i.push(o),t(e,r[a],i),o=",";return void i.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(r in i.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,r)&&("function"!=typeof(a=n[r])&&(i.push(o),Yn(r,i),i.push(":"),t(e,a,i),o=","));return void i.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,i);break;case"number":i.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":i.push(String(n));break;case"function":i.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Wn,t,e),e.join("")}function Wn(){}var Xn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Jn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(Jn,function(t){var e=Xn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Xn[t]=e),e}),'"')}function zn(){var t=vi();return me&&!!Ae&&11==Ae||/Edge\/\d+/.test(t)}function $n(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function Zn(t,e){e=e||l.window;var n="about:blank";t&&(n=bt(wt(t)).toString()),e.location.href=n}function Qn(t){return!!((t=(t||vi()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function ti(t){t=t||l.window;try{t.close()}catch(t){}}function ei(t,e,n){var i=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var r=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<r?r:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=vi().toLowerCase(),i&&(e.target=i,vt(n,"crios/")&&(e.target="_blank")),fi(vi())==hi&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),i=window,e=n instanceof gt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,r=[],t)switch(a){case"width":case"height":case"top":case"left":r.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:r.push(a+"="+(t[a]?1:0))}var a=r.join(",");if((St("iPhone")&&!St("iPod")&&!St("iPad")||St("iPad")||St("iPod"))&&i.navigator&&i.navigator.standalone&&n&&"_self"!=n?(L(a=i.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),yt.test(e)||(e="about:invalid#zClosurez"),e=Et(e)),a.href=bt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,i,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=i.open("",n,a),t=bt(e).toString(),a&&(be&&vt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Pt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+xt(t)+'">'),a.document.write(Ot(t)),a.document.close())):(a=i.open(bt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var ni=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ii=/^[^@]+@[^@]+$/;function ri(){var e=null;return new qt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},We(window,"load",e))}).s(function(t){throw Xe(window,"load",e),t})}function oi(t){return t=t||vi(),!("file:"!==wi()&&"ionic:"!==wi()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ai(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function si(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ui(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":si()?"Worker":"Browser"}function ci(){var t=ui();return"ReactNative"===t||"Node"===t}var hi="Firefox",li="Chrome";function fi(t){var e=t.toLowerCase();return vt(e,"opera/")||vt(e,"opr/")||vt(e,"opios/")?"Opera":vt(e,"iemobile")?"IEMobile":vt(e,"msie")||vt(e,"trident/")?"IE":vt(e,"edge/")?"Edge":vt(e,"firefox/")?hi:vt(e,"silk/")?"Silk":vt(e,"blackberry")?"Blackberry":vt(e,"webos")?"Webos":!vt(e,"safari/")||vt(e,"chrome/")||vt(e,"crios/")||vt(e,"android")?!vt(e,"chrome/")&&!vt(e,"crios/")||vt(e,"edge/")?vt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":li:"Safari"}var di={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function pi(t,e){e=e||[];var n,i=[],r={};for(n in di)r[di[n]]=!0;for(n=0;n<e.length;n++)void 0!==r[e[n]]&&(delete r[e[n]],i.push(e[n]));return i.sort(),(e=i).length||(e=["FirebaseCore-web"]),"Browser"===(i=ui())?i=fi(r=vi()):"Worker"===i&&(i=fi(r=vi())+"-"+i),i+"/JsCore/"+t+"/"+e.join(",")}function vi(){return l.navigator&&l.navigator.userAgent||""}function mi(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gi(){try{var t=l.localStorage,e=Ai();if(t)return t.setItem(e,"1"),t.removeItem(e),!zn()||!!l.indexedDB}catch(t){return si()&&!!l.indexedDB}return!1}function bi(){return(yi()||"chrome-extension:"===wi()||oi())&&!ci()&&gi()&&!si()}function yi(){return"http:"===wi()||"https:"===wi()}function wi(){return l.location&&l.location.protocol||null}function Ii(t){return!Qn(t=t||vi())&&fi(t)!=hi}function Ti(t){return void 0===t?null:Gn(t)}function Ei(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function ki(t){if(null!==t)return JSON.parse(t)}function Ai(t){return t||Math.floor(1e9*Math.random()).toString()}function Si(t){return"Safari"!=fi(t=t||vi())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Ni(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Oi(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=vi(),e=ui(),this.b=Qn(t)||"ReactNative"===e}function _i(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Pi(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Ri(){return!(!mi("fireauth.oauthhelper",l)&&!mi("fireauth.iframe",l))}Oi.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!yi()&&"chrome-extension:"!==wi()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Ci,Di={};function Li(t){Di[t]||(Di[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var xi={};Object.defineProperty(xi,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(xi,"abcd",{configurable:!0,enumerable:!0,value:2}),Ci=2==xi.abcd}catch(t){Ci=!1}function Mi(t,e,n){Ci?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function ji(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Mi(t,n,e[n])}function Ui(t){var e={};return ji(e,t),e}function Vi(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Mi(e,n,Vi(t[n]));return e}function Fi(t){var e={},n=t[qi],i=t[Hi];if(!(t=t[Bi])||t!=Ki&&!n)throw Error("Invalid provider user info!");e[Wi]=i||null,e[Gi]=n||null,Mi(this,Ji,t),Mi(this,Xi,Vi(e))}var Ki="EMAIL_SIGNIN",qi="email",Hi="newEmail",Bi="requestType",Gi="email",Wi="fromEmail",Xi="data",Ji="operation";function Yi(t,e){this.code=$i+t,this.message=e||Zi[t]||""}function zi(t){var e=t&&t.code;return e?new Yi(e.substring($i.length),t.message):null}k(Yi,Error),Yi.prototype.A=function(){return{code:this.code,message:this.message}},Yi.prototype.toJSON=function(){return this.A()};var $i="auth/",Zi={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Qi(t){var e=wn(t=In(t),tr)||null,n=wn(t,er)||null,i=wn(t,rr)||null;if(i=i&&ar[i]||null,!e||!n||!i)throw new Yi("argument-error",tr+", "+er+"and "+rr+" are required in a valid action code URL.");ji(this,{apiKey:e,operation:i,code:n,continueUrl:wn(t,nr)||null,languageCode:wn(t,ir)||null,tenantId:wn(t,or)||null})}var tr="apiKey",er="oobCode",nr="continueUrl",ir="languageCode",rr="mode",or="tenantId",ar={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Ki,verifyEmail:"VERIFY_EMAIL"};function sr(t){try{return new Qi(t)}catch(t){return null}}function ur(t){var e=t[dr];if(void 0===e)throw new Yi("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yi("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[cr];if(n&&"object"==typeof n){e=n[mr];var i=n[pr];if(n=n[vr],"string"==typeof e&&e.length){if(this.a=e,void 0!==i&&"boolean"!=typeof i)throw new Yi("argument-error",pr+" property must be a boolean when specified.");if(this.g=!!i,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yi("argument-error",vr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yi("argument-error",mr+" property must be a non empty string when specified.");if(void 0!==i||void 0!==n)throw new Yi("missing-android-pkg-name")}}else if(void 0!==n)throw new Yi("argument-error",cr+" property must be a non null object when specified.");if(this.f=null,(e=t[fr])&&"object"==typeof e){if("string"==typeof(e=e[gr])&&e.length)this.f=e;else if(void 0!==e)throw new Yi("argument-error",gr+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yi("argument-error",fr+" property must be a non null object when specified.");if(void 0!==(e=t[lr])&&"boolean"!=typeof e)throw new Yi("argument-error",lr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yi("argument-error",hr+" property must be a non empty string when specified.");this.i=t||null}var cr="android",hr="dynamicLinkDomain",lr="handleCodeInApp",fr="iOS",dr="url",pr="installApp",vr="minimumVersion",mr="packageName",gr="bundleId";function br(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var yr=null,wr=null;function Ir(t){var e="";return function(i,t){function e(t){for(;r<i.length;){var e=i.charAt(r++),n=wr[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!yr){yr={},wr={};for(var t=0;t<65;t++)yr[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wr[yr[t]]=t)&&(wr["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Tr(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Er(t){return(t=kr(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Tr(t):null}function kr(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Ir(t))}catch(t){}return null}Tr.prototype.R=function(){return this.c},Tr.prototype.g=function(){return this.b};var Ar,Sr={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Nr(t){for(var e in Sr)if(Sr[e].id===t)return{firebaseEndpoint:(t=Sr[e]).cb,secureTokenEndpoint:t.ib};return null}Ar=Nr("__EID__")?"__EID__":void 0;var Or="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),_r=["client_id","response_type","scope","redirect_uri","state"],Pr={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:_r},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:_r},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:_r},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Or},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Rr(t){for(var e in Pr)if(Pr[e].Fa==t)return Pr[e];return null}function Cr(t){var e={};e["facebook.com"]=jr,e["google.com"]=Vr,e["github.com"]=Ur,e["twitter.com"]=Fr;var n=t&&t[Lr];try{if(n)return e[n]?new e[n](t):new Mr(t);if(void 0!==t[Dr])return new xr(t)}catch(t){}return null}var Dr="idToken",Lr="providerId";function xr(t){var e=t[Lr];if(!e&&t[Dr]){var n=Er(t[Dr]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Mi(this,"providerId",e),Mi(this,"isNewUser",n)}function Mr(t){xr.call(this,t),Mi(this,"profile",Vi((t=ki(t.rawUserInfo||"{}"))||{}))}function jr(t){if(Mr.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ur(t){if(Mr.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Mi(this,"username",this.profile&&this.profile.login||null)}function Vr(t){if(Mr.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Fr(t){if(Mr.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Mi(this,"username",t.screenName||null)}function Kr(t){var e=In(t),n=wn(e,"link"),i=wn(In(n),"link");return wn(In(e=wn(e,"deep_link_id")),"link")||e||i||n||t}function qr(){}function Hr(t,n){return t.then(function(t){if(t[Ca]){var e=Er(t[Ca]);if(!e||n!=e.f)throw new Yi("user-mismatch");return t}throw new Yi("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==$i+"user-not-found"?new Yi("user-mismatch"):t})}function Br(t,e){if(!e)throw new Yi("internal-error","failed to construct a credential");this.a=e,Mi(this,"providerId",t),Mi(this,"signInMethod",t)}function Gr(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Wr(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Br(t.providerId,t.pendingToken)}catch(t){}return null}function Xr(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Mi(this,"idToken",e.idToken),e.accessToken&&Mi(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Mi(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yi("internal-error","failed to construct a credential");Mi(this,"accessToken",e.oauthToken),Mi(this,"secret",e.oauthTokenSecret)}Mi(this,"providerId",t),Mi(this,"signInMethod",n)}function Jr(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Dn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yr(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Xr(t.providerId,e,t.signInMethod)}catch(t){}}return null}function zr(t,e){this.Fc=e||[],ji(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Rr(t)||{}).Ea||null,this.bb=null}function $r(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yi("argument-error",'SAML provider IDs must be prefixed with "saml."');zr.call(this,t,[])}function Zr(t){zr.call(this,t,_r),this.a=[]}function Qr(){Zr.call(this,"facebook.com")}function to(t){if(!t)throw new Yi("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Qr).credential({accessToken:e})}function eo(){Zr.call(this,"github.com")}function no(t){if(!t)throw new Yi("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function io(){Zr.call(this,"google.com"),this.ya("profile")}function ro(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new io).credential({idToken:n,accessToken:e})}function oo(){zr.call(this,"twitter.com",Or)}function ao(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yi("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Xr("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,Mi(this,"providerId","password"),Mi(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){ji(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yi("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=sr(t=Kr(t)))&&t.operation===Ki?t:null}function fo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new Yi("internal-error");this.a=t,Mi(this,"providerId","phone"),Mi(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return M(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function vo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function mo(t){try{this.a=t||fl.auth()}catch(t){throw new Yi("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}ji(this,{providerId:"phone",isOAuthProvider:!1})}function go(t,e){if(!t)throw new Yi("missing-verification-id");if(!e)throw new Yi("missing-verification-code");return new fo({Va:t,Ua:e})}function bo(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,i=t&&t.oauthTokenSecret,r=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return ro(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,i);default:return n||i||o||a?a?0==e.indexOf("saml.")?new Br(e,a):new Xr(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Zr(e).credential({idToken:o,accessToken:n,rawNonce:r}):null}}catch(t){return null}}function yo(t){if(!t.isOAuthProvider)throw new Yi("invalid-oauth-provider")}function wo(t,e,n,i,r,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=i||null,this.i=o||null,this.h=a||null,this.a=r||null,!this.g&&!this.a)throw new Yi("invalid-auth-event");if(this.g&&this.a)throw new Yi("invalid-auth-event");if(this.g&&!this.f)throw new Yi("invalid-auth-event")}function Io(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&zi(t.error),t.postBody,t.tenantId):null}function To(){this.b=null,this.a=[]}k(Mr,xr),k(jr,Mr),k(Ur,Mr),k(Vr,Mr),k(Fr,Mr),Br.prototype.na=function(t){return za(t,Gr(this))},Br.prototype.b=function(t,e){var n=Gr(this);return n.idToken=e,$a(t,n)},Br.prototype.f=function(t,e){return Hr(Za(t,Gr(this)),e)},Br.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Xr.prototype.na=function(t){return za(t,Jr(this))},Xr.prototype.b=function(t,e){var n=Jr(this);return n.idToken=e,$a(t,n)},Xr.prototype.f=function(t,e){return Hr(Za(t,Jr(this)),e)},Xr.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},zr.prototype.Ga=function(t){return this.zb=W(t),this},k($r,zr),k(Zr,zr),Zr.prototype.ya=function(t){return V(this.a,t)||this.a.push(t),this},Zr.prototype.Hb=function(){return H(this.a)},Zr.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yi("argument-error","credential failed: must provide the ID token and/or the access token.");return new Xr(this.providerId,n,this.providerId)},k(Qr,Zr),Mi(Qr,"PROVIDER_ID","facebook.com"),Mi(Qr,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),k(eo,Zr),Mi(eo,"PROVIDER_ID","github.com"),Mi(eo,"GITHUB_SIGN_IN_METHOD","github.com"),k(io,Zr),Mi(io,"PROVIDER_ID","google.com"),Mi(io,"GOOGLE_SIGN_IN_METHOD","google.com"),k(oo,zr),Mi(oo,"PROVIDER_ID","twitter.com"),Mi(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Es,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,gs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Hr(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},ji(co,{PROVIDER_ID:"password"}),ji(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),ji(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Wa(vo(this))},fo.prototype.b=function(t,e){var n=vo(this);return n.idToken=e,Ns(t,As,n)},fo.prototype.f=function(t,e){var n=vo(this);return n.operation="REAUTH",Hr(t=Ns(t,Ss,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Wa=function(e,n){var i=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yi("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,vs,e)}(i,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yi("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},ji(mo,{PROVIDER_ID:"phone"}),ji(mo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Eo,ko=null;function Ao(t){var e="unauthorized-domain",n=void 0,i=In(t);t=i.b,"chrome-extension"==(i=i.f)?n=Lt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==i||"https"==i?n=Lt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yi.call(this,e,n)}function So(t,e,n){Yi.call(this,t,n),(t=e||{}).Ab&&Mi(this,"email",t.Ab),t.ba&&Mi(this,"phoneNumber",t.ba),t.credential&&Mi(this,"credential",t.credential),t.Qb&&Mi(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf($i)&&(e=e.substring($i.length));var n={credential:bo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yi(e,t.message||void 0);return new So(e,n,t.message)}return null}function Oo(){}function _o(t){return t.c||(t.c=t.b())}function Po(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var i=e[n];try{return new ActiveXObject(i),t.f=i}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Co(){}function Do(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=I(this.fc,this),this.a.onerror=I(this.Ib,this),this.a.onprogress=I(this.gc,this),this.a.ontimeout=I(this.kc,this)}function Lo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function xo(t,e,n){this.reset(t,e,n,void 0,void 0)}function Mo(t){this.f=t,this.b=this.c=this.a=null}function jo(t,e){this.name=t,this.value=e}k(Ao,Yi),k(So,Yi),So.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&J(t,e),t},So.prototype.toJSON=function(){return this.A()},Oo.prototype.c=null,k(Po,Oo),Po.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Po.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},Eo=new Po,k(Co,Oo),Co.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Do;throw Error("Unsupported browser")},Co.prototype.b=function(){return{}},(t=Do.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Lo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Lo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Lo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},xo.prototype.a=null,xo.prototype.reset=function(t,e,n,i,r){delete this.a},jo.prototype.toString=function(){return this.name};var Uo=new jo("SEVERE",1e3),Vo=new jo("WARNING",900),Fo=new jo("CONFIG",700),Ko=new jo("FINE",500);Mo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(O("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new xo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var qo,Ho={},Bo=null;function Go(t){var e;if(Bo||(Bo=new Mo(""),(Ho[""]=Bo).c=Fo),!(e=Ho[t])){e=new Mo(t);var n=t.lastIndexOf("."),i=t.substr(n+1);(n=Go(t.substr(0,n))).b||(n.b={}),(n.b[i]=e).a=n,Ho[t]=e}return e}function Wo(t,e){t&&t.log(Ko,e,void 0)}function Xo(t){this.f=t}function Jo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Go("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}k(Xo,Oo),Xo.prototype.a=function(){return new Jo(this.f)},Xo.prototype.b=(qo={},function(){return qo}),k(Jo,nn);var Yo=0;function zo(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function $o(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Zo(t)}function Zo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Qo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=Jo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Zo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,$o(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Zo(this)),this.a&&(this.readyState=3,Zo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,zo(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?$o(this,!0):Zo(this),3==this.readyState&&zo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,$o(this,!0))},t.hc=function(t){this.a&&(this.response=t,$o(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Vo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&$o(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Vo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Vo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},k(Qo,nn);var ta="";Qo.prototype.b=Go("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ia(e,t,n,i,r){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():Eo.a(),e.w=e.B?_o(e.B):_o(Eo),e.a.onreadystatechange=I(e.Lb,e);try{Wo(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Wo(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=i||"";var o=new ln(e.headers);r&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(v(t)||h(t))M(t,e,void 0);else for(var n=hn(t),i=cn(t),r=i.length,o=0;o<r;o++)e.call(void 0,i[o],n&&n[o],t)}(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=ra,n=t.length,i=h(t)?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t)){e=r;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),i=l.FormData&&t instanceof l.FormData,!V(na,n)||r||i||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Wo(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=I(e.Ia,e)):e.o=sn(e.Ia,e.g,e)),Wo(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Wo(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ra(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Wo(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Wo(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(t=i)){var r;if(r=0===n){var o=String(e.l).match(pn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}r=!ea.test(o?o.toLowerCase():"")}t=r}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Wo(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,i=e.w[0]?d:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=i}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function da(t){var e=ka;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function pa(t,e,n){t.a=!0,t.c=n,t.f=!e,ba(t)}function va(t){if(t.a){if(!t.u)throw new ya(t);t.u=!1}}function ma(t,e,n,i){t.g.push([e,n,i]),t.a&&ba(t)}function ga(t){return U(t.g,function(t){return m(t[1])})}function ba(e){if(e.h&&e.a&&ga(e)){var n=e.h,i=Ta[n];i&&(l.clearTimeout(i.a),delete Ta[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=i=!1;e.g.length&&!e.i;){var r=e.g.shift(),o=r[0],a=r[1];if(r=r[2],o=e.f?a:o)try{var s=o.call(r||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(A(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ga(e)||(i=!0)}}e.c=n,t&&(s=I(e.m,e,!0),t=I(e.m,e,!1),n instanceof da?(ma(n,s,t),n.w=!0):n.then(s,t)),i&&(n=new Ia(n),Ta[n.a]=n,e.h=n.a)}function ya(){S.call(this)}function wa(){S.call(this)}function Ia(t){this.a=l.setTimeout(I(this.c,this),0),this.b=t}(t=Qo.prototype).Ia=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Wo(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Wo(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Qo.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Wo(this.b,"Can not get response: "+t.message),null}},da.prototype.cancel=function(t){if(this.a)this.c instanceof da&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),va(this),pa(this,!1,t))}},da.prototype.m=function(t,e){this.i=!1,pa(this,t,e)},da.prototype.then=function(t,e,n){var i,r,o=new qt(function(t,e){i=t,r=e});return ma(this,i,function(t){t instanceof wa?o.cancel():r(t)}),o.then(t,e,n)},da.prototype.$goog_Thenable=!0,k(ya,S),ya.prototype.message="Deferred has already fired",ya.prototype.name="AlreadyCalledError",k(wa,S),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",Ia.prototype.c=function(){throw delete Ta[this.a],this.b};var Ta={};function Ea(t){var e,n=document,i=et(t).toString(),r=document.createElement("SCRIPT"),o={Nb:r,Ia:void 0},a=new da(o);return e=window.setTimeout(function(){Aa(r,!0);var t=new Oa(Na,"Timeout reached for loading script "+i);va(a),pa(a,!1,t)},5e3),o.Ia=e,r.onload=r.onreadystatechange=function(){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(Aa(r,!1,e),va(a),pa(a,!0,null))},r.onerror=function(){Aa(r,!0,e);var t=new Oa(Sa,"Error while loading script "+i);va(a),pa(a,!1,t)},J(o={},{type:"text/javascript",charset:"UTF-8"}),Kn(r,o),function(t,e){L(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(r,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(r),a}function ka(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Aa(t,!0,this.Ia)}}function Aa(t,e,n){null!=n&&l.clearTimeout(n),t.onload=d,t.onerror=d,t.onreadystatechange=d,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Sa=0,Na=1;function Oa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),S.call(this,n),this.code=t}function _a(t){this.f=t}function Pa(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Da,this.g=W(t.secureTokenHeaders||La),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||xa,this.a=W(t.firebaseHeaders||Ma),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ui(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!si())throw new Yi("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,si()?this.f=new Xo(self):ci()?this.f=new _a(n):this.f=new Co,this.b=null}k(Oa,S),k(_a,Oo),_a.prototype.a=function(){return new this.f},_a.prototype.b=function(){return{}};var Ra,Ca="idToken",Da=new Oi(3e4,6e4),La={"Content-Type":"application/x-www-form-urlencoded"},xa=new Oi(3e4,6e4),Ma={"Content-Type":"application/json"};function ja(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Va(t,e,n,i,r,o,a){(t=function(){var t=vi();return!((t=fi(t)!=li?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ae||9<Ae)}()||si()?I(t.o,t):(Ra=Ra||new qt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ka]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ma(t,null,e,void 0)}(Ea(nt(Fa,{onload:Ka})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),I(t.m,t)))(e,n,i,r,o,a)}Pa.prototype.R=function(){return this.b},Pa.prototype.o=function(t,n,e,i,r,o){if(si()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yi("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Qo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Wo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ia(a,t,e,i,r)};var Fa=new Y(Z,"https://apis.google.com/js/client.js?onload=%{onload}"),Ka="__fcb"+Math.floor(1e6*Math.random()).toString();function qa(t){if(!h(t=t.email)||!ii.test(t))throw new Yi("invalid-email")}function Ha(t){"email"in t&&qa(t)}function Ba(t){if(!t[Ca])throw new Yi("internal-error")}function Ga(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yi("internal-error")}else{if(!t.sessionInfo)throw new Yi("missing-verification-id");if(!t.code)throw new Yi("missing-verification-code")}}Pa.prototype.m=function(t,n,i,r,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:i,body:r,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Pa.prototype.ob=function(){return Ns(this,bs,{})},Pa.prototype.rb=function(t,e){return Ns(this,ms,{idToken:t,email:e})},Pa.prototype.sb=function(t,e){return Ns(this,gs,{idToken:t,password:e})};var Wa={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Xa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yi("internal-error")}function Ja(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=Os(t.errorMessage)),e)throw e;if(!t[Ca])throw new Yi("internal-error")}function za(t,e){return e.returnIdpCredential=!0,Ns(t,ys,e)}function $a(t,e){return e.returnIdpCredential=!0,Ns(t,Is,e)}function Za(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Qa(t){if(!t.oobCode)throw new Yi("invalid-action-code")}(t=Pa.prototype).tb=function(t,i){var r={idToken:t},o=[];return B(Wa,function(t,e){var n=i[e];null===n?o.push(t):e in i&&(r[e]=n)}),o.length&&(r.deleteAttribute=o),Ns(this,ms,r)},t.kb=function(t,e){return J(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return J(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return J(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Wa=function(t){return Ns(this,ks,t)},t.ab=function(t,e){return Ns(this,ps,{oobCode:t,newPassword:e})},t.Ma=function(t){return Ns(this,es,{oobCode:t})},t.Ya=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Qa,fa:"email",F:!0},es={endpoint:"resetPassword",D:Qa,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yi("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(qa(t),!t.password)throw new Yi("weak-password")},K:Ba,T:!0,F:!0},is={endpoint:"createAuthUri",F:!0},rs={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!p(t.deleteProvider))throw new Yi("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:qa,K:Ba,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:qa,K:Ba,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yi("internal-error");qa(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yi("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yi("internal-error");qa(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ds={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yi("internal-error")}},ps={endpoint:"resetPassword",D:Qa,fa:"email",F:!0},vs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ms={endpoint:"setAccountInfo",V:["idToken"],D:Ha,T:!0},gs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Ha(t),!t.password)throw new Yi("weak-password")},K:Ba,T:!0},bs={endpoint:"signupNewUser",K:Ba,T:!0,F:!0},ys={endpoint:"verifyAssertion",D:Xa,Ra:Ja,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Xa,Ra:Ja,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yi("user-not-found");if(t.errorMessage)throw Os(t.errorMessage);if(!t[Ca])throw new Yi("internal-error")},T:!0,F:!0},Is={endpoint:"verifyAssertion",D:function(t){if(Xa(t),!t.idToken)throw new Yi("internal-error")},Ra:Ja,K:Ya,T:!0},Ts={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yi("invalid-custom-token")},K:Ba,T:!0,F:!0},Es={endpoint:"verifyPassword",D:function(t){if(qa(t),!t.password)throw new Yi("wrong-password")},K:Ba,T:!0,F:!0},ks={endpoint:"verifyPhoneNumber",D:Ga,K:Ba,F:!0},As={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yi("internal-error");Ga(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Ba(t)}},Ss={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Ga,K:Ba,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var i=t[e[n]];if(null==i||""===i)return!1}return!0}(n,e.V))return zt(new Yi("internal-error"));var i,r=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,i,r,o,n){var a=In(t.h+e);yn(a,"key",t.c),n&&yn(a,"cb",E().toString());var s="GET"==i;if(s)for(var u in r)r.hasOwnProperty(u)&&yn(a,u,r[u]);return new qt(function(e,n){Va(t,a.toString(),function(t){t?t.error?n(_s(t,o||{})):e(t):n(new Yi("network-request-failed"))},i,s?void 0:Gn(Ei(r)),t.a,t.i.get())})}(t,e.endpoint,r,n,e.Yb,e.wb||!1)}).then(function(t){return i=t,e.Ra?e.Ra(n,i):i}).then(e.K).then(function(){if(!e.fa)return i;if(!(e.fa in i))throw new Yi("internal-error");return i[e.fa]})}function Os(t){return _s({error:{errors:[{message:t}],code:400,message:t}})}function _s(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",i={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=i[n]?new Yi(i[n]):null)return n;for(var r in n=t.error&&t.error.message||"",J(i={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,i)if(0===n.indexOf(r))return new Yi(i[r],e);return!e&&t&&(e=Ti(t)),new Yi("internal-error",e)}function Ps(t){this.b=t,this.a=null,this.gb=function(o){return(Ls=Ls||new qt(function(t,e){function n(){Ni(),mi("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Ni(),e(Error("Network Error"))},timeout:Cs.get()})}if(mi("gapi.iframes.Iframe"))t();else if(mi("gapi.load"))n();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[i]=function(){mi("gapi.load")?n():e(Error("Network Error"))},Yt(Ea(i=nt(Rs,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ls=null,t})).then(function(){return new qt(function(i,r){mi("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mi("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),i()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){r(Error("Network Error"))},Ds.get());t.ping(e).then(e,function(){r(Error("Network Error"))})})})})}(this)}var Rs=new Y(Z,"https://apis.google.com/js/api.js?onload=%{onload}"),Cs=new Oi(3e4,6e4),Ds=new Oi(5e3,15e3),Ls=null;function xs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Tn(this.i,"/__/auth/iframe"),yn(this.a,"apiKey",this.g),yn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ms(t,e,n,i,r){this.o=t,this.m=e,this.c=n,this.u=i,this.i=this.g=this.l=null,this.a=r,this.h=this.f=null}function js(t){try{return fl.app(t).auth().Ca()}catch(t){return[]}}function Us(t,e,n,i,r){this.u=t,this.f=e,this.b=n,this.c=i||null,this.h=r||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Vs(t){var s=$n();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=In(s),n=e.f;e=e.b;for(var i=0;i<t.length;i++){var r=t[i],o=e,a=n;if(o=0==r.indexOf("chrome-extension://")?In(r).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(ni.test(r)?o==r:(r=r.split(".").join("\\."),new RegExp("^(.+\\."+r+"|"+r+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Ao($n())})}function Fs(r){return r.l||(r.l=ri().then(function(){if(!r.o){var t=r.c,e=r.h,n=js(r.b),i=new xs(r.u,r.f,r.b);i.f=t,i.b=e,i.c=H(n||[]),r.o=i.toString()}r.i=new Ps(r.o),function(i){if(!i.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,mi("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(i.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=Io(t.authEvent),e=0;e<i.g.length;e++)n=i.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(r)})),r.l}function Ks(t){return t.m||(t.v=t.c?pi(t.c,js(t.b)):null,t.m=new Pa(t.f,Nr(t.h),t.v)),t.m}function qs(t,e,n,i,r,o,a,s,u,c,h){return(t=new Ms(t,e,n,i,r)).l=o,t.g=a,t.i=s,t.b=W(u||null),t.f=c,t.nb(h).toString()}function Hs(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yi("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Bs(t){this.b=t,this.a={},this.f=I(this.c,this)}xs.prototype.toString=function(){return this.f?yn(this.a,"v",this.f):Ln(this.a.a,"v"),this.b?yn(this.a,"eid",this.b):Ln(this.a.a,"eid"),this.c.length?yn(this.a,"fw",this.c.join(",")):Ln(this.a.a,"fw"),this.a.toString()},Ms.prototype.nb=function(t){return this.h=t,this},Ms.prototype.toString=function(){var t=Tn(this.o,"/__/auth/handler");if(yn(t,"apiKey",this.m),yn(t,"appName",this.c),yn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var i in e.bb=n,yn(t,"providerId",this.a.providerId),n=Ei((e=this.a).zb))n[i]=n[i].toString();i=e.Fc,n=W(n);for(var r=0;r<i.length;r++){var o=i[r];o in n&&delete n[o]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),G(n)||yn(t,"customParameters",Ti(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&yn(t,"scopes",e.join(","))),this.l?yn(t,"redirectUrl",this.l):Ln(t.a,"redirectUrl"),this.g?yn(t,"eventId",this.g):Ln(t.a,"eventId"),this.i?yn(t,"v",this.i):Ln(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&yn(t,a,this.b[a]);return this.h?yn(t,"tid",this.h):Ln(t.a,"tid"),this.f?yn(t,"eid",this.f):Ln(t.a,"eid"),(a=js(this.c)).length&&yn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var i=new Yi("popup-closed-by-user"),r=new Yi("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return Fs(t).then(function(){return function(e,n){return e.gb.then(function(){return new qt(function(t){e.a.send(n.type,n,t,mi("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&ti(e),n(r),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new qt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(i)})})},t.Ob=function(){var t=vi();return!Ii(t)&&!Si(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,i,r,o,a,s){if(!e)return zt(new Yi("popup-blocked"));if(a&&!Ii())return this.ia().s(function(t){ti(e),r(t)}),i(),Yt();this.a||(this.a=Vs(Ks(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw ti(e),r(t),t});return i(),t}).then(function(){yo(n),a||Zn(qs(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,i){this.a||(this.a=Vs(Ks(this)));var r=this;return this.a.then(function(){yo(e),Zn(qs(r.u,r.f,r.b,t,e,$n(),n,r.c,void 0,r.h,i))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ia=function(){var t=this;return Fs(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Yi("network-request-failed")})},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(e){K(this.g,function(t){return t==e})},(t=Hs.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&ki(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Ti(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Gs,Ws=[];function Xs(t,e,n){G(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Js(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function zs(i,t,e,n){var r,o,a,s,u=e||{},c=null;if(i.b)return zt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new qt(function(e,n){l?(r=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===r&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},i.a.push(c),l.port1.addEventListener("message",o),i.c.postMessage({eventType:t,eventId:r,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return $s(i,c),t}).s(function(t){throw $s(i,c),t})}function $s(t,e){if(e){var n=e.messageChannel,i=e.onMessage;n&&(n.port1.removeEventListener("message",i),n.port1.close()),K(t.a,function(t){return t==e})}}function Zs(){if(!eu())throw new Yi("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var i=this;si()&&self?(this.l=function(){var e=si()?self:null;if(M(Ws,function(t){t.b==e&&(n=t)}),!n){var n=new Bs(e);Ws.push(n)}return n}(),Xs(this.l,"keyChanged",function(t,n){return au(i).then(function(e){return 0<e.length&&M(i.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Xs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(i.h=t)&&(i.g=new Ys(new Js(t)),zs(i.g,"ping",null,!0).then(function(t){t[0].fulfilled&&V(t[0].value,"keyChanged")&&(i.o=!0)}).s(function(){}))})}function Qs(i){return new qt(function(e,n){var t=i.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(i){return new qt(function(t,e){var n=i.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(i).then(function(){return Qs(i)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Qs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function iu(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function ru(t){return new qt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?zs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(i){return tu(i).then(function(t){var r=nu(iu(t,!1));return r.getAll?ru(r.getAll()):new qt(function(e,n){var i=[],t=r.openCursor();t.onsuccess=function(t){(t=t.target.result)?(i.push(t.value),t.continue()):e(i)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==i.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var i,r=[];for(i in e)i in n?typeof e[i]!=typeof n[i]?r.push(i):"object"==typeof e[i]&&null!=e[i]&&null!=n[i]?0<t(e[i],n[i]).length&&r.push(i):e[i]!==n[i]&&r.push(i):r.push(i);for(i in n)i in e||r.push(i);return r}(i.c,e),i.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var i=this,r=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ai(),n="__sak"+e;return Gs=Gs||new Zs,(r=Gs).set(n,e).then(function(){return r.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return r.S(n)}).then(function(){return r}).s(function(){return i.c})}return i.c}).then(function(t){return i.type=t.type,t.$(function(e){M(i.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ui();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ui())throw new Yi("internal-error","The LocalStorage compatibility library was not found.");throw new Yi("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ai();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function du(){if(!function(){var t="Node"==ui();if(!(t=pu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ui())throw new Yi("internal-error","The SessionStorage compatibility library was not found.");throw new Yi("web-storage-unsupported")}this.a=pu()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function pu(){try{var t=l.sessionStorage,e=Ai();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function vu(){var t={};t.Browser=bu,t.Node=yu,t.ReactNative=wu,t.Worker=Iu,this.a=t[ui()]}Bs.prototype.c=function(n){var i=n.data.eventType,r=n.data.eventId,t=this.a[i];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:r,eventType:i,response:null});var e=[];M(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),Zt(e).then(function(t){var e=[];M(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),M(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:e})})}},Js.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)$s(this,this.a[0]);this.b=!0},(t=Zs.prototype).set=function(n,i){var r,o=!1,a=this;return tu(this).then(function(t){return ru((t=nu(iu(r=t,!0))).get(n))}).then(function(t){var e=nu(iu(r,!0));return t?(t.value=i,ru(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=i,ru(e.add(t)))}).then(function(){return a.c[n]=i,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return ru(nu(iu(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,i=this;return tu(this).then(function(t){return n=!0,i.b++,ru(nu(iu(t,!0)).delete(e))}).then(function(){return delete i.c[e],ou(i,e)}).ka(function(){n&&i.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&M(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){K(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){K(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return ki(e.a.getItem(t))})},t.set=function(e,n){var i=this;return Yt().then(function(){var t=Ti(n);null===t?i.S(e):i.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Be(l.window,"storage",t)},t.ea=function(t){l.window&&Xe(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=du.prototype).get=function(t){var e=this;return Yt().then(function(){return ki(e.a.getItem(t))})},t.set=function(e,n){var i=this;return Yt().then(function(){var t=Ti(n);null===t?i.S(e):i.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var mu,gu,bu={C:hu,Ta:du},yu={C:hu,Ta:du},wu={C:Hs,Ta:fu},Iu={C:hu,Ta:fu},Tu={ad:"local",NONE:"none",cd:"session"};function Eu(){var t=!(Si(vi())||!ai()),e=Ii(),n=gi();this.m=t,this.h=e,this.l=n,this.a={},t=mu=mu||new vu;try{this.g=!zn()&&Ri()||!l.indexedDB?new t.a.C:new uu(si()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new cu}this.u=new cu,this.f=I(this.Pb,this),this.b={}}function ku(){return gu=gu||new Eu}function Au(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Su(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Su(e,n),"local"==e.C&&(t.b[n]=null),Au(t,e.C).S(n)}function Ou(t){t.c&&(clearInterval(t.c),t.c=null)}function _u(t){this.a=t,this.b=ku()}(t=Eu.prototype).get=function(t,e){return Au(this,t.C).get(Su(t,e))},t.set=function(e,t,n){var i=Su(e,n),r=this,o=Au(this,e.C);return o.set(i,t).then(function(){return o.get(i)}).then(function(t){"local"==e.C&&(r.b[i]=t)})},t.addListener=function(t,e,n){t=Su(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),G(this.a)&&(Au(this,"local").$(this.f),this.h||(zn()||!Ri())&&l.indexedDB||!this.l||function(i){Ou(i),i.c=setInterval(function(){for(var t in i.a){var e=l.localStorage.getItem(t),n=i.b[t];e!=n&&(i.b[t]=e,e=new De({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),i.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Su(t,e),this.a[t]&&(K(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),G(this.a)&&(Au(this,"local").ea(this.f),Ou(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var i=this.b[n];void 0===i&&(i=null);var r=l.localStorage.getItem(n);r!==i&&(this.b[n]=r,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Au(this,"local").ea(this.f):Ou(this),this.m)if(n=l.localStorage.getItem(e),(i=t.a.newValue)!==n)null!==i?l.localStorage.setItem(e,i):l.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.$a(e))},me&&Ae&&10==Ae&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else M(t,I(this.$a,this))},t.$a=function(t){this.a[t]&&M(this.a[t],function(t){t()})};var Pu,Ru={name:"authEvent",C:"local"};function Cu(){this.a=ku()}function Du(t,e){this.b=Lu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Pu||(Pu=l.Int32Array?new Int32Array(Ku):Ku),this.reset()}k(Du,function(){this.b=-1});for(var Lu=64,xu=Lu-1,Mu=[],ju=0;ju<xu;ju++)Mu[ju]=0;var Uu=q(128,Mu);function Vu(t){for(var e=t.f,n=t.l,i=0,r=0;r<e.length;)n[i++]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r=4*i;for(e=16;e<64;e++){r=0|n[e-15],i=0|n[e-2];var o=(0|n[e-16])+((r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3)|0,a=(0|n[e-7])+((i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)|0;n[e]=o+a|0}i=0|t.a[0],r=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&r^i&s^r&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Pu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=r,r=i,i=a+f|0}t.a[0]=t.a[0]+i|0,t.a[1]=t.a[1]+r|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Fu(t,e,n){void 0===n&&(n=e.length);var i=0,r=t.c;if(h(e))for(;i<n;)t.f[r++]=e.charCodeAt(i++),r==t.b&&(Vu(t),r=0);else{if(!v(e))throw Error("message must be string or array");for(;i<n;){var o=e[i++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[r++]=o,r==t.b&&(Vu(t),r=0)}}t.c=r,t.g+=n}Du.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):H(this.h)};var Ku=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function qu(){Du.call(this,8,Hu)}k(qu,Du);var Hu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Bu(t,e,n,i,r){this.u=t,this.i=e,this.l=n,this.m=i||null,this.o=r||null,this.h=e+":"+n,this.v=new Cu,this.g=new _u(this.h),this.f=null,this.b=[],this.a=this.c=null}function Gu(t){return new Yi("invalid-cordova-configuration",t)}function Wu(t){var e=new qu;Fu(e,t),t=[];var n=8*e.g;e.c<56?Fu(e,Uu,56-e.c):Fu(e,Uu,e.b-(e.c-56));for(var i=63;56<=i;i--)e.f[i]=255&n,n/=256;for(Vu(e),i=n=0;i<e.i;i++)for(var r=24;0<=r;r-=8)t[n++]=e.a[i]>>r&255;return function(t){return j(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Xu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Ju(i){return i.f||(i.f=i.ia().then(function(){return new qt(function(n){i.Aa(function t(e){return n(e),i.Na(t),!1}),function(r){function e(i){t=!0,n&&n.cancel(),Yu(r).then(function(t){var e=o;if(t&&i&&i.url){var n=null;-1!=(e=Kr(i.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=ki(wn(n=In(e),"firebaseError")||null))?zi(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Xu(r,e)})}var o=new wo("unknown",null,null,null,new Yi("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(r).then(function(){t||Xu(r,o)})}),i=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mi("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof i)try{i(t)}catch(t){console.error(t)}},ko=ko||new To,function(t){var n=ko;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mi("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(i)})})),i.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return Io(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function zu(t){this.a=t,this.b=ku()}(t=Bu.prototype).ia=function(){return this.Da?this.Da:this.Da=(oi(void 0)?ri().then(function(){return new qt(function(t,e){var n=l.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):zt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mi("universalLinks.subscribe",l))throw Gu("cordova-universal-links-plugin-fix is not installed");if(void 0===mi("BuildInfo.packageName",l))throw Gu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mi("cordova.plugins.browsertab.openUrl",l))throw Gu("cordova-plugin-browsertab is not installed");if("function"!=typeof mi("cordova.InAppBrowser.open",l))throw Gu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yi("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yi("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return zt(new Yi("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,i){if(this.c)return zt(new Yi("redirect-operation-pending"));var r=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return yo(e),Ju(r)}).then(function(){return function(n,t,e,i,r){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,i,null,o,new Yi("no-auth-event"),null,r),s=mi("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yi("invalid-cordova-configuration");var u=mi("BuildInfo.displayName",l),c={};if(vi().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!vi().toLowerCase().match(/android/))return zt(new Yi("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Wu(o),c.sessionId=o;var h=qs(n.u,n.i,n.l,t,e,null,i,n.m,c,n.o,r);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=mi("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yi("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mi("cordova.plugins.browsertab.openUrl",l)))throw new Yi("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=mi("cordova.InAppBrowser.open",l)))throw new Yi("invalid-cordova-configuration");t=vi(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n,i)}).then(function(){return new qt(function(e,t){s=function(){var t=mi("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.Aa(s),u=function(){a=a||un(2e3).then(function(){t(new Yi("redirect-cancelled-by-user"))})},c=function(){_i()&&u()},o.addEventListener("resume",u,!1),vi().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(r).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&r.Na(s),r.c=null})},t.Aa=function(e){this.b.push(e),Ju(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yi("no-auth-event")),e(t))})},t.Na=function(e){K(this.b,function(t){return t==e})};var $u={name:"pendingRedirect",C:"session"};function Zu(t){return Nu(t.b,$u,t.a)}function Qu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=I(this.o,this),this.b=new dc,this.w=new bc,this.g=new zu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ar)}function tc(t,e,n,i){var r=fl.SDK_VERSION||null;return oi()?new Bu(t,e,n,r,i):new Us(t,e,n,r,i)}function ec(e){e.f||(e.f=!0,e.a.Aa(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yi("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||pc(n.b)}function ic(n,t){V(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get($u,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?Zu(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yi("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function rc(t,e){K(t.h,function(t){return t==e})}Qu.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Qu.prototype.o=function(t){if(!t)throw new Yi("invalid-auth-event");if(6e5<=E()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var i=this.h[n];if(i.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,i),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=E())),e=!0;break}}return pc(this.b),e};var oc=new Oi(2e3,1e4),ac=new Oi(3e4,6e4);function sc(t,e,n,i,r,o,a){return t.a.Db(e,n,i,function(){t.f||(t.f=!0,t.a.Aa(t.l))},function(){t.reset()},r,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,i,r){var o;return function(t){return t.b.set($u,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,i,r).s(function(t){if(uc(t))throw new Yi("operation-not-supported-in-this-environment");return o=t,Zu(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new qt(function(){}):Zu(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,i,r){return t.a.Fb(i,function(t){e.ja(n,null,t,r)},oc.get())}Qu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var i=e+":"+n;return lc[i]||(lc[i]=new Qu(t,e,n)),lc[i]}function dc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function pc(t){t.g||(t.g=!0,gc(t,!1,null,null))}function vc(t){t.g&&!t.i&&gc(t,!1,null,null)}function mc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function gc(t,e,n,i){e?i?function(t,e){if(t.b=function(){return zt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,i):mc(t,n):mc(t,{user:null}),t.f=[],t.c=[]}function bc(){}function yc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,Mi(this,"verificationId",t)}function Ic(t,e,n,i){return new mo(t).Wa(e,n).then(function(t){return new wc(t,i)})}function Tc(t){var e=kr(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yi("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");ji(this,{token:t,expirationTime:Pi(1e3*e.exp),authTime:Pi(1e3*e.auth_time),issuedAtTime:Pi(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Ec(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function kc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ac(t){this.f=t,this.b=this.a=null,this.c=0}function Sc(t,e){var n=e[Ca],i=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=i}function Nc(t){return E()+1e3*parseInt(t,10)}function Oc(e,t){return function(t,i){return new qt(function(e,n){"refresh_token"==i.grant_type&&i.refresh_token||"authorization_code"==i.grant_type&&i.code?Va(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(_s(t)):t.access_token&&t.refresh_token?e(t):n(new Yi("internal-error")):n(new Yi("network-request-failed"))},"POST",Dn(i).toString(),t.g,t.u.get()):n(new Yi("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function _c(t,e){this.a=t||null,this.b=e||null,ji(this,{lastSignInTime:Pi(e||null),creationTime:Pi(t||null)})}function Pc(t,e,n,i,r,o){ji(this,{uid:t,displayName:i||null,photoURL:r||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Ce.call(this,t),e)this[n]=e[n]}function Cc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?pi(fl.SDK_VERSION):null,this.a=new Pa(this.l,Nr(Ar),t),this.b=new Ac(this.a),Vc(this,e[Ca]),Sc(this.b,e),Mi(this,"refreshToken",this.b.a),qc(this,n||{}),nn.call(this),this.J=!1,this.o&&bi()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Ec(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-E()-3e5;return 0<t?t:0})}(this),this.W=I(this.Ja,this);var i=this;this.ga=null,this.xa=function(t){i.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Lc(i,t.c)},this.Y=null}function Dc(t,e){t.Z&&Xe(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&Be(e,"languageCodeChanged",t.xa)}function Lc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?pi(fl.SDK_VERSION,t.P):null)}function xc(t,e){t.Y&&Xe(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&Be(e,"frameworkChanged",t.wa)}function Mc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yi("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function jc(t){t.B||t.w.b||(t.w.start(),Xe(t,"tokenChanged",t.W),Be(t,"tokenChanged",t.W))}function Uc(t){Xe(t,"tokenChanged",t.W),t.w.stop()}function Vc(t,e){t.ma=e,Mi(t,"_lat",e)}function Fc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return Zt(e).then(function(){return t})}function Kc(t){t.i&&!t.J&&(t.J=!0,ic(t.i,t))}function qc(t,e){ji(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new _c(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Hc(){}function Bc(t){return Yt().then(function(){if(t.B)throw new Yi("app-deleted")})}function Gc(t){return j(t.providerData,function(t){return t.providerId})}function Wc(t,e){e&&(Xc(t,e.providerId),t.providerData.push(e))}function Xc(t,e){K(t.providerData,function(t){return t.providerId==e})}function Jc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Mi(t,e,n)}function Yc(e,t){e!=t&&(ji(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Mi(e,"metadata",function(t){return new _c(t.a,t.b)}(t.metadata)):Mi(e,"metadata",new _c),M(t.providerData,function(t){Wc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),Mi(e,"refreshToken",e.b.a))}function zc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(I(t.zc,t))}(n,t).then(function(){return e||Jc(n,"isAnonymous",!1),t})})}function $c(t,e){e[Ca]&&t.ma!=e[Ca]&&(Sc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),Vc(t,e[Ca]),Jc(t,"refreshToken",t.b.a))}function Zc(t,e){return zc(t).then(function(){if(V(Gc(t),e))return Fc(t).then(function(){throw new Yi("provider-already-linked")})})}function Qc(t,e,n){return Ui({user:t,credential:bo(e),additionalUserInfo:e=Cr(e),operationType:n})}function th(t,e){return $c(t,e),t.reload().then(function(){return t})}function eh(n,i,t,e,r){if(!bi())return zt(new Yi("operation-not-supported-in-this-environment"));if(n.h&&!r)return zt(n.h);var o=Rr(t.providerId),a=Ai(n.uid+":::"),s=null;(!Ii()||ai())&&n.o&&t.isOAuthProvider&&(s=qs(n.o,n.l,n.m,i,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=ei(s,o&&o.sa,o&&o.ra);return e=e().then(function(){if(ih(n),!r)return n.G().then(function(){})}).then(function(){return sc(n.i,u,i,t,a,!!s,n.tenantId)}).then(function(){return new qt(function(t,e){n.ja(i,null,new Yi("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,i,u,a)})}).then(function(t){return u&&ti(u),t?Ui(t):null}).s(function(t){throw u&&ti(u),t}),rh(n,e,r)}function nh(e,t,n,i,r){if(!bi())return zt(new Yi("operation-not-supported-in-this-environment"));if(e.h&&!r)return zt(e.h);var o=null,a=Ai(e.uid+":::");return i=i().then(function(){if(ih(e),!r)return e.G().then(function(){})}).then(function(){return e.ca=a,Fc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),rh(e,i,r)}function ih(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yi("internal-error");throw new Yi("auth-domain-config-required")}}function rh(t,e,n){var i=function(e,t,n){return e.h&&!n?(t.cancel(),zt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(i),i.ka(function(){F(t.I,i)}),i}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ca]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-E())/1e3;var i=new Cc(e,n,t);return t.providerData&&M(t.providerData,function(t){t&&Wc(i,Ui(t))}),t.redirectEventId&&(i.ca=t.redirectEventId),i}function ah(t){this.a=t,this.b=ku()}dc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},dc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,i=t.b,r=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!r&&!o),"unknown"!=n||r||o?t.a?(gc(this,!0,null,t.a),Yt()):e.Ba(n,i)?function(e,t,n){n=n.Ba(t.c,t.b);var i=t.g,r=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(i,r,a,o).then(function(t){gc(e,s,t,null)}).s(function(t){gc(e,s,null,t)})}(this,t,e):zt(new Yi("invalid-auth-event")):(gc(this,!1,null,null),Yt())}else zt(new Yi("invalid-auth-event"))},dc.prototype.oa=function(){var n=this;return new qt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yi("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,gc(t,!0,null,e))})}(n))})},bc.prototype.h=function(t,e){if(t){var n=t.c,i=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.Ba(n,i)?function(t,e){var n=t.b,i=t.c;e.Ba(i,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(i,t,null,n)}).s(function(t){e.ja(i,null,t,n)})}(t,e):zt(new Yi("invalid-auth-event"))}else zt(new Yi("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=go(this.verificationId,t),this.a(t)},Ec.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(kc(n,t)).then(function(){return e=l.document,n=null,_i()||!e?Yt():new qt(function(t){n=function(){_i()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Ec.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ac.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ac.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?zt(new Yi("user-token-expired")):t||!this.b||E()>this.c-3e4?this.a?Oc(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},_c.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},k(Rc,Ce),k(Cc,nn),Cc.prototype.ua=function(t){this.ga=t,ja(this.a,t)},Cc.prototype.ha=function(){return this.ga},Cc.prototype.Ca=function(){return H(this.P)},Cc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},Mi(Cc.prototype,"providerId","firebase"),(t=Cc.prototype).reload=function(){var t=this;return rh(this,Bc(this).then(function(){return zc(t).then(function(){return Fc(t)}).then(Hc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Tc(t)})},t.G=function(t){var e=this;return rh(this,Bc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yi("internal-error");return t.accessToken!=e.ma&&(Vc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),Jc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yi("internal-error");qc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?j(t,function(t){return new Pc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Wc(this,e[n]);Jc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Li("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return rh(this,t.f(this.a,this.uid).then(function(t){return $c(e,t),n=Qc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Li("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(e){var n=this,i=null;return rh(this,Zc(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return i=Qc(n,t,"link"),th(n,t)}).then(function(){return i}))},t.sc=function(t,e){var n=this;return rh(this,Zc(this,"phone").then(function(){return Ic(Mc(n),t,e,I(n.fb,n))}))},t.Bc=function(t,e){var n=this;return rh(this,Yt().then(function(){return Ic(Mc(n),t,e,I(n.hb,n))}),!0)},t.rb=function(e){var n=this;return rh(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return $c(n,t),n.reload()}))},t.Sc=function(e){var n=this;return rh(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return $c(n,t),n.reload()}))},t.sb=function(e){var n=this;return rh(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return $c(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Bc(this);var n=this;return rh(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return $c(n,t),Jc(n,"displayName",t.displayName||null),Jc(n,"photoURL",t.photoUrl||null),M(n.providerData,function(t){"password"===t.providerId&&(Mi(t,"displayName",n.displayName),Mi(t,"photoURL",n.photoURL))}),Fc(n)}).then(Hc))},t.Qc=function(e){var n=this;return rh(this,zc(this).then(function(t){return V(Gc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return M(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),M(Gc(n),function(t){e[t]||Xc(n,t)}),e[mo.PROVIDER_ID]||Mi(n,"phoneNumber",null),Fc(n)}):Fc(n).then(function(){throw new Yi("no-such-provider")})}))},t.delete=function(){var e=this;return rh(this,this.G().then(function(t){return Ns(e.a,rs,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Dc(e,null),xc(e,null),e.I=[],e.B=!0,Uc(e),Mi(e,"refreshToken",null),e.i&&rc(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,i){"linkViaPopup"!=t&&"reauthViaPopup"!=t||i!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?I(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?I(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?I(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?I(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return Zc(e,t.providerId).then(function(){return Fc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return Zc(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return $a(r.a,{requestUri:e,postBody:i,sessionId:n,idToken:t})}).then(function(t){return o=Qc(r,t,"link"),th(r,t)}).then(function(){return o}),rh(this,t)},t.Cb=function(t,e,n,i){var r=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return rh(this,Yt().then(function(){return Hr(Za(r.a,{requestUri:t,sessionId:e,postBody:i,tenantId:n}),r.uid)}).then(function(t){return o=Qc(r,t,"reauthenticate"),$c(r,t),r.h=null,r.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,i=null;return rh(this,this.G().then(function(t){return i=t,void 0===e||G(e)?{}:br(new ur(e))}).then(function(t){return n.a.jb(i,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&J(e,this.metadata.A()),M(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=ku(),this.c=null,this.f=function(e){var n=fh("local"),i=fh("session"),r=fh("none");return function(n,i,r){var o=Su(i,r),a=Au(n,i.C);return n.get(i,r).then(function(t){var e=null;try{e=ki(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(i,e,r);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(i,e.a)}).then(function(t){return t?i:e.b.get(r,e.a).then(function(t){return t?r:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,I(this.g,this))}function hh(t,e){var n,i=[];for(n in Tu)Tu[n]!==e&&i.push(Nu(t.b,fh(Tu[n]),t.a));return i.push(Nu(t.b,lh,t.a)),function(s){return new qt(function(n,e){var i=s.length,r=[];if(i)for(var t=function(t,e){i--,r[t]=e,0==i&&n(r)},o=function(t){e(t)},a=0;a<s.length;a++)$t(s[a],T(t,a),o);else n(r)})}(i)}ch.prototype.g=function(){var e=this,n=fh("local");mh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function dh(t,e){return mh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function ph(t){return mh(t,function(){return Nu(t.b,t.c,t.a)})}function vh(t,e){return mh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function mh(t,e){return t.f=t.f.then(e,e),t.f}function gh(t){if(this.l=!1,Mi(this,"settings",new yc),Mi(this,"app",t),!Ah(this).options||!Ah(this).options.apiKey)throw new Yi("invalid-api-key");t=fl.SDK_VERSION?pi(fl.SDK_VERSION):null,this.b=new Pa(Ah(this).options&&Ah(this).options.apiKey,Nr(Ar),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(I(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(I(this.pc,this)),Eh(this,null),this.h=new ch(Ah(this).options.apiKey+":"+Ah(this).name),this.w=new ah(Ah(this).options.apiKey+":"+Ah(this).name),this.Y=_h(this,function(n){var t=Ah(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ah(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return _h(e,t)}(n).then(function(){return vh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return dh(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:ph(n.h)})):null}).then(function(t){Eh(n,t||null)});return _h(n,e)}(this)),this.i=_h(this,function(e){return e.Y.then(function(){return Ih(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=I(this.Nc,this),this.ub=I(this.aa,this),this.wa=I(this.bc,this),this.xa=I(this.mc,this),this.Ja=I(this.nc,this),this.a=null,function(e){var n=Ah(e).options.authDomain,i=Ah(e).options.apiKey;n&&bi()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,i,Ah(e).name),ic(e.a,e),Sh(e)&&Kc(Sh(e)),e.B){Kc(e.B);var t=e.B;t.ua(e.ha()),Dc(t,e),Lc(t=e.B,e.I),xc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=I(this.delete,this),this.INTERNAL.logFramework=I(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function bh(t){Ce.call(this,"languageCodeChanged"),this.g=t}function yh(t){Ce.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||zt(new Yi("auth-domain-config-required"))}function Ih(t){if(!bi())return zt(new Yi("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ui(t):null});return _h(t,e)}function Th(e,t){var n={};return n.apiKey=Ah(e).options.apiKey,n.authDomain=Ah(e).options.authDomain,n.appName=Ah(e).name,e.Y.then(function(){return function(t,e,n,i){var r=new Cc(t,e);return n&&(r.da=n),i&&Lc(r,i),r.reload().then(function(){return r})}(n,t,e.w,e.Ca())}).then(function(t){return Sh(e)&&t.uid==Sh(e).uid?Yc(Sh(e),t):(Eh(e,t),Kc(t)),e.aa(t)}).then(function(){Oh(e)})}function Eh(t,e){Sh(t)&&(function(t,e){K(t.O,function(t){return t==e})}(Sh(t),t.ub),Xe(Sh(t),"tokenChanged",t.wa),Xe(Sh(t),"userDeleted",t.xa),Xe(Sh(t),"userInvalidated",t.Ja),Uc(Sh(t))),e&&(e.O.push(t.ub),Be(e,"tokenChanged",t.wa),Be(e,"userDeleted",t.xa),Be(e,"userInvalidated",t.Ja),0<t.o&&jc(e)),Mi(t,"currentUser",e),e&&(e.ua(t.ha()),Dc(e,t),Lc(e,t.I),xc(e,t))}function kh(e,t){var n=null,i=null;return _h(e,t.then(function(t){return n=bo(t),i=Cr(t),Th(e,t)}).then(function(){return Ui({user:Sh(e),credential:n,additionalUserInfo:i,operationType:"signIn"})}))}function Ah(t){return t.app}function Sh(t){return t.currentUser}function Nh(t){return Sh(t)&&Sh(t)._lat||null}function Oh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function _h(t,e){return t.O.push(e),e.ka(function(){F(t.O,e)}),e}function Ph(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,i=this;return function(t){var e=new Yi("invalid-persistence-type"),n=new Yi("unsupported-persistence-type");t:{for(i in Tu)if(Tu[i]==t){var i=!0;break t}i=!1}if(!i||"string"!=typeof t)throw e;switch(ui()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gi()&&"none"!==t)throw n}}(e),mh(this,function(){return e!=i.c.C?i.b.get(i.c,i.a).then(function(t){return n=t,hh(i,e)}).then(function(){if(i.c=fh(e),n)return i.b.set(i.c,n,i.a)}):Yt()})},k(gh,nn),k(bh,Ce),k(yh,Ce),(t=gh.prototype).mb=function(t){return t=this.h.mb(t),_h(this,t)},t.ua=function(t){this.Z===t||this.l||(this.Z=t,ja(this.b,this.Z),this.dispatchEvent(new bh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?pi(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new yh(this.I))},t.Ca=function(){return H(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ah(this).options.apiKey,authDomain:Ah(this).options.authDomain,appName:Ah(this).name,currentUser:Sh(this)&&Sh(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,i){"signInViaPopup"==t&&this.g==i&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?I(this.ac,this):null},t.ac=function(t,e,n,i){var r=this;t={requestUri:t,postBody:i,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=za(r.b,t).then(function(t){return o=bo(t),a=Cr(t),t});return _h(this,t=r.Y.then(function(){return s}).then(function(t){return Th(r,t)}).then(function(){return Ui({user:Sh(r),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!bi())return zt(new Yi("operation-not-supported-in-this-environment"));var n=this,t=Rr(e.providerId),i=Ai(),r=null;(!Ii()||ai())&&Ah(this).options.authDomain&&e.isOAuthProvider&&(r=qs(Ah(this).options.authDomain,Ah(this).options.apiKey,Ah(this).name,"signInViaPopup",e,null,i,fl.SDK_VERSION||null,null,null,this.R()));var o=ei(r,t&&t.sa,t&&t.ra);return _h(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,i,!!r,n.R())}).then(function(){return new qt(function(t,e){n.ja("signInViaPopup",null,new Yi("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=i,n.c=hc(n.a,n,"signInViaPopup",o,i)})}).then(function(t){return o&&ti(o),t?Ui(t):null}).s(function(t){throw o&&ti(o),t}))},t.Mc=function(t){if(!bi())return zt(new Yi("operation-not-supported-in-this-environment"));var e=this;return _h(this,wh(this).then(function(){return function(t){return mh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return Ih(this).then(function(t){return e.a&&vc(e.a.b),t}).s(function(t){throw e.a&&vc(e.a.b),t})},t.Rc=function(t){if(!t)return zt(new Yi("null-user"));if(this.P!=t.tenantId)return zt(new Yi("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ah(this).options.apiKey,n.authDomain=Ah(this).options.authDomain,n.appName=Ah(this).name;var i=function(t,e,n,i){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var r=t.b,o={};return o[Ca]=r.b,o.refreshToken=r.a,o.expiresIn=(r.c-E())/1e3,e=new Cc(e,o),n&&(e.da=n),i&&Lc(e,i),Yc(e,t),e}(t,n,e.w,e.Ca());return _h(this,this.i.then(function(){if(Ah(e).options.apiKey!=t.l)return i.reload()}).then(function(){return Sh(e)&&t.uid==Sh(e).uid?(Yc(Sh(e),t),e.aa(t)):(Eh(e,i),Kc(i),e.aa(i))}).then(function(){Oh(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&vc(t.a.b),Sh(t)?(Eh(t,null),ph(t.h).then(function(){Oh(t)})):Yt()});return _h(this,e)},t.Nc=function(){var i=this;return vh(this.h,Ah(this).options.authDomain).then(function(t){if(!i.l){var e;if(e=Sh(i)&&t){e=Sh(i).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Sh(i),t),Sh(i).G();(Sh(i)||t)&&(Eh(i,t),t&&(Kc(t),t.da=i.w),i.a&&ic(i.a,i),Oh(i))}})},t.aa=function(t){return dh(this.h,t)},t.bc=function(){Oh(this),this.aa(Sh(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Sh(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),_h(t,t.i.then(function(){!t.l&&V(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Sh(e))})},t.xc=function(t,e,n){var i=this;return this.ga&&Promise.resolve().then(function(){m(t)?t(Sh(i)):m(t.next)&&t.next(Sh(i))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var i=this;return this.ga&&Promise.resolve().then(function(){i.W=i.getUid(),m(t)?t(Sh(i)):m(t.next)&&t.next(Sh(i))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Sh(e)?Sh(e).G(t).then(function(t){return{accessToken:t}}):null});return _h(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return kh(n,Ns(n.b,Ts,{token:t}))}).then(function(t){var e=t.user;return Jc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return kh(n,Ns(n.b,Es,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return kh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Sa=function(t){var e=this;return this.i.then(function(){return kh(e,t.na(e.b))})},t.Gc=function(t){return Li("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Sh(n);return t&&t.isAnonymous?Ui({user:t,credential:null,additionalUserInfo:Ui({providerId:null,isNewUser:!1}),operationType:"signIn"}):kh(n,n.b.ob()).then(function(t){var e=t.user;return Jc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Sh(this)&&Sh(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Sh(this)&&jc(Sh(this))},t.Ec=function(e){var n=this;M(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Sh(this)&&Uc(Sh(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),_h(this,this.i.then(function(){e.l||V(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){K(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(rc(this.a,this),vc(this.a.b)),Promise.resolve()},t.$b=function(t){return _h(this,function(t,e){return Ns(t,is,{identifier:e,continueUri:yi()?$n():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var i=this;return _h(this,Yt().then(function(){var t=new ur(n);if(!t.c)throw new Yi("argument-error",lr+" must be true when sending sign in link to email");return br(t)}).then(function(t){return i.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ma(t).then(function(t){return t.data.email})},t.ab=function(t,e){return _h(this,this.b.ab(t,e).then(function(){}))},t.Ma=function(t){return _h(this,this.b.Ma(t).then(function(t){return new Fi(t)}))},t.Ya=function(t){return _h(this,this.b.Ya(t).then(function(){}))},t.kb=function(e,t){var n=this;return _h(this,Yt().then(function(){return void 0===t||G(t)?{}:br(new ur(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return _h(this,Ic(this,t,e,I(this.Sa,this)))},t.Jc=function(n,i){var r=this;return _h(this,Yt().then(function(){var t=i||$n(),e=ho(n,t);if(!(t=lo(t)))throw new Yi("argument-error","Invalid email link!");if(t.tenantId!==r.R())throw new Yi("tenant-id-mismatch");return r.Sa(e)}))},Ph.prototype.render=function(){},Ph.prototype.reset=function(){},Ph.prototype.getResponse=function(){},Ph.prototype.execute=function(){};var Ch=null;function Dh(t,e){return(e=Lh(e))&&t.a[e]||null}function Lh(t){return(t=void 0===t?1e12:t)?t.toString():null}function xh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Fn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Be(this.f,"click",this.i)}function Mh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function jh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new xh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Dh(this,t);t=Lh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Dh(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Dh(this,t))&&t.execute()},xh.prototype.getResponse=function(){return Mh(this),this.b},xh.prototype.execute=function(){Mh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},xh.prototype.delete=function(){Mh(this),this.g=!0,clearTimeout(this.a),this.a=null,Xe(this.f,"click",this.i)},jh.prototype.g=function(){return Yt(Ch=Ch||new Rh)},jh.prototype.c=function(){};var Uh=null;function Vh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Fh=new Y(Z,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Kh=new Oi(3e4,6e4);Vh.prototype.g=function(r){var o=this;return new qt(function(t,e){var i=setTimeout(function(){e(new Yi("network-request-failed"))},Kh.get());!l.grecaptcha||r!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=r;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(i),t(l.grecaptcha)}else clearTimeout(i),e(new Yi("internal-error"));delete l[o.a]},Yt(Ea(nt(Fh,{onload:o.a,hl:r||""}))).s(function(){clearTimeout(i),e(new Yi("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),t(l.grecaptcha))})},Vh.prototype.c=function(){this.b--};var qh=null;function Hh(t,e,n,i,r,o,a){if(Mi(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new jh:qh=qh||new Vh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Wh])throw new Yi("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Xh],!l.document)throw new Yi("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Fn(e)||!this.i&&Fn(e).hasChildNodes())throw new Yi("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Pa(t,o||null,r||null),this.v=i||function(){return null};var s=this;this.l=[];var u=this.a[Bh];this.a[Bh]=function(t){if(Jh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mi(u,l);"function"==typeof e&&e(t)}};var c=this.a[Gh];this.a[Gh]=function(){if(Jh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mi(c,l);"function"==typeof t&&t()}}}var Bh="callback",Gh="expired-callback",Wh="sitekey",Xh="size";function Jh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){F(t.h,e)}),e}function zh(t){if(t.B)throw new Yi("internal-error","RecaptchaVerifier instance has been destroyed.")}function $h(t,e,n){var i=!1;try{this.b=n||fl.app()}catch(t){throw new Yi("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yi("invalid-api-key");n=this.b.options.apiKey;var r=this,o=null;try{o=this.b.auth().Ca()}catch(t){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?pi(fl.SDK_VERSION,o):null,Hh.call(this,n,t,e,function(){try{var e=r.b.auth().ha()}catch(t){e=null}return e},o,Nr(Ar),i)}function Zh(t,e,n,i){t:{n=Array.prototype.slice.call(n);for(var r=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yi("internal-error","Argument validator encountered a required argument after an optional argument.");r++}if(o=e.length,n.length<r||o<n.length)i="Expected "+(r==o?1==r?"1 argument":r+" arguments":r+"-"+o+" arguments")+" but got "+n.length+".";else{for(r=0;r<n.length;r++)if(o=e[r].optional&&void 0===n[r],!e[r].N(n[r])&&!o){if(e=e[r],r<0||r>=Qh.length)throw new Yi("internal-error","Argument validator received an unsupported number of arguments.");n=Qh[r],i=(i?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}i=null}}if(i)throw new Yi("argument-error",t+" failed: "+i)}(t=Hh.prototype).Da=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(yi()&&!si())return ri();throw new Yi("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ds,{})}).then(function(t){e.a[Wh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){zh(this);var n=this;return Yh(this,this.Da().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=Fn(t);t=Hn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){zh(this);var r=this;return Yh(this,this.render().then(function(i){return new qt(function(e){var t=r.g.getResponse(i);if(t)e(t);else{var n=function(t){t&&(function(t,e){K(t.l,function(t){return t==e})}(r,n),e(t))};r.l.push(n),r.i&&r.g.execute(r.c)}})}))},t.reset=function(){zh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){zh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Fn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},k($h,Hh);var Qh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:g}}function il(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function rl(t,e){return{name:t||"",M:"null",optional:!!e,N:r}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function sl(e,n,t,i){return{name:t||"",M:e.M+" or "+n.M,optional:!!i,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var i=e[n].name;t[i]=ll(i,t[n],e[n].j)}}function cl(t,e){for(var n in e){var i=e[n].name;i!==n&&Object.defineProperty(t,i,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,i){Zh(t,[n],[i],!0),this[e]=i},i,n,e[n].Za),enumerable:!0})}}function hl(t,e,n,i){t[e]=ll(e,n,i)}function ll(t,e,n){function i(){var t=Array.prototype.slice.call(arguments);return Zh(o,n,t),e.apply(this,t)}if(!n)return e;var r,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(r in e)i[r]=e[r];for(r in e.prototype)i.prototype[r]=e.prototype[r];return i}ul(gh.prototype,{Ya:{name:"applyActionCode",j:[tl("code")]},Ma:{name:"checkActionCode",j:[tl("code")]},ab:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),il(),"nextOrObserver"),il("opt_error",!0),il("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),il(),"nextOrObserver"),il("opt_error",!0),il("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),rl(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Cc)}},rl(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(gh.prototype,{lc:{name:"languageCode",Za:sl(tl(),rl(),"languageCode")},ti:{name:"tenantId",Za:sl(tl(),rl(),"tenantId")}}),(gh.Persistence=Tu).LOCAL="local",gh.Persistence.SESSION="session",gh.Persistence.NONE="none",ul(Cc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},fb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},hb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),rl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Ph.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(qt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(yc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(qr,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yr,uo,po,Wr],i=0;i<n.length;i++)if(e=n[i](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Qr.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Qr,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(io.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(io,"credential",ro,[sl(tl(),sl(nl(),rl()),"idToken"),sl(tl(),rl(),"accessToken",!0)]),ul(oo.prototype,{Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul(Zr.prototype,{ya:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),rl()),"optionsOrIdToken"),sl(tl(),rl(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Xr.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Br.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(mo,"credential",go,[tl("verificationId"),tl("verificationCode")]),ul(mo.prototype,{Wa:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yi.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(So.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Ao.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul($h.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Qi,"parseLink",sr,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Ki,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:gh,AuthCredential:qr,Error:Yi};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Qr,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",io,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",Zr,[tl("providerId")]),hl(t,"SAMLAuthProvider",$r,[tl("providerId")]),hl(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof gh)}}]),hl(t,"RecaptchaVerifier",$h,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Qi,[]),fl.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new gh(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),fl.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:I((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:I(t.cc,t),addAuthTokenListener:I(t.Wb,t),removeAuthTokenListener:I(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),fl.registerVersion("@firebase/auth","0.13.5"),fl.INTERNAL.extendNamespace({User:Cc})}()}.apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-auth.js - be sure to load firebase-app.js first.")}});

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(nm){"use strict";try{(function(){nm=nm&&nm.hasOwnProperty("default")?nm.default:nm;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,l=function(){return(l=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function m(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,s(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,s(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,s(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,s(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,s([this,o.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,s([this,o.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,s([this,o.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,s([this,o.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,s([this,o.ERROR],t))},c);function c(t){this.name=t,this._logLevel=i,this._logHandler=n}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var h,d=(t(y,h=Error),y);function y(t,e){var n=h.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(v.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new d(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},v);function v(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,w=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var S,E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=I||{},C=E;function D(t){return"string"==typeof t}function N(t){return"number"==typeof t}function A(t,e){t=t.split("."),e=e||C;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function k(){}function R(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function M(t){return"array"==R(t)}function _(t){var e=R(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),P=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function F(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:F).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var B=Date.now||function(){return+new Date};function U(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).xb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function K(){this.j=this.j,this.i=this.i}K.prototype.j=!1,K.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[O]||(this[O]=++P)},K.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(D(t))return D(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=D(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var H,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var Z=C.navigator;if(Z){var $=Z.userAgent;if($){H=$;break t}}H=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=k;var ot,at,st=X(H,"Opera"),ut=X(H,"Trident")||X(H,"MSIE"),ct=X(H,"Edge"),ht=ct||ut,lt=X(H,"Gecko")&&!(X(H.toLowerCase(),"webkit")&&!X(H,"Edge"))&&!(X(H,"Trident")||X(H,"MSIE"))&&!X(H,"Edge"),ft=X(H.toLowerCase(),"webkit")&&!X(H,"Edge");function pt(){var t=C.document;return t?t.documentMode:void 0}t:{var dt="",mt=(at=H,lt?/rv:([^\);]+)(\)|;)/.exec(at):ct?/Edge\/([\d\.]+)/.exec(at):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(at):ft?/WebKit\/(\S+)/.exec(at):st?/(?:Version)[ \/]?(\S+)/.exec(at):void 0);if(mt&&(dt=mt?mt[1]:""),ut){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var gt,vt={};function bt(s){return function(t,e){var n=vt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=Y(String(ot)).split("."),n=Y(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=J(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||J(0==o[2].length,0==a[2].length)||J(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var wt=C.document;gt=wt&&ut?pt()||("CSS1Compat"==wt.compatMode?parseInt(ot,10):5):void 0;var Tt=!ut||9<=Number(gt),St=ut&&!bt("9"),Et=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{C.addEventListener("test",k,e),C.removeEventListener("test",k,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function Ct(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(lt){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=D(t.pointerType)?t.pointerType:Dt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.Ia=!1},U(Ct,It);var Dt={2:"touch",3:"pen",4:"mouse"};Ct.prototype.b=function(){Ct.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,St)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),At=0;function kt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++At,this.X=this.Z=!1}function Rt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Mt(t){this.src=t,this.a={},this.b=0}function _t(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Q(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Rt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Mt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Lt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new kt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Pt={};function xt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(M(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=jt(r);return e&&e[Nt]?e.Aa(n,r,L(i)?!!i.capture:!!i,o):Ft(e,n,r,!0,i,o)}(t,e,n,r,i);if(M(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=jt(n),t&&t[Nt]?t.za(e,n,L(r)?!!r.capture:!!r,i):Ft(t,e,n,!1,r,i)}function Ft(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=L(i)?!!i.capture:!!i;if(a&&!Tt)return null;var s=Kt(t);if(s||(t[Ot]=s=new Mt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Ut,n=Tt?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Et||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!N(t)&&t&&!t.X){var e=t.src;if(e&&e[Nt])_t(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Kt(e))?(_t(n,t),0==n.b&&(n.src=null,e[Ot]=null)):Rt(t)}}}function Vt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Bt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function Ut(t,e){return!!t.X||(Tt?Bt(t,new Ct(e,this)):Bt(t,e=new Ct(e||A("window.event"),this)))}function Kt(t){return(t=t[Ot])instanceof Mt?t:null}var Qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(e){return"function"==R(e)?e:(e[Qt]||(e[Qt]=function(t){return e.handleEvent(t)}),e[Qt])}function Gt(){K.call(this),this.c=new Mt(this),(this.J=this).B=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&_t(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}U(Gt,K),Gt.prototype[Nt]=!0,(S=Gt.prototype).addEventListener=function(t,e,n,r){xt(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(M(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=L(i)?!!i.capture:!!i,r=jt(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Lt(a=e.a[n],r,i,o))&&(Rt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Kt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Lt(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},S.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(D(t))t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var i=t;rt(t=new It(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Wt(a,r,!0,t)&&i}if(i=Wt(a=t.a=n,r,!0,t)&&i,i=Wt(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Wt(a=t.a=e[o],r,!1,t)&&i;return i},S.G=function(){if(Gt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Rt(n[r]);delete e.a[t],e.b--}}this.B=null},S.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=C.JSON.stringify;function Ht(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Yt(){this.b=this.a=null}Ht.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Xt,Jt=new Ht(function(){return new Zt},function(t){t.reset()});function Zt(){this.next=this.b=this.a=null}function $t(t){C.setTimeout(function(){throw t},0)}function te(t,e){Xt||function(){var t=C.Promise.resolve(void 0);Xt=function(){t.then(re)}}(),ee||(Xt(),ee=!0),ne.add(t,e)}Yt.prototype.add=function(t,e){var n=Jt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!(Zt.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Yt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){$t(t)}var e=Jt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){Gt.call(this),this.b=t||1,this.a=e||C,this.f=q(this.fb,this),this.g=B()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ae(t,e,n){if("function"==R(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:C.setTimeout(t,e||0)}function se(t,e,n){K.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ue(t){t.U=ae(t.b,t.c),t.f.apply(null,t.a)}function ce(t){K.call(this),this.b=t,this.a={}}U(ie,Gt),(S=ie.prototype).ba=!1,S.L=null,S.fb=function(){if(this.ba){var t=B()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},S.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=B())},S.G=function(){ie.N.G.call(this),oe(this),delete this.a},U(se,K),(S=se.prototype).ea=!1,S.U=null,S.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},S.G=function(){se.N.G.call(this),this.U&&(C.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},S.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},U(ce,K);var he=[];function le(t,e,n,r){M(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=xt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}ce.prototype.G=function(){ce.N.G.call(this),fe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new Gt;function me(t){It.call(this,"serverreachability",t)}function ye(t){de.dispatchEvent(new me(de,t))}function ge(t){It.call(this,"statevent",t)}function ve(t){de.dispatchEvent(new ge(de,t))}function be(t){It.call(this,"timingevent",t)}function we(t,e){if("function"!=R(t))throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){t()},e)}U(me,It),U(ge,It),U(be,It);var Te={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Se={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Ee(){}function Ie(t){var e;return(e=t.a)||(e=t.a={}),e}function Ce(){}Ee.prototype.a=null;var De,Ne={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function Ae(){It.call(this,"d")}function ke(){It.call(this,"c")}function Re(){}function Me(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new ce(this),this.O=_e,t=ht?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}U(Ae,It),U(ke,It),U(Re,Ee),De=new Re;var _e=45e3,Le={},Oe={};function Pe(t,e,n){t.F=1,t.f=sn($e(e)),t.l=n,t.H=!0,Fe(t,null)}function xe(t,e,n,r){t.F=1,t.f=sn($e(e)),t.l=null,t.H=n,Fe(t,r)}function Fe(t,e){t.v=B(),Be(t),t.D=$e(t.f),an(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new se(q(t.Ja,t,t.a),t.J)),le(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ye(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ve(t,n);if(i==Oe){4==e&&(t.c=4,ve(14),r=!1);break}if(i==Le){t.c=4,ve(15),r=!1;break}Ge(t,i)}4==e&&0==n.length&&(t.c=1,ve(16),r=!1),t.b=t.b&&r,r||(je(t),Qe(t))}function Ve(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Oe:(n=Number(e.substring(n,r)),isNaN(n)?Le:(r+=1)+n>e.length?Oe:(e=e.substr(r,n),t.A=r+n,e))}function Be(t){t.R=B()+t.O,Ue(t,t.O)}function Ue(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=we(q(t.ab,t),e)}function Ke(t){t.i&&(C.clearTimeout(t.i),t.i=null)}function Qe(t){t.g.Ca()||t.m||t.g.na(t)}function je(t){Ke(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),fe(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ge(t,e){try{t.g.Fa(t,e),ye(4)}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||D(t))j(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(_(t)||D(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(D(t))return t.split("");if(_(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t,e){Xe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ye(t))}function Ye(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Xe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Xe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Xe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Me.prototype).setTimeout=function(t){this.O=t},S.cb=function(t){t=t.target;var e=this.B;e&&3==$n(t)?e.Ta():this.Ja(t)},S.Ja=function(t){try{if(t==this.a)t:{var e=$n(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ht&&!this.a.aa())){this.m||4!=e||7==n||ye(8==n||r<=0?3:2),Ke(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=tr(this.a,"X-HTTP-Initial-Response");if(a&&!z(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,ve(12),je(this),Qe(this);break t}this.s=!0,Ge(this,s)}this.H?(qe(this,e,o),ht&&this.b&&3==e&&(le(this.I,this.P,"tick",this.bb),this.P.start())):Ge(this,o),4==e&&je(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Be(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ve(12)):(this.c=0,ve(13)),je(this),Qe(this)}}}catch(t){}},S.bb=function(){if(this.a){var t=$n(this.a),e=this.a.aa();this.A<e.length&&(Ke(this),qe(this,t,e),this.b&&4!=t&&Be(this))}},S.cancel=function(){this.m=!0,je(this)},S.ab=function(){this.i=null;var t=B();0<=t-this.R?(2!=this.F&&(ye(3),ve(17)),je(this),this.c=2,Qe(this)):Ue(this,this.R-t)},(S=ze.prototype).C=function(){Ye(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.K=function(){return Ye(this),this.a.concat()},S.get=function(t,e){return Xe(this.b,t)?this.b[t]:e},S.set=function(t,e){Xe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ze(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Ze?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,Tn(t.c)),this.g=t.g):t&&(n=String(t).match(Je))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new yn(null,this.h))}function $e(t){return new Ze(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof yn?(t.c=e,function(t,e){e&&!t.f&&(gn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(vn(this,e),wn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=cn(e,dn)),t.c=new yn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function an(t,e,n){M(n)||(n=[String(n)]),wn(t.c,e,n)}function sn(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^B()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cn(t,e,n){return D(t)?(t=encodeURI(t).replace(e,hn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(cn(e,ln,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(cn(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(cn(n,"/"==n.charAt(0)?pn:fn,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",cn(n,mn)),t.join("")},Ze.prototype.resolve=function(t){var e=$e(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(X(i,"./")||X(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,Tn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ln=/[#\/\?@]/g,fn=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,mn=/#/g;function yn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function gn(n){n.a||(n.a=new ze,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function vn(t,e){gn(t),e=Sn(t,e),Xe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He(t.a,e))}function bn(t,e){return gn(t),e=Sn(t,e),Xe(t.a.b,e)}function wn(t,e,n){vn(t,e),0<n.length&&(t.c=null,t.a.set(Sn(t,e),W(n)),t.b+=n.length)}function Tn(t){var e=new yn;return e.c=t.c,t.a&&(e.a=new ze(t.a),e.b=t.b),e}function Sn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function En(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function In(t){var e=t.a.F.a;if(null!=e)ve(4),e?(ve(10),fr(t.a,t,!1)):(ve(11),fr(t.a,t,!0));else{t.b=new Me(t,void 0,void 0),t.b.h=t.h,e=gr(e=t.a,e.Y()?t.f:null,t.i),ve(4),an(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),xe(t.b,e,!1,t.f)}}function Cn(){this.a=this.b=null}function Dn(){this.a=new ze}function Nn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[O]||(t[O]=++P)):e.charAt(0)+t}function An(t,e){this.b=t,this.a=e}function kn(t){this.g=t||Rn,t=C.PerformanceNavigationTiming?0<(t=C.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(C.ka&&C.ka.Da&&C.ka.Da()&&C.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Dn),this.b=null,this.c=[]}(S=yn.prototype).add=function(t,e){gn(this),this.c=null,t=Sn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(n,r){gn(this),this.a.forEach(function(t,e){j(t,function(t){n.call(r,t,e,this)},this)},this)},S.K=function(){gn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.C=function(t){gn(this);var e=[];if(D(t))bn(this,t)&&(e=G(e,this.a.get(Sn(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},S.set=function(t,e){return gn(this),this.c=null,bn(this,t=Sn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},U(function(){},function(){}),(S=En.prototype).M=null,S.$=function(t){return this.a.$(t)},S.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},S.Ca=function(){return!1},S.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void mr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,mr(e,2)}else 1==this.M&&(this.g?ve(6):"11111"==e?(ve(5),this.g=!0,(!ut||10<=Number(gt))&&(this.c=200,this.b.cancel(),ve(11),fr(this.a,this,!0))):(ve(7),this.g=!1))},S.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,In(this)):1==this.M&&(this.g?(ve(11),fr(this.a,this,!0)):(ve(10),fr(this.a,this,!1)));else{0==this.M?ve(8):1==this.M&&ve(9);var t=this.a;t.m=this.c,mr(t,2)}},S.Y=function(){return this.a.Y()},S.ma=function(){return this.a.ma()},Dn.prototype.add=function(t){this.a.set(Nn(t),t)},Dn.prototype.C=function(){return this.a.C()};var Rn=10;function Mn(t,e){!t.a&&(X(e,"spdy")||X(e,"quic")||X(e,"h2"))&&(t.f=t.g,t.a=new Dn,t.b&&(Pn(t,t.b),t.b=null))}function _n(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Ln(t){return t.b?1:t.a?t.a.a.c:0}function On(t,e){return t=t.b?t.b==e:!!t.a&&(e=Nn(e),Xe(t.a.a.b,e))}function Pn(t,e){t.a?t.a.add(e):t.b=e}function xn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Nn(e),n=Xe(t.a.a.b,n)),n&&He(t.a.a,Nn(e)))}function Fn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return W(t.c);var e=t.c;return j(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Vn(){this.a=new qn}function Bn(t,r,e){var i=e||"";try{We(t,function(t,e){var n=t;L(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Un(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}kn.prototype.cancel=function(){this.c=Fn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(j(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return C.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return C.JSON.parse(t,void 0)};var Kn=C.JSON.parse;function Qn(t){Gt.call(this),this.headers=new ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=jn,this.D=this.F=!1}U(Qn,Gt);var jn="",Gn=/^https?$/i,Wn=["POST","PUT"];function zn(t){return"content-type"==t.toLowerCase()}function Hn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Yn(t),Jn(t)}function Yn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Xn(t){if(t.b&&void 0!==I&&(!t.s[1]||4!=$n(t)||2!=t.T()))if(t.l&&4==$n(t))ae(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==$n(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Je)[1]||null;if(!o&&C.self&&C.self.location){var a=C.self.location.protocol;o=a.substr(0,a.length-1)}i=!Gn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var s=2<$n(t)?t.a.statusText:""}catch(t){s=""}t.f=s+" ["+t.T()+"]",Yn(t)}}finally{Jn(t)}}}function Jn(t,e){if(t.a){Zn(t);var n=t.a,r=t.s[0]?k:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Zn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(C.clearTimeout(t.m),t.m=null)}function $n(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),D(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new Cn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!A("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=A("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=A("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=A("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=A("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new kn(t&&t.concurrentRequestLimit),this.ja=new Vn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=$e(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new Me(t,e,void 0)).F=2,e.f=sn($e(n)),n=!1,C.navigator&&C.navigator.sendBeacon&&(n=C.navigator.sendBeacon(e.f.toString(),"")),!n&&C.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=B(),Be(e)}yr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(C.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(N(t.h)&&C.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new An(t.Qa++,e)),3==t.u&&ar(t)}function ar(t){_n(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function sr(t,e){var n;n=e?e.W:t.P++;var r=$e(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new Me(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=cr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Pn(t.b,n),Pe(n,r,e)}function ur(t,n){t.c&&We({},function(t,e){on(n,e,t)})}function cr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Bn(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function hr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function lr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=we(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function fr(t,e,n){var r=e.l;r&&Mn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=gr(t,null,t.ha),ar(t)}function pr(t){null!=t.s&&(C.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function mr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new Ze("//www.google.com/images/cleardot.gif"),C.location&&"http"==C.location.protocol||tn(n,"https"),sn(n)),function(t,e){var n=new pe;if(C.Image){var r=new Image;r.onload=V(Un,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(Un,n,r,"TestLoadImage: error",!1,e),r.onabort=V(Un,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(Un,n,r,"TestLoadImage: timeout",!1,e),C.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ve(2);t.u=0,t.c&&t.c.ta(e),yr(t),ir(t)}function yr(t){t.u=0,t.m=-1,t.c&&(0==Fn(t.b).length&&0==t.f.length||(t.b.c.length=0,W(t.f),t.f.length=0),t.c.sa())}function gr(t,e,n){var r=function(t){return t instanceof Ze?$e(t):new Ze(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=C.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Ze(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function vr(){}function br(){if(ut&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function wr(t,e){Gt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Er(this)}function Tr(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Sr(){ke.call(this),this.status=1}function Er(t){this.a=t}(S=Qn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ie(this.H):Ie(De),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Hn(this,t)}t=n||"";var i=new ze(this.headers);r&&We(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=zn,n=t.length,r=D(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:D(t)?t.charAt(e):t[e]}(i.K()),n=C.FormData&&t instanceof C.FormData,0<=Q(Wn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Zn(this),0<this.o&&((this.D=function(t){return ut&&bt(9)&&N(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=ae(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Hn(this,t)}},S.Ba=function(){void 0!==I&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Jn(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Jn(this,!0)),Qn.N.G.call(this)},S.Ea=function(){this.j||(this.w||this.l||this.g?Xn(this):this.Za())},S.Za=function(){Xn(this)},S.T=function(){try{return 2<$n(this)?this.a.status:-1}catch(t){return-1}},S.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Kn(e)}},S.ya=function(){return this.h},S.Xa=function(){return D(this.f)?this.f:String(this.f)},(S=nr.prototype).wa=8,S.u=1,S.Ca=function(){return 0==this.u},S.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Me(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&D(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=cr(this,n,e),on(i=$e(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Pn(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Pe(n,i,null)):Pe(n,i,e),this.u=2}}else 3==this.u&&(t?sr(this,t):0==this.f.length||_n(this.b)||sr(this))},S.Ga=function(){this.l=null,this.a=new Me(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=$e(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),xe(this.a,t,!0,this.ga)},S.Fa=function(t,e){if(0!=this.u&&(this.a==t||On(this.b,t)))if(this.m=t.o,!t.s&&On(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(M(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}lr(this),ve(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=we(q(this.Ya,this),6e3));if(Ln(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else mr(this,11)}else if(!t.s&&this.a!=t||pr(this),!z(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&N(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&Mn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=gr(this,this.Y()?this.ga:null,this.ha),r.s?(xn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ke(r),Be(r)),this.a=r):hr(this),0<this.f.length&&ar(this)}else"stop"!=r[0]&&"close"!=r[0]||mr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?mr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},S.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,lr(this),ve(19))},S.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!On(this.b,t))return;e=t.j,xn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=B()-t.v,de.dispatchEvent(new be(de,t.l?t.l.length:0,e,this.A)),ar(this)):hr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Ln(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=we(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&lr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:mr(this,5);break;case 4:mr(this,10);break;case 3:mr(this,6);break;default:mr(this,2)}}},S.eb=function(t){ve(t?2:1)},S.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Qn(this.Ka)).F=this.R,t},S.ma=function(){return!!this.c&&!0},S.Y=function(){return this.R},(S=vr.prototype).va=function(){},S.ua=function(){},S.ta=function(){},S.sa=function(){},S.Sa=function(){},br.prototype.a=function(t,e){return new wr(t,e)},U(wr,Gt),(S=wr.prototype).addEventListener=function(t,e,n,r){wr.N.addEventListener.call(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){wr.N.removeEventListener.call(this,t,e,n,r)},S.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ve(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new En(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=gr(t.a,null,t.i),ve(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,In(t)):(an(e,"MODE","init"),!t.a.o&&t.a.j&&an(e,"X-HTTP-Session-Id",t.a.j),t.b=new Me(t,void 0,void 0),t.b.h=t.h,xe(t.b,e,!1,null),t.M=0)},S.close=function(){rr(this.a)},S.Wa=function(t){if(D(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=zt(t),or(this.a,e)):or(this.a,t)},S.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,wr.N.G.call(this)},U(Tr,Ae),U(Sr,ke),U(Er,vr),Er.prototype.va=function(){this.a.dispatchEvent("a")},Er.prototype.ua=function(t){this.a.dispatchEvent(new Tr(t))},Er.prototype.ta=function(t){this.a.dispatchEvent(new Sr(t))},Er.prototype.sa=function(){this.a.dispatchEvent("b")};var Ir=V(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},br);br.prototype.createWebChannel=br.prototype.a,wr.prototype.send=wr.prototype.Wa,wr.prototype.open=wr.prototype.Va,wr.prototype.close=wr.prototype.close,Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,Se.COMPLETE="complete",(Ce.EventType=Ne).OPEN="a",Ne.CLOSE="b",Ne.ERROR="c",Ne.MESSAGE="d",Gt.prototype.listen=Gt.prototype.za,Qn.prototype.listenOnce=Qn.prototype.Aa,Qn.prototype.getLastError=Qn.prototype.Xa,Qn.prototype.getLastErrorCode=Qn.prototype.ya,Qn.prototype.getStatus=Qn.prototype.T,Qn.prototype.getResponseJson=Qn.prototype.Ua,Qn.prototype.getResponseText=Qn.prototype.aa,Qn.prototype.send=Qn.prototype.ca;var Cr,Dr,Nr={createWebChannelTransport:Ir,ErrorCode:Te,EventType:Se,WebChannel:Ce,XhrIo:Qn},Ar=Nr.createWebChannelTransport,kr=Nr.ErrorCode,Rr=Nr.EventType,Mr=Nr.WebChannel,_r=Nr.XhrIo,Lr=nm.SDK_VERSION,Or=new u("@firebase/firestore");function Pr(){return Or.logLevel===o.DEBUG?Cr.DEBUG:Or.logLevel===o.SILENT?Cr.SILENT:Cr.ERROR}function xr(t){switch(t){case Cr.DEBUG:Or.logLevel=o.DEBUG;break;case Cr.ERROR:Or.logLevel=o.ERROR;break;case Cr.SILENT:Or.logLevel=o.SILENT;break;default:Or.error("Firestore ("+Lr+"): Invalid value passed to `setLogLevel`")}}function Fr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Or.logLevel<=o.DEBUG){var i=n.map(Vr);Or.debug.apply(Or,a(["Firestore ("+Lr+") ["+t+"]: "+e],i))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Or.logLevel<=o.ERROR){var r=e.map(Vr);Or.error.apply(Or,a(["Firestore ("+Lr+"): "+t],r))}}function Vr(e){if("string"==typeof e)return e;var t=Kr.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Br(t){var e="FIRESTORE ("+Lr+") INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function Ur(t,e){t||Br(e)}(Dr=Cr=Cr||{})[Dr.DEBUG=0]="DEBUG",Dr[Dr.ERROR=1]="ERROR",Dr[Dr.SILENT=2]="SILENT";var Kr=(Qr.setPlatform=function(t){Qr.platform&&Br("Platform already defined"),Qr.platform=t},Qr.getPlatform=function(){return Qr.platform||Br("Platform not set"),Qr.platform},Qr);function Qr(){}function jr(){return Kr.getPlatform().emptyByteString}var Gr,Wr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},zr=(t(Hr,Gr=Error),Hr);function Hr(t,e){var n=Gr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Yr(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new zr(Wr.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Xr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Jr(t,e){return void 0!==t?t:e}function Zr(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function $r(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(var e in Ur(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ei(t,e){if(0!==e.length)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+bi(e.length,"argument")+".")}function ni(t,e,n){if(e.length!==n)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function ri(t,e,n){if(e.length<n)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function ii(t,e,n,r){if(e.length<n||e.length>r)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+bi(e.length,"argument")+".")}function oi(t,e,n,r){li(t,e,vi(n)+" argument",r)}function ai(t,e,n,r){void 0!==r&&oi(t,e,n,r)}function si(t,e,n,r){li(t,e,n+" option",r)}function ui(t,e,n,r){void 0!==r&&si(t,e,n,r)}function ci(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+pi(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+pi(r[o]))}(t,e,n,r,i)}function hi(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(pi(u))}var c=pi(r);throw new zr(Wr.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function li(t,e,n,r){if(!("object"===e?fi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=pi(r);throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function fi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function pi(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Br("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function di(t,e,n){if(void 0===n)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+vi(e)+" argument, but it was undefined.")}function mi(n,t,r){$r(t,function(t,e){if(r.indexOf(t)<0)throw new zr(Wr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function yi(t,e,n,r){var i=pi(r);return new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+vi(n)+" argument to be a "+e+", but it was: "+i)}function gi(t,e,n){if(n<=0)throw new zr(Wr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+vi(e)+" argument to be a positive number, but it was: "+n+".")}function vi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function bi(t,e){return t+" "+e+(1===t?"":"s")}var wi=(Ti.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Ur(20===e.length,"Invalid auto ID: "+e),e},Ti);function Ti(){}function Si(t,e){return t<e?-1:e<t?1:0}function Ei(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Ii(t){return t+"\0"}function Ci(){if("undefined"==typeof Uint8Array)throw new zr(Wr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Di(){if(!Kr.getPlatform().base64Available)throw new zr(Wr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ni=(Ai.fromBase64String=function(t){ni("Blob.fromBase64String",arguments,1),oi("Blob.fromBase64String","string",1,t),Di();try{return new Ai(Kr.getPlatform().atob(t))}catch(t){throw new zr(Wr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Ai.fromUint8Array=function(t){if(ni("Blob.fromUint8Array",arguments,1),Ci(),!(t instanceof Uint8Array))throw yi("Blob.fromUint8Array","Uint8Array",1,t);return new Ai(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},Ai.prototype.toBase64=function(){return ni("Blob.toBase64",arguments,0),Di(),Kr.getPlatform().btoa(this._binaryString)},Ai.prototype.toUint8Array=function(){ni("Blob.toUint8Array",arguments,0),Ci();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},Ai.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ai.prototype.isEqual=function(t){return this._binaryString===t._binaryString},Ai.prototype._approximateByteSize=function(){return 2*this._binaryString.length},Ai.prototype._compareTo=function(t){return Si(this._binaryString,t._binaryString)},Ai);function Ai(t){Di(),this._binaryString=t}var ki=Yr(Ni,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Ri=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Mi="(default)",_i=(Object.defineProperty(Li.prototype,"isDefaultDatabase",{get:function(){return this.database===Mi},enumerable:!0,configurable:!0}),Li.prototype.isEqual=function(t){return t instanceof Li&&t.projectId===this.projectId&&t.database===this.database},Li.prototype.compareTo=function(t){return Si(this.projectId,t.projectId)||Si(this.database,t.database)},Li);function Li(t,e){this.projectId=t,this.database=e||Mi}var Oi=(Pi.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Pi.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Pi.INVALID=-1,Pi);function Pi(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var xi="__name__",Fi=(Object.defineProperty(qi.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),qi.prototype.isEqual=function(t){return 0===qi.comparator(this,t)},qi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof qi?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},qi.prototype.limit=function(){return this.offset+this.length},qi.prototype.popFirst=function(t){return t=void 0===t?1:t,Ur(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},qi.prototype.popLast=function(){return Ur(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},qi.prototype.firstSegment=function(){return Ur(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},qi.prototype.lastSegment=function(){return this.get(this.length-1)},qi.prototype.get=function(t){return Ur(t<this.length,"Index out of range"),this.segments[this.offset+t]},qi.prototype.isEmpty=function(){return 0===this.length},qi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},qi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},qi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},qi);function qi(t,e,n){void 0===e?e=0:e>t.length&&Br("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Br("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Vi,Bi=(t(Ui,Vi=Fi),Ui.prototype.construct=function(t,e,n){return new Ui(t,e,n)},Ui.prototype.canonicalString=function(){return this.toArray().join("/")},Ui.prototype.toString=function(){return this.canonicalString()},Ui.fromString=function(t){if(0<=t.indexOf("//"))throw new zr(Wr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Ui(t.split("/").filter(function(t){return 0<t.length}))},Ui.EMPTY_PATH=new Ui([]),Ui);function Ui(){return null!==Vi&&Vi.apply(this,arguments)||this}var Ki,Qi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ji=(t(Gi,Ki=Fi),Gi.prototype.construct=function(t,e,n){return new Gi(t,e,n)},Gi.isValidIdentifier=function(t){return Qi.test(t)},Gi.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Gi.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Gi.prototype.toString=function(){return this.canonicalString()},Gi.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===xi},Gi.keyField=function(){return new Gi([xi])},Gi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new zr(Wr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new zr(Wr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new zr(Wr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new zr(Wr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Gi(e)},Gi.EMPTY_PATH=new Gi([]),Gi);function Gi(){return null!==Ki&&Ki.apply(this,arguments)||this}var Wi=(zi.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},zi.prototype.isEqual=function(t){return null!==t&&0===Bi.comparator(this.path,t.path)},zi.prototype.toString=function(){return this.path.toString()},zi.comparator=function(t,e){return Bi.comparator(t.path,e.path)},zi.isDocumentKey=function(t){return t.length%2==0},zi.fromSegments=function(t){return new zi(new Bi(t.slice()))},zi.fromPathString=function(t){return new zi(Bi.fromString(t))},zi.EMPTY=new zi(new Bi([])),zi);function zi(t){this.path=t,Ur(zi.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Hi,Yi,Xi=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(Yi=Hi=Hi||{}).All="all",Yi.ListenStreamIdle="listen_stream_idle",Yi.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Yi.WriteStreamIdle="write_stream_idle",Yi.WriteStreamConnectionBackoff="write_stream_connection_backoff",Yi.OnlineStateTimeout="online_state_timeout",Yi.ClientMetadataRefresh="client_metadata_refresh",Yi.LruGarbageCollection="lru_garbage_collection",Yi.RetryTransaction="retry_transaction";var Ji=(Zi.createAndSchedule=function(t,e,n,r,i){var o=new Zi(t,e,Date.now()+n,r,i);return o.start(n),o},Zi.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Zi.prototype.skipDelay=function(){return this.handleDelayElapsed()},Zi.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zr(Wr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Zi.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Zi.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Zi);function Zi(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Xi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var $i=(Object.defineProperty(to.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),to.prototype.enqueueAndForget=function(t){this.enqueue(t)},to.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},to.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},to.prototype.enqueueAndInitiateShutdown=function(e){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},to.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},to.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw qr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},to.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Ur(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Ji.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},to.prototype.verifyNotFailed=function(){this.failure&&Br("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},to.prototype.verifyOperationInProgress=function(){Ur(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},to.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},to.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},to.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Ur(r===Hi.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Hi.All&&n.timerId===r)break}return i.drain()})},to.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},to.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Ur(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},to);function to(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var eo="",no="",ro="",io="";function oo(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=so(e)),e=ao(t.get(n),e);return so(e)}function ao(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=eo+ro;break;case eo:n+=eo+io;break;default:n+=o}}return n}function so(t){return t+eo+no}function uo(t){var e=t.length;if(Ur(2<=e,"Invalid path "+t),2===e)return Ur(t.charAt(0)===eo&&t.charAt(1)===no,"Non-empty path "+t+" had length 2"),Bi.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(eo,o);switch((a<0||n<a)&&Br('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case no:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case ro:i+=t.substring(o,a),i+="\0";break;case io:i+=t.substring(o,a+1);break;default:Br('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Bi(r)}var co=(ho.now=function(){return ho.fromMillis(Date.now())},ho.fromDate=function(t){return ho.fromMillis(t.getTime())},ho.fromMillis=function(t){var e=Math.floor(t/1e3);return new ho(e,1e6*(t-1e3*e))},ho.prototype.toDate=function(){return new Date(this.toMillis())},ho.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ho.prototype._compareTo=function(t){return this.seconds===t.seconds?Si(this.nanoseconds,t.nanoseconds):Si(this.seconds,t.seconds)},ho.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ho.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ho);function ho(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new zr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new zr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new zr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new zr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var lo=(fo.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new fo(new co(e,t%1e6*1e3))},fo.fromTimestamp=function(t){return new fo(t)},fo.forDeletedDoc=function(){return fo.MIN},fo.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},fo.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},fo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},fo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},fo.prototype.toTimestamp=function(){return this.timestamp},fo.MIN=new fo(new co(0,0)),fo);function fo(t){this.timestamp=t}var po=(mo.prototype.insert=function(t,e){return new mo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,vo.BLACK,null,null))},mo.prototype.remove=function(t){return new mo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,vo.BLACK,null,null))},mo.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},mo.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},mo.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(mo.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),mo.prototype.minKey=function(){return this.root.minKey()},mo.prototype.maxKey=function(){return this.root.maxKey()},mo.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},mo.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},mo.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},mo.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},mo.prototype.getIterator=function(){return new yo(this.root,null,this.comparator,!1)},mo.prototype.getIteratorFrom=function(t){return new yo(this.root,t,this.comparator,!1)},mo.prototype.getReverseIterator=function(){return new yo(this.root,null,this.comparator,!0)},mo.prototype.getReverseIteratorFrom=function(t){return new yo(this.root,t,this.comparator,!0)},mo);function mo(t,e){this.comparator=t,this.root=e||vo.EMPTY}var yo=(go.prototype.getNext=function(){Ur(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},go.prototype.hasNext=function(){return 0<this.nodeStack.length},go.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},go);function go(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var vo=(bo.prototype.copy=function(t,e,n,r,i){return new bo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},bo.prototype.isEmpty=function(){return!1},bo.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},bo.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},bo.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},bo.prototype.minKey=function(){return this.min().key},bo.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},bo.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},bo.prototype.removeMin=function(){if(this.left.isEmpty())return bo.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},bo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return bo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},bo.prototype.isRed=function(){return this.color},bo.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},bo.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},bo.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},bo.prototype.rotateLeft=function(){var t=this.copy(null,null,bo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},bo.prototype.rotateRight=function(){var t=this.copy(null,null,bo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},bo.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},bo.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},bo.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Br("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Br("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Br("Black depths differ");return t+(this.isRed()?0:1)},bo.EMPTY=null,bo.RED=!0,bo.BLACK=!1,bo);function bo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:bo.RED,this.left=null!=r?r:bo.EMPTY,this.right=null!=i?i:bo.EMPTY,this.size=this.left.size+1+this.right.size}var wo=(Object.defineProperty(To.prototype,"key",{get:function(){throw Br("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(To.prototype,"value",{get:function(){throw Br("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(To.prototype,"color",{get:function(){throw Br("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(To.prototype,"left",{get:function(){throw Br("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(To.prototype,"right",{get:function(){throw Br("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),To.prototype.copy=function(t,e,n,r,i){return this},To.prototype.insert=function(t,e,n){return new vo(t,e)},To.prototype.remove=function(t,e){return this},To.prototype.isEmpty=function(){return!0},To.prototype.inorderTraversal=function(t){return!1},To.prototype.reverseTraversal=function(t){return!1},To.prototype.minKey=function(){return null},To.prototype.maxKey=function(){return null},To.prototype.isRed=function(){return!1},To.prototype.checkMaxDepth=function(){return!0},To.prototype.check=function(){return 0},To);function To(){this.size=0}vo.EMPTY=new wo;var So=(Eo.fromMapKeys=function(t){var e=new Eo(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},Eo.prototype.has=function(t){return null!==this.data.get(t)},Eo.prototype.first=function(){return this.data.minKey()},Eo.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Eo.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),Eo.prototype.indexOf=function(t){return this.data.indexOf(t)},Eo.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Eo.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Eo.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Eo.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},Eo.prototype.getIterator=function(){return new Io(this.data.getIterator())},Eo.prototype.getIteratorFrom=function(t){return new Io(this.data.getIteratorFrom(t))},Eo.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Eo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Eo.prototype.isEmpty=function(){return this.data.isEmpty()},Eo.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},Eo.prototype.isEqual=function(t){if(!(t instanceof Eo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Eo.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Eo.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Eo.prototype.copy=function(t){var e=new Eo(this.comparator);return e.data=t,e},Eo);function Eo(t){this.comparator=t,this.data=new po(this.comparator)}var Io=(Co.prototype.getNext=function(){return this.iter.getNext().key},Co.prototype.hasNext=function(){return this.iter.hasNext()},Co);function Co(t){this.iter=t}var Do=new po(Wi.comparator);function No(){return Do}function Ao(){return No()}var ko=new po(Wi.comparator);function Ro(){return ko}var Mo=new po(Wi.comparator);function _o(){return Mo}var Lo=new So(Wi.comparator);function Oo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Lo,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Po=new So(Si);function xo(){return Po}var Fo=(qo.prototype.applyToRemoteDocument=function(t,e,n){e&&Ur(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Ur(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},qo.prototype.applyToLocalView=function(t,e){e&&Ur(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},qo.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},qo.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Oo())},qo.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ei(this.mutations,t.mutations)&&Ei(this.baseMutations,t.baseMutations)},qo);function qo(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Ur(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Vo=(Bo.from=function(t,e,n,r){Ur(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=_o(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Bo(t,e,n,r,i)},Bo);function Bo(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Uo=(Ko.prototype.catch=function(t){return this.next(void 0,t)},Ko.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Br("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Ko(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Ko.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ko.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Ko?e:Ko.resolve(e)}catch(t){return Ko.reject(t)}},Ko.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Ko.resolve(e)},Ko.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Ko.reject(e)},Ko.resolve=function(n){return new Ko(function(t,e){t(n)})},Ko.reject=function(n){return new Ko(function(t,e){e(n)})},Ko.waitFor=function(t){return new Ko(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ko.or=function(t){for(var n=Ko.resolve(!1),e=function(e){n=n.next(function(t){return t?Ko.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Ko.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Ko);function Ko(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Qo="SimpleDb",jo=(Go.openOrCreate=function(o,t,a){return Ur(Go.isAvailable(),"IndexedDB not supported in current environment."),Fr(Qo,"Opening database:",o),new Uo(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Go(e))},i.onblocked=function(){r(new zr(Wr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new zr(Wr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Fr(Qo,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;a.createOrUpgrade(e,i.transaction,t.oldVersion,fu).next(function(){Fr(Qo,"Database upgrade to version "+fu+" complete")})}}).toPromise()},Go.delete=function(t){return Fr(Qo,"Removing database:",t),Zo(window.indexedDB.deleteDatabase(t)).toPromise()},Go.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Go.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=f(),e=Go.getIOSVersion(t),n=0<e&&e<10,r=Go.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Go.isMockPersistence=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},Go.getStore=function(t,e){return t.store(e)},Go.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Go.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Go.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Go.prototype.runTransaction=function(r,c,h){return p(this,void 0,void 0,function(){var o,a,s,e,u,n;return m(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),a=r.endsWith("idempotent"),s=0,e=function(){var e,n,r,i;return m(this,function(t){switch(t.label){case 0:++s,e=Ho.open(u.db,o?"readonly":"readwrite",c),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=h(e).catch(function(t){return e.abort(t),Uo.reject(t)}).toPromise()).catch(function(){}),[4,e.completionPromise];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=a&&"FirebaseError"!==r.name&&s<3,Fr(Qo,"Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Go.prototype.close=function(){this.db.close()},Go);function Go(t){this.db=t,12.2===Go.getIOSVersion(f())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Wo=(Object.defineProperty(zo.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(zo.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(zo.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),zo.prototype.done=function(){this.shouldStop=!0},zo.prototype.skip=function(t){this.nextKey=t},zo.prototype.delete=function(){return Zo(this.dbCursor.delete())},zo);function zo(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Ho=(Yo.open=function(t,e,n){return new Yo(t.transaction(n,e))},Object.defineProperty(Yo.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Yo.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Fr(Qo,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Yo.prototype.store=function(t){var e=this.transaction.objectStore(t);return Ur(!!e,"Object store not part of transaction: "+t),new Xo(e)},Yo);function Yo(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Xi,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=ta(t.target.error);n.completionDeferred.reject(e)}}var Xo=(Jo.prototype.put=function(t,e){return Zo(void 0!==e?(Fr(Qo,"PUT",this.store.name,t,e),this.store.put(e,t)):(Fr(Qo,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Jo.prototype.add=function(t){return Fr(Qo,"ADD",this.store.name,t,t),Zo(this.store.add(t))},Jo.prototype.get=function(e){var n=this;return Zo(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Fr(Qo,"GET",n.store.name,e,t),t})},Jo.prototype.delete=function(t){return Fr(Qo,"DELETE",this.store.name,t),Zo(this.store.delete(t))},Jo.prototype.count=function(){return Fr(Qo,"COUNT",this.store.name),Zo(this.store.count())},Jo.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Jo.prototype.deleteAll=function(t,e){Fr(Qo,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Jo.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Jo.prototype.iterateSerial=function(i){var t=this.cursor({});return new Uo(function(n,r){t.onerror=function(t){var e=ta(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Jo.prototype.iterateCursor=function(t,a){var s=[];return new Uo(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Wo(e),r=a(e.primaryKey,e.value,n);if(r instanceof Uo){var i=r.catch(function(t){return n.done(),Uo.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Uo.waitFor(s)})},Jo.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Ur(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Jo.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Jo);function Jo(t){this.store=t}function Zo(t){return new Uo(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=ta(t.target.error);r(e)}})}var $o=!1;function ta(t){var e=jo.getIOSVersion(f());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new zr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return $o||($o=!0,setTimeout(function(){throw r},0)),r}}return t}var ea=(na.forUser=function(t,e,n,r){return Ur(""!==t.uid,"UserID must not be an empty string."),new na(t.isAuthenticated()?t.uid:"",e,n,r)},na.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).iterate({index:wu.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},na.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=oa(n),ua(e).put(t)})},na.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},na.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=oa(n),ua(e).put(t)})},na.prototype.addMutationBatch=function(c,h,l,f){var p=this,d=sa(c),m=aa(c);return m.add({}).next(function(t){Ur("number"==typeof t,"Auto-generated key is not a number");for(var e=new Fo(t,h,l,f),n=p.serializer.toDbMutationBatch(p.userId,e),r=[],i=new So(function(t,e){return Si(t.canonicalString(),e.canonicalString())}),o=0,a=f;o<a.length;o++){var s=a[o],u=Su.key(p.userId,s.key.path,t);i=i.add(s.key.path.popLast()),r.push(m.put(n)),r.push(d.put(u,Su.PLACEHOLDER))}return i.forEach(function(t){r.push(p.indexManager.addToCollectionParentIndex(c,t))}),c.addOnCommittedListener(function(){p.documentKeysByBatchId[t]=e.keys()}),Uo.waitFor(r).next(function(){return e})})},na.prototype.lookupMutationBatch=function(t,e){var n=this;return aa(t).get(e).next(function(t){return t?(Ur(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},na.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Uo.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},na.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return aa(t).iterate({index:wu.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Ur(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},na.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return aa(t).iterate({index:wu.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},na.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).loadAll(wu.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},na.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=Su.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return sa(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=uo(i);if(r===c.userId&&u.path.isEqual(a))return aa(s).get(o).next(function(t){if(!t)throw Br("Dangling document-mutation reference found: "+e+" which points to "+o);Ur(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},na.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new So(Si),i=[];return t.forEach(function(s){var t=Su.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=sa(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=uo(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Uo.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},na.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Ur(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Ur(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=Su.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new So(Si);return sa(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=uo(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},na.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(aa(t).get(e).next(function(t){if(null===t)throw Br("Dangling document-mutation reference found, which points to "+e);Ur(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Uo.waitFor(i).next(function(){return r})},na.prototype.removeMutationBatch=function(e,n){var r=this;return ia(e.simpleDbTransaction,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),Uo.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},na.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},na.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Uo.resolve();var e=IDBKeyRange.lowerBound(Su.prefixForUser(o.userId)),i=[];return sa(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=uo(t[1]);i.push(r)}else n.done()}).next(function(){Ur(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},na.prototype.containsKey=function(t,e){return ra(t,this.userId,e)},na.prototype.getMutationQueueMetadata=function(t){var e=this;return ua(t).get(this.userId).next(function(t){return t||new vu(e.userId,-1,"")})},na);function na(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function ra(t,o,e){var n=Su.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return sa(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function ia(t,e,n){var r=t.store(wu.store),i=t.store(Su.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Ur(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Su.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Uo.waitFor(o).next(function(){return c})}function oa(t){return t instanceof Uint8Array?(Ur(jo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function aa(t){return Cc.getStore(t,wu.store)}function sa(t){return Cc.getStore(t,Su.store)}function ua(t){return Cc.getStore(t,vu.store)}var ca,ha;(ha=ca=ca||{})[ha.QueryCache=0]="QueryCache",ha[ha.SyncEngine=1]="SyncEngine";var la=(fa.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},fa.prototype.after=function(t){return this.seek(t+2),this.next()},fa.prototype.seek=function(t){Ur((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},fa.forTargetCache=function(){return new fa(ca.QueryCache,2)},fa.forSyncEngine=function(){return new fa(ca.SyncEngine)},fa);function fa(t,e){Ur((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var pa=(da.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},da.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return lo.fromTimestamp(new co(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},da.prototype.getHighestSequenceNumber=function(t){return ga(t.simpleDbTransaction)},da.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},da.prototype.addTargetData=function(e,n){var r=this;return this.saveTargetData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromTargetData(n,t),r.saveMetadata(e,t)})})},da.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},da.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return ma(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Ur(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.saveMetadata(e,t)})},da.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return ma(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(s++,u.push(a.removeTargetData(r,n)))}).next(function(){return Uo.waitFor(u)}).next(function(){return s})},da.prototype.forEachTarget=function(t,r){var i=this;return ma(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},da.prototype.retrieveMetadata=function(t){return ya(t.simpleDbTransaction)},da.prototype.saveMetadata=function(t,e){return function(t){return Cc.getStore(t,Ou.store)}(t).put(Ou.key,e)},da.prototype.saveTargetData=function(t,e){return ma(t).put(this.serializer.toDbTarget(e))},da.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},da.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},da.prototype.getTargetData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return ma(t).iterate({range:n,index:Ru.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.target)&&(a=r,n.done())}).next(function(){return a})},da.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=va(n);return t.forEach(function(t){var e=oo(t.path);o.push(a.put(new _u(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Uo.waitFor(o)},da.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=va(n);return Uo.forEach(t,function(t){var e=oo(t.path);return Uo.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},da.prototype.removeMatchingKeysForTargetId=function(t,e){var n=va(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},da.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=va(t),o=Oo();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=uo(t[1]),i=new Wi(r);o=o.add(i)}).next(function(){return o})},da.prototype.containsKey=function(t,e){var n=oo(e.path),r=IDBKeyRange.bound([n],[Ii(n)],!1,!0),i=0;return va(t).iterate({index:_u.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},da.prototype.getTargetDataForTarget=function(t,e){var n=this;return ma(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},da);function da(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=la.forTargetCache()}function ma(t){return Cc.getStore(t,Ru.store)}function ya(t){return jo.getStore(t,Ou.store).get(Ou.key).next(function(t){return Ur(null!==t,"Missing metadata row."),t})}function ga(t){return ya(t).next(function(t){return t.highestListenSequenceNumber})}function va(t){return Cc.getStore(t,_u.store)}var ba=(wa.fromSet=function(t){return new wa(t)},wa.fromArray=function(t){var e=new So(ji.comparator);return t.forEach(function(t){return e=e.add(t)}),new wa(e)},wa.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},wa.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},wa);function wa(t){this.fields=t}var Ta=(Sa.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Sa);function Sa(t,e){this.field=t,this.transform=e}var Ea,Ia,Ca=function(t,e){this.version=t,this.transformResults=e};(Ia=Ea=Ea||{})[Ia.Set=0]="Set",Ia[Ia.Patch=1]="Patch",Ia[Ia.Transform=2]="Transform",Ia[Ia.Delete=3]="Delete",Ia[Ia.Verify=4]="Verify";var Da=(Na.exists=function(t){return new Na(void 0,t)},Na.updateTime=function(t){return new Na(t)},Object.defineProperty(Na.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Na.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Ks&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ks:(Ur(this.isNone,"Precondition should be empty"),!0)},Na.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Na.NONE=new Na,Na);function Na(t,e){this.updateTime=t,this.exists=e,Ur(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Aa=(ka.prototype.verifyKeyMatches=function(t){null!=t&&Ur(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},ka.getPostMutationVersion=function(t){return t instanceof Ks?t.version:lo.MIN},ka);function ka(){}var Ra,Ma=(t(_a,Ra=Aa),_a.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Ur(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ks(this.key,n,{hasCommittedMutations:!0},this.value)},_a.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Aa.getPostMutationVersion(t);return new Ks(this.key,r,{hasLocalMutations:!0},this.value)},_a.prototype.extractBaseValue=function(t){return null},_a.prototype.isEqual=function(t){return t instanceof _a&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},_a);function _a(t,e,n){var r=Ra.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Ea.Set,r}var La,Oa=(t(Pa,La=Aa),Pa.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Ur(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Hs(this.key,e.version);var n=this.patchDocument(t);return new Ks(this.key,e.version,{hasCommittedMutations:!0},n)},Pa.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Aa.getPostMutationVersion(t),i=this.patchDocument(t);return new Ks(this.key,r,{hasLocalMutations:!0},i)},Pa.prototype.extractBaseValue=function(t){return null},Pa.prototype.isEqual=function(t){return t instanceof Pa&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Pa.prototype.patchDocument=function(t){var e;return e=t instanceof Ks?t.data():Os.EMPTY,this.patchObject(e)},Pa.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Pa);function Pa(t,e,n,r){var i=La.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Ea.Patch,i}var xa,Fa=(t(qa,xa=Aa),qa.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Ur(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Hs(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Ks(this.key,i,{hasCommittedMutations:!0},o)},qa.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Ks(this.key,r.version,{hasLocalMutations:!0},o)},qa.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ks?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Os.EMPTY.set(i.field,a):e.set(i.field,a))}return e},qa.prototype.isEqual=function(t){return t instanceof qa&&this.key.isEqual(t.key)&&Ei(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},qa.prototype.requireDocument=function(t){return Ur(t instanceof Ks,"Unknown MaybeDocument type "+t),Ur(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},qa.prototype.serverTransformResults=function(t,e){var n=[];Ur(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Ks&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},qa.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Ks&&(u=e.field(a.field)),null===u&&n instanceof Ks&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},qa.prototype.transformObject=function(t,e){Ur(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},qa);function qa(t,e){var n=xa.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Ea.Transform,n.precondition=Da.exists(!0),n}var Va,Ba=(t(Ua,Va=Aa),Ua.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Ur(null==e.transformResults,"Transform results received by DeleteMutation."),new Gs(this.key,e.version,{hasCommittedMutations:!0})},Ua.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Ur(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Gs(this.key,lo.forDeletedDoc())):t},Ua.prototype.extractBaseValue=function(t){return null},Ua.prototype.isEqual=function(t){return t instanceof Ua&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Ua);function Ua(t,e){var n=Va.call(this)||this;return n.key=t,n.precondition=e,n.type=Ea.Delete,n}var Ka,Qa,ja,Ga,Wa,za=(t(Ha,Ka=Aa),Ha.prototype.applyToRemoteDocument=function(t,e){Br("VerifyMutation should only be used in Transactions.")},Ha.prototype.applyToLocalView=function(t,e,n){Br("VerifyMutation should only be used in Transactions.")},Ha.prototype.extractBaseValue=function(t){Br("VerifyMutation should only be used in Transactions.")},Ha.prototype.isEqual=function(t){return t instanceof Ha&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Ha);function Ha(t,e){var n=Ka.call(this)||this;return n.key=t,n.precondition=e,n.type=Ea.Verify,n}(ja=Qa=Qa||{})[ja.NullValue=0]="NullValue",ja[ja.BooleanValue=1]="BooleanValue",ja[ja.NumberValue=2]="NumberValue",ja[ja.TimestampValue=3]="TimestampValue",ja[ja.StringValue=4]="StringValue",ja[ja.BlobValue=5]="BlobValue",ja[ja.RefValue=6]="RefValue",ja[ja.GeoPointValue=7]="GeoPointValue",ja[ja.ArrayValue=8]="ArrayValue",ja[ja.ObjectValue=9]="ObjectValue",(Wa=Ga=Ga||{})[Wa.Default=0]="Default",Wa[Wa.Estimate=1]="Estimate",Wa[Wa.Previous=2]="Previous";var Ya=(Xa.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Xa(Ga.Estimate,e);case"previous":return new Xa(Ga.Previous,e);case"none":case void 0:return new Xa(Ga.Default,e);default:return Br("fromSnapshotOptions() called with invalid options.")}},Xa);function Xa(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Ja=(Za.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Za.prototype.defaultCompareTo=function(t){return Ur(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Si(this.typeOrder,t.typeOrder)},Za);function Za(){}var $a,ts=(t(es,$a=Ja),es.prototype.value=function(t){return null},es.prototype.isEqual=function(t){return t instanceof es},es.prototype.compareTo=function(t){return t instanceof es?0:this.defaultCompareTo(t)},es.prototype.approximateByteSize=function(){return 4},es.INSTANCE=new es,es);function es(){var t=$a.call(this)||this;return t.typeOrder=Qa.NullValue,t.internalValue=null,t}var ns,rs=(t(is,ns=Ja),is.prototype.value=function(t){return this.internalValue},is.prototype.isEqual=function(t){return t instanceof is&&this.internalValue===t.internalValue},is.prototype.compareTo=function(t){return t instanceof is?Si(this,t):this.defaultCompareTo(t)},is.prototype.approximateByteSize=function(){return 4},is.of=function(t){return t?is.TRUE:is.FALSE},is.TRUE=new is(!0),is.FALSE=new is(!1),is);function is(t){var e=ns.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.BooleanValue,e}var os,as=(t(ss,os=Ja),ss.prototype.value=function(t){return this.internalValue},ss.prototype.compareTo=function(t){return t instanceof ss?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},ss.prototype.approximateByteSize=function(){return 8},ss);function ss(t){var e=os.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.NumberValue,e}function us(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var cs,hs=(t(ls,cs=as),ls.prototype.isEqual=function(t){return t instanceof ls&&us(this.internalValue,t.internalValue)},ls);function ls(){return null!==cs&&cs.apply(this,arguments)||this}var fs,ps=(t(ds,fs=as),ds.prototype.isEqual=function(t){return t instanceof ds&&us(this.internalValue,t.internalValue)},ds.NAN=new ds(NaN),ds.POSITIVE_INFINITY=new ds(1/0),ds.NEGATIVE_INFINITY=new ds(-1/0),ds);function ds(){return null!==fs&&fs.apply(this,arguments)||this}var ms,ys=(t(gs,ms=Ja),gs.prototype.value=function(t){return this.internalValue},gs.prototype.isEqual=function(t){return t instanceof gs&&this.internalValue===t.internalValue},gs.prototype.compareTo=function(t){return t instanceof gs?Si(this.internalValue,t.internalValue):this.defaultCompareTo(t)},gs.prototype.approximateByteSize=function(){return 2*this.internalValue.length},gs);function gs(t){var e=ms.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.StringValue,e}var vs,bs=(t(ws,vs=Ja),ws.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},ws.prototype.isEqual=function(t){return t instanceof ws&&this.internalValue.isEqual(t.internalValue)},ws.prototype.compareTo=function(t){return t instanceof ws?this.internalValue._compareTo(t.internalValue):t instanceof Ss?-1:this.defaultCompareTo(t)},ws.prototype.approximateByteSize=function(){return 16},ws);function ws(t){var e=vs.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.TimestampValue,e}var Ts,Ss=(t(Es,Ts=Ja),Es.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ga.Estimate?new bs(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ga.Previous&&this.previousValue?this.previousValue.value(t):null},Es.prototype.isEqual=function(t){return t instanceof Es&&this.localWriteTime.isEqual(t.localWriteTime)},Es.prototype.compareTo=function(t){return t instanceof Es?this.localWriteTime._compareTo(t.localWriteTime):t instanceof bs?1:this.defaultCompareTo(t)},Es.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Es.prototype.approximateByteSize=function(){return 16+(this.previousValue?this.previousValue.approximateByteSize():0)},Es);function Es(t,e){var n=Ts.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Qa.TimestampValue,n}var Is,Cs=(t(Ds,Is=Ja),Ds.prototype.value=function(t){return this.internalValue},Ds.prototype.isEqual=function(t){return t instanceof Ds&&this.internalValue.isEqual(t.internalValue)},Ds.prototype.compareTo=function(t){return t instanceof Ds?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Ds.prototype.approximateByteSize=function(){return this.internalValue._approximateByteSize()},Ds);function Ds(t){var e=Is.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.BlobValue,e}var Ns,As=(t(ks,Ns=Ja),ks.prototype.value=function(t){return this.key},ks.prototype.isEqual=function(t){return t instanceof ks&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},ks.prototype.compareTo=function(t){if(t instanceof ks){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Wi.comparator(this.key,t.key)}return this.defaultCompareTo(t)},ks.prototype.approximateByteSize=function(){return this.databaseId.projectId.length+this.databaseId.database.length+this.key.toString().length},ks);function ks(t,e){var n=Ns.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Qa.RefValue,n}var Rs,Ms=(t(_s,Rs=Ja),_s.prototype.value=function(t){return this.internalValue},_s.prototype.isEqual=function(t){return t instanceof _s&&this.internalValue.isEqual(t.internalValue)},_s.prototype.compareTo=function(t){return t instanceof _s?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},_s.prototype.approximateByteSize=function(){return 16},_s);function _s(t){var e=Rs.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.GeoPointValue,e}var Ls,Os=(t(Ps,Ls=Ja),Ps.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},Ps.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Ps.prototype.isEqual=function(t){if(t instanceof Ps){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Ps.prototype.compareTo=function(t){if(t instanceof Ps){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=Si(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return Si(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Ps.prototype.set=function(t,e){if(Ur(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Ps||(n=Ps.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Ps.prototype.delete=function(t){if(Ur(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ps(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Ps){var n=e.delete(t.popFirst());return new Ps(this.internalValue.insert(t.firstSegment(),n))}return this},Ps.prototype.contains=function(t){return null!==this.field(t)},Ps.prototype.field=function(t){Ur(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ps?e.internalValue.get(t):null}),e},Ps.prototype.fieldMask=function(){var i=new So(ji.comparator);return this.internalValue.forEach(function(t,e){var n=new ji([t]);if(e instanceof Ps){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),ba.fromSet(i)},Ps.prototype.approximateByteSize=function(){var n=0;return this.internalValue.inorderTraversal(function(t,e){n+=t.length+e.approximateByteSize()}),n},Ps.prototype.toString=function(){return this.internalValue.toString()},Ps.prototype.child=function(t){return this.internalValue.get(t)||void 0},Ps.prototype.setChild=function(t,e){return new Ps(this.internalValue.insert(t,e))},Ps.EMPTY=new Ps(new po(Si)),Ps);function Ps(t){var e=Ls.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.ObjectValue,e}var xs,Fs=(t(qs,xs=Ja),qs.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},qs.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},qs.prototype.forEach=function(t){this.internalValue.forEach(t)},qs.prototype.isEqual=function(t){if(t instanceof qs){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},qs.prototype.compareTo=function(t){if(t instanceof qs){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return Si(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},qs.prototype.approximateByteSize=function(){return this.internalValue.reduce(function(t,e){return t+e.approximateByteSize()},0)},qs.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},qs);function qs(t){var e=xs.call(this)||this;return e.internalValue=t,e.typeOrder=Qa.ArrayValue,e}var Vs=(Bs.compareByKey=function(t,e){return Wi.comparator(t.key,e.key)},Bs);function Bs(t,e){this.key=t,this.version=e}var Us,Ks=(t(Qs,Us=Vs),Qs.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Qs.prototype.data=function(){var n=this;if(!this.objectValue){var r=Os.EMPTY;$r(this.proto.fields||{},function(t,e){r=r.set(new ji([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Qs.prototype.value=function(){return this.data().value()},Qs.prototype.isEqual=function(t){return t instanceof Qs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Qs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Qs.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Qs.prototype.getProtoField=function(t){Ur(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Qs.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Br("Trying to compare documents on fields that don't exist")},Qs);function Qs(t,e,n,r,i,o){var a=Us.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Ur(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var js,Gs=(t(Ws,js=Vs),Ws.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ws.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ws.prototype.isEqual=function(t){return t instanceof Ws&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ws);function Ws(t,e,n){var r=js.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var zs,Hs=(t(Ys,zs=Vs),Ys.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ys.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ys.prototype.isEqual=function(t){return t instanceof Ys&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ys);function Ys(){return null!==zs&&zs.apply(this,arguments)||this}var Xs=(Js.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Js.prototype.has=function(t){return void 0!==this.get(t)},Js.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Js.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Js.prototype.forEach=function(s){$r(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Js.prototype.isEmpty=function(){return ti(this.inner)},Js);function Js(t){this.mapKeyFn=t,this.inner={}}var Zs=(Object.defineProperty($s.prototype,"readTime",{get:function(){return Ur(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Ur(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),$s.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},$s.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},$s.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Uo.resolve(n):this.getFromCache(t,e)},$s.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},$s.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},$s.prototype.assertNotApplied=function(){Ur(!this.changesApplied,"Changes have already been applied.")},$s);function $s(){this.changes=new Xs(function(t){return t.toString()}),this.changesApplied=!1}var tu,eu=(nu.prototype.addEntry=function(t,e,n){return ou(t).put(au(e),n)},nu.prototype.removeEntry=function(t,e){var n=ou(t),r=au(e);return n.delete(r)},nu.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},nu.prototype.getEntry=function(t,e){var n=this;return ou(t).get(au(e)).next(function(t){return n.maybeDecodeDocument(t)})},nu.prototype.getSizedEntry=function(t,e){var n=this;return ou(t).get(au(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:su(t)}:null})},nu.prototype.getEntries=function(t,e){var r=this,i=Ao();return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);i=i.insert(t,n)}).next(function(){return i})},nu.prototype.getSizedEntries=function(t,e){var r=this,i=Ao(),o=new po(Wi.comparator);return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);o=n?(i=i.insert(t,n),o.insert(t,su(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},nu.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Uo.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return ou(t).iterate({range:n},function(t,e,n){for(var r=Wi.fromSegments(t);a&&Wi.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},nu.prototype.getDocumentsMatchingQuery=function(t,i,e){var o=this;Ur(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=Ro(),s=i.path.length+1,n={};if(e.isEqual(lo.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(e);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=Du.collectionReadTimeIndex}return ou(t).iterate(n,function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Ks&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},nu.prototype.getNewDocumentChanges=function(t,e){var r=this,i=No(),o=this.serializer.toDbTimestampKey(e),n=ou(t),a=IDBKeyRange.lowerBound(o,!0);return n.iterate({index:Du.readTimeIndex,range:a},function(t,e){var n=r.serializer.fromDbRemoteDocument(e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{changedDocs:i,readTime:r.serializer.fromDbTimestampKey(o)}})},nu.prototype.getLastReadTime=function(t){var r=this,e=ou(t),i=lo.MIN;return e.iterate({index:Du.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.fromDbTimestampKey(e.readTime)),n.done()}).next(function(){return i})},nu.prototype.newChangeBuffer=function(t){return new nu.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},nu.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},nu.prototype.getMetadata=function(t){return iu(t).get(Au.key).next(function(t){return Ur(!!t,"Missing document cache metadata"),t})},nu.prototype.setMetadata=function(t,e){return iu(t).put(Au.key,e)},nu.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof Gs&&e.version.isEqual(lo.forDeletedDoc())?null:e}return null},nu.RemoteDocumentChangeBuffer=(t(ru,tu=Zs),ru.prototype.applyChanges=function(a){var s=this,u=[],c=0,h=new So(function(t,e){return Si(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n=s.documentSizes.get(t);if(Ur(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Ur(!s.readTime.isEqual(lo.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(e,s.readTime);h=h.add(t.path.popLast());var i=su(r);c+=i-n,u.push(s.documentCache.addEntry(a,t,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new Gs(t,lo.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,t,o))}else u.push(s.documentCache.removeEntry(a,t))}),h.forEach(function(t){u.push(s.documentCache.indexManager.addToCollectionParentIndex(a,t))}),u.push(this.documentCache.updateMetadata(a,c)),Uo.waitFor(u)},ru.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},ru.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},ru),nu);function nu(t,e){this.serializer=t,this.indexManager=e}function ru(t,e){var n=tu.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Xs(function(t){return t.toString()}),n}function iu(t){return Cc.getStore(t,Au.store)}function ou(t){return Cc.getStore(t,Du.store)}function au(t){return t.path.toArray()}function su(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Br("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var uu=(cu.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Uo.resolve()},cu.prototype.getCollectionParents=function(t,e){return Uo.resolve(this.collectionParentIndex.getEntries(e))},cu);function cu(){this.collectionParentIndex=new hu}var hu=(lu.prototype.add=function(t){Ur(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new So(Bi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},lu.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},lu.prototype.getEntries=function(t){return(this.index[t]||new So(Bi.comparator)).toArray()},lu);function lu(){this.index={}}var fu=9,pu=(du.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Ur(n<r&&0<=n&&r<=fu,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Ho(e);n<1&&1<=r&&(function(t){t.createObjectStore(yu.store)}(t),function(t){t.createObjectStore(vu.store,{keyPath:vu.keyPath}),t.createObjectStore(wu.store,{keyPath:wu.keyPath,autoIncrement:!0}).createIndex(wu.userMutationsIndex,wu.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Su.store)}(t),qu(t),function(t){t.createObjectStore(Du.store)}(t));var a=Uo.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(_u.store),t.deleteObjectStore(Ru.store),t.deleteObjectStore(Ou.store)}(t),qu(t)),a=a.next(function(){return function(t){var e=t.store(Ou.store),n=new Ou(0,0,lo.MIN.toTimestamp(),0);return e.put(Ou.key,n)}(o)})),n<4&&4<=r&&(0!==n&&(a=a.next(function(){return function(r,i){return i.store(wu.store).loadAll().next(function(t){r.deleteObjectStore(wu.store),r.createObjectStore(wu.store,{keyPath:wu.keyPath,autoIncrement:!0}).createIndex(wu.userMutationsIndex,wu.userMutationsKeyPath,{unique:!0});var e=i.store(wu.store),n=t.map(function(t){return e.put(t)});return Uo.waitFor(n)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(Vu.store,{keyPath:Vu.keyPath})}(t)})),n<5&&5<=r&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&6<=r&&(a=a.next(function(){return function(t){t.createObjectStore(Au.store)}(t),i.addDocumentGlobal(o)})),n<7&&7<=r&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&8<=r&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&9<=r&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Du.store);e.createIndex(Du.readTimeIndex,Du.readTimeIndexPath,{unique:!1}),e.createIndex(Du.collectionReadTimeIndex,Du.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},du.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Du.store).iterate(function(t,e){n+=su(e)}).next(function(){var t=new Au(n);return e.store(Au.store).put(Au.key,t)})},du.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(vu.store),e=r.store(wu.store);return t.loadAll().next(function(t){return Uo.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(wu.userMutationsIndex,t).next(function(t){return Uo.forEach(t,function(t){Ur(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return ia(r,n.userId,e).next(function(){})})})})})},du.prototype.ensureSequenceNumbers=function(t){var a=t.store(_u.store),e=t.store(Du.store);return ga(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Bi(t),r=function(t){return[0,oo(t)]}(n);o.push(a.get(r).next(function(t){return t?Uo.resolve():function(t){return a.put(new _u(0,oo(t),i))}(n)}))}).next(function(){return Uo.waitFor(o)})})},du.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:oo(n)})}}t.createObjectStore(xu.store,{keyPath:xu.keyPath});var r=e.store(xu.store),o=new hu;return e.store(Du.store).iterate({keysOnly:!0},function(t,e){var n=new Bi(t);return i(n.popLast())}).next(function(){return e.store(Su.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],uo(n));return i(r.popLast())})})},du);function du(t){this.serializer=t}var mu=function(t,e){this.seconds=t,this.nanoseconds=e},yu=(gu.store="owner",gu.key="owner",gu);function gu(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var vu=(bu.store="mutationQueues",bu.keyPath="userId",bu);function bu(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var wu=(Tu.store="mutations",Tu.keyPath="batchId",Tu.userMutationsIndex="userMutationsIndex",Tu.userMutationsKeyPath=["userId","batchId"],Tu);function Tu(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Su=(Eu.prefixForUser=function(t){return[t]},Eu.prefixForPath=function(t,e){return[t,oo(e)]},Eu.key=function(t,e,n){return[t,oo(e),n]},Eu.store="documentMutations",Eu.PLACEHOLDER=new Eu,Eu);function Eu(){}var Iu=function(t,e){this.path=t,this.readTime=e},Cu=function(t,e){this.path=t,this.version=e},Du=(Nu.store="remoteDocuments",Nu.readTimeIndex="readTimeIndex",Nu.readTimeIndexPath="readTime",Nu.collectionReadTimeIndex="collectionReadTimeIndex",Nu.collectionReadTimeIndexPath=["parentPath","readTime"],Nu);function Nu(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var Au=(ku.store="remoteDocumentGlobal",ku.key="remoteDocumentGlobalKey",ku);function ku(t){this.byteSize=t}var Ru=(Mu.store="targets",Mu.keyPath="targetId",Mu.queryTargetsIndexName="queryTargetsIndex",Mu.queryTargetsKeyPath=["canonicalId","targetId"],Mu);function Mu(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var _u=(Lu.store="targetDocuments",Lu.keyPath=["targetId","path"],Lu.documentTargetsIndex="documentTargetsIndex",Lu.documentTargetsKeyPath=["path","targetId"],Lu);function Lu(t,e,n){this.targetId=t,this.path=e,Ur(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var Ou=(Pu.key="targetGlobalKey",Pu.store="targetGlobal",Pu);function Pu(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var xu=(Fu.store="collectionParents",Fu.keyPath=["collectionId","parent"],Fu);function Fu(t,e){this.collectionId=t,this.parent=e}function qu(t){t.createObjectStore(_u.store,{keyPath:_u.keyPath}).createIndex(_u.documentTargetsIndex,_u.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ru.store,{keyPath:Ru.keyPath}).createIndex(Ru.queryTargetsIndexName,Ru.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ou.store)}var Vu=(Bu.store="clientMetadata",Bu.keyPath="clientId",Bu);function Bu(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var Uu,Ku,Qu=a(a(a([vu.store,wu.store,Su.store,Du.store,Ru.store,yu.store,Ou.store,_u.store],[Vu.store]),[Au.store]),[xu.store]),ju=(Gu.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Ur(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return Uo.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.collectionParentsCache.add(e)});var o={collectionId:r,parent:oo(i)};return Wu(t).put(o)},Gu.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Ii(i),""],!1,!0);return Wu(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(uo(r.parent))}return o})},Gu);function Gu(){this.collectionParentsCache=new hu}function Wu(t){return Cc.getStore(t,xu.store)}(Ku=Uu=Uu||{})[Ku.Listen=0]="Listen",Ku[Ku.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",Ku[Ku.LimboResolution=2]="LimboResolution";var zu=(Hu.prototype.withSequenceNumber=function(t){return new Hu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Hu.prototype.withResumeToken=function(t,e){return new Hu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Hu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Hu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Hu.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},Hu);function Hu(t,e,n,r,i,o,a){void 0===i&&(i=lo.MIN),void 0===o&&(o=lo.MIN),void 0===a&&(a=jr()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var Yu=(Xu.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Wi.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Gs(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Wi.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Hs(e,n)):Br("Unexpected DbRemoteDocument")},Xu.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Ks){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new Du(null,null,i,o,n,r)}if(t instanceof Gs){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new Du(null,new Iu(a,s),null,o,n,r)}if(t instanceof Hs){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new Du(new Cu(a,u),null,null,!0,n,r)}return Br("Unexpected MaybeDocument")},Xu.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},Xu.prototype.fromDbTimestampKey=function(t){var e=new co(t[0],t[1]);return lo.fromTimestamp(e)},Xu.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new mu(e.seconds,e.nanoseconds)},Xu.prototype.fromDbTimestamp=function(t){var e=new co(t.seconds,t.nanoseconds);return lo.fromTimestamp(e)},Xu.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new wu(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Xu.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=co.fromMillis(t.localWriteTimeMs);return new Fo(t.batchId,i,n,r)},Xu.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(oo(t.path))}),e},Xu.prototype.fromDbResourcePaths=function(t){for(var e=Oo(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Wi(uo(i)))}return e},Xu.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):lo.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new zu(e,t.targetId,Uu.Listen,t.lastListenSequenceNumber,n,r,i)},Xu.prototype.toDbTarget=function(t){Ur(Uu.Listen===t.purpose,"Only queries with purpose "+Uu.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?(Ur(jo.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Ru(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},Xu);function Xu(t){this.remoteSerializer=t}var Ju=(Zu.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},Zu.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},Zu.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=Ao();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},Zu.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},Zu.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=No();return e.forEach(function(t,e){e=e||new Gs(t,lo.forDeletedDoc()),n=n.insert(t,e)}),n})},Zu.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},Zu.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Wi(e)).next(function(t){var e=Ro();return t instanceof Ks&&(e=e.insert(t.key,t)),e})},Zu.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Ur(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=Ro();return this.indexManager.getCollectionParents(n,a).next(function(t){return Uo.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(a));return o.getDocumentsMatchingCollectionQuery(n,e,i).next(function(t){t.forEach(function(t,e){s=s.insert(t,e)})})}).next(function(){return s})})},Zu.prototype.getDocumentsMatchingCollectionQuery=function(e,n,t){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,t).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof Ks?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},Zu.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Oo(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Oa&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ks&&(c=c.insert(t,e))}),c})},Zu);function Zu(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var $u="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",tc=(ec.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},ec.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},ec);function ec(){this.onCommittedListeners=[]}var nc=(rc.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},rc.prototype.addReference=function(t,e){var n=new ic(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},rc.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},rc.prototype.removeReference=function(t,e){this.removeRef(new ic(t,e))},rc.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},rc.prototype.removeReferencesForId=function(t){var e=this,n=Wi.EMPTY,r=new ic(n,t),i=new ic(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},rc.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},rc.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},rc.prototype.referencesForId=function(t){var e=Wi.EMPTY,n=new ic(e,t),r=new ic(e,t+1),i=Oo();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},rc.prototype.containsKey=function(t){var e=new ic(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},rc);function rc(){this.refsByKey=new So(ic.compareByKey),this.refsByTarget=new So(ic.compareByTargetId)}var ic=(oc.compareByKey=function(t,e){return Wi.comparator(t.key,e.key)||Si(t.targetOrBatchId,e.targetOrBatchId)},oc.compareByTargetId=function(t,e){return Si(t.targetOrBatchId,e.targetOrBatchId)||Wi.comparator(t.key,e.key)},oc);function oc(t,e){this.key=t,this.targetOrBatchId=e}var ac="LocalStore",sc=(uc.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},uc.prototype.handleUserChange=function(i){return p(this,void 0,void 0,function(){var e,y,n,r=this;return m(this,function(t){switch(t.label){case 0:return e=this.mutationQueue,y=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var m;return r.mutationQueue.getAllMutationBatches(d).next(function(t){return m=t,e=r.persistence.getMutationQueue(i),y=new Ju(r.remoteDocuments,e,r.persistence.getIndexManager()),e.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Oo(),i=0,o=m;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return y.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return n=t.sent(),this.mutationQueue=e,this.localDocuments=y,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,n]}})})},uc.prototype.localWrite=function(s){var u,c=this,h=co.now(),t=s.reduce(function(t,e){return t.add(e.key)},Oo());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(a){return c.localDocuments.getDocuments(a,t).next(function(t){u=t;for(var e=[],n=0,r=s;n<r.length;n++){var i=r[n],o=i.extractBaseValue(u.get(i.key));null!=o&&e.push(new Oa(i.key,o,o.fieldMask(),Da.exists(!0)))}return c.mutationQueue.addMutationBatch(a,h,e,s)})}).then(function(t){var e=t.applyToLocalDocumentSet(u);return{batchId:t.batchId,changes:e}})},uc.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Uo.resolve(null)})})},uc.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},uc.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Ur(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},uc.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},uc.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.mutationQueue.getLastStreamToken(t)})},uc.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},uc.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.targetCache.getLastRemoteSnapshotVersion(t)})},uc.prototype.applyRemoteEvent=function(u){var c=this,h=u.snapshotVersion,l=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});l=c.targetDataByTarget;var a=[];Zr(u.targetChanges,function(t,e){var n=l.get(t);if(n){a.push(c.targetCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.targetCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);l=l.insert(t,i),uc.shouldPersistTargetData(n,i,e)&&a.push(c.targetCache.updateTargetData(o,i))}}});var s=No(),n=Oo();if(u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(i.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);e instanceof Gs&&e.version.isEqual(lo.MIN)?(i.removeEntry(t,h),s=s.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(Ur(!lo.MIN.isEqual(h),"Cannot add a document when the remote version is zero"),i.addEntry(e,h),s=s.insert(t,e)):Fr(ac,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual(lo.MIN)){var t=c.targetCache.getLastRemoteSnapshotVersion(o).next(function(t){return Ur(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),c.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return Uo.waitFor(a).next(function(){return i.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,s)})}).then(function(t){return c.targetDataByTarget=l,t})},uc.shouldPersistTargetData=function(t,e,n){return Ur(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},uc.prototype.notifyLocalViewChanges=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Ur(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Uo.forEach(t,function(t){return Uo.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},uc.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},uc.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.localDocuments.getDocument(t,e)})},uc.prototype.allocateTarget=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.targetCache.getTargetData(e,r).next(function(t){return t?(n=t,Uo.resolve(n)):i.targetCache.allocateTargetId(e).next(function(t){return n=new zu(r,t,Uu.Listen,e.currentSequenceNumber),i.targetCache.addTargetData(e,n).next(function(){return n})})})}).then(function(t){return null===i.targetDataByTarget.get(t.targetId)&&(i.targetDataByTarget=i.targetDataByTarget.insert(t.targetId,t),i.targetIdByTarget.set(r,t.targetId)),t})},uc.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Uo.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},uc.prototype.releaseTarget=function(n,r){var i=this,o=this.targetDataByTarget.get(n);Ur(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.localViewReferences.removeReferencesForId(n);return r?Uo.resolve():Uo.forEach(t,function(t){return i.persistence.referenceDelegate.removeReference(e,t)}).next(function(){i.persistence.referenceDelegate.removeTarget(e,o)})}).then(function(){i.targetDataByTarget=i.targetDataByTarget.remove(n),i.targetIdByTarget.delete(o.target)})},uc.prototype.executeQuery=function(t,n){var r=this,i=lo.MIN,o=Oo();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.getTargetData(e,t.toTarget()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(function(t){o=t})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:lo.MIN,n?o:Oo())}).next(function(t){return{documents:t,remoteKeys:o}})})},uc.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.targetCache.getMatchingKeysForTargetId(t,e)})},uc.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},uc.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},uc.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},uc.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Uo.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Ur(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e,i.commitVersion):Ur(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},uc.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.collect(t,n.targetDataByTarget)})},uc.prototype.getTarget=function(e){var n=this,t=this.targetDataByTarget.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.targetCache.getTargetDataForTarget(t,e).next(function(t){return t?t.target:null})})},uc.prototype.getNewDocumentChanges=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.remoteDocuments.getNewDocumentChanges(t,r.lastDocumentChangeReadTime)}).then(function(t){var e=t.changedDocs,n=t.readTime;return r.lastDocumentChangeReadTime=n,e})},uc.prototype.synchronizeLastDocumentChangeReadTime=function(){return p(this,void 0,void 0,function(){var e,n=this;return m(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.remoteDocuments.getLastReadTime(t)})];case 1:return e.lastDocumentChangeReadTime=t.sent(),[2]}})})},uc.RESUME_TOKEN_MAX_AGE_MICROS=3e8,uc);function uc(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new nc,this.targetDataByTarget=new po(Si),this.targetIdByTarget=new Xs(function(t){return t.canonicalId()}),this.lastDocumentChangeReadTime=lo.MIN,Ur(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new Ju(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}function cc(e){return p(this,void 0,void 0,function(){return m(this,function(t){if(e.code!==Wr.FAILED_PRECONDITION||e.message!==$u)throw e;return Fr(ac,"Unexpectedly lost primary lease"),[2]})})}function hc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Si(n,i);return 0===a?Si(r,o):a}var lc=(fc.prototype.nextIndex=function(){return++this.previousIndex},fc.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();hc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(fc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),fc);function fc(t){this.maxElements=t,this.buffer=new So(hc),this.previousIndex=0}var pc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dc=(mc.withCacheSize=function(t){return new mc(t,mc.DEFAULT_COLLECTION_PERCENTILE,mc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},mc.COLLECTION_DISABLED=-1,mc.MINIMUM_CACHE_SIZE_BYTES=1048576,mc.DEFAULT=new mc(mc.DEFAULT_CACHE_SIZE_BYTES=41943040,mc.DEFAULT_COLLECTION_PERCENTILE=10,mc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),mc.DISABLED=new mc(mc.COLLECTION_DISABLED,0,0),mc);function mc(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var yc=(gc.prototype.start=function(){Ur(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==dc.COLLECTION_DISABLED&&this.scheduleGC()},gc.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(gc.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),gc.prototype.scheduleGC=function(){var t=this;Ur(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Fr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Hi.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(cc)})},gc);function gc(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var vc=(bc.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},bc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Uo.resolve(Oi.INVALID);var r=new lc(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},bc.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},bc.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},bc.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===dc.COLLECTION_DISABLED?(Fr("LruGarbageCollector","Garbage collection skipped; disabled"),Uo.resolve(pc)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Fr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),pc):r.runGarbageCollection(e,n)})},bc.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},bc.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Fr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Pr()<=Cr.DEBUG&&Fr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Uo.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},bc);function bc(t,e){this.delegate=t,this.params=e}var wc,Tc="IndexedDbPersistence",Sc="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ec=(t(Ic,wc=tc),Ic);function Ic(t,e){var n=wc.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var Cc=(Dc.getStore=function(t,e){if(t instanceof Ec)return jo.getStore(t.simpleDbTransaction,e);throw Br("IndexedDbPersistence must use instances of IndexedDbTransaction")},Dc.createIndexedDbPersistence=function(n){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:if(!Dc.isAvailable())throw new zr(Wr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Dc(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},Dc.prototype.start=function(){var e=this;return Ur(!this.started,"IndexedDbPersistence double-started!"),Ur(null!==this.window,"Expected 'window' to be defined"),jo.openOrCreate(this.dbName,fu,new pu(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.simpleDb.runTransaction("readonly-idempotent",[Ou.store],function(t){return ga(t)})}).then(function(t){e.listenSequence=new Oi(t,e.sequenceNumberSyncer)}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},Dc.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return p(t,void 0,void 0,function(){return m(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Dc.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return p(t,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Dc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return p(e,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Dc.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.simpleDb.runTransaction("readwrite-idempotent",Qu,function(e){return Ac(e).put(new Vu(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(e).next(function(t){t||(n.isPrimary=!1,n.queue.enqueueAndForget(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(e)}).next(function(t){return n.isPrimary&&!t?n.releasePrimaryLeaseIfHeld(e).next(function(){return!1}):!!t&&n.acquireOrExtendPrimaryLease(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Fr(Tc,"Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.queue.enqueueAndForget(function(){return n.primaryStateListener(t)}),n.isPrimary=t})},Dc.prototype.verifyPrimaryLease=function(t){var e=this;return Nc(t).get(yu.key).next(function(t){return Uo.resolve(e.isLocalClient(t))})},Dc.prototype.removeClientMetadata=function(t){return Ac(t).delete(this.clientId)},Dc.prototype.maybeGarbageCollectMultiClientState=function(){return p(this,void 0,void 0,function(){var i=this;return m(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Dc.getStore(t,Vu.store);return r.loadAll().next(function(t){var e=i.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Uo.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},Dc.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Hi.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Dc.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Dc.prototype.canActAsPrimary=function(e){var i=this;return Nc(e).get(yu.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new zr(Wr.FAILED_PRECONDITION,Sc);return!1}}return!(!i.networkEnabled||!i.inForeground)||Ac(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Fr(Tc,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Dc.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return m(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[yu.store,Vu.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Dc.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Dc.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly-idempotent",[Vu.store],function(t){return Ac(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},Dc.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return Dc.isAvailable()?(e=n+Dc.MAIN_DATABASE,[4,jo.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Dc.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Dc.prototype.getMutationQueue=function(t){return Ur(this.started,"Cannot initialize MutationQueue before persistence is started."),ea.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Dc.prototype.getTargetCache=function(){return Ur(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},Dc.prototype.getRemoteDocumentCache=function(){return Ur(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Dc.prototype.getIndexManager=function(){return Ur(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Dc.prototype.runTransaction=function(n,t,r){var i=this;Fr(Tc,"Starting transaction:",n);var o,e=t.endsWith("idempotent"),a=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,Qu,function(e){return o=new Ec(e,i.listenSequence.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.verifyPrimaryLease(e).next(function(t){return!!t||i.canActAsPrimary(e)}).next(function(t){if(!t)throw qr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new zr(Wr.FAILED_PRECONDITION,$u);return r(o)}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},Dc.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Nc(t).get(yu.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new zr(Wr.FAILED_PRECONDITION,Sc)})},Dc.prototype.acquireOrExtendPrimaryLease=function(t){var e=new yu(this.clientId,this.allowTabSynchronization,Date.now());return Nc(t).put(yu.key,e)},Dc.isAvailable=function(){return jo.isAvailable()},Dc.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Dc.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Nc(t);return n.get(yu.key).next(function(t){return e.isLocalClient(t)?(Fr(Tc,"Releasing primary lease."),n.delete(yu.key)):Uo.resolve()})},Dc.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},Dc.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Dc.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Ur(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Dc.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Dc.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Ur("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Dc.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Fr(Tc,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return qr(Tc,"Failed to get zombied client id.",t),!1}},Dc.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},Dc.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Dc.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Dc.MAIN_DATABASE="main",Dc);function Dc(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new kc(this,i),this.dbName=e+Dc.MAIN_DATABASE,this.serializer=new Yu(a),this.document=r.document,this.targetCache=new pa(this.referenceDelegate,this.serializer),this.indexManager=new ju,this.remoteDocumentCache=new eu(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new zr(Wr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function Nc(t){return t.store(yu.store)}function Ac(t){return t.store(Vu.store)}var kc=(Rc.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},Rc.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Rc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},Rc.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},Rc.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Rc.prototype.addReference=function(t,e){return Mc(t,e)},Rc.prototype.removeReference=function(t,e){return Mc(t,e)},Rc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},Rc.prototype.removeMutationReference=function(t,e){return Mc(t,e)},Rc.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Uo.resolve(!0):function(e,n){var r=!1;return ua(e).iterateSerial(function(t){return ra(e,t,n).next(function(t){return t&&(r=!0),Uo.resolve(!t)})}).next(function(){return r})}(t,e)},Rc.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),va(r).delete(function(t){return[0,oo(t.path)]}(e))})});s.push(n)}}).next(function(){return Uo.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},Rc.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},Rc.prototype.updateLimboDocument=function(t,e){return Mc(t,e)},Rc.prototype.forEachOrphanedDocument=function(t,o){var a,e=va(t),s=Oi.INVALID;return e.iterate({index:_u.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Oi.INVALID&&o(new Wi(uo(a)),s),s=i,a=r):s=Oi.INVALID}).next(function(){s!==Oi.INVALID&&o(new Wi(uo(a)),s)})},Rc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Rc);function Rc(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new vc(this,e)}function Mc(t,e){return va(t).put(function(t,e){return new _u(0,oo(t.path),e)}(e,t.currentSequenceNumber))}var _c=Number,Lc=_c.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Oc=_c.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Pc=_c.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function xc(t){return null==t}function Fc(t){return Pc(t)&&t<=Oc&&Lc<=t}var qc,Vc,Bc=(Uc.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";xc(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},Uc.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),xc(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Uc.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Uc.prototype.isDocumentQuery=function(){return Wi.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},Uc);function Uc(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(Vc=qc=qc||{}).First="F",Vc.Last="L";var Kc=(Qc.atPath=function(t){return new Qc(t)},Object.defineProperty(Qc.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[gh]:this.memoizedOrderBy=[new mh(t),gh];else{Ur(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:lh.ASCENDING;this.memoizedOrderBy.push(a===lh.ASCENDING?gh:vh)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),Qc.prototype.addFilter=function(t){Ur(null==this.getInequalityFilterField()||!(t instanceof Hc)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Ur(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Qc(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},Qc.prototype.addOrderBy=function(t){Ur(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new Qc(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},Qc.prototype.withLimitToFirst=function(t){return new Qc(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,qc.First,this.startAt,this.endAt)},Qc.prototype.withLimitToLast=function(t){return new Qc(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,qc.Last,this.startAt,this.endAt)},Qc.prototype.withStartAt=function(t){return new Qc(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},Qc.prototype.withEndAt=function(t){return new Qc(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},Qc.prototype.asCollectionQueryAtPath=function(t){return new Qc(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},Qc.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},Qc.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},Qc.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},Qc.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},Qc.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Ur(n,"orderBy used that doesn't compare on key field"),0},Qc.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},Qc.prototype.hasLimitToFirst=function(){return!xc(this.limit)&&this.limitType===qc.First},Qc.prototype.hasLimitToLast=function(){return!xc(this.limit)&&this.limitType===qc.Last},Qc.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},Qc.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Hc&&n.isInequality())return n.field}return null},Qc.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Hc&&0<=t.indexOf(r.op))return r.op}return null},Qc.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},Qc.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},Qc.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===qc.First)this.memoizedTarget=new Bc(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===lh.DESCENDING?lh.ASCENDING:lh.DESCENDING;t.push(new mh(r.field,i))}var o=this.endAt?new ph(this.endAt.position,!this.endAt.before):null,a=this.startAt?new ph(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new Bc(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memoizedTarget},Qc.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Wi.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},Qc.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},Qc.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Qc.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},Qc.prototype.assertValidBound=function(t){Ur(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Qc);function Qc(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=qc.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function jc(){}var Gc=(Wc.fromString=function(t){switch(t){case"<":return Wc.LESS_THAN;case"<=":return Wc.LESS_THAN_OR_EQUAL;case"==":return Wc.EQUAL;case">=":return Wc.GREATER_THAN_OR_EQUAL;case">":return Wc.GREATER_THAN;case"array-contains":return Wc.ARRAY_CONTAINS;case"in":return Wc.IN;case"array-contains-any":return Wc.ARRAY_CONTAINS_ANY;default:return Br("Unknown FieldFilter operator: "+t)}},Wc.prototype.toString=function(){return this.name},Wc.prototype.isEqual=function(t){return this.name===t.name},Wc.LESS_THAN=new Wc("<"),Wc.LESS_THAN_OR_EQUAL=new Wc("<="),Wc.EQUAL=new Wc("=="),Wc.GREATER_THAN=new Wc(">"),Wc.GREATER_THAN_OR_EQUAL=new Wc(">="),Wc.ARRAY_CONTAINS=new Wc("array-contains"),Wc.IN=new Wc("in"),Wc.ARRAY_CONTAINS_ANY=new Wc("array-contains-any"),Wc);function Wc(t){this.name=t}var zc,Hc=(t(Yc,zc=jc),Yc.create=function(t,e,n){if(t.isKeyField())return e===Gc.IN?(Ur(n instanceof Fs,"Comparing on key with IN, but filter value not an ArrayValue"),Ur(n.internalValue.every(function(t){return t instanceof As}),"Comparing on key with IN, but an array value was not a RefValue"),new th(t,n)):(Ur(n instanceof As,"Comparing on key, but filter value not a RefValue"),Ur(e!==Gc.ARRAY_CONTAINS&&e!==Gc.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Jc(t,e,n));if(n.isEqual(ts.INSTANCE)){if(e!==Gc.EQUAL)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Yc(t,e,n)}if(n.isEqual(ps.NAN)){if(e!==Gc.EQUAL)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Yc(t,e,n)}return e===Gc.ARRAY_CONTAINS?new rh(t,n):e===Gc.IN?(Ur(n instanceof Fs,"IN filter has invalid value: "+n.toString()),new ah(t,n)):e===Gc.ARRAY_CONTAINS_ANY?(Ur(n instanceof Fs,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new ch(t,n)):new Yc(t,e,n)},Yc.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},Yc.prototype.matchesComparison=function(t){switch(this.op){case Gc.LESS_THAN:return t<0;case Gc.LESS_THAN_OR_EQUAL:return t<=0;case Gc.EQUAL:return 0===t;case Gc.GREATER_THAN:return 0<t;case Gc.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Br("Unknown FieldFilter operator: "+this.op)}},Yc.prototype.isInequality=function(){return 0<=[Gc.LESS_THAN,Gc.LESS_THAN_OR_EQUAL,Gc.GREATER_THAN,Gc.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Yc.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},Yc.prototype.isEqual=function(t){return t instanceof Yc&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Yc.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},Yc);function Yc(t,e,n){var r=zc.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var Xc,Jc=(t(Zc,Xc=Hc),Zc.prototype.matches=function(t){var e=this.value,n=Wi.comparator(t.key,e.key);return this.matchesComparison(n)},Zc);function Zc(){return null!==Xc&&Xc.apply(this,arguments)||this}var $c,th=(t(eh,$c=Hc),eh.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},eh);function eh(t,e){var n=$c.call(this,t,Gc.IN,e)||this;return n.value=e,n}var nh,rh=(t(ih,nh=Hc),ih.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Fs&&e.contains(this.value)},ih);function ih(t,e){return nh.call(this,t,Gc.ARRAY_CONTAINS,e)||this}var oh,ah=(t(sh,oh=Hc),sh.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},sh);function sh(t,e){var n=oh.call(this,t,Gc.IN,e)||this;return n.value=e,n}var uh,ch=(t(hh,uh=Hc),hh.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Fs&&n.internalValue.some(function(t){return e.value.contains(t)})},hh);function hh(t,e){var n=uh.call(this,t,Gc.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var lh=(fh.prototype.toString=function(){return this.name},fh.ASCENDING=new fh("asc"),fh.DESCENDING=new fh("desc"),fh);function fh(t){this.name=t}var ph=(dh.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},dh.prototype.sortsBeforeDocument=function(t,e){Ur(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Ur(o instanceof As,"Bound has a non-key value where the key path is being used."),n=Wi.comparator(o.key,e.key);else{var a=e.field(i.field);Ur(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===lh.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},dh.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},dh);function dh(t,e){this.position=t,this.before=e}var mh=(yh.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Ks.compareByKey(t,e):Ks.compareByField(this.field,t,e);switch(this.dir){case lh.ASCENDING:return n;case lh.DESCENDING:return-1*n;default:return Br("Unknown direction: "+this.dir)}},yh.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},yh.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},yh.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},yh);function yh(t,e){this.field=t,void 0===e&&(e=lh.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var gh=new mh(ji.keyField(),lh.ASCENDING),vh=new mh(ji.keyField(),lh.DESCENDING),bh=(wh.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},wh.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var a=this;return Ur(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),r.matchesAllDocuments()?this.executeFullCollectionScan(e,r):i.isEqual(lo.MIN)?this.executeFullCollectionScan(e,r):this.localDocumentsView.getDocuments(e,o).next(function(t){var n=a.applyQuery(r,t);return(r.hasLimitToFirst()||r.hasLimitToLast())&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(e,r):(Pr()<=Cr.DEBUG&&Fr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),a.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},wh.prototype.applyQuery=function(n,t){var r=new So(function(t,e){return n.docComparator(t,e)});return t.forEach(function(t,e){e instanceof Ks&&n.matches(e)&&(r=r.add(e))}),r},wh.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===qc.First?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},wh.prototype.executeFullCollectionScan=function(t,e){return Pr()<=Cr.DEBUG&&Fr("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,lo.MIN)},wh);function wh(){}var Th=(Sh.prototype.checkEmpty=function(t){return Uo.resolve(0===this.mutationQueue.length)},Sh.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Ur(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Ur(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Uo.resolve()},Sh.prototype.getLastStreamToken=function(t){return Uo.resolve(this.lastStreamToken)},Sh.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Uo.resolve()},Sh.prototype.addMutationBatch=function(t,e,n,r){Ur(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Ur(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Fo(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new ic(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Uo.resolve(o)},Sh.prototype.lookupMutationBatch=function(t,e){return Uo.resolve(this.findMutationBatch(e))},Sh.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Ur(null!=n,"Failed to find local mutation batch."),Uo.resolve(n.keys())},Sh.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Uo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},Sh.prototype.getHighestUnacknowledgedBatchId=function(){return Uo.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},Sh.prototype.getAllMutationBatches=function(t){return Uo.resolve(this.mutationQueue.slice())},Sh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new ic(n,0),i=new ic(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Ur(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Ur(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Uo.resolve(o)},Sh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new So(Si);return e.forEach(function(e){var t=new ic(e,0),n=new ic(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Ur(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Uo.resolve(this.findMutationBatches(i))},Sh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Ur(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Wi.isDocumentKey(i)||(i=i.child(""));var o=new ic(new Wi(i),0),a=new So(Si);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Uo.resolve(this.findMutationBatches(a))},Sh.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},Sh.prototype.removeMutationBatch=function(n,r){var i=this;Ur(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Uo.forEach(r.mutations,function(t){var e=new ic(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},Sh.prototype.removeCachedMutationKeys=function(t){},Sh.prototype.containsKey=function(t,e){var n=new ic(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Uo.resolve(e.isEqual(r&&r.key))},Sh.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Ur(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Uo.resolve()},Sh.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Ur(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},Sh.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},Sh.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Ur(n.batchId===t,"If found batch must match"),n},Sh);function Sh(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=jr(),this.batchesByDocumentKey=new So(ic.compareByKey)}var Eh,Ih=(Ch.prototype.addEntry=function(t,e,n){Ur(!n.isEqual(lo.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},Ch.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Ch.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Uo.resolve(n?n.maybeDocument:null)},Ch.prototype.getEntries=function(t,e){var n=this,r=Ao();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Uo.resolve(r)},Ch.prototype.getDocumentsMatchingQuery=function(t,e,n){Ur(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=Ro(),i=new Wi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof Ks&&e.matches(c)&&(r=r.insert(c.key,c))}return Uo.resolve(r)},Ch.prototype.forEachDocumentKey=function(t,e){return Uo.forEach(this.docs,function(t){return e(t)})},Ch.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Ch.prototype.getLastReadTime=function(t){return Uo.resolve(lo.MIN)},Ch.prototype.newChangeBuffer=function(t){return new Ch.RemoteDocumentChangeBuffer(this)},Ch.prototype.getSize=function(t){return Uo.resolve(this.size)},Ch.RemoteDocumentChangeBuffer=(t(Dh,Eh=Zs),Dh.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e,r.readTime)):r.documentCache.removeEntry(t)}),Uo.waitFor(i)},Dh.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},Dh.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},Dh),Ch);function Ch(t,e){this.indexManager=t,this.sizer=e,this.docs=new po(Wi.comparator),this.size=0}function Dh(t){var e=Eh.call(this)||this;return e.documentCache=t,e}var Nh=(Ah.prototype.forEachTarget=function(t,n){return this.targets.forEach(function(t,e){return n(e)}),Uo.resolve()},Ah.prototype.getLastRemoteSnapshotVersion=function(t){return Uo.resolve(this.lastRemoteSnapshotVersion)},Ah.prototype.getHighestSequenceNumber=function(t){return Uo.resolve(this.highestSequenceNumber)},Ah.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Uo.resolve(e)},Ah.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Uo.resolve()},Ah.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Ah.prototype.addTargetData=function(t,e){return Ur(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Uo.resolve()},Ah.prototype.updateTargetData=function(t,e){return Ur(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Uo.resolve()},Ah.prototype.removeTargetData=function(t,e){return Ur(0<this.targetCount,"Removing a target from an empty cache"),Ur(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Uo.resolve()},Ah.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.targets.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Uo.waitFor(s).next(function(){return a})},Ah.prototype.getTargetCount=function(t){return Uo.resolve(this.targetCount)},Ah.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Uo.resolve(n)},Ah.prototype.getTargetDataForTarget=function(t,e){return Br("Not yet implemented.")},Ah.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Uo.waitFor(i)},Ah.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Uo.waitFor(i)},Ah.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Uo.resolve()},Ah.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Uo.resolve(n)},Ah.prototype.containsKey=function(t,e){return Uo.resolve(this.references.containsKey(e))},Ah);function Ah(t){this.persistence=t,this.targets=new Xs(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=lo.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new nc,this.targetCount=0,this.targetIdGenerator=la.forTargetCache()}var kh=(Rh.createLruPersistence=function(t,e){return new Rh(t,function(t){return new xh(t,e)})},Rh.createEagerPersistence=function(t){return new Rh(t,function(t){return new Oh(t)})},Rh.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Rh.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Rh.prototype.getActiveClients=function(){return p(this,void 0,void 0,function(){return m(this,function(t){return[2,[this.clientId]]})})},Rh.prototype.setPrimaryStateListener=function(t){return t(!0)},Rh.prototype.setDatabaseDeletedListener=function(){},Rh.prototype.setNetworkEnabled=function(t){},Rh.prototype.getIndexManager=function(){return this.indexManager},Rh.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Th(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Rh.prototype.getTargetCache=function(){return this.targetCache},Rh.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Rh.prototype.runTransaction=function(t,e,n){var r=this;Fr("MemoryPersistence","Starting transaction:",t);var i=new _h(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Rh.prototype.mutationQueuesContainKey=function(e,n){return Uo.or(function(t){var n=[];return $r(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},Rh);function Rh(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Oi(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Nh(this);this.indexManager=new uu,this.remoteDocumentCache=new Ih(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var Mh,_h=(t(Lh,Mh=tc),Lh);function Lh(t){var e=Mh.call(this)||this;return e.currentSequenceNumber=t,e}var Oh=(Object.defineProperty(Ph.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Br("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Ph.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Ph.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Uo.resolve()},Ph.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Uo.resolve()},Ph.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Uo.resolve()},Ph.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeTargetData(t,e)})},Ph.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Ph.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Uo.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},Ph.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Ph.prototype.documentSize=function(t){return 0},Ph.prototype.isReferenced=function(t,e){var n=this;return Uo.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Uo.resolve(n.inMemoryPins.containsKey(e))}])},Ph);function Ph(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var xh=(Fh.prototype.onTransactionStarted=function(){},Fh.prototype.onTransactionCommitted=function(t){return Uo.resolve()},Fh.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},Fh.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},Fh.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Fh.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Uo.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Uo.resolve():r(e)})})},Fh.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Fh.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},Fh.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Fh.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Fh.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},Fh.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Fh.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Fh.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Uo.resolve()},Fh.prototype.documentSize=function(t){var e=t.key.toString().length;return t instanceof Ks&&(e+=t.data().approximateByteSize()),e},Fh.prototype.isPinned=function(t,e,n){var r=this;return Uo.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Uo.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Uo.resolve(void 0!==t&&n<t)}])},Fh.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Fh);function Fh(t,e){this.persistence=t,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Xs(function(t){return oo(t.path)}),this.garbageCollector=new vc(this,e)}var qh=(Vh.prototype.reset=function(){this.currentBaseMs=0},Vh.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Vh.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Fr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Vh.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Vh.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Vh);function Vh(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var Bh,Uh,Kh="PersistentStream";(Uh=Bh=Bh||{})[Uh.Initial=0]="Initial",Uh[Uh.Starting=1]="Starting",Uh[Uh.Open=2]="Open",Uh[Uh.Error=3]="Error",Uh[Uh.Backoff=4]="Backoff";var Qh=(jh.prototype.isStarted=function(){return this.state===Bh.Starting||this.state===Bh.Open||this.state===Bh.Backoff},jh.prototype.isOpen=function(){return this.state===Bh.Open},jh.prototype.start=function(){this.state!==Bh.Error?(Ur(this.state===Bh.Initial,"Already started"),this.auth()):this.performBackoff()},jh.prototype.stop=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Bh.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},jh.prototype.inhibitBackoff=function(){Ur(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Bh.Initial,this.backoff.reset()},jh.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},jh.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},jh.prototype.handleIdleCloseTimer=function(){return p(this,void 0,void 0,function(){return m(this,function(t){return this.isOpen()?[2,this.close(Bh.Initial)]:[2]})})},jh.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},jh.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return Ur(this.isStarted(),"Only started streams should be closed."),Ur(e===Bh.Error||xc(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==Bh.Error?this.backoff.reset():n&&n.code===Wr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Wr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},jh.prototype.tearDown=function(){},jh.prototype.auth=function(){var n=this;Ur(this.state===Bh.Initial,"Must be in initial state to auth"),this.state=Bh.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new zr(Wr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},jh.prototype.startStream=function(t){var e=this;Ur(this.state===Bh.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Ur(e.state===Bh.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Bh.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},jh.prototype.performBackoff=function(){var t=this;Ur(this.state===Bh.Error,"Should only perform backoff when in Error state"),this.state=Bh.Backoff,this.backoff.backoffAndRun(function(){return p(t,void 0,void 0,function(){return m(this,function(t){return Ur(this.state===Bh.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Bh.Initial,this.start(),Ur(this.isStarted(),"PersistentStream should have started"),[2]})})})},jh.prototype.handleStreamClose=function(t){return Ur(this.isStarted(),"Can't handle server close on non-started stream"),Fr(Kh,"close with error: "+t),this.stream=null,this.close(Bh.Error,t)},jh.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Fr(Kh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},jh);function jh(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Bh.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new qh(t,e)}var Gh,Wh=(t(zh,Gh=Qh),zh.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},zh.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},zh.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},zh.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},zh);function zh(t,e,n,r,i){var o=Gh.call(this,t,Hi.ListenStreamConnectionBackoff,Hi.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Hh,Yh=(t(Xh,Hh=Qh),Object.defineProperty(Xh.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),Xh.prototype.start=function(){this.handshakeComplete_=!1,Hh.prototype.start.call(this)},Xh.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Xh.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},Xh.prototype.onMessage=function(t){if(Ur(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Ur(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Xh.prototype.writeHandshake=function(){Ur(this.isOpen(),"Writing handshake requires an opened stream"),Ur(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},Xh.prototype.writeMutations=function(t){var e=this;Ur(this.isOpen(),"Writing mutations requires an opened stream"),Ur(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Ur(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},Xh);function Xh(t,e,n,r,i){var o=Hh.call(this,t,Hi.WriteStreamConnectionBackoff,Hi.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=jr(),o}var Jh=(Zh.prototype.newPersistentWriteStream=function(t){return new Yh(this.queue,this.connection,this.credentials,this.serializer,t)},Zh.prototype.newPersistentWatchStream=function(t){return new Wh(this.queue,this.connection,this.credentials,this.serializer,t)},Zh.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},Zh.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=No();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Ur(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},Zh.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},Zh.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},Zh);function Zh(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var $h,tl,el,nl,rl=(il.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return m(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new zr(Wr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Gs||t instanceof Ks?n.recordVersion(t):Br("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},il.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},il.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},il.prototype.delete=function(t){this.write([new Ba(t,this.precondition(t))]),this.writtenDocs.add(t)},il.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return m(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new za(t,n.precondition(t)))}),[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},il.prototype.recordVersion=function(t){var e;if(t instanceof Ks)e=t.version;else{if(!(t instanceof Gs))throw Br("Document in a transaction was a "+t.constructor.name);e=lo.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new zr(Wr.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},il.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Da.updateTime(e):Da.NONE},il.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Da.exists(!0);if(e.isEqual(lo.forDeletedDoc()))throw new zr(Wr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Da.updateTime(e)},il.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},il.prototype.ensureCommitNotCalled=function(){Ur(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},il);function il(t){this.datastore=t,this.readVersions=_o(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(tl=$h=$h||{})[tl.Unknown=0]="Unknown",tl[tl.Online=1]="Online",tl[tl.Offline=2]="Offline",(nl=el=el||{})[nl.RemoteStore=0]="RemoteStore",nl[nl.SharedClientState=1]="SharedClientState";var ol,al,sl=(ul.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast($h.Unknown),Ur(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Hi.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Ur(t.state===$h.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast($h.Offline),Promise.resolve()}))},ul.prototype.handleWatchStreamFailure=function(t){this.state===$h.Online?(this.setAndBroadcast($h.Unknown),Ur(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Ur(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast($h.Offline)))},ul.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===$h.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},ul.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},ul.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(qr(e),this.shouldWarnClientIsOffline=!1):Fr("OnlineStateTracker",e)},ul.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},ul);function ul(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=$h.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function cl(t){switch(t){case Wr.OK:return Br("Treated status OK as error");case Wr.CANCELLED:case Wr.UNKNOWN:case Wr.DEADLINE_EXCEEDED:case Wr.RESOURCE_EXHAUSTED:case Wr.INTERNAL:case Wr.UNAVAILABLE:case Wr.UNAUTHENTICATED:return!1;case Wr.INVALID_ARGUMENT:case Wr.NOT_FOUND:case Wr.ALREADY_EXISTS:case Wr.PERMISSION_DENIED:case Wr.FAILED_PRECONDITION:case Wr.ABORTED:case Wr.OUT_OF_RANGE:case Wr.UNIMPLEMENTED:case Wr.DATA_LOSS:return!0;default:return Br("Unknown status code: "+t)}}function hl(t){if(void 0===t)return qr("GRPC error has no .code"),Wr.UNKNOWN;switch(t){case ol.OK:return Wr.OK;case ol.CANCELLED:return Wr.CANCELLED;case ol.UNKNOWN:return Wr.UNKNOWN;case ol.DEADLINE_EXCEEDED:return Wr.DEADLINE_EXCEEDED;case ol.RESOURCE_EXHAUSTED:return Wr.RESOURCE_EXHAUSTED;case ol.INTERNAL:return Wr.INTERNAL;case ol.UNAVAILABLE:return Wr.UNAVAILABLE;case ol.UNAUTHENTICATED:return Wr.UNAUTHENTICATED;case ol.INVALID_ARGUMENT:return Wr.INVALID_ARGUMENT;case ol.NOT_FOUND:return Wr.NOT_FOUND;case ol.ALREADY_EXISTS:return Wr.ALREADY_EXISTS;case ol.PERMISSION_DENIED:return Wr.PERMISSION_DENIED;case ol.FAILED_PRECONDITION:return Wr.FAILED_PRECONDITION;case ol.ABORTED:return Wr.ABORTED;case ol.OUT_OF_RANGE:return Wr.OUT_OF_RANGE;case ol.UNIMPLEMENTED:return Wr.UNIMPLEMENTED;case ol.DATA_LOSS:return Wr.DATA_LOSS;default:return Br("Unknown status code: "+t)}}(al=ol=ol||{})[al.OK=0]="OK",al[al.CANCELLED=1]="CANCELLED",al[al.UNKNOWN=2]="UNKNOWN",al[al.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",al[al.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",al[al.NOT_FOUND=5]="NOT_FOUND",al[al.ALREADY_EXISTS=6]="ALREADY_EXISTS",al[al.PERMISSION_DENIED=7]="PERMISSION_DENIED",al[al.UNAUTHENTICATED=16]="UNAUTHENTICATED",al[al.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",al[al.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",al[al.ABORTED=10]="ABORTED",al[al.OUT_OF_RANGE=11]="OUT_OF_RANGE",al[al.UNIMPLEMENTED=12]="UNIMPLEMENTED",al[al.INTERNAL=13]="INTERNAL",al[al.UNAVAILABLE=14]="UNAVAILABLE",al[al.DATA_LOSS=15]="DATA_LOSS";var ll,fl,pl,dl,ml=(yl.emptySet=function(t){return new yl(t.comparator)},yl.prototype.has=function(t){return null!=this.keyedMap.get(t)},yl.prototype.get=function(t){return this.keyedMap.get(t)},yl.prototype.first=function(){return this.sortedSet.minKey()},yl.prototype.last=function(){return this.sortedSet.maxKey()},yl.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},yl.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(yl.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),yl.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},yl.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},yl.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},yl.prototype.isEqual=function(t){if(!(t instanceof yl))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},yl.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},yl.prototype.copy=function(t,e){var n=new yl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},yl);function yl(n){this.comparator=n?function(t,e){return n(t,e)||Wi.comparator(t.key,e.key)}:function(t,e){return Wi.comparator(t.key,e.key)},this.keyedMap=Ro(),this.sortedSet=new po(this.comparator)}(fl=ll=ll||{})[fl.Added=0]="Added",fl[fl.Removed=1]="Removed",fl[fl.Modified=2]="Modified",fl[fl.Metadata=3]="Metadata",(dl=pl=pl||{})[dl.Local=0]="Local",dl[dl.Synced=1]="Synced";var gl=(vl.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==ll.Added&&n.type===ll.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===ll.Metadata&&n.type!==ll.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===ll.Modified&&n.type===ll.Modified?this.changeMap=this.changeMap.insert(e,{type:ll.Modified,doc:t.doc}):t.type===ll.Modified&&n.type===ll.Added?this.changeMap=this.changeMap.insert(e,{type:ll.Added,doc:t.doc}):t.type===ll.Removed&&n.type===ll.Added?this.changeMap=this.changeMap.remove(e):t.type===ll.Removed&&n.type===ll.Modified?this.changeMap=this.changeMap.insert(e,{type:ll.Removed,doc:n.doc}):t.type===ll.Added&&n.type===ll.Removed?this.changeMap=this.changeMap.insert(e,{type:ll.Modified,doc:t.doc}):Br("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},vl.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},vl);function vl(){this.changeMap=new po(Wi.comparator)}var bl=(wl.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:ll.Added,doc:t})}),new wl(t,e,ml.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(wl.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),wl.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},wl);function wl(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var Tl=(Sl.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=El.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new Sl(lo.MIN,r,xo(),No(),Oo())},Sl);function Sl(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var El=(Il.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new Il(jr(),e,Oo(),Oo(),Oo())},Il);function Il(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var Cl,Dl,Nl=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},Al=function(t,e){this.targetId=t,this.existenceFilter=e};(Dl=Cl=Cl||{})[Dl.NoChange=0]="NoChange",Dl[Dl.Added=1]="Added",Dl[Dl.Removed=2]="Removed",Dl[Dl.Current=3]="Current",Dl[Dl.Reset=4]="Reset";var kl=function(t,e,n,r){void 0===n&&(n=jr()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Rl=(Object.defineProperty(Ml.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(Ml.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(Ml.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(Ml.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),Ml.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},Ml.prototype.toTargetChange=function(){var n=Oo(),r=Oo(),i=Oo();return this.documentChanges.forEach(function(t,e){switch(e){case ll.Added:n=n.add(t);break;case ll.Modified:r=r.add(t);break;case ll.Removed:i=i.add(t);break;default:Br("Encountered invalid change type: "+e)}}),new El(this._resumeToken,this._current,n,r,i)},Ml.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Pl()},Ml.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},Ml.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},Ml.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},Ml.prototype.recordTargetResponse=function(){this.pendingResponses-=1},Ml.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},Ml);function Ml(){this.pendingResponses=0,this.documentChanges=Pl(),this._resumeToken=jr(),this._current=!1,this._hasPendingChanges=!0}var _l=(Ll.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Ks?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Gs&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},Ll.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case Cl.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case Cl.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case Cl.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Ur(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case Cl.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case Cl.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Br("Unknown target watch change state: "+n.state)}})},Ll.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Zr(this.targetStates,e)},Ll.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new Wi(i.path);this.removeDocumentFromTarget(e,o,new Gs(o,lo.forDeletedDoc()))}else Ur(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},Ll.prototype.createRemoteEvent=function(i){var o=this,a={};Zr(this.targetStates,function(t,e){var n=o.targetDataForActiveTarget(t);if(n){if(e.current&&n.target.isDocumentQuery()){var r=new Wi(n.target.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Gs(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Oo();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.targetDataForActiveTarget(t);return!e||e.purpose===Uu.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new Tl(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=No(),this.pendingDocumentTargetMapping=Ol(),this.pendingTargetResets=new So(Si),t},Ll.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?ll.Modified:ll.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},Ll.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,ll.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},Ll.prototype.removeTarget=function(t){delete this.targetStates[t]},Ll.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},Ll.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},Ll.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new Rl),this.targetStates[t]},Ll.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new So(Si),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},Ll.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||Fr("WatchChangeAggregator","Detected inactive target",t),e},Ll.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},Ll.prototype.resetTarget=function(e){var n=this;Ur(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new Rl,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},Ll.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},Ll);function Ll(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=No(),this.pendingDocumentTargetMapping=Ol(),this.pendingTargetResets=new So(Si)}function Ol(){return new po(Wi.comparator)}function Pl(){return new po(Wi.comparator)}var xl="RemoteStore",Fl=(ql.prototype.start=function(){return this.enableNetwork()},ql.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set($h.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ql.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set($h.Offline),[2]}})})},ql.prototype.disableNetworkInternal=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Fr(xl,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},ql.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return Fr(xl,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set($h.Unknown),[2]}})})},ql.prototype.listen=function(t){Xr(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},ql.prototype.unlisten=function(t){Ur(Xr(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),ti(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set($h.Unknown))},ql.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},ql.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},ql.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},ql.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},ql.prototype.startWatchStream=function(){Ur(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new _l(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},ql.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!ti(this.listenTargets)},ql.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},ql.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},ql.prototype.onWatchStreamOpen=function(){return p(this,void 0,void 0,function(){var n=this;return m(this,function(t){return Zr(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},ql.prototype.onWatchStreamClose=function(e){return p(this,void 0,void 0,function(){return m(this,function(t){return void 0===e&&Ur(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set($h.Unknown),[2]})})},ql.prototype.onWatchStreamChange=function(n,r){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set($h.Online),n instanceof kl&&n.state===Cl.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof Nl?this.watchChangeAggregator.handleDocumentChange(n):n instanceof Al?this.watchChangeAggregator.handleExistenceFilter(n):(Ur(n instanceof kl,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(lo.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ql.prototype.raiseWatchSnapshot=function(r){var i=this;Ur(!r.isEqual(lo.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Zr(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(jr(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new zu(e.target,t,Uu.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},ql.prototype.handleTargetError=function(t){var n=this;Ur(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return m(this,function(t){return Xr(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},ql.prototype.fillWritePipeline=function(){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},ql.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},ql.prototype.outstandingWrites=function(){return this.writePipeline.length},ql.prototype.addToWritePipeline=function(t){Ur(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},ql.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},ql.prototype.startWriteStream=function(){Ur(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},ql.prototype.onWriteStreamOpen=function(){return p(this,void 0,void 0,function(){return m(this,function(t){return this.writeStream.writeHandshake(),[2]})})},ql.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(cc)},ql.prototype.onMutationResult=function(t,e){var n=this;Ur(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Vo.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},ql.prototype.onWriteStreamClose=function(n){return p(this,void 0,void 0,function(){var e=this;return m(this,function(t){return void 0===n&&Ur(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},ql.prototype.handleHandshakeError=function(e){return p(this,void 0,void 0,function(){return m(this,function(t){return cl(e.code)?(Fr(xl,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=jr(),[2,this.localStore.setLastStreamToken(jr()).catch(cc)]):[2]})})},ql.prototype.handleWriteError=function(r){return p(this,void 0,void 0,function(){var e,n=this;return m(this,function(t){return function(t){return cl(t)&&t!==Wr.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},ql.prototype.createTransaction=function(){return new rl(this.datastore)},ql.prototype.restartNetwork=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set($h.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},ql.prototype.handleCredentialChange=function(){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Fr(xl,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ql.prototype.applyPrimaryState=function(e){return p(this,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set($h.Unknown),t.label=4;case 4:return[2]}})})},ql);function ql(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return p(o,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Fr(xl,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new sl(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var Vl=(Object.defineProperty(Bl.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(Bl.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),Bl.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Bl.prototype._compareTo=function(t){return Si(this._lat,t._lat)||Si(this._long,t._long)},Bl);function Bl(t,e){if(ni("GeoPoint",arguments,2),oi("GeoPoint","number",1,t),oi("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new zr(Wr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new zr(Wr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var Ul=(Kl.prototype.applyToLocalView=function(t,e){return new Ss(e,t)},Kl.prototype.applyToRemoteDocument=function(t,e){return e},Kl.prototype.computeBaseValue=function(t){return null},Kl.prototype.isEqual=function(t){return t instanceof Kl},Kl.instance=new Kl,Kl);function Kl(){}var Ql=(jl.prototype.applyToLocalView=function(t,e){return this.apply(t)},jl.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},jl.prototype.apply=function(t){for(var n=Yl(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Fs(n)},jl.prototype.computeBaseValue=function(t){return null},jl.prototype.isEqual=function(t){return t instanceof jl&&Ei(t.elements,this.elements)},jl);function jl(t){this.elements=t}var Gl=(Wl.prototype.applyToLocalView=function(t,e){return this.apply(t)},Wl.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},Wl.prototype.apply=function(t){for(var n=Yl(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Fs(n)},Wl.prototype.computeBaseValue=function(t){return null},Wl.prototype.isEqual=function(t){return t instanceof Wl&&Ei(t.elements,this.elements)},Wl);function Wl(t){this.elements=t}var zl=(Hl.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof hs&&this.operand instanceof hs){var r=n.internalValue+this.operand.internalValue;return new hs(r)}return r=n.internalValue+this.operand.internalValue,new ps(r)},Hl.prototype.applyToRemoteDocument=function(t,e){return Ur(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},Hl.prototype.computeBaseValue=function(t){return t instanceof as?t:new hs(0)},Hl.prototype.isEqual=function(t){return t instanceof Hl&&this.operand.isEqual(t.operand)},Hl);function Hl(t){this.operand=t}function Yl(t){return t instanceof Fs?t.internalValue.slice():[]}var Xl=(Jl.prototype.isEqual=function(t){return t&&t.count===this.count},Jl);function Jl(t){this.count=t}var Zl,$l,tf=((Zl={})[lh.ASCENDING.name]="ASCENDING",Zl[lh.DESCENDING.name]="DESCENDING",Zl),ef=(($l={})[Gc.LESS_THAN.name]="LESS_THAN",$l[Gc.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",$l[Gc.GREATER_THAN.name]="GREATER_THAN",$l[Gc.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",$l[Gc.EQUAL.name]="EQUAL",$l[Gc.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",$l[Gc.IN.name]="IN",$l[Gc.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",$l),nf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rf(t,e){Ur(!xc(t),e+" is missing")}function of(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Br("can't parse "+t)}var af=(sf.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},sf.prototype.unsafeCastProtoByteString=function(t){return t},sf.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Wr.UNKNOWN:hl(t.code);return new zr(e,t.message||"")},sf.prototype.toInt32Value=function(t){return this.options.useProto3Json||xc(t)?t:{value:t}},sf.prototype.fromInt32Value=function(t){var e;return xc(e="object"==typeof t?t.value:t)?null:e},sf.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},sf.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Ur(!!t,"Cannot deserialize null or undefined timestamp.");var e=of(t.seconds||"0"),n=t.nanos||0;return new co(e,n)},sf.prototype.fromIso8601String=function(t){var e=0,n=nf.exec(t);if(Ur(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new co(o,e)},sf.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},sf.prototype.fromBlob=function(t){return"string"==typeof t?(Ur(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ni.fromBase64String(t)):(Ur(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ni.fromUint8Array(t))},sf.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},sf.prototype.fromVersion=function(t){return Ur(!!t,"Trying to deserialize version that isn't set"),lo.fromTimestamp(this.fromTimestamp(t))},sf.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},sf.prototype.fromResourceName=function(t){var e=Bi.fromString(t);return Ur(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},sf.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},sf.prototype.fromName=function(t){var e=this.fromResourceName(t);return Ur(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Ur(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Wi(this.extractLocalPathFromResourceName(e))},sf.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},sf.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Bi.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(sf.prototype,"encodedDatabaseId",{get:function(){return new Bi(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),sf.prototype.fullyQualifiedPrefixPath=function(t){return new Bi(["projects",t.projectId,"databases",t.database])},sf.prototype.extractLocalPathFromResourceName=function(t){return Ur(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},sf.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},sf.prototype.toValue=function(t){if(t instanceof ts)return{nullValue:"NULL_VALUE"};if(t instanceof rs)return{booleanValue:t.value()};if(t instanceof hs)return{integerValue:""+t.value()};if(t instanceof ps){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof ys?{stringValue:t.value()}:t instanceof Os?{mapValue:this.toMapValue(t)}:t instanceof Fs?{arrayValue:this.toArrayValue(t)}:t instanceof bs?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Ms?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Cs?{bytesValue:this.toBytes(t.value())}:t instanceof As?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Br("Unknown FieldValue "+JSON.stringify(t))},sf.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return ts.INSTANCE;if("booleanValue"in t)return rs.of(t.booleanValue);if("integerValue"in t)return new hs(of(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return ps.NAN;if("Infinity"===t.doubleValue)return ps.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return ps.NEGATIVE_INFINITY}return new ps(t.doubleValue)}if("stringValue"in t)return new ys(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){rf(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Fs(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return rf(t.timestampValue,"timestampValue"),new bs(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){rf(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Ms(new Vl(r,i))}if("bytesValue"in t){rf(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Cs(o)}if("referenceValue"in t){rf(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new _i(a.get(1),a.get(3)),u=new Wi(this.extractLocalPathFromResourceName(a));return new As(s,u)}return Br("Unknown Value proto "+JSON.stringify(t))},sf.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},sf.prototype.toDocument=function(t){return Ur(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},sf.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Ks(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},sf.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},sf.prototype.fromFields=function(t){var n=this,e=t,r=Os.EMPTY;return $r(e,function(t,e){r=r.set(new ji([t]),n.fromValue(e))}),r},sf.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},sf.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},sf.prototype.fromFound=function(t){var e=this;Ur(!!t.found,"Tried to deserialize a found document from a missing document."),rf(t.found.name,"doc.found.name"),rf(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ks(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},sf.prototype.fromMissing=function(t){Ur(!!t.missing,"Tried to deserialize a missing document from a found document."),Ur(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Gs(e,n)},sf.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Br("invalid batch get response: "+JSON.stringify(t))},sf.prototype.toWatchTargetChangeState=function(t){switch(t){case Cl.Added:return"ADD";case Cl.Current:return"CURRENT";case Cl.NoChange:return"NO_CHANGE";case Cl.Removed:return"REMOVE";case Cl.Reset:return"RESET";default:return Br("Unknown WatchTargetChangeState: "+t)}},sf.prototype.toTestWatchChange=function(t){if(t instanceof Al)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Nl){if(t.newDoc instanceof Ks){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Gs)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof kl){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return ol.OK;switch(t){case Wr.OK:return ol.OK;case Wr.CANCELLED:return ol.CANCELLED;case Wr.UNKNOWN:return ol.UNKNOWN;case Wr.DEADLINE_EXCEEDED:return ol.DEADLINE_EXCEEDED;case Wr.RESOURCE_EXHAUSTED:return ol.RESOURCE_EXHAUSTED;case Wr.INTERNAL:return ol.INTERNAL;case Wr.UNAVAILABLE:return ol.UNAVAILABLE;case Wr.UNAUTHENTICATED:return ol.UNAUTHENTICATED;case Wr.INVALID_ARGUMENT:return ol.INVALID_ARGUMENT;case Wr.NOT_FOUND:return ol.NOT_FOUND;case Wr.ALREADY_EXISTS:return ol.ALREADY_EXISTS;case Wr.PERMISSION_DENIED:return ol.PERMISSION_DENIED;case Wr.FAILED_PRECONDITION:return ol.FAILED_PRECONDITION;case Wr.ABORTED:return ol.ABORTED;case Wr.OUT_OF_RANGE:return ol.OUT_OF_RANGE;case Wr.UNIMPLEMENTED:return ol.UNIMPLEMENTED;case Wr.DATA_LOSS:return ol.DATA_LOSS;default:return Br("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Br("Unrecognized watch change: "+JSON.stringify(t))},sf.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){rf(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new kl(r,i,o,s||null)}else if("documentChange"in t){rf(t.documentChange,"documentChange");var u=t.documentChange;rf(u.document,"documentChange.name"),rf(u.document.name,"documentChange.document.name"),rf(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Ks(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new Nl(f,p,l.key,l)}else if("documentDelete"in t){rf(t.documentDelete,"documentDelete");var d=t.documentDelete;rf(d.document,"documentDelete.document"),c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):lo.forDeletedDoc(),l=new Gs(c,h),p=d.removedTargetIds||[],e=new Nl([],p,l.key,l)}else if("documentRemove"in t){rf(t.documentRemove,"documentRemove");var m=t.documentRemove;rf(m.document,"documentRemove"),c=this.fromName(m.document),p=m.removedTargetIds||[],e=new Nl([],p,c,null)}else{if(!("filter"in t))return Br("Unknown change type "+JSON.stringify(t));rf(t.filter,"filter");var y=t.filter;rf(y.targetId,"filter.targetId");var g=y.count||0,v=new Xl(g),b=y.targetId;e=new Al(b,v)}return e},sf.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Cl.NoChange:"ADD"===t?Cl.Added:"REMOVE"===t?Cl.Removed:"CURRENT"===t?Cl.Current:"RESET"===t?Cl.Reset:Br("Got unexpected TargetChange.state: "+t)},sf.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return lo.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?lo.MIN:e.readTime?this.fromVersion(e.readTime):lo.MIN},sf.prototype.toMutation=function(t){var e,n=this;if(t instanceof Ma)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Ba)e={delete:this.toName(t.key)};else if(t instanceof Oa)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else if(t instanceof Fa)e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}};else{if(!(t instanceof za))return Br("Unknown mutation type "+t.type);e={verify:this.toName(t.key)}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},sf.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Da.NONE;if(t.update){rf(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Oa(r,i,o,n)}return new Ma(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Ba(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Ur(!0===n.exists,'Transforms only support precondition "exists == true"'),new Fa(r,a)}return t.verify?(r=this.fromName(t.verify),new za(r,n)):Br("unknown mutation proto: "+JSON.stringify(t))},sf.prototype.toPrecondition=function(t){return Ur(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Br("Unknown precondition")},sf.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Da.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Da.exists(t.exists):Da.NONE},sf.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(lo.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Ca(r,i)},sf.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Ur(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},sf.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Ul)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ql)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Gl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof zl)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Br("Unknown transform: "+t.transform)},sf.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Ur("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Ul.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Ql(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new Gl(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Ur(i instanceof as,"NUMERIC_ADD transform requires a NumberValue"),n=new zl(i)}else Br("Unknown transform proto: "+JSON.stringify(t));var o=ji.fromServerFormat(t.fieldPath);return new Ta(o,n)},sf.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},sf.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Ur(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Kc.atPath(this.fromQueryPath(n)).toTarget()},sf.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Ur(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Ur(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},sf.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Ur(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Kc(e,i,s,a,u,qc.First,c,h).toTarget()},sf.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},sf.prototype.toLabel=function(t){switch(t){case Uu.Listen:return null;case Uu.ExistenceFilterMismatch:return"existence-filter-mismatch";case Uu.LimboResolution:return"limbo-document";default:return Br("Unrecognized query purpose: "+t)}},sf.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},sf.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Hc?e.toUnaryOrFieldFilter(t):Br("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},sf.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Br("Unknown filter: "+JSON.stringify(t)):[]},sf.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},sf.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},sf.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},sf.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new ph(r,n)},sf.prototype.toDirection=function(t){return tf[t.name]},sf.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return lh.ASCENDING;case"DESCENDING":return lh.DESCENDING;default:return}},sf.prototype.toOperatorName=function(t){return ef[t.name]},sf.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Gc.EQUAL;case"GREATER_THAN":return Gc.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Gc.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Gc.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Gc.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Gc.ARRAY_CONTAINS;case"IN":return Gc.IN;case"ARRAY_CONTAINS_ANY":return Gc.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Br("Unspecified operator");default:return Br("Unknown operator")}},sf.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},sf.prototype.fromFieldPathReference=function(t){return ji.fromServerFormat(t.fieldPath)},sf.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},sf.prototype.fromPropertyOrder=function(t){return new mh(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},sf.prototype.fromFieldFilter=function(t){return Hc.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},sf.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Gc.EQUAL){if(t.value.isEqual(ps.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(ts.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},sf.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return Hc.create(e,Gc.EQUAL,ps.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return Hc.create(n,Gc.EQUAL,ts.INSTANCE);case"OPERATOR_UNSPECIFIED":return Br("Unspecified filter");default:return Br("Unknown filter")}},sf.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},sf.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return ji.fromServerFormat(t)});return ba.fromArray(e)},sf);function sf(t,e){this.databaseId=t,this.options=e}var uf=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},cf=(hf.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new uf,this.queries.set(e,r)),r.listeners.push(t),Ur(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},hf.prototype.unlisten=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return m(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},hf.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},hf.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},hf.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},hf.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},hf.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},hf.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},hf);function hf(t){this.syncEngine=t,this.queries=new Xs(function(t){return t.canonicalId()}),this.onlineState=$h.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var lf=(ff.prototype.onViewSnapshot=function(t){if(Ur(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==ll.Metadata&&e.push(i)}t=new bl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},ff.prototype.onError=function(t){this.queryObserver.error(t)},ff.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},ff.prototype.shouldRaiseInitialEvent=function(t,e){if(Ur(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==$h.Offline;return this.options.waitForSyncWhenOnline&&n?(Ur(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===$h.Offline},ff.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},ff.prototype.raiseInitialEvent=function(t){Ur(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=bl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},ff);function ff(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=$h.Unknown,this.options=n||{}}var pf=(df.fromSnapshot=function(t,e){for(var n=Oo(),r=Oo(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case ll.Added:n=n.add(a.doc.key);break;case ll.Removed:r=r.add(a.doc.key)}}return new df(t,e.fromCache,n,r)},df);function df(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var mf=function(t){this.key=t},yf=function(t){this.key=t},gf=(Object.defineProperty(vf.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),vf.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new gl,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimitToFirst()&&c.size===this.query.limit?c.last():null,d=this.query.hasLimitToLast()&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Ks?e:null;r&&(Ur(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:ll.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:ll.Modified,doc:r}),a=!0,(p&&0<s.query.docComparator(r,p)||d&&s.query.docComparator(r,d)<0)&&(f=!0)):!n&&r?(u.track({type:ll.Added,doc:r}),a=!0):n&&!r&&(u.track({type:ll.Removed,doc:n}),a=!0,(p||d)&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;l.size>this.query.limit;){var n=this.query.hasLimitToFirst()?l.last():l.first();l=l.delete(n.key),h=h.delete(n.key),u.track({type:ll.Removed,doc:n})}return Ur(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},vf.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},vf.prototype.applyChanges=function(t,e,n){var r=this;Ur(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case ll.Added:return 1;case ll.Modified:case ll.Metadata:return 2;case ll.Removed:return 0;default:return Br("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?pl.Synced:pl.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new bl(this.query,t.documentSet,i,o,t.mutatedKeys,s===pl.Local,u,!1),limboChanges:a}:{limboChanges:a}},vf.prototype.applyOnlineStateChange=function(t){return this.current&&t===$h.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new gl,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},vf.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},vf.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Ur(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},vf.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Oo(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new yf(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new mf(t))}),r},vf.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Oo();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},vf.prototype.computeInitialSnapshot=function(){return bl.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===pl.Local)},vf);function vf(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Oo(),this.mutatedKeys=Oo(),this.documentSet=new ml(t.docComparator.bind(t))}var bf=(wf.prototype.run=function(){this.runWithBackOff()},wf.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return m(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},wf.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!xc(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},wf.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},wf.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!cl(e)},wf);function wf(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new qh(this.asyncQueue,Hi.RetryTransaction)}var Tf="SyncEngine",Sf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ef=function(t){this.key=t,this.receivedDocument=!1},If=(Object.defineProperty(Cf.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Cf.prototype.subscribe=function(t){Ur(null!==t,"SyncEngine listener cannot be null"),Ur(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},Cf.prototype.listen=function(a){return p(this,void 0,void 0,function(){var e,n,r,i,o;return m(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(a.toTarget())];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(a,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},Cf.prototype.initializeViewAndComputeSnapshot=function(s,u,c){return p(this,void 0,void 0,function(){var e,n,r,i,o,a;return m(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(s,!0)];case 1:return e=t.sent(),n=new gf(s,e.remoteKeys),r=n.computeDocChanges(e.documents),i=El.createSynthesizedTargetChangeForCurrentChange(u,c&&this.onlineState!==$h.Offline),Ur(0===(o=n.applyChanges(r,!0===this.isPrimary,i)).limboChanges.length,"View returned limbo docs before target ack from the server."),Ur(!!o.snapshot,"applyChanges for new view should always return a snapshot"),a=new Sf(s,u,n),this.queryViewsByQuery.set(s,a),this.queriesByTarget[u]||(this.queriesByTarget[u]=[]),this.queriesByTarget[u].push(s),[2,o.snapshot]}})})},Cf.prototype.synchronizeViewAndComputeSnapshot=function(r){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return e=t.sent(),n=r.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},Cf.prototype.unlisten=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return m(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Ur(!!(e=this.queryViewsByQuery.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.queryViewsByQuery.delete(i),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then(function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)}).catch(cc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Cf.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},Cf.prototype.runTransaction=function(t,e,n){new bf(t,this.remoteStore,e,n).run()},Cf.prototype.applyRemoteEvent=function(n){return p(this,void 0,void 0,function(){var e,r=this;return m(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),$r(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Ur(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Ur(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Ur(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cf.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===el.RemoteStore||!this.isPrimary&&t===el.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Ur(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},Cf.prototype.rejectListen=function(s,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,a=this;return m(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(s,"rejected",u),e=this.limboResolutionsByTarget[s],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[s],r=(r=new po(Wi.comparator)).insert(n,new Gs(n,lo.forDeletedDoc())),i=Oo().add(n),o=new Tl(lo.MIN,{},new So(Si),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return[4,this.localStore.releaseTarget(s,!1).then(function(){return a.removeAndCleanupTarget(s,u)}).catch(cc)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Cf.prototype.applyBatchState=function(n,r,i){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Fr(Tf,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Br("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},Cf.prototype.applySuccessfulWrite=function(r){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cf.prototype.rejectFailedWrite=function(n,r){return p(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cf.prototype.registerPendingWritesCallback=function(r){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||Fr(Tf,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},Cf.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},Cf.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new zr(Wr.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},Cf.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new po(Si)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},Cf.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Ur(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},Cf.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Ur(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach(function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)})}},Cf.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},Cf.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof mf?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof yf?(Fr(Tf,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Br("Unknown limbo change: "+JSON.stringify(i))}},Cf.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Fr(Tf,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Kc.atPath(e.path);this.limboResolutionsByTarget[n]=new Ef(e),this.remoteStore.listen(new zu(r.toTarget(),n,Uu.LimboResolution,Oi.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},Cf.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},Cf.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return p(this,void 0,void 0,function(){var o,a,e,s=this;return m(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(t){var e=t.documents;return i.view.computeDocChanges(e,n)}):n}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=pf.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},Cf.prototype.assertSubscribed=function(t){Ur(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},Cf.prototype.handleCredentialChange=function(r){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},Cf.prototype.applyPrimaryState=function(c){return p(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return m(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Zr(this.queriesByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)}),u.remoteStore.unlisten(t)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Cf.prototype.resetLimboDocuments=function(){var e=this;Zr(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new po(Wi.comparator)},Cf.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p;return m(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=t.sent(),u=0,c=s,t.label=4;case 4:return u<c.length?(h=c[u],Ur(!!(l=this.queryViewsByQuery.get(h)),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(f=t.sent()).snapshot&&n.push(f.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Ur(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return Ur(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(p)];case 10:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(a),t.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},Cf.prototype.synthesizeTargetToQuery=function(t){return new Kc(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,qc.First,t.startAt,t.endAt)},Cf.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},Cf.prototype.applyTargetState=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Fr(Tf,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=Tl.createSynthesizedRemoteEventForCurrentChange(r,"current"===i),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(r,!0)];case 5:return t.sent(),this.removeAndCleanupTarget(r,o),[3,7];case 6:Br("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},Cf.prototype.applyActiveTargetsChange=function(l,f){return p(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return m(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Ur(!this.queriesByTarget[c],"Trying to add an already active target"),[4,this.localStore.getTarget(c)]):[3,6];case 2:return Ur(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateTarget(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(r),i.targetId,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return m(this,function(t){switch(t.label){case 0:return a.queriesByTarget[e]?[4,a.localStore.releaseTarget(e,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupTarget(e)}).catch(cc)]:[2,"continue"];case 1:return t.sent(),[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},Cf.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},Cf.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},Cf.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Oo().add(e.key);var n=Oo(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Ur(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},Cf);function Cf(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Xs(function(t){return t.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new po(Wi.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new nc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=la.forSyncEngine(),this.isPrimary=void 0,this.onlineState=$h.Unknown}var Df=(Nf.prototype.isAuthenticated=function(){return null!=this.uid},Nf.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Nf.prototype.isEqual=function(t){return t.uid===this.uid},Nf.UNAUTHENTICATED=new Nf(null),Nf.GOOGLE_CREDENTIALS=new Nf("google-credentials-uid"),Nf.FIRST_PARTY=new Nf("first-party-uid"),Nf);function Nf(t){this.uid=t}var Af="firestore_clients";function kf(t,e){return Ur(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Af+"_"+t+"_"+e}var Rf="firestore_mutations";function Mf(t,e,n){var r=Rf+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var _f="firestore_targets";function Lf(t,e){return _f+"_"+t+"_"+e}var Of="firestore_online_state";var Pf="firestore_sequence_number";var xf="SharedClientState",Ff=(qf.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new zr(r.error.code,r.error.message)),i?new qf(t,e,r.state,o):(qr(xf,"Failed to parse mutation state for ID '"+e+"': "+n),null)},qf.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},qf);function qf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Ur(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var Vf=(Bf.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new zr(n.error.code,n.error.message)),r?new Bf(t,n.state,i):(qr(xf,"Failed to parse target state for ID '"+t+"': "+e),null)},Bf.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Bf);function Bf(t,e,n){this.targetId=t,this.state=e,Ur(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var Uf=(Kf.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=xo(),o=0;r&&o<n.activeTargetIds.length;++o)r=Fc(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Kf(t,i):(qr(xf,"Failed to parse client data for instance '"+t+"': "+e),null)},Kf);function Kf(t,e){this.clientId=t,this.activeTargetIds=e}var Qf=(jf.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in $h&&"string"==typeof e.clientId?new jf(e.clientId,$h[e.onlineState]):(qr(xf,"Failed to parse online state: "+t),null)},jf);function jf(t,e){this.clientId=t,this.onlineState=e}var Gf=(Wf.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Wf.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Wf.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},Wf);function Wf(){this.activeTargetIds=xo()}var zf=(Hf.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},Hf.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return m(this,function(t){switch(t.label){case 0:return Ur(!this.started,"WebStorageSharedClientState already started"),Ur(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Ur(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(kf(this.persistenceKey,i)))&&(a=Uf.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},Hf.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},Hf.prototype.getAllActiveQueryTargets=function(){var n=xo();return $r(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},Hf.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},Hf.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},Hf.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},Hf.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Lf(this.persistenceKey,t));if(n){var r=Vf.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},Hf.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},Hf.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},Hf.prototype.clearQueryState=function(t){this.removeItem(Lf(this.persistenceKey,t))},Hf.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},Hf.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},Hf.prototype.setOnlineState=function(t){this.persistOnlineState(t)},Hf.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},Hf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fr(xf,"READ",t,e),e},Hf.prototype.setItem=function(t,e){Fr(xf,"SET",t,e),this.storage.setItem(t,e)},Hf.prototype.removeItem=function(t){Fr(xf,"REMOVE",t),this.storage.removeItem(t)},Hf.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Fr(xf,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,a;return m(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Ur(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Oi.INVALID;if(null!=t)try{var n=JSON.parse(t);Ur("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){qr(xf,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Oi.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(Hf.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),Hf.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},Hf.prototype.persistMutationState=function(t,e,n){var r=new Ff(this.currentUser,t,e,n),i=Mf(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},Hf.prototype.removeMutationState=function(t){var e=Mf(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Hf.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:$h[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},Hf.prototype.persistQueryTargetState=function(t,e,n){var r=Lf(this.persistenceKey,t),i=new Vf(t,e,n);this.setItem(r,i.toWebStorageJSON())},Hf.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},Hf.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Ur(null!==n,"Cannot parse client state key '"+t+"'"),Uf.fromWebStorageEntry(n,e)},Hf.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Ur(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ff.fromWebStorageEntry(new Df(i),r,e)},Hf.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Ur(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Vf.fromWebStorageEntry(r,e)},Hf.prototype.fromWebStorageOnlineState=function(t){return Qf.fromWebStorageEntry(t)},Hf.prototype.handleMutationBatchEvent=function(e){return p(this,void 0,void 0,function(){return m(this,function(t){return e.user.uid!==this.currentUser.uid?(Fr(xf,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},Hf.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},Hf.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return m(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return m(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},Hf.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},Hf);function Hf(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!Hf.isAvailable(this.platform))throw new zr(Wr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=kf(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return Pf+"_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new Gf,this.clientStateKeyRe=new RegExp("^"+Af+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Rf+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+_f+"_"+o+"_(\\d+)$"),this.onlineStateKey=function(t){return Of+"_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}var Yf=(Xf.prototype.addPendingMutation=function(t){},Xf.prototype.updateMutationState=function(t,e,n){},Xf.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},Xf.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},Xf.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},Xf.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},Xf.prototype.clearQueryState=function(t){delete this.queryState[t]},Xf.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},Xf.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},Xf.prototype.start=function(){return this.localState=new Gf,Promise.resolve()},Xf.prototype.handleUserChange=function(t,e,n){},Xf.prototype.setOnlineState=function(t){},Xf.prototype.shutdown=function(){},Xf.prototype.writeSequenceNumber=function(t){},Xf);function Xf(){this.localState=new Gf,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var Jf="FirestoreClient",Zf=($f.prototype.lruParams=function(){return dc.withCacheSize(this.cacheSizeBytes)},$f);function $f(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var tp=function(){},ep=(np.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new Xi,i=new Xi,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},np.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},np.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Zf?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},np.prototype.canFallback=function(t){return t instanceof zr?t.code===Wr.FAILED_PRECONDITION||t.code===Wr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},np.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new zr(Wr.FAILED_PRECONDITION,"The client has already been terminated.")},np.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=Cc.buildStoragePrefix(this.databaseInfo),a=new af(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return m(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!zf.isAvailable(this.platform))throw new zr(Wr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new zf(this.asyncQueue,this.platform,o,this.clientId,r):new Yf,[4,Cc.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},np.prototype.startMemoryPersistence=function(){return this.persistence=kh.createEagerPersistence(this.clientId),this.sharedClientState=new Yf,Promise.resolve(null)},np.prototype.initializeRest=function(c,h){var t=this;return Fr(Jf,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return m(this,function(t){switch(t.label){case 0:return e=new bh,this.localStore=new sc(this.persistence,e,c),[4,this.localStore.start()];case 1:return t.sent(),h&&(this.lruScheduler=new yc(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new Jh(this.asyncQueue,u,this.credentials,r),o=function(t){return s.syncEngine.applyOnlineStateChange(t,el.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,el.SharedClientState)},this.remoteStore=new Fl(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new If(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new cf(this.syncEngine),[4,this.sharedClientState.start()];case 2:return t.sent(),[4,this.remoteStore.start()];case 3:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return p(s,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return p(s,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},np.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Fr(Jf,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},np.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},np.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return p(t,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},np.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Xi;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},np.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new lf(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},np.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},np.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Ks)return t;if(t instanceof Gs)return null;throw new zr(Wr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},np.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return m(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return e=t.sent(),n=new gf(i,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},np.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Xi;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},np.prototype.databaseId=function(){return this.databaseInfo.databaseId},np.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},np.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(np.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),np.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Xi;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},np);function np(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=wi.newId()}var rp=(ip.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},ip.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},ip.prototype.mute=function(){this.muted=!0},ip.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},ip);function ip(t){this.observer=t,this.muted=!1}var op=(ap.documentId=function(){return ap._DOCUMENT_ID},ap.prototype.isEqual=function(t){if(!(t instanceof ap))throw yi("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},ap._DOCUMENT_ID=new ap(ji.keyField().canonicalString()),ap);function ap(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+bi(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(oi("FieldPath","string",n,t[n]),0===t[n].length)throw new zr(Wr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ji(t)}var sp=new RegExp("[~\\*/\\[\\]]");var up=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},cp=(hp.prototype.getToken=function(){return Promise.resolve(null)},hp.prototype.invalidateToken=function(){},hp.prototype.setChangeListener=function(t){Ur(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(Df.UNAUTHENTICATED)},hp.prototype.removeChangeListener=function(){Ur(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},hp);function hp(){this.changeListener=null}var lp=(fp.prototype.getToken=function(){var e=this;Ur(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new zr(Wr.ABORTED,"getToken aborted due to token change.");return t?(Ur("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new up(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},fp.prototype.invalidateToken=function(){this.forceRefresh=!0},fp.prototype.setChangeListener=function(t){Ur(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},fp.prototype.removeChangeListener=function(){Ur(null!=this.tokenListener,"removeChangeListener() called twice"),Ur(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},fp.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return Ur(null===t||"string"==typeof t,"Received invalid UID: "+t),new Df(t)},fp);function fp(t){var e=this;this.tokenListener=null,this.currentUser=Df.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then(function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)},function(){}))}var pp=(Object.defineProperty(dp.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),dp);function dp(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Df.FIRST_PARTY}var mp=(yp.prototype.getToken=function(){return Promise.resolve(new pp(this.gapi,this.sessionIndex))},yp.prototype.setChangeListener=function(t){t(Df.FIRST_PARTY)},yp.prototype.removeChangeListener=function(){},yp.prototype.invalidateToken=function(){},yp);function yp(t,e){this.gapi=t,this.sessionIndex=e}function gp(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var vp=(bp.delete=function(){return ei("FieldValue.delete",arguments),Tp.instance},bp.serverTimestamp=function(){return ei("FieldValue.serverTimestamp",arguments),Ip.instance},bp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ri("FieldValue.arrayUnion",arguments,1),new Np(t)},bp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ri("FieldValue.arrayRemove",arguments,1),new Rp(t)},bp.increment=function(t){return oi("FieldValue.increment","number",1,t),ni("FieldValue.increment",arguments,1),new Lp(t)},bp.prototype.isEqual=function(t){return this===t},bp);function bp(t){this._methodName=t}var wp,Tp=(t(Sp,wp=vp),Sp.instance=new Sp,Sp);function Sp(){return wp.call(this,"FieldValue.delete")||this}var Ep,Ip=(t(Cp,Ep=vp),Cp.instance=new Cp,Cp);function Cp(){return Ep.call(this,"FieldValue.serverTimestamp")||this}var Dp,Np=(t(Ap,Dp=vp),Ap);function Ap(t){var e=Dp.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var kp,Rp=(t(Mp,kp=vp),Mp);function Mp(t){var e=kp.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var _p,Lp=(t(Op,_p=vp),Op);function Op(t){var e=_p.call(this,"FieldValue.increment")||this;return e._operand=t,e}var Pp=Yr(vp,"Use FieldValue.<field>() instead."),xp=/^__.*__$/,Fp=(qp.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Oa(t,this.data,this.fieldMask,e)):n.push(new Ma(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Fa(t,this.fieldTransforms)),n},qp);function qp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var Vp,Bp,Up=(Kp.prototype.toMutations=function(t,e){var n=[new Oa(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Fa(t,this.fieldTransforms)),n},Kp);function Kp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Qp(t){switch(t){case Vp.Set:case Vp.MergeSet:case Vp.Update:return!0;case Vp.Argument:case Vp.ArrayArgument:return!1;default:throw Br("Unexpected case for UserDataSource: "+t)}}(Bp=Vp=Vp||{})[Bp.Set=0]="Set",Bp[Bp.Update=1]="Update",Bp[Bp.MergeSet=2]="MergeSet",Bp[Bp.Argument=3]="Argument",Bp[Bp.ArrayArgument=4]="ArrayArgument";var jp=(Gp.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new Gp(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},Gp.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new Gp(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},Gp.prototype.childContextForArray=function(t){return new Gp(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},Gp.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new zr(Wr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},Gp.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},Gp.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},Gp.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(Qp(this.dataSource)&&xp.test(t))throw this.createError('Document fields cannot begin and end with "__"')},Gp);function Gp(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var Wp=function(t,e){this.databaseId=t,this.key=e},zp=(Hp.prototype.parseSetData=function(t,e){var n=new jp(Vp.Set,t,ji.EMPTY_PATH);Xp("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Fp(r,null,n.fieldTransforms)},Hp.prototype.parseMergeData=function(t,e,n){var r=new jp(Vp.MergeSet,t,ji.EMPTY_PATH);Xp("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new So(ji.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof op)l=h._internalPath;else{if("string"!=typeof h)throw Br("Expected stringOrFieldPath to be a string or a FieldPath");l=Zp(t,h)}if(!r.contains(l))throw new zr(Wr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=ba.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=ba.fromArray(r.fieldMask),o=r.fieldTransforms;return new Fp(a,i,o)},Hp.prototype.parseUpdateData=function(o,t){var a=this,s=new jp(Vp.Update,o,ji.EMPTY_PATH);Xp("Data must be an object, but it was:",s,t);var u=new So(ji.comparator),c=Os.EMPTY;$r(t,function(t,e){var n=Zp(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof Tp)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=ba.fromSet(u);return new Up(c,e,s.fieldTransforms)},Hp.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new jp(Vp.Update,t,ji.EMPTY_PATH),o=[Jp(t,e)],a=[n];if(r.length%2!=0)throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Jp(t,r[s])),a.push(r[s+1]);var u=new So(ji.comparator),c=Os.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Tp)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=ba.fromSet(u);return new Up(c,d,i.fieldTransforms)},Hp.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new jp(n?Vp.ArrayArgument:Vp.Argument,t,ji.EMPTY_PATH),i=this.parseData(e,r);return Ur(null!=i,"Parsed data should not be null."),Ur(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Hp.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=$p(t);throw e.createError(n)}},Hp.prototype.parseData=function(t,e){if(Yp(t=this.runPreConverter(t,e)))return Xp("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof vp)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==Vp.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},Hp.prototype.parseObject=function(t,r){var i=this,o=new po(Si);return ti(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):$r(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new Os(o)},Hp.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=ts.INSTANCE),n.push(s),r++}return new Fs(n)},Hp.prototype.parseSentinelFieldValue=function(t,e){if(!Qp(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Tp){if(e.dataSource!==Vp.MergeSet)throw e.dataSource===Vp.Update?(Ur(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Ip)e.fieldTransforms.push(new Ta(e.path,Ul.instance));else if(t instanceof Np){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Ql(n);e.fieldTransforms.push(new Ta(e.path,r))}else if(t instanceof Rp){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Gl(n);e.fieldTransforms.push(new Ta(e.path,i))}else if(t instanceof Lp){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new zl(o);e.fieldTransforms.push(new Ta(e.path,a))}else Br("Unknown FieldValue type: "+t)},Hp.prototype.parseScalarValue=function(t,e){if(null===t)return ts.INSTANCE;if("number"==typeof t)return Fc(t)?new hs(t):new ps(t);if("boolean"==typeof t)return rs.of(t);if("string"==typeof t)return new ys(t);if(t instanceof Date)return new bs(co.fromDate(t));if(t instanceof co)return new bs(new co(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Vl)return new Ms(t);if(t instanceof Ni)return new Cs(t);if(t instanceof Wp)return new As(t.databaseId,t.key);throw e.createError("Unsupported field value: "+pi(t))},Hp.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new jp(Vp.Argument,r,ji.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},Hp);function Hp(t){this.preConverter=t}function Yp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof co||t instanceof Vl||t instanceof Ni||t instanceof Wp||t instanceof vp)}function Xp(t,e,n){if(!Yp(n)||!fi(n)){var r=pi(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Jp(t,e){if(e instanceof op)return e._internalPath;if("string"==typeof e)return Zp(t,e);throw new zr(Wr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Zp(e,t){try{return function(e){if(0<=e.search(sp))throw new zr(Wr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(op.bind.apply(op,a([void 0],e.split("."))))}catch(t){throw new zr(Wr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=$p(t);throw new zr(Wr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function $p(t){return t instanceof Error?t.message:t.toString()}var td=dc.COLLECTION_DISABLED,ed=(nd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},nd);function nd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new zr(Wr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else si("settings","non-empty string","host",t.host),this.host=t.host,ui("settings","boolean","ssl",t.ssl),this.ssl=Jr(t.ssl,!0);if(mi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ui("settings","object","credentials",t.credentials),this.credentials=t.credentials,ui("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?qr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&qr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Jr(t.timestampsInSnapshots,!0),ui("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=dc.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==td&&t.cacheSizeBytes<dc.MINIMUM_CACHE_SIZE_BYTES)throw new zr(Wr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+dc.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}ui("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var rd=(id.prototype.settings=function(t){if(ni("Firestore.settings",arguments,1),oi("Firestore.settings","object",1,t),Xr(t,"persistence"))throw new zr(Wr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new ed(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new zr(Wr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new cp;switch(t.type){case"gapi":var e=t.client;return Ur(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new mp(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new zr(Wr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},id.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},id.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},id.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new zr(Wr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&qr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Jr(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Zf(this._settings.cacheSizeBytes,e))},id.prototype.clearPersistence=function(){var t=this,n=Cc.buildStoragePrefix(this.makeDatabaseInfo()),r=new Xi;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return p(t,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new zr(Wr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Cc.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},id.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(id.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),id.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},id.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),gp(t))return this.onSnapshotsInSyncInternal(t);oi("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},id.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new rp({next:function(){t.next&&t.next()},error:function(t){throw Br("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},id.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new tp),this._firestoreClient},id.prototype.makeDatabaseInfo=function(){return new Ri(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},id.prototype.configureClient=function(t){Ur(!!this._settings.host,"FirestoreSettings.host is not set"),Ur(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new ep(Kr.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},id.prototype.createDataConverter=function(r){return new zp(function(t){if(t instanceof cd){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new zr(Wr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new Wp(r,t._key)}return t})},id.databaseIdFromApp=function(t){var e=t.options;if(!Xr(e,"projectId"))throw new zr(Wr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new zr(Wr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new _i(n)},Object.defineProperty(id.prototype,"app",{get:function(){if(!this._firebaseApp)throw new zr(Wr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),id.prototype.collection=function(t){return ni("Firestore.collection",arguments,1),oi("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Ed(Bi.fromString(t),this)},id.prototype.doc=function(t){return ni("Firestore.doc",arguments,1),oi("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),cd.forPath(Bi.fromString(t),this)},id.prototype.collectionGroup=function(t){if(ni("Firestore.collectionGroup",arguments,1),oi("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new zr(Wr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new vd(new Kc(Bi.EMPTY_PATH,t),this)},id.prototype.runTransaction=function(e){var n=this;return ni("Firestore.runTransaction",arguments,1),oi("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new od(n,t))})},id.prototype.batch=function(){return this.ensureClientConfigured(),new sd(this)},Object.defineProperty(id,"logLevel",{get:function(){switch(Pr()){case Cr.DEBUG:return"debug";case Cr.ERROR:return"error";case Cr.SILENT:return"silent";default:return Br("Unknown log level: "+Pr())}},enumerable:!0,configurable:!0}),id.setLogLevel=function(t){switch(ni("Firestore.setLogLevel",arguments,1),oi("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":xr(Cr.DEBUG);break;case"error":xr(Cr.ERROR);break;case"silent":xr(Cr.SILENT);break;default:throw new zr(Wr.INVALID_ARGUMENT,"Invalid log level: "+t)}},id.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},id);function id(t,e){var n=this;if(this._firebaseApp=null,this._queue=new $i,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this._firebaseApp=r,this._databaseId=id.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new lp(e)}else{var i=t;if(!i.projectId)throw new zr(Wr.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new _i(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new cp}this._settings=new ed({}),this._dataConverter=this.createDataConverter(this._databaseId)}var od=(ad.prototype.get=function(t){var n=this;ni("Transaction.get",arguments,1);var r=Ad("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Br("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Gs)return new pd(n._firestore,r._key,null,!1,!1,r._converter);if(e instanceof Ks)return new pd(n._firestore,r._key,e,!1,!1,r._converter);throw Br("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},ad.prototype.set=function(t,e,n){ii("Transaction.set",arguments,2,3);var r=Ad("Transaction.set",t,this._firestore);n=Cd("Transaction.set",n);var i=kd(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},ad.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof op?(ri("Transaction.update",arguments,3),r=Ad("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(ni("Transaction.update",arguments,2),r=Ad("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},ad.prototype.delete=function(t){ni("Transaction.delete",arguments,1);var e=Ad("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},ad);function ad(t,e){this._firestore=t,this._transaction=e}var sd=(ud.prototype.set=function(t,e,n){ii("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Ad("WriteBatch.set",t,this._firestore);n=Cd("WriteBatch.set",n);var i=kd(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,Da.NONE)),this},ud.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof op?(ri("WriteBatch.update",arguments,3),r=Ad("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(ni("WriteBatch.update",arguments,2),r=Ad("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Da.exists(!0))),this},ud.prototype.delete=function(t){ni("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Ad("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Ba(e._key,Da.NONE)),this},ud.prototype.commit=function(){return p(this,void 0,void 0,function(){return m(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},ud.prototype.verifyNotCommitted=function(){if(this._committed)throw new zr(Wr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},ud);function ud(t){this._firestore=t,this._mutations=[],this._committed=!1}var cd=(hd.forPath=function(t,e,n){if(t.length%2!=0)throw new zr(Wr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new hd(new Wi(t),e,n)},Object.defineProperty(hd.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"parent",{get:function(){return new Ed(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),hd.prototype.collection=function(t){if(ni("DocumentReference.collection",arguments,1),oi("DocumentReference.collection","non-empty string",1,t),!t)throw new zr(Wr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Bi.fromString(t);return new Ed(this._key.path.child(e),this.firestore)},hd.prototype.isEqual=function(t){if(!(t instanceof hd))throw yi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)&&this._converter===t._converter},hd.prototype.set=function(t,e){ii("DocumentReference.set",arguments,1,2),e=Cd("DocumentReference.set",e);var n=kd(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,Da.NONE))},hd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof op?(ri("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(ni("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Da.exists(!0)))},hd.prototype.delete=function(){return ni("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Ba(this._key,Da.NONE)])},hd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ii("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||gp(t[i])||(mi("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ui("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=gp(t[i])?t[i]:(oi("DocumentReference.onSnapshot","function",i,t[i]),ai("DocumentReference.onSnapshot","function",i+1,t[i+1]),ai("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},hd.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new rp({next:function(t){if(n.next){Ur(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new pd(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites,r._converter))}},error:e}),o=this._firestoreClient.listen(Kc.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},hd.prototype.get=function(n){var r=this;return ii("DocumentReference.get",arguments,0,1),Nd("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new pd(r.firestore,r._key,t,!0,t instanceof Ks&&t.hasLocalMutations,r._converter))},t):r.getViaSnapshotListener(e,t,n)})},hd.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new zr(Wr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new zr(Wr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},hd.prototype.withConverter=function(t){return new hd(this._key,this.firestore,t)},hd);function hd(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}var ld=(fd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},fd);function fd(t,e){this.hasPendingWrites=t,this.fromCache=e}var pd=(dd.prototype.data=function(t){if(ii("DocumentSnapshot.data",arguments,0,1),t=Dd("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new yd(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),Ya.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},dd.prototype.get=function(t,e){if(ii("DocumentSnapshot.get",arguments,1,2),e=Dd("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(Jp("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,Ya.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(dd.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(dd.prototype,"ref",{get:function(){return new cd(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(dd.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(dd.prototype,"metadata",{get:function(){return new ld(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),dd.prototype.isEqual=function(t){if(!(t instanceof dd))throw yi("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))&&this._converter===t._converter},dd.prototype.toJSObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.toJSValue(e,n)}),i},dd.prototype.toJSValue=function(t,e){if(t instanceof Os)return this.toJSObject(t,e);if(t instanceof Fs)return this.toJSArray(t,e);if(t instanceof As){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||qr("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new cd(n,this._firestore,this._converter)}return t.value(e)},dd.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.toJSValue(t,e)})},dd);function dd(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}var md,yd=(t(gd,md=pd),gd.prototype.data=function(t){var e=md.prototype.data.call(this,t);return Ur(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},gd);function gd(){return null!==md&&md.apply(this,arguments)||this}var vd=(bd.prototype.where=function(t,e,n){var r;ni("Query.where",arguments,3),di("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new zr(Wr.INVALID_ARGUMENT,"Invalid value "+pi(r)+" provided to function "+t+"() for its "+vi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Jp("Query.where",t),o=Gc.fromString(e);if(i.isKeyField()){if(o===Gc.ARRAY_CONTAINS||o===Gc.ARRAY_CONTAINS_ANY)throw new zr(Wr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===Gc.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Fs(a)}else r=this.parseDocumentIdValue(n)}else o!==Gc.IN&&o!==Gc.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===Gc.IN);var h=Hc.create(i,o,r);return this.validateNewFilter(h),new bd(this._query.addFilter(h),this.firestore,this._converter)},bd.prototype.orderBy=function(t,e){var n;if(ii("Query.orderBy",arguments,1,2),ai("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=lh.ASCENDING;else{if("desc"!==e)throw new zr(Wr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=lh.DESCENDING}if(null!==this._query.startAt)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Jp("Query.orderBy",t),i=new mh(r,n);return this.validateNewOrderBy(i),new bd(this._query.addOrderBy(i),this.firestore,this._converter)},bd.prototype.limit=function(t){return ni("Query.limit",arguments,1),oi("Query.limit","number",1,t),gi("Query.limit",1,t),new bd(this._query.withLimitToFirst(t),this.firestore,this._converter)},bd.prototype.limitToLast=function(t){return ni("Query.limitToLast",arguments,1),oi("Query.limitToLast","number",1,t),gi("Query.limitToLast",1,t),new bd(this._query.withLimitToLast(t),this.firestore,this._converter)},bd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new bd(this._query.withStartAt(r),this.firestore,this._converter)},bd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new bd(this._query.withStartAt(r),this.firestore,this._converter)},bd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new bd(this._query.withEndAt(r),this.firestore,this._converter)},bd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new bd(this._query.withEndAt(r),this.firestore,this._converter)},bd.prototype.isEqual=function(t){if(!(t instanceof bd))throw yi("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},bd.prototype.withConverter=function(t){return new bd(this._query,this.firestore,t)},bd.prototype.boundFromDocOrFields=function(t,e,n,r){if(di(t,1,e),e instanceof pd){if(0<n.length)throw new zr(Wr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new zr(Wr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},bd.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new As(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Ss)throw new zr(Wr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new ph(r,n)},bd.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new zr(Wr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Bi.fromString(a));if(!Wi.isDocumentKey(s))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Wi(s);i.push(new As(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new ph(i,n)},bd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ii("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||gp(t[i])||(mi("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ui("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=gp(t[i])?t[i]:(oi("Query.onSnapshot","function",i,t[i]),ai("Query.onSnapshot","function",i+1,t[i+1]),ai("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},bd.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new rp({next:function(t){e.next&&e.next(new wd(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},bd.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new zr(Wr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},bd.prototype.get=function(n){var r=this;return ii("Query.get",arguments,0,1),Nd("Query.get",n),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new wd(r.firestore,r._query,t,r._converter))},t):r.getViaSnapshotListener(e,t,n)})},bd.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new zr(Wr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},bd.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Bi.fromString(t));if(!Wi.isDocumentKey(e))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new As(this.firestore._databaseId,new Wi(e))}if(t instanceof cd){var n=t;return new As(this.firestore._databaseId,n._key)}throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+pi(t)+".")},bd.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new zr(Wr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new zr(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new zr(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new zr(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},bd.prototype.validateNewFilter=function(t){if(t instanceof Hc){var e=[Gc.ARRAY_CONTAINS,Gc.ARRAY_CONTAINS_ANY],n=[Gc.IN,Gc.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new zr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new zr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},bd.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},bd.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new zr(Wr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},bd);function bd(t,e,n){this._query=t,this.firestore=e,this._converter=n}var wd=(Object.defineProperty(Td.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(Td.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(Td.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),Td.prototype.forEach=function(e,n){var r=this;ii("QuerySnapshot.forEach",arguments,1,2),oi("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(Td.prototype,"query",{get:function(){return new vd(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Td.prototype.docChanges=function(t){t&&(mi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ui("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new zr(Wr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o,a){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new yd(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key),a);return Ur(t.type===ll.Added,"Invalid event type for first snapshot"),Ur(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var s=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==ll.Metadata}).map(function(t){var e=new yd(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key),a),n=-1,r=-1;return t.type!==ll.Added&&(Ur(0<=(n=s.indexOf(t.doc.key)),"Index for document not found"),s=s.delete(t.doc.key)),t.type!==ll.Removed&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case ll.Added:return"added";case ll.Modified:case ll.Metadata:return"modified";case ll.Removed:return"removed";default:return Br("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},Td.prototype.isEqual=function(t){if(!(t instanceof Td))throw yi("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)&&this._converter===t._converter},Td.prototype.convertToDocumentImpl=function(t){return new yd(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},Td);function Td(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new ld(n.hasPendingWrites,n.fromCache)}a(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(wd.prototype.docChanges,t,{get:function(){return function(){throw new zr(Wr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Sd,Ed=(t(Id,Sd=vd),Object.defineProperty(Id.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(Id.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new cd(new Wi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(Id.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),Id.prototype.doc=function(t){if(ii("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=wi.newId()),oi("CollectionReference.doc","non-empty string",1,t),""===t)throw new zr(Wr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Bi.fromString(t);return cd.forPath(this._query.path.child(e),this.firestore,this._converter)},Id.prototype.add=function(t){ni("CollectionReference.add",arguments,1),oi("CollectionReference.add","object",1,this._converter?this._converter.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Id.prototype.withConverter=function(t){return new Id(this._path,this.firestore,t)},Id);function Id(t,e,n){var r=Sd.call(this,Kc.atPath(t),e,n)||this;if((r._path=t).length%2!=1)throw new zr(Wr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return r}function Cd(t,e){if(void 0===e)return{merge:!1};if(mi(t,e,["merge","mergeFields"]),ui(t,"boolean","merge",e.merge),ci(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof op}),void 0!==e.mergeFields&&void 0!==e.merge)throw new zr(Wr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Dd(t,e){return void 0===e?{}:(mi(t,e,["serverTimestamps"]),hi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Nd(t,e){ai(t,"object",1,e),e&&(mi(t,e,["source"]),hi(t,0,"source",e.source,["default","server","cache"]))}function Ad(t,e,n){if(e instanceof cd){if(e.firestore!==n)throw new zr(Wr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw yi(t,"DocumentReference",1,e)}function kd(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Rd=Yr(rd,"Use firebase.firestore() instead."),Md=Yr(od,"Use firebase.firestore().runTransaction() instead."),_d=Yr(sd,"Use firebase.firestore().batch() instead."),Ld=Yr(cd,"Use firebase.firestore().doc() instead."),Od=Yr(pd),Pd=Yr(yd),xd=Yr(vd),Fd=Yr(wd),qd=Yr(Ed,"Use firebase.firestore().collection() instead."),Vd={Firestore:Rd,GeoPoint:Vl,Timestamp:co,Blob:ki,Transaction:Md,WriteBatch:_d,DocumentReference:Ld,DocumentSnapshot:Od,Query:xd,QueryDocumentSnapshot:Pd,QuerySnapshot:Fd,CollectionReference:qd,FieldPath:op,FieldValue:Pp,setLogLevel:rd.setLogLevel,CACHE_SIZE_UNLIMITED:td};function Bd(t){t.INTERNAL.registerComponent(new w("firestore",function(t){var e=t.getProvider("app").getImmediate();return new rd(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(t){Ur(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Vd)))}var Ud=(Kd.prototype.addCallback=function(t){},Kd.prototype.shutdown=function(){},Kd);function Kd(){}var Qd="ConnectivityMonitor",jd=(Gd.prototype.addCallback=function(t){this.callbacks.push(t)},Gd.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},Gd.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},Gd.prototype.onNetworkAvailable=function(){Fr(Qd,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},Gd.prototype.onNetworkUnavailable=function(){Fr(Qd,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},Gd.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Gd);function Gd(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var Wd=(zd.prototype.onOpen=function(t){Ur(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},zd.prototype.onClose=function(t){Ur(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},zd.prototype.onMessage=function(t){Ur(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},zd.prototype.close=function(){this.closeFn()},zd.prototype.send=function(t){this.sendFn(t)},zd.prototype.callOnOpen=function(){Ur(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},zd.prototype.callOnClose=function(t){Ur(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},zd.prototype.callOnMessage=function(t){Ur(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},zd);function zd(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var Hd="Connection",Yd={BatchGetDocuments:"batchGet",Commit:"commit"},Xd="gl-js/ fire/"+Lr,Jd=(Zd.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Xd},Zd.prototype.invokeRPC=function(s,r,u){var c=this,h=this.makeUrl(s);return new Promise(function(i,o){var a=new _r;a.listenOnce(Rr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case kr.NO_ERROR:var t=a.getResponseJson();Fr(Hd,"XHR received:",JSON.stringify(t)),i(t);break;case kr.TIMEOUT:Fr(Hd,'RPC "'+s+'" timed out'),o(new zr(Wr.DEADLINE_EXCEEDED,"Request time out"));break;case kr.HTTP_ERROR:var e=a.getStatus();if(Fr(Hd,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Wr).indexOf(e)?e:Wr.UNKNOWN}(n.status);o(new zr(r,n.message))}else o(new zr(Wr.UNKNOWN,"Server responded with status "+a.getStatus()))}else Fr(Hd,'RPC "'+s+'" failed'),o(new zr(Wr.UNAVAILABLE,"Connection failed."));break;default:Br('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Fr(Hd,'RPC "'+s+'" completed.')}});var t=l({},r);delete t.database;var e=JSON.stringify(t);Fr(Hd,"XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c.modifyHeadersForRequest(n,u),a.send(h,"POST",e,n,15)})},Zd.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},Zd.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ar(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==typeof navigator&&"ReactNative"===navigator.product||0<=f().indexOf("Electron/")||function(){var t=f();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=f().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Fr(Hd,"Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),s=!1,c=!1,h=new Wd({sendFn:function(t){c?Fr(Hd,"Not sending because WebChannel is closed:",t):(s||(Fr(Hd,"Opening WebChannel transport."),u.open(),s=!0),Fr(Hd,"WebChannel sending:",t),u.send(t))},closeFn:function(){return u.close()}});return a(Mr.EventType.OPEN,function(){c||Fr(Hd,"WebChannel transport opened.")}),a(Mr.EventType.CLOSE,function(){c||(c=!0,Fr(Hd,"WebChannel transport closed"),h.callOnClose())}),a(Mr.EventType.ERROR,function(t){c||(c=!0,Fr(Hd,"WebChannel transport errored:",t),h.callOnClose(new zr(Wr.UNAVAILABLE,"The operation could not be completed")))}),a(Mr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Ur(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Fr(Hd,"WebChannel received error:",i);var o=i.status,a=function(t){var e=ol[t];if(void 0!==e)return hl(e)}(o),s=i.message;void 0===a&&(a=Wr.INTERNAL,s="Unknown error status: "+o+" with message "+i.message),c=!0,h.callOnClose(new zr(a,s)),u.close()}else Fr(Hd,"WebChannel received:",n),h.callOnMessage(n)}}),setTimeout(function(){h.callOnOpen()},0),h},Zd.prototype.makeUrl=function(t){var e=Yd[t];return Ur(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},Zd);function Zd(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var $d=(Object.defineProperty(tm.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(tm.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),tm.prototype.loadConnection=function(t){return Promise.resolve(new Jd(t))},tm.prototype.newConnectivityMonitor=function(){return jd.isAvailable()?new jd:new Ud},tm.prototype.newSerializer=function(t){return new af(t,{useProto3Json:!0})},tm.prototype.formatJSON=function(t){return JSON.stringify(t)},tm.prototype.atob=function(t){return atob(t)},tm.prototype.btoa=function(t){return btoa(t)},tm);function tm(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Kr.setPlatform(new $d);var em;Bd(em=nm),em.registerVersion("@firebase/firestore","1.10.2")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e=e||self).firebase)}(this,function(wt){"use strict";try{(function(){wt=wt&&wt.hasOwnProperty("default")?wt.default:wt;var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function e(r,n){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function d(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var t,n,o,h=(o=Error,r(t=a,n=o),void(t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)),a);function i(){this.constructor=t}function a(e,t){var r=o.call(this,t)||this;return r.code=e,r.name="FirebaseError",Object.setPrototypeOf(r,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,s.prototype.create),r}var s=(u.prototype.create=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=t[0]||{},o=this.service+"/"+e,i=this.errors[e],a=i?function(e,n){return e.replace(f,function(e,t){var r=n[t];return null!=r?r.toString():"<"+t+"?>"})}(i,n):"Error",s=this.serviceName+": "+a+" ("+o+").",u=new h(o,s),c=0,l=Object.keys(n);c<l.length;c++){var p=l[c];"_"!==p.slice(-1)&&(p in u&&console.warn('Overwriting FirebaseError base field "'+p+'" can cause unexpected behavior.'),u[p]=n[p])}return u},u);function u(e,t,r){this.service=e,this.serviceName=t,this.errors=r}var f=/\{\$([^}]+)}/g,c=(l.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},l.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},l.prototype.setServiceProps=function(e){return this.serviceProps=e,this},l);function l(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var p="firebasestorage.googleapis.com",_="storageBucket",m=(v.prototype.codeProp=function(){return this.code},v.prototype.codeEquals=function(e){return g(e)===this.codeProp()},v.prototype.serverResponseProp=function(){return this.serverResponse_},v.prototype.setServerResponseProp=function(e){this.serverResponse_=e},Object.defineProperty(v.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),v);function v(e,t){this.code_=g(e),this.message_="Firebase Storage: "+t,this.serverResponse_=null,this.name_="FirebaseError"}var b={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function g(e){return"storage/"+e}function y(){return new m(b.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function w(){return new m(b.CANCELED,"User canceled the upload/download.")}function R(){return new m(b.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function T(e,t,r){return new m(b.INVALID_ARGUMENT,"Invalid argument in `"+t+"` at index "+e+": "+r)}function E(){return new m(b.APP_DELETED,"The Firebase app was deleted.")}function k(e,t){return new m(b.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function O(e){throw new m(b.INTERNAL_ERROR,"Internal error: "+e)}var U={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function A(e){switch(e){case U.RAW:case U.BASE64:case U.BASE64URL:case U.DATA_URL:return;default:throw"Expected one of the event types: ["+U.RAW+", "+U.BASE64+", "+U.BASE64URL+", "+U.DATA_URL+"]."}}var x=function(e,t){this.data=e,this.contentType=t||null};function P(e,t){switch(e){case U.RAW:return new x(S(t));case U.BASE64:case U.BASE64URL:return new x(C(e,t));case U.DATA_URL:return new x(function(e){var t=new N(e);return t.base64?C(U.BASE64,t.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(e){throw k(U.DATA_URL,"Malformed data URL.")}return S(t)}(t.rest)}(t),function(e){return new N(e).contentType}(t))}throw y()}function S(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<=127)t.push(n);else if(n<=2047)t.push(192|n>>6,128|63&n);else if(55296==(64512&n))if(r<e.length-1&&56320==(64512&e.charCodeAt(r+1)))n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n);else t.push(239,191,189);else 56320==(64512&n)?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function C(t,e){switch(t){case U.BASE64:var r=-1!==e.indexOf("-"),n=-1!==e.indexOf("_");if(r||n)throw k(t,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break;case U.BASE64URL:var o=-1!==e.indexOf("+"),i=-1!==e.indexOf("/");if(o||i)throw k(t,"Invalid character '"+(o?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw k(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var N=function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw k(U.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var r=t[1]||null;null!=r&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)};var I,L,D={STATE_CHANGED:"state_changed"},M="running",W="pausing",B="paused",j="success",q="canceling",F="canceled",H="error",z={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function G(e){switch(e){case M:case W:case q:return z.RUNNING;case B:return z.PAUSED;case j:return z.SUCCESS;case F:return z.CANCELED;case H:default:return z.ERROR}}function X(e){return null!=e}function V(e){return void 0!==e}function K(e){return"function"==typeof e}function Z(e){return"object"==typeof e}function J(e){return"string"==typeof e||e instanceof String}function $(e){return"number"==typeof e||e instanceof Number}function Q(e){return Y()&&e instanceof Blob}function Y(){return"undefined"!=typeof Blob}(L=I=I||{})[L.NO_ERROR=0]="NO_ERROR",L[L.NETWORK_ERROR=1]="NETWORK_ERROR",L[L.ABORT=2]="ABORT";var ee=(te.prototype.send=function(e,t,r,n){if(this.sent_)throw O("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),X(n))for(var o in n)n.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,n[o].toString());return X(r)?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_},te.prototype.getErrorCode=function(){if(!this.sent_)throw O("cannot .getErrorCode() before sending");return this.errorCode_},te.prototype.getStatus=function(){if(!this.sent_)throw O("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},te.prototype.getResponseText=function(){if(!this.sent_)throw O("cannot .getResponseText() before sending");return this.xhr_.responseText},te.prototype.abort=function(){this.xhr_.abort()},te.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},te.prototype.addUploadProgressListener=function(e){X(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)},te.prototype.removeUploadProgressListener=function(e){X(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)},te);function te(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=I.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=I.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=I.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}var re=(ne.prototype.createXhrIo=function(){return new ee},ne);function ne(){}function oe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==r){for(var n=new r,o=0;o<e.length;o++)n.append(e[o]);return n.getBlob()}if(Y())return new Blob(e);throw Error("This browser doesn't seem to support creating Blobs")}var ie=(ae.prototype.size=function(){return this.size_},ae.prototype.type=function(){return this.type_},ae.prototype.slice=function(e,t){if(Q(this.data_)){var r=function(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}(this.data_,e,t);return null===r?null:new ae(r)}return new ae(new Uint8Array(this.data_.buffer,e,t-e),!0)},ae.getBlob=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(Y()){var r=e.map(function(e){return e instanceof ae?e.data_:e});return new ae(oe.apply(null,r))}var n=e.map(function(e){return J(e)?P(U.RAW,e).data:e.data_}),o=0;n.forEach(function(e){o+=e.byteLength});var i=new Uint8Array(o),a=0;return n.forEach(function(e){for(var t=0;t<e.length;t++)i[a++]=e[t]}),new ae(i,!0)},ae.prototype.uploadData=function(){return this.data_},ae);function ae(e,t){var r=0,n="";Q(e)?(r=(this.data_=e).size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}var se=(Object.defineProperty(ue.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),ue.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},ue.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},ue.makeFromBucketSpec=function(t){var e;try{e=ue.makeFromUrl(t)}catch(e){return new ue(t,"")}if(""===e.path)return e;throw function(e){return new m(b.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}(t)},ue.makeFromUrl=function(e){for(var t=null,r="([A-Za-z0-9.\\-_]+)",n=new RegExp("^gs://"+r+"(/(.*))?$","i"),o=p.replace(/[.]/g,"\\."),i=[{regex:n,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+r+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(e){e.path_=decodeURIComponent(e.path)}}],a=0;a<i.length;a++){var s=i[a],u=s.regex.exec(e);if(u){var c=u[s.indices.bucket],l=u[s.indices.path];t=new ue(c,l=l||""),s.postModify(t);break}}if(null==t)throw function(e){return new m(b.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return t},ue);function ue(e,t){this.bucket=e,this.path_=t}function ce(e){var t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return Z(e)&&!Array.isArray(e)}(t)?t:null}function le(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function pe(e){return"https://"+p+"/v0"+e}function he(e){var t=encodeURIComponent,r="?";for(var n in e){if(e.hasOwnProperty(n))r=r+(t(n)+"="+t(e[n]))+"&"}return r=r.slice(0,-1)}function fe(e,t){return t}var de=function(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||fe},_e=null;function ve(){if(_e)return _e;var e=[];e.push(new de("bucket")),e.push(new de("generation")),e.push(new de("metageneration")),e.push(new de("name","fullPath",!0));var t=new de("name");t.xform=function(e,t){return function(e){return!J(e)||e.length<2?e:le(e)}(t)},e.push(t);var r=new de("size");return r.xform=function(e,t){return X(t)?Number(t):t},e.push(r),e.push(new de("timeCreated")),e.push(new de("updated")),e.push(new de("md5Hash",null,!0)),e.push(new de("cacheControl",null,!0)),e.push(new de("contentDisposition",null,!0)),e.push(new de("contentEncoding",null,!0)),e.push(new de("contentLanguage",null,!0)),e.push(new de("contentType",null,!0)),e.push(new de("metadata","customMetadata",!0)),_e=e}function me(n,o){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,r=new se(e,t);return o.makeStorageReference(r)}})}function be(e,t,r){var n=ce(t);return null===n?null:function(e,t,r){for(var n={type:"file"},o=r.length,i=0;i<o;i++){var a=r[i];n[a.local]=a.xform(n,t[a.server])}return me(n,e),n}(e,n,r)}function ge(e,t){for(var r={},n=t.length,o=0;o<n;o++){var i=t[o];i.writable&&(r[i.server]=e[i.local])}return JSON.stringify(r)}function ye(e){if(!Z(e)||!e)throw"Expected Metadata object.";for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if("customMetadata"===t){if(!Z(r))throw"Expected object for 'customMetadata' mapping."}else if(Z(n=r)&&null!==n)throw"Mapping for '"+t+"' cannot be an object."}var n}var we="maxResults",Re=1e3,Te="pageToken",Ee="prefixes",ke="items";function Oe(e,t){var r={prefixes:[],items:[],nextPageToken:t.nextPageToken},n=e.bucket();if(null===n)throw new m(b.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_+"' property when initializing the app?");if(t[Ee])for(var o=0,i=t[Ee];o<i.length;o++){var a=i[o].replace(/\/$/,""),s=e.makeStorageReference(new se(n,a));r.prefixes.push(s)}if(t[ke])for(var u=0,c=t[ke];u<c.length;u++){var l=c[u];s=e.makeStorageReference(new se(n,l.name));r.items.push(s)}return r}function Ue(e){if(!Z(e)||!e)throw"Expected ListOptions object.";for(var t in e)if(t===we){if(!$(r=e[we])||!Number.isInteger(r)||e[we]<=0)throw"Expected maxResults to be a positive number.";if(1e3<e[we])throw"Expected maxResults to be less than or equal to "+Re+"."}else{if(t!==Te)throw"Unknown option: "+t;if(e[Te]&&!J(e[Te]))throw"Expected pageToken to be string."}var r}var Ae=function(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function xe(e){if(!e)throw y()}function Pe(n,o){return function(e,t){var r=be(n,t,o);return xe(null!==r),r}}function Se(n){return function(e,t){var r=function(e,t){var r=ce(t);return null===r?null:Oe(e,r)}(n,t);return xe(null!==r),r}}function Ce(n,o){return function(e,t){var r=be(n,t,o);return xe(null!==r),function(n,e){var t=ce(e);if(null===t)return null;if(!J(t.downloadTokens))return null;var r=t.downloadTokens;if(0===r.length)return null;var o=encodeURIComponent;return r.split(",").map(function(e){var t=n.bucket,r=n.fullPath;return pe("/b/"+o(t)+"/o/"+o(r))+he({alt:"media",token:e})})[0]}(r,t)}}function Ne(n){return function(e,t){var r;return(r=401===e.getStatus()?new m(b.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(e){return new m(b.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(n.bucket):403===e.getStatus()?function(e){return new m(b.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}(n.path):t).setServerResponseProp(t.serverResponseProp()),r}}function Ie(n){var o=Ne(n);return function(e,t){var r=o(e,t);return 404===e.getStatus()&&(r=function(e){return new m(b.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}(n.path)),r.setServerResponseProp(t.serverResponseProp()),r}}function Le(e,t,r){var n=pe(t.fullServerUrl()),o=e.maxOperationRetryTime(),i=new Ae(n,"GET",Pe(e,r),o);return i.errorHandler=Ie(t),i}function De(e,t,r){var n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),n}function Me(e,t,r,n,o){var i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var s=function(){for(var e="",t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+s;var u=De(t,n,o),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ge(u,r)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+s+"--",p=ie.getBlob(c,n,l);if(null===p)throw R();var h={name:u.fullPath},f=pe(i),d=e.maxUploadRetryTime(),_=new Ae(f,"POST",Pe(e,r),d);return _.urlParams=h,_.headers=a,_.body=p.uploadData(),_.errorHandler=Ne(t),_}var We=function(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null};function Be(e,t){var r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){xe(!1)}return xe(!!r&&-1!==(t||["active"]).indexOf(r)),r}function je(e,t,r,n,o){var i=t.bucketOnlyServerUrl(),a=De(t,n,o),s={name:a.fullPath},u=pe(i),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":n.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},l=ge(a,r),p=e.maxUploadRetryTime();var h=new Ae(u,"POST",function(e){var t;Be(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){xe(!1)}return xe(J(t)),t},p);return h.urlParams=s,h.headers=c,h.body=l,h.errorHandler=Ne(t),h}function qe(e,t,r,o){var n=e.maxUploadRetryTime(),i=new Ae(r,"POST",function(e){var t=Be(e,["active","final"]),r=null;try{r=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){xe(!1)}r||xe(!1);var n=Number(r);return xe(!isNaN(n)),new We(n,o.size(),"final"===t)},n);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=Ne(t),i}function Fe(e,a,t,s,r,u,n,o){var c=new We(0,0);if(n?(c.current=n.current,c.total=n.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new m(b.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var i=c.total-c.current,l=i;0<r&&(l=Math.min(l,r));var p=c.current,h=p+l,f={"X-Goog-Upload-Command":l===i?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(p,h);if(null===d)throw R();var _=a.maxUploadRetryTime(),v=new Ae(t,"POST",function(e,t){var r,n=Be(e,["active","final"]),o=c.current+l,i=s.size();return r="final"===n?Pe(a,u)(e,t):null,new We(o,i,"final"===n,r)},_);return v.headers=f,v.body=d.uploadData(),v.progressCallback=o||null,v.errorHandler=Ne(e),v}var He=function(e,t,r){if(K(e)||X(t)||X(r))this.next=e,this.error=t||null,this.complete=r||null;else{var n=e;this.next=n.next||null,this.error=n.error||null,this.complete=n.complete||null}},ze=function(e,t,r,n,o,i){this.bytesTransferred=e,this.totalBytes=t,this.state=r,this.metadata=n,this.task=o,this.ref=i};function Ge(t,e,r){for(var n=e.length,o=e.length,i=0;i<e.length;i++)if(e[i].optional){n=i;break}if(!(n<=r.length&&r.length<=o))throw function(e,t,r,n){var o,i;return i=e===t?1===(o=e)?"argument":"arguments":(o="between "+e+" and "+t,"arguments"),new m(b.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+r+"`: Expected "+o+" "+i+", received "+n+".")}(n,o,t,r.length);for(i=0;i<r.length;i++)try{e[i].validator(r[i])}catch(e){throw e instanceof Error?T(i,t,e.message):T(i,t,e)}}var Xe=function(t,e){var r=this;this.validator=function(e){r.optional&&!V(e)||t(e)},this.optional=!!e};function Ve(e,t){function r(e){if(!J(e))throw"Expected string."}var n;return n=e?function(t,r){return function(e){t(e),r(e)}}(r,e):r,new Xe(n,t)}function Ke(){return new Xe(function(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Y()&&e instanceof Blob))throw"Expected Blob or File."})}function Ze(e){return new Xe(ye,e)}function Je(){return new Xe(function(e){if(!($(e)&&0<=e))throw"Expected a number 0 or greater."})}function $e(t,e){return new Xe(function(e){if(!(null===e||X(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function Qe(e){return new Xe(function(e){if(!(null===e||K(e)))throw"Expected a Function."},e)}function Ye(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Promise.resolve().then(function(){return r.apply(void 0,e)})}}var et=(tt.prototype.makeProgressCallback_=function(){var t=this,r=this.transferred_;return function(e){return t.updateProgress_(r+e)}},tt.prototype.shouldDoResumable_=function(e){return 262144<e.size()},tt.prototype.start_=function(){this.state_===M&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},tt.prototype.resolveToken_=function(t){var r=this;this.authWrapper_.getAuthToken().then(function(e){switch(r.state_){case M:t(e);break;case q:r.transition_(F);break;case W:r.transition_(B)}})},tt.prototype.createResumable_=function(){var n=this;this.resolveToken_(function(e){var t=je(n.authWrapper_,n.location_,n.mappings_,n.blob_,n.metadata_),r=n.authWrapper_.makeRequest(t,e);(n.request_=r).getPromise().then(function(e){n.request_=null,n.uploadUrl_=e,n.needToFetchStatus_=!1,n.completeTransitions_()},n.errorHandler_)})},tt.prototype.fetchStatus_=function(){var n=this,o=this.uploadUrl_;this.resolveToken_(function(e){var t=qe(n.authWrapper_,n.location_,o,n.blob_),r=n.authWrapper_.makeRequest(t,e);(n.request_=r).getPromise().then(function(e){e=e,n.request_=null,n.updateProgress_(e.current),n.needToFetchStatus_=!1,e.finalized&&(n.needToFetchMetadata_=!0),n.completeTransitions_()},n.errorHandler_)})},tt.prototype.continueUpload_=function(){var n=this,o=262144*this.chunkMultiplier_,i=new We(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(e){var t;try{t=Fe(n.location_,n.authWrapper_,a,n.blob_,o,n.mappings_,i,n.makeProgressCallback_())}catch(e){return n.error_=e,void n.transition_(H)}var r=n.authWrapper_.makeRequest(t,e);(n.request_=r).getPromise().then(function(e){n.increaseMultiplier_(),n.request_=null,n.updateProgress_(e.current),e.finalized?(n.metadata_=e.metadata,n.transition_(j)):n.completeTransitions_()},n.errorHandler_)})},tt.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},tt.prototype.fetchMetadata_=function(){var n=this;this.resolveToken_(function(e){var t=Le(n.authWrapper_,n.location_,n.mappings_),r=n.authWrapper_.makeRequest(t,e);(n.request_=r).getPromise().then(function(e){n.request_=null,n.metadata_=e,n.transition_(j)},n.metadataErrorHandler_)})},tt.prototype.oneShotUpload_=function(){var n=this;this.resolveToken_(function(e){var t=Me(n.authWrapper_,n.location_,n.mappings_,n.blob_,n.metadata_),r=n.authWrapper_.makeRequest(t,e);(n.request_=r).getPromise().then(function(e){n.request_=null,n.metadata_=e,n.updateProgress_(n.blob_.size()),n.transition_(j)},n.errorHandler_)})},tt.prototype.updateProgress_=function(e){var t=this.transferred_;this.transferred_=e,this.transferred_!==t&&this.notifyObservers_()},tt.prototype.transition_=function(e){if(this.state_!==e)switch(e){case q:case W:this.state_=e,null!==this.request_&&this.request_.cancel();break;case M:var t=this.state_===B;this.state_=e,t&&(this.notifyObservers_(),this.start_());break;case B:this.state_=e,this.notifyObservers_();break;case F:this.error_=w(),this.state_=e,this.notifyObservers_();break;case H:case j:this.state_=e,this.notifyObservers_()}},tt.prototype.completeTransitions_=function(){switch(this.state_){case W:this.transition_(B);break;case q:this.transition_(F);break;case M:this.start_()}},Object.defineProperty(tt.prototype,"snapshot",{get:function(){var e=G(this.state_);return new ze(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),tt.prototype.on=function(e,t,r,i){var n="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=Qe(!0).validator,a=$e(null,!0).validator;function s(e){try{return void o(e)}catch(e){}try{if(a(e),!(V(e.next)||V(e.error)||V(e.complete)))throw"";return}catch(e){throw n}}Ge("on",[Ve(function(){if(e!==D.STATE_CHANGED)throw"Expected one of the event types: ["+D.STATE_CHANGED+"]."}),$e(s,!0),Qe(!0),Qe(!0)],arguments);var u=this;function c(o){return function(e,t,r){null!==o&&Ge("on",o,arguments);var n=new He(e,t,i);return u.addObserver_(n),function(){u.removeObserver_(n)}}}var l=[$e(function(e){if(null===e)throw n;s(e)}),Qe(!0),Qe(!0)];return V(t)||V(r)||V(i)?c(null)(t,r,i):c(l)},tt.prototype.then=function(e,t){return this.promise_.then(e,t)},tt.prototype.catch=function(e){return this.then(null,e)},tt.prototype.addObserver_=function(e){this.observers_.push(e),this.notifyObserver_(e)},tt.prototype.removeObserver_=function(e){var t=this.observers_.indexOf(e);-1!==t&&this.observers_.splice(t,1)},tt.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach(function(e){t.notifyObserver_(e)})},tt.prototype.finishPromise_=function(){if(null!==this.resolve_){var e=!0;switch(G(this.state_)){case z.SUCCESS:Ye(this.resolve_.bind(null,this.snapshot))();break;case z.CANCELED:case z.ERROR:Ye(this.reject_.bind(null,this.error_))();break;default:e=!1}e&&(this.resolve_=null,this.reject_=null)}},tt.prototype.notifyObserver_=function(e){switch(G(this.state_)){case z.RUNNING:case z.PAUSED:e.next&&Ye(e.next.bind(e,this.snapshot))();break;case z.SUCCESS:e.complete&&Ye(e.complete.bind(e))();break;case z.CANCELED:case z.ERROR:e.error&&Ye(e.error.bind(e,this.error_))();break;default:e.error&&Ye(e.error.bind(e,this.error_))()}},tt.prototype.resume=function(){Ge("resume",[],arguments);var e=this.state_===B||this.state_===W;return e&&this.transition_(M),e},tt.prototype.pause=function(){Ge("pause",[],arguments);var e=this.state_===M;return e&&this.transition_(W),e},tt.prototype.cancel=function(){Ge("cancel",[],arguments);var e=this.state_===M||this.state_===W;return e&&this.transition_(q),e},tt);function tt(e,t,r,n,o,i){var a=this;void 0===i&&(i=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.authWrapper_=t,this.location_=r,this.blob_=o,this.metadata_=i,this.mappings_=n,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=M,this.errorHandler_=function(e){a.request_=null,a.chunkMultiplier_=1,e.codeEquals(b.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=e,a.transition_(H))},this.metadataErrorHandler_=function(e){a.request_=null,e.codeEquals(b.CANCELED)?a.completeTransitions_():(a.error_=e,a.transition_(H))},this.promise_=new Promise(function(e,t){a.resolve_=e,a.reject_=t,a.start_()}),this.promise_.then(null,function(){})}var rt=(nt.prototype.toString=function(){return Ge("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},nt.prototype.newRef=function(e,t){return new nt(e,t)},nt.prototype.mappings=function(){return ve()},nt.prototype.child=function(e){Ge("child",[Ve()],arguments);var t=function(e,t){var r=t.split("/").filter(function(e){return 0<e.length}).join("/");return 0===e.length?r:e+"/"+r}(this.location.path,e),r=new se(this.location.bucket,t);return this.newRef(this.authWrapper,r)},Object.defineProperty(nt.prototype,"parent",{get:function(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this.location.path);if(null===e)return null;var t=new se(this.location.bucket,e);return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"root",{get:function(){var e=new se(this.location.bucket,"");return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"name",{get:function(){return le(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(nt.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),nt.prototype.put=function(e,t){return void 0===t&&(t=null),Ge("put",[Ke(),Ze(!0)],arguments),this.throwIfRoot_("put"),new et(this,this.authWrapper,this.location,this.mappings(),new ie(e),t)},nt.prototype.putString=function(e,t,r){void 0===t&&(t=U.RAW),Ge("putString",[Ve(),Ve(A,!0),Ze(!0)],arguments),this.throwIfRoot_("putString");var n=P(t,e),o=Object.assign({},r);return!X(o.contentType)&&X(n.contentType)&&(o.contentType=n.contentType),new et(this,this.authWrapper,this.location,this.mappings(),new ie(n.data,!0),o)},nt.prototype.delete=function(){var r=this;return Ge("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(e){var t=function(e,t){var r=pe(t.fullServerUrl()),n=e.maxOperationRetryTime(),o=new Ae(r,"DELETE",function(e,t){},n);return o.successCodes=[200,204],o.errorHandler=Ie(t),o}(r.authWrapper,r.location);return r.authWrapper.makeRequest(t,e).getPromise()})},nt.prototype.listAll=function(){Ge("listAll",[],arguments);var e={prefixes:[],items:[]};return this.listAllHelper(e).then(function(){return e})},nt.prototype.listAllHelper=function(i,a){return function(i,a,s,u){return new(s=s||Promise)(function(e,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}o((u=u.apply(i,a||[])).next())})}(this,void 0,void 0,function(){var t,r,n,o;return e(this,function(e){switch(e.label){case 0:return t={pageToken:a},[4,this.list(t)];case 1:return r=e.sent(),(n=i.prefixes).push.apply(n,r.prefixes),(o=i.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(i,r.nextPageToken)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},nt.prototype.list=function(n){Ge("list",[function(e){return new Xe(Ue,e)}(!0)],arguments);var o=this;return this.authWrapper.getAuthToken().then(function(e){var t=n||{},r=function(e,t,r,n,o){var i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",r&&0<r.length&&(i.delimiter=r),n&&(i.pageToken=n),o&&(i.maxResults=o);var a=pe(t.bucketOnlyServerUrl()),s=e.maxOperationRetryTime(),u=new Ae(a,"GET",Se(e),s);return u.urlParams=i,u.errorHandler=Ne(t),u}(o.authWrapper,o.location,"/",t.pageToken,t.maxResults);return o.authWrapper.makeRequest(r,e).getPromise()})},nt.prototype.getMetadata=function(){var r=this;return Ge("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(e){var t=Le(r.authWrapper,r.location,r.mappings());return r.authWrapper.makeRequest(t,e).getPromise()})},nt.prototype.updateMetadata=function(r){var n=this;return Ge("updateMetadata",[Ze()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(e){var t=function(e,t,r,n){var o=pe(t.fullServerUrl()),i=ge(r,n),a=e.maxOperationRetryTime(),s=new Ae(o,"PATCH",Pe(e,n),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=i,s.errorHandler=Ie(t),s}(n.authWrapper,n.location,r,n.mappings());return n.authWrapper.makeRequest(t,e).getPromise()})},nt.prototype.getDownloadURL=function(){var r=this;return Ge("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(e){var t=function(e,t,r){var n=pe(t.fullServerUrl()),o=e.maxOperationRetryTime(),i=new Ae(n,"GET",Ce(e,r),o);return i.errorHandler=Ie(t),i}(r.authWrapper,r.location,r.mappings());return r.authWrapper.makeRequest(t,e).getPromise().then(function(e){if(null===e)throw new m(b.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})})},nt.prototype.throwIfRoot_=function(e){if(""===this.location.path)throw function(e){return new m(b.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)},nt);function nt(e,t){this.authWrapper=e,this.location=t instanceof se?t:se.makeFromUrl(t)}var ot=(it.prototype.getPromise=function(){return this.promise_},it.prototype.cancel=function(e){},it);function it(e){this.promise_=Promise.reject(e)}var at=(st.prototype.addRequest=function(e){var t=this,r=this.id;this.id++,this.map.set(r,e),e.getPromise().then(function(){return t.map.delete(r)},function(){return t.map.delete(r)})},st.prototype.clear=function(){this.map.forEach(function(e){e&&e.cancel(!0)}),this.map.clear()},st);function st(){this.map=new Map,this.id=-9007199254740991}var ut=(ct.extractBucket_=function(e){var t=e[_]||null;return null==t?null:se.makeFromBucketSpec(t).bucket},ct.prototype.getAuthToken=function(){var e=this.authProvider_.getImmediate({optional:!0});return e?e.getToken().then(function(e){return null!==e?e.accessToken:null},function(){return null}):Promise.resolve(null)},ct.prototype.bucket=function(){if(this.deleted_)throw E();return this.bucket_},ct.prototype.service=function(){return this.service_},ct.prototype.makeStorageReference=function(e){return this.storageRefMaker_(this,e)},ct.prototype.makeRequest=function(e,t){if(this.deleted_)return new ot(E());var r=this.requestMaker_(e,t,this.pool_);return this.requestMap_.addRequest(r),r},ct.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},ct.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},ct.prototype.setMaxUploadRetryTime=function(e){this.maxUploadRetryTime_=e},ct.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},ct.prototype.setMaxOperationRetryTime=function(e){this.maxOperationRetryTime_=e},ct);function ct(e,t,r,n,o,i){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var a=this.app_.options;X(a)&&(this.bucket_=ct.extractBucket_(a))}this.authProvider_=t,this.storageRefMaker_=r,this.requestMaker_=n,this.pool_=i,this.service_=o,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new at}var lt=(pt.prototype.start_=function(){var s=this;function e(e,t){var r,n=s.resolve_,o=s.reject_,i=t.xhr;if(t.wasSuccessCode)try{var a=s.callback_(i,i.getResponseText());V(a)?n(a):n()}catch(e){o(e)}else null!==i?((r=y()).setServerResponseProp(i.getResponseText()),s.errorCallback_?o(s.errorCallback_(i,r)):o(r)):t.canceled?o(r=s.appDelete_?E():w()):o(r=new m(b.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new ht(!1,null,!0)):this.backoffId_=function(t,r,e){var n=1,o=null,i=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];u||(u=!0,r.apply(null,e))}function l(e){o=setTimeout(function(){o=null,t(p,s())},e)}function p(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];u||(e?c.call.apply(c,d([null,e],t)):s()||i?c.call.apply(c,d([null,e],t)):(n<64&&(n*=2),l(1===a?(a=2,0):1e3*(n+Math.random()))))}var h=!1;function f(e){h||(h=!0,u||(null!==o?(e||(a=2),clearTimeout(o),l(0)):e||(a=1)))}return l(0),setTimeout(function(){f(i=!0)},e),f}(function(i,e){if(e)i(!1,new ht(!1,null,!0));else{var t=s.pool_.createXhrIo();s.pendingXhr_=t,null!==s.progressCallback_&&t.addUploadProgressListener(a),t.send(s.url_,s.method_,s.body_,s.headers_).then(function(e){null!==s.progressCallback_&&e.removeUploadProgressListener(a),s.pendingXhr_=null;var t=(e=e).getErrorCode()===I.NO_ERROR,r=e.getStatus();if(t&&!s.isRetryStatusCode_(r)){var n=-1!==s.successCodes_.indexOf(r);i(!0,new ht(n,e))}else{var o=e.getErrorCode()===I.ABORT;i(!1,new ht(!1,null,o))}})}function a(e){var t=e.loaded,r=e.lengthComputable?e.total:-1;null!==s.progressCallback_&&s.progressCallback_(t,r)}},e,this.timeout_)},pt.prototype.getPromise=function(){return this.promise_},pt.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},pt.prototype.isRetryStatusCode_=function(e){var t=500<=e&&e<600,r=-1!==[408,429].indexOf(e),n=-1!==this.additionalRetryCodes_.indexOf(e);return t||r||n},pt);function pt(e,t,r,n,o,i,a,s,u,c,l){var p=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=o.slice(),this.additionalRetryCodes_=i.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=l,this.promise_=new Promise(function(e,t){p.resolve_=e,p.reject_=t,p.start_()})}var ht=function(e,t,r){this.wasSuccessCode=e,this.xhr=t,this.canceled=!!r};function ft(e,t,r){var n=he(e.urlParams),o=e.url+n,i=Object.assign({},e.headers);return function(e,t){null!==t&&0<t.length&&(e.Authorization="Firebase "+t)}(i,t),function(e){var t=void 0!==wt?wt.SDK_VERSION:"AppManager";e["X-Firebase-Storage-Version"]="webjs/"+t}(i),new lt(o,e.method,i,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r)}var dt=(_t.prototype.ref=function(e){if(Ge("ref",[Ve(function(e){if("string"!=typeof e)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(e))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var t=new rt(this.authWrapper_,this.bucket_);return null!=e?t.child(e):t},_t.prototype.refFromURL=function(e){return Ge("refFromURL",[Ve(function(e){if("string"!=typeof e)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(e))throw"Expected full URL but got a child path, use ref instead.";try{se.makeFromUrl(e)}catch(e){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new rt(this.authWrapper_,e)},Object.defineProperty(_t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),_t.prototype.setMaxUploadRetryTime=function(e){Ge("setMaxUploadRetryTime",[Je()],arguments),this.authWrapper_.setMaxUploadRetryTime(e)},_t.prototype.setMaxOperationRetryTime=function(e){Ge("setMaxOperationRetryTime",[Je()],arguments),this.authWrapper_.setMaxOperationRetryTime(e)},Object.defineProperty(_t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),_t);function _t(e,t,r,n){if(this.bucket_=null,this.authWrapper_=new ut(e,t,function(e,t){return new rt(e,t)},ft,this,r),this.app_=e,null!=n)this.bucket_=se.makeFromBucketSpec(n);else{var o=this.authWrapper_.bucket();null!=o&&(this.bucket_=new se(o,""))}this.internals_=new vt(this)}var vt=(mt.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},mt);function mt(e){this.service_=e}var bt,gt;function yt(e,t){var r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal");return new dt(r,n,new re,t)}gt={TaskState:z,TaskEvent:D,StringFormat:U,Storage:dt,Reference:rt},(bt=wt).INTERNAL.registerComponent(new c("storage",yt,"PUBLIC").setServiceProps(gt).setMultipleInstances(!0)),bt.registerVersion("@firebase/storage","0.3.26")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-storage.js - be sure to load firebase-app.js first.")}});

// ********************************************************** //
// Description: This is a standalone debounce function extracted from
// lodash core. It is useful when the page only needs
// debounce function not complete lodash.
// Don't add this script if the page already use lodash.
// ********************************************************** //

(function () {
  /* Built-in method references for those with the same name as other `lodash` methods. */
  var nativeMax = Math.max;
  var nativeMin = Math.min;
  var reIsBinary = "/^0b[01]+$/i";
  var now = Date.now;

  /** Used to determine if values are of the language type `Object`. */
  var objectTypes = {
    function: true,
    object: true,
  };

  /** Detect free variable `exports`. */
  var freeExports =
    objectTypes[typeof exports] && exports && !exports.nodeType
      ? exports
      : undefined;

  /** Detect free variable `module`. */
  var freeModule =
    objectTypes[typeof module] && module && !module.nodeType
      ? module
      : undefined;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports =
    freeModule && freeModule.exports === freeExports ? freeExports : undefined;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = checkGlobal(
    freeExports && freeModule && typeof global == "object" && global
  );

  /** Detect free variable `self`. */
  var freeSelf = checkGlobal(objectTypes[typeof self] && self);

  /** Detect free variable `window`. */
  var freeWindow = checkGlobal(objectTypes[typeof window] && window);

  /** Detect `this` as the global object. */
  var thisGlobal = checkGlobal(objectTypes[typeof this] && this);

  var root =
    freeGlobal ||
    (freeWindow !== (thisGlobal && thisGlobal.window) && freeWindow) ||
    freeSelf ||
    thisGlobal ||
    Function("return this")();

  function debounce(func, wait, options) {
    var lastArgs,
      lastThis,
      result,
      timerId,
      lastCallTime = 0,
      lastInvokeTime = 0,
      leading = false,
      maxWait = false,
      trailing = true;

    if (typeof func != "function") {
      throw new TypeError("Expected a function");
    }
    wait = toNumber(wait) || 0;
    if (isObject(options)) {
      leading = !!options.leading;
      maxWait =
        "maxWait" in options && nativeMax(toNumber(options.maxWait) || 0, wait);
      trailing = "trailing" in options ? !!options.trailing : trailing;
    }

    function invokeFunc(time) {
      var args = lastArgs,
        thisArg = lastThis;

      lastArgs = lastThis = undefined;
      lastInvokeTime = time;
      result = func.apply(thisArg, args);
      return result;
    }

    function leadingEdge(time) {
      // Reset any `maxWait` timer.
      lastInvokeTime = time;
      // Start the timer for the trailing edge.
      timerId = setTimeout(timerExpired, wait);
      // Invoke the leading edge.
      return leading ? invokeFunc(time) : result;
    }

    function remainingWait(time) {
      var timeSinceLastCall = time - lastCallTime,
        timeSinceLastInvoke = time - lastInvokeTime,
        result = wait - timeSinceLastCall;

      return maxWait === false
        ? result
        : nativeMin(result, maxWait - timeSinceLastInvoke);
    }

    function shouldInvoke(time) {
      var timeSinceLastCall = time - lastCallTime,
        timeSinceLastInvoke = time - lastInvokeTime;

      // Either this is the first call, activity has stopped and we're at the
      // trailing edge, the system time has gone backwards and we're treating
      // it as the trailing edge, or we've hit the `maxWait` limit.
      return (
        !lastCallTime ||
        timeSinceLastCall >= wait ||
        timeSinceLastCall < 0 ||
        (maxWait !== false && timeSinceLastInvoke >= maxWait)
      );
    }

    function timerExpired() {
      var time = now();
      if (shouldInvoke(time)) {
        return trailingEdge(time);
      }
      // Restart the timer.
      timerId = setTimeout(timerExpired, remainingWait(time));
    }

    function trailingEdge(time) {
      clearTimeout(timerId);
      timerId = undefined;

      // Only invoke if we have `lastArgs` which means `func` has been
      // debounced at least once.
      if (trailing && lastArgs) {
        return invokeFunc(time);
      }
      lastArgs = lastThis = undefined;
      return result;
    }

    function cancel() {
      if (timerId !== undefined) {
        clearTimeout(timerId);
      }
      lastCallTime = lastInvokeTime = 0;
      lastArgs = lastThis = timerId = undefined;
    }

    function flush() {
      return timerId === undefined ? result : trailingEdge(now());
    }

    function debounced() {
      var time = now(),
        isInvoking = shouldInvoke(time);

      lastArgs = arguments;
      lastThis = this;
      lastCallTime = time;

      if (isInvoking) {
        if (timerId === undefined) {
          return leadingEdge(lastCallTime);
        }
        // Handle invocations in a tight loop.
        clearTimeout(timerId);
        timerId = setTimeout(timerExpired, wait);
        return invokeFunc(lastCallTime);
      }
      return result;
    }
    debounced.cancel = cancel;
    debounced.flush = flush;
    return debounced;
  }

  function throttle(func, wait, options) {
    var leading = true,
      trailing = true;

    if (typeof func != "function") {
      throw new TypeError("Expected a function");
    }
    if (isObject(options)) {
      leading = "leading" in options ? !!options.leading : leading;
      trailing = "trailing" in options ? !!options.trailing : trailing;
    }
    return debounce(func, wait, {
      leading: leading,
      maxWait: wait,
      trailing: trailing,
    });
  }

  function isFunction(value) {
    // The use of `Object#toString` avoids issues with the `typeof` operator
    // in Safari 8 which returns 'object' for typed array constructors, and
    // PhantomJS 1.9 which returns 'function' for `NodeList` instances.
    var tag = isObject(value) ? objectToString.call(value) : "";
    return tag == funcTag || tag == genTag;
  }

  function isObject(value) {
    var type = typeof value;
    return !!value && (type == "object" || type == "function");
  }

  function toNumber(value) {
    if (typeof value == "number") {
      return value;
    }
    if (isSymbol(value)) {
      return NAN;
    }
    if (isObject(value)) {
      var other = isFunction(value.valueOf) ? value.valueOf() : value;
      value = isObject(other) ? other + "" : other;
    }
    if (typeof value != "string") {
      return value === 0 ? value : +value;
    }
    value = value.replace(reTrim, "");
    var isBinary = reIsBinary.test(value);
    return isBinary || reIsOctal.test(value)
      ? freeParseInt(value.slice(2), isBinary ? 2 : 8)
      : reIsBadHex.test(value)
      ? NAN
      : +value;
  }

  function checkGlobal(value) {
    return value && value.Object === Object ? value : null;
  }

  var _ = {};
  _.debounce = debounce;
  _.throttle = throttle;
  // Expose lodash on the free variable `window` or `self` when available. This
  // prevents errors in cases where lodash is loaded by a script tag in the presence
  // of an AMD loader. See http://requirejs.org/docs/errors.html#mismatch for more details.
  (freeWindow || freeSelf || {})._ = _;

  // Some AMD build optimizers like r.js check for condition patterns like the following:
  if (
    typeof define == "function" &&
    typeof define.amd == "object" &&
    define.amd
  ) {
    // Define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module.
    define(function () {
      return _;
    });
  }
  // Check for `exports` after `define` in case a build optimizer adds an `exports` object.
  else if (freeExports && freeModule) {
    // Export for Node.js.
    if (moduleExports) {
      (freeModule.exports = _)._ = _;
    }
    // Export for CommonJS support.
    freeExports._ = _;
  } else {
    // Export to the global object.
    root._ = _;
  }
}).call(this);

/*! markdown-it 12.2.0 https://github.com/markdown-it/markdown-it @license MIT */
!(function (e, r) {
  "object" == typeof exports && "undefined" != typeof module
    ? (module.exports = r())
    : "function" == typeof define && define.amd
    ? define(r)
    : ((e =
        "undefined" != typeof globalThis ? globalThis : e || self).markdownit =
        r());
})(this, function () {
  "use strict";
  function e(e) {
    if (e.__esModule) return e;
    var r = Object.defineProperty({}, "__esModule", { value: !0 });
    return (
      Object.keys(e).forEach(function (t) {
        var n = Object.getOwnPropertyDescriptor(e, t);
        Object.defineProperty(
          r,
          t,
          n.get
            ? n
            : {
                enumerable: !0,
                get: function () {
                  return e[t];
                },
              }
        );
      }),
      r
    );
  }
  var r = {
      Aacute: "\xc1",
      aacute: "\xe1",
      Abreve: "\u0102",
      abreve: "\u0103",
      ac: "\u223e",
      acd: "\u223f",
      acE: "\u223e\u0333",
      Acirc: "\xc2",
      acirc: "\xe2",
      acute: "\xb4",
      Acy: "\u0410",
      acy: "\u0430",
      AElig: "\xc6",
      aelig: "\xe6",
      af: "\u2061",
      Afr: "\ud835\udd04",
      afr: "\ud835\udd1e",
      Agrave: "\xc0",
      agrave: "\xe0",
      alefsym: "\u2135",
      aleph: "\u2135",
      Alpha: "\u0391",
      alpha: "\u03b1",
      Amacr: "\u0100",
      amacr: "\u0101",
      amalg: "\u2a3f",
      amp: "&",
      AMP: "&",
      andand: "\u2a55",
      And: "\u2a53",
      and: "\u2227",
      andd: "\u2a5c",
      andslope: "\u2a58",
      andv: "\u2a5a",
      ang: "\u2220",
      ange: "\u29a4",
      angle: "\u2220",
      angmsdaa: "\u29a8",
      angmsdab: "\u29a9",
      angmsdac: "\u29aa",
      angmsdad: "\u29ab",
      angmsdae: "\u29ac",
      angmsdaf: "\u29ad",
      angmsdag: "\u29ae",
      angmsdah: "\u29af",
      angmsd: "\u2221",
      angrt: "\u221f",
      angrtvb: "\u22be",
      angrtvbd: "\u299d",
      angsph: "\u2222",
      angst: "\xc5",
      angzarr: "\u237c",
      Aogon: "\u0104",
      aogon: "\u0105",
      Aopf: "\ud835\udd38",
      aopf: "\ud835\udd52",
      apacir: "\u2a6f",
      ap: "\u2248",
      apE: "\u2a70",
      ape: "\u224a",
      apid: "\u224b",
      apos: "'",
      ApplyFunction: "\u2061",
      approx: "\u2248",
      approxeq: "\u224a",
      Aring: "\xc5",
      aring: "\xe5",
      Ascr: "\ud835\udc9c",
      ascr: "\ud835\udcb6",
      Assign: "\u2254",
      ast: "*",
      asymp: "\u2248",
      asympeq: "\u224d",
      Atilde: "\xc3",
      atilde: "\xe3",
      Auml: "\xc4",
      auml: "\xe4",
      awconint: "\u2233",
      awint: "\u2a11",
      backcong: "\u224c",
      backepsilon: "\u03f6",
      backprime: "\u2035",
      backsim: "\u223d",
      backsimeq: "\u22cd",
      Backslash: "\u2216",
      Barv: "\u2ae7",
      barvee: "\u22bd",
      barwed: "\u2305",
      Barwed: "\u2306",
      barwedge: "\u2305",
      bbrk: "\u23b5",
      bbrktbrk: "\u23b6",
      bcong: "\u224c",
      Bcy: "\u0411",
      bcy: "\u0431",
      bdquo: "\u201e",
      becaus: "\u2235",
      because: "\u2235",
      Because: "\u2235",
      bemptyv: "\u29b0",
      bepsi: "\u03f6",
      bernou: "\u212c",
      Bernoullis: "\u212c",
      Beta: "\u0392",
      beta: "\u03b2",
      beth: "\u2136",
      between: "\u226c",
      Bfr: "\ud835\udd05",
      bfr: "\ud835\udd1f",
      bigcap: "\u22c2",
      bigcirc: "\u25ef",
      bigcup: "\u22c3",
      bigodot: "\u2a00",
      bigoplus: "\u2a01",
      bigotimes: "\u2a02",
      bigsqcup: "\u2a06",
      bigstar: "\u2605",
      bigtriangledown: "\u25bd",
      bigtriangleup: "\u25b3",
      biguplus: "\u2a04",
      bigvee: "\u22c1",
      bigwedge: "\u22c0",
      bkarow: "\u290d",
      blacklozenge: "\u29eb",
      blacksquare: "\u25aa",
      blacktriangle: "\u25b4",
      blacktriangledown: "\u25be",
      blacktriangleleft: "\u25c2",
      blacktriangleright: "\u25b8",
      blank: "\u2423",
      blk12: "\u2592",
      blk14: "\u2591",
      blk34: "\u2593",
      block: "\u2588",
      bne: "=\u20e5",
      bnequiv: "\u2261\u20e5",
      bNot: "\u2aed",
      bnot: "\u2310",
      Bopf: "\ud835\udd39",
      bopf: "\ud835\udd53",
      bot: "\u22a5",
      bottom: "\u22a5",
      bowtie: "\u22c8",
      boxbox: "\u29c9",
      boxdl: "\u2510",
      boxdL: "\u2555",
      boxDl: "\u2556",
      boxDL: "\u2557",
      boxdr: "\u250c",
      boxdR: "\u2552",
      boxDr: "\u2553",
      boxDR: "\u2554",
      boxh: "\u2500",
      boxH: "\u2550",
      boxhd: "\u252c",
      boxHd: "\u2564",
      boxhD: "\u2565",
      boxHD: "\u2566",
      boxhu: "\u2534",
      boxHu: "\u2567",
      boxhU: "\u2568",
      boxHU: "\u2569",
      boxminus: "\u229f",
      boxplus: "\u229e",
      boxtimes: "\u22a0",
      boxul: "\u2518",
      boxuL: "\u255b",
      boxUl: "\u255c",
      boxUL: "\u255d",
      boxur: "\u2514",
      boxuR: "\u2558",
      boxUr: "\u2559",
      boxUR: "\u255a",
      boxv: "\u2502",
      boxV: "\u2551",
      boxvh: "\u253c",
      boxvH: "\u256a",
      boxVh: "\u256b",
      boxVH: "\u256c",
      boxvl: "\u2524",
      boxvL: "\u2561",
      boxVl: "\u2562",
      boxVL: "\u2563",
      boxvr: "\u251c",
      boxvR: "\u255e",
      boxVr: "\u255f",
      boxVR: "\u2560",
      bprime: "\u2035",
      breve: "\u02d8",
      Breve: "\u02d8",
      brvbar: "\xa6",
      bscr: "\ud835\udcb7",
      Bscr: "\u212c",
      bsemi: "\u204f",
      bsim: "\u223d",
      bsime: "\u22cd",
      bsolb: "\u29c5",
      bsol: "\\",
      bsolhsub: "\u27c8",
      bull: "\u2022",
      bullet: "\u2022",
      bump: "\u224e",
      bumpE: "\u2aae",
      bumpe: "\u224f",
      Bumpeq: "\u224e",
      bumpeq: "\u224f",
      Cacute: "\u0106",
      cacute: "\u0107",
      capand: "\u2a44",
      capbrcup: "\u2a49",
      capcap: "\u2a4b",
      cap: "\u2229",
      Cap: "\u22d2",
      capcup: "\u2a47",
      capdot: "\u2a40",
      CapitalDifferentialD: "\u2145",
      caps: "\u2229\ufe00",
      caret: "\u2041",
      caron: "\u02c7",
      Cayleys: "\u212d",
      ccaps: "\u2a4d",
      Ccaron: "\u010c",
      ccaron: "\u010d",
      Ccedil: "\xc7",
      ccedil: "\xe7",
      Ccirc: "\u0108",
      ccirc: "\u0109",
      Cconint: "\u2230",
      ccups: "\u2a4c",
      ccupssm: "\u2a50",
      Cdot: "\u010a",
      cdot: "\u010b",
      cedil: "\xb8",
      Cedilla: "\xb8",
      cemptyv: "\u29b2",
      cent: "\xa2",
      centerdot: "\xb7",
      CenterDot: "\xb7",
      cfr: "\ud835\udd20",
      Cfr: "\u212d",
      CHcy: "\u0427",
      chcy: "\u0447",
      check: "\u2713",
      checkmark: "\u2713",
      Chi: "\u03a7",
      chi: "\u03c7",
      circ: "\u02c6",
      circeq: "\u2257",
      circlearrowleft: "\u21ba",
      circlearrowright: "\u21bb",
      circledast: "\u229b",
      circledcirc: "\u229a",
      circleddash: "\u229d",
      CircleDot: "\u2299",
      circledR: "\xae",
      circledS: "\u24c8",
      CircleMinus: "\u2296",
      CirclePlus: "\u2295",
      CircleTimes: "\u2297",
      cir: "\u25cb",
      cirE: "\u29c3",
      cire: "\u2257",
      cirfnint: "\u2a10",
      cirmid: "\u2aef",
      cirscir: "\u29c2",
      ClockwiseContourIntegral: "\u2232",
      CloseCurlyDoubleQuote: "\u201d",
      CloseCurlyQuote: "\u2019",
      clubs: "\u2663",
      clubsuit: "\u2663",
      colon: ":",
      Colon: "\u2237",
      Colone: "\u2a74",
      colone: "\u2254",
      coloneq: "\u2254",
      comma: ",",
      commat: "@",
      comp: "\u2201",
      compfn: "\u2218",
      complement: "\u2201",
      complexes: "\u2102",
      cong: "\u2245",
      congdot: "\u2a6d",
      Congruent: "\u2261",
      conint: "\u222e",
      Conint: "\u222f",
      ContourIntegral: "\u222e",
      copf: "\ud835\udd54",
      Copf: "\u2102",
      coprod: "\u2210",
      Coproduct: "\u2210",
      copy: "\xa9",
      COPY: "\xa9",
      copysr: "\u2117",
      CounterClockwiseContourIntegral: "\u2233",
      crarr: "\u21b5",
      cross: "\u2717",
      Cross: "\u2a2f",
      Cscr: "\ud835\udc9e",
      cscr: "\ud835\udcb8",
      csub: "\u2acf",
      csube: "\u2ad1",
      csup: "\u2ad0",
      csupe: "\u2ad2",
      ctdot: "\u22ef",
      cudarrl: "\u2938",
      cudarrr: "\u2935",
      cuepr: "\u22de",
      cuesc: "\u22df",
      cularr: "\u21b6",
      cularrp: "\u293d",
      cupbrcap: "\u2a48",
      cupcap: "\u2a46",
      CupCap: "\u224d",
      cup: "\u222a",
      Cup: "\u22d3",
      cupcup: "\u2a4a",
      cupdot: "\u228d",
      cupor: "\u2a45",
      cups: "\u222a\ufe00",
      curarr: "\u21b7",
      curarrm: "\u293c",
      curlyeqprec: "\u22de",
      curlyeqsucc: "\u22df",
      curlyvee: "\u22ce",
      curlywedge: "\u22cf",
      curren: "\xa4",
      curvearrowleft: "\u21b6",
      curvearrowright: "\u21b7",
      cuvee: "\u22ce",
      cuwed: "\u22cf",
      cwconint: "\u2232",
      cwint: "\u2231",
      cylcty: "\u232d",
      dagger: "\u2020",
      Dagger: "\u2021",
      daleth: "\u2138",
      darr: "\u2193",
      Darr: "\u21a1",
      dArr: "\u21d3",
      dash: "\u2010",
      Dashv: "\u2ae4",
      dashv: "\u22a3",
      dbkarow: "\u290f",
      dblac: "\u02dd",
      Dcaron: "\u010e",
      dcaron: "\u010f",
      Dcy: "\u0414",
      dcy: "\u0434",
      ddagger: "\u2021",
      ddarr: "\u21ca",
      DD: "\u2145",
      dd: "\u2146",
      DDotrahd: "\u2911",
      ddotseq: "\u2a77",
      deg: "\xb0",
      Del: "\u2207",
      Delta: "\u0394",
      delta: "\u03b4",
      demptyv: "\u29b1",
      dfisht: "\u297f",
      Dfr: "\ud835\udd07",
      dfr: "\ud835\udd21",
      dHar: "\u2965",
      dharl: "\u21c3",
      dharr: "\u21c2",
      DiacriticalAcute: "\xb4",
      DiacriticalDot: "\u02d9",
      DiacriticalDoubleAcute: "\u02dd",
      DiacriticalGrave: "`",
      DiacriticalTilde: "\u02dc",
      diam: "\u22c4",
      diamond: "\u22c4",
      Diamond: "\u22c4",
      diamondsuit: "\u2666",
      diams: "\u2666",
      die: "\xa8",
      DifferentialD: "\u2146",
      digamma: "\u03dd",
      disin: "\u22f2",
      div: "\xf7",
      divide: "\xf7",
      divideontimes: "\u22c7",
      divonx: "\u22c7",
      DJcy: "\u0402",
      djcy: "\u0452",
      dlcorn: "\u231e",
      dlcrop: "\u230d",
      dollar: "$",
      Dopf: "\ud835\udd3b",
      dopf: "\ud835\udd55",
      Dot: "\xa8",
      dot: "\u02d9",
      DotDot: "\u20dc",
      doteq: "\u2250",
      doteqdot: "\u2251",
      DotEqual: "\u2250",
      dotminus: "\u2238",
      dotplus: "\u2214",
      dotsquare: "\u22a1",
      doublebarwedge: "\u2306",
      DoubleContourIntegral: "\u222f",
      DoubleDot: "\xa8",
      DoubleDownArrow: "\u21d3",
      DoubleLeftArrow: "\u21d0",
      DoubleLeftRightArrow: "\u21d4",
      DoubleLeftTee: "\u2ae4",
      DoubleLongLeftArrow: "\u27f8",
      DoubleLongLeftRightArrow: "\u27fa",
      DoubleLongRightArrow: "\u27f9",
      DoubleRightArrow: "\u21d2",
      DoubleRightTee: "\u22a8",
      DoubleUpArrow: "\u21d1",
      DoubleUpDownArrow: "\u21d5",
      DoubleVerticalBar: "\u2225",
      DownArrowBar: "\u2913",
      downarrow: "\u2193",
      DownArrow: "\u2193",
      Downarrow: "\u21d3",
      DownArrowUpArrow: "\u21f5",
      DownBreve: "\u0311",
      downdownarrows: "\u21ca",
      downharpoonleft: "\u21c3",
      downharpoonright: "\u21c2",
      DownLeftRightVector: "\u2950",
      DownLeftTeeVector: "\u295e",
      DownLeftVectorBar: "\u2956",
      DownLeftVector: "\u21bd",
      DownRightTeeVector: "\u295f",
      DownRightVectorBar: "\u2957",
      DownRightVector: "\u21c1",
      DownTeeArrow: "\u21a7",
      DownTee: "\u22a4",
      drbkarow: "\u2910",
      drcorn: "\u231f",
      drcrop: "\u230c",
      Dscr: "\ud835\udc9f",
      dscr: "\ud835\udcb9",
      DScy: "\u0405",
      dscy: "\u0455",
      dsol: "\u29f6",
      Dstrok: "\u0110",
      dstrok: "\u0111",
      dtdot: "\u22f1",
      dtri: "\u25bf",
      dtrif: "\u25be",
      duarr: "\u21f5",
      duhar: "\u296f",
      dwangle: "\u29a6",
      DZcy: "\u040f",
      dzcy: "\u045f",
      dzigrarr: "\u27ff",
      Eacute: "\xc9",
      eacute: "\xe9",
      easter: "\u2a6e",
      Ecaron: "\u011a",
      ecaron: "\u011b",
      Ecirc: "\xca",
      ecirc: "\xea",
      ecir: "\u2256",
      ecolon: "\u2255",
      Ecy: "\u042d",
      ecy: "\u044d",
      eDDot: "\u2a77",
      Edot: "\u0116",
      edot: "\u0117",
      eDot: "\u2251",
      ee: "\u2147",
      efDot: "\u2252",
      Efr: "\ud835\udd08",
      efr: "\ud835\udd22",
      eg: "\u2a9a",
      Egrave: "\xc8",
      egrave: "\xe8",
      egs: "\u2a96",
      egsdot: "\u2a98",
      el: "\u2a99",
      Element: "\u2208",
      elinters: "\u23e7",
      ell: "\u2113",
      els: "\u2a95",
      elsdot: "\u2a97",
      Emacr: "\u0112",
      emacr: "\u0113",
      empty: "\u2205",
      emptyset: "\u2205",
      EmptySmallSquare: "\u25fb",
      emptyv: "\u2205",
      EmptyVerySmallSquare: "\u25ab",
      emsp13: "\u2004",
      emsp14: "\u2005",
      emsp: "\u2003",
      ENG: "\u014a",
      eng: "\u014b",
      ensp: "\u2002",
      Eogon: "\u0118",
      eogon: "\u0119",
      Eopf: "\ud835\udd3c",
      eopf: "\ud835\udd56",
      epar: "\u22d5",
      eparsl: "\u29e3",
      eplus: "\u2a71",
      epsi: "\u03b5",
      Epsilon: "\u0395",
      epsilon: "\u03b5",
      epsiv: "\u03f5",
      eqcirc: "\u2256",
      eqcolon: "\u2255",
      eqsim: "\u2242",
      eqslantgtr: "\u2a96",
      eqslantless: "\u2a95",
      Equal: "\u2a75",
      equals: "=",
      EqualTilde: "\u2242",
      equest: "\u225f",
      Equilibrium: "\u21cc",
      equiv: "\u2261",
      equivDD: "\u2a78",
      eqvparsl: "\u29e5",
      erarr: "\u2971",
      erDot: "\u2253",
      escr: "\u212f",
      Escr: "\u2130",
      esdot: "\u2250",
      Esim: "\u2a73",
      esim: "\u2242",
      Eta: "\u0397",
      eta: "\u03b7",
      ETH: "\xd0",
      eth: "\xf0",
      Euml: "\xcb",
      euml: "\xeb",
      euro: "\u20ac",
      excl: "!",
      exist: "\u2203",
      Exists: "\u2203",
      expectation: "\u2130",
      exponentiale: "\u2147",
      ExponentialE: "\u2147",
      fallingdotseq: "\u2252",
      Fcy: "\u0424",
      fcy: "\u0444",
      female: "\u2640",
      ffilig: "\ufb03",
      fflig: "\ufb00",
      ffllig: "\ufb04",
      Ffr: "\ud835\udd09",
      ffr: "\ud835\udd23",
      filig: "\ufb01",
      FilledSmallSquare: "\u25fc",
      FilledVerySmallSquare: "\u25aa",
      fjlig: "fj",
      flat: "\u266d",
      fllig: "\ufb02",
      fltns: "\u25b1",
      fnof: "\u0192",
      Fopf: "\ud835\udd3d",
      fopf: "\ud835\udd57",
      forall: "\u2200",
      ForAll: "\u2200",
      fork: "\u22d4",
      forkv: "\u2ad9",
      Fouriertrf: "\u2131",
      fpartint: "\u2a0d",
      frac12: "\xbd",
      frac13: "\u2153",
      frac14: "\xbc",
      frac15: "\u2155",
      frac16: "\u2159",
      frac18: "\u215b",
      frac23: "\u2154",
      frac25: "\u2156",
      frac34: "\xbe",
      frac35: "\u2157",
      frac38: "\u215c",
      frac45: "\u2158",
      frac56: "\u215a",
      frac58: "\u215d",
      frac78: "\u215e",
      frasl: "\u2044",
      frown: "\u2322",
      fscr: "\ud835\udcbb",
      Fscr: "\u2131",
      gacute: "\u01f5",
      Gamma: "\u0393",
      gamma: "\u03b3",
      Gammad: "\u03dc",
      gammad: "\u03dd",
      gap: "\u2a86",
      Gbreve: "\u011e",
      gbreve: "\u011f",
      Gcedil: "\u0122",
      Gcirc: "\u011c",
      gcirc: "\u011d",
      Gcy: "\u0413",
      gcy: "\u0433",
      Gdot: "\u0120",
      gdot: "\u0121",
      ge: "\u2265",
      gE: "\u2267",
      gEl: "\u2a8c",
      gel: "\u22db",
      geq: "\u2265",
      geqq: "\u2267",
      geqslant: "\u2a7e",
      gescc: "\u2aa9",
      ges: "\u2a7e",
      gesdot: "\u2a80",
      gesdoto: "\u2a82",
      gesdotol: "\u2a84",
      gesl: "\u22db\ufe00",
      gesles: "\u2a94",
      Gfr: "\ud835\udd0a",
      gfr: "\ud835\udd24",
      gg: "\u226b",
      Gg: "\u22d9",
      ggg: "\u22d9",
      gimel: "\u2137",
      GJcy: "\u0403",
      gjcy: "\u0453",
      gla: "\u2aa5",
      gl: "\u2277",
      glE: "\u2a92",
      glj: "\u2aa4",
      gnap: "\u2a8a",
      gnapprox: "\u2a8a",
      gne: "\u2a88",
      gnE: "\u2269",
      gneq: "\u2a88",
      gneqq: "\u2269",
      gnsim: "\u22e7",
      Gopf: "\ud835\udd3e",
      gopf: "\ud835\udd58",
      grave: "`",
      GreaterEqual: "\u2265",
      GreaterEqualLess: "\u22db",
      GreaterFullEqual: "\u2267",
      GreaterGreater: "\u2aa2",
      GreaterLess: "\u2277",
      GreaterSlantEqual: "\u2a7e",
      GreaterTilde: "\u2273",
      Gscr: "\ud835\udca2",
      gscr: "\u210a",
      gsim: "\u2273",
      gsime: "\u2a8e",
      gsiml: "\u2a90",
      gtcc: "\u2aa7",
      gtcir: "\u2a7a",
      gt: ">",
      GT: ">",
      Gt: "\u226b",
      gtdot: "\u22d7",
      gtlPar: "\u2995",
      gtquest: "\u2a7c",
      gtrapprox: "\u2a86",
      gtrarr: "\u2978",
      gtrdot: "\u22d7",
      gtreqless: "\u22db",
      gtreqqless: "\u2a8c",
      gtrless: "\u2277",
      gtrsim: "\u2273",
      gvertneqq: "\u2269\ufe00",
      gvnE: "\u2269\ufe00",
      Hacek: "\u02c7",
      hairsp: "\u200a",
      half: "\xbd",
      hamilt: "\u210b",
      HARDcy: "\u042a",
      hardcy: "\u044a",
      harrcir: "\u2948",
      harr: "\u2194",
      hArr: "\u21d4",
      harrw: "\u21ad",
      Hat: "^",
      hbar: "\u210f",
      Hcirc: "\u0124",
      hcirc: "\u0125",
      hearts: "\u2665",
      heartsuit: "\u2665",
      hellip: "\u2026",
      hercon: "\u22b9",
      hfr: "\ud835\udd25",
      Hfr: "\u210c",
      HilbertSpace: "\u210b",
      hksearow: "\u2925",
      hkswarow: "\u2926",
      hoarr: "\u21ff",
      homtht: "\u223b",
      hookleftarrow: "\u21a9",
      hookrightarrow: "\u21aa",
      hopf: "\ud835\udd59",
      Hopf: "\u210d",
      horbar: "\u2015",
      HorizontalLine: "\u2500",
      hscr: "\ud835\udcbd",
      Hscr: "\u210b",
      hslash: "\u210f",
      Hstrok: "\u0126",
      hstrok: "\u0127",
      HumpDownHump: "\u224e",
      HumpEqual: "\u224f",
      hybull: "\u2043",
      hyphen: "\u2010",
      Iacute: "\xcd",
      iacute: "\xed",
      ic: "\u2063",
      Icirc: "\xce",
      icirc: "\xee",
      Icy: "\u0418",
      icy: "\u0438",
      Idot: "\u0130",
      IEcy: "\u0415",
      iecy: "\u0435",
      iexcl: "\xa1",
      iff: "\u21d4",
      ifr: "\ud835\udd26",
      Ifr: "\u2111",
      Igrave: "\xcc",
      igrave: "\xec",
      ii: "\u2148",
      iiiint: "\u2a0c",
      iiint: "\u222d",
      iinfin: "\u29dc",
      iiota: "\u2129",
      IJlig: "\u0132",
      ijlig: "\u0133",
      Imacr: "\u012a",
      imacr: "\u012b",
      image: "\u2111",
      ImaginaryI: "\u2148",
      imagline: "\u2110",
      imagpart: "\u2111",
      imath: "\u0131",
      Im: "\u2111",
      imof: "\u22b7",
      imped: "\u01b5",
      Implies: "\u21d2",
      incare: "\u2105",
      in: "\u2208",
      infin: "\u221e",
      infintie: "\u29dd",
      inodot: "\u0131",
      intcal: "\u22ba",
      int: "\u222b",
      Int: "\u222c",
      integers: "\u2124",
      Integral: "\u222b",
      intercal: "\u22ba",
      Intersection: "\u22c2",
      intlarhk: "\u2a17",
      intprod: "\u2a3c",
      InvisibleComma: "\u2063",
      InvisibleTimes: "\u2062",
      IOcy: "\u0401",
      iocy: "\u0451",
      Iogon: "\u012e",
      iogon: "\u012f",
      Iopf: "\ud835\udd40",
      iopf: "\ud835\udd5a",
      Iota: "\u0399",
      iota: "\u03b9",
      iprod: "\u2a3c",
      iquest: "\xbf",
      iscr: "\ud835\udcbe",
      Iscr: "\u2110",
      isin: "\u2208",
      isindot: "\u22f5",
      isinE: "\u22f9",
      isins: "\u22f4",
      isinsv: "\u22f3",
      isinv: "\u2208",
      it: "\u2062",
      Itilde: "\u0128",
      itilde: "\u0129",
      Iukcy: "\u0406",
      iukcy: "\u0456",
      Iuml: "\xcf",
      iuml: "\xef",
      Jcirc: "\u0134",
      jcirc: "\u0135",
      Jcy: "\u0419",
      jcy: "\u0439",
      Jfr: "\ud835\udd0d",
      jfr: "\ud835\udd27",
      jmath: "\u0237",
      Jopf: "\ud835\udd41",
      jopf: "\ud835\udd5b",
      Jscr: "\ud835\udca5",
      jscr: "\ud835\udcbf",
      Jsercy: "\u0408",
      jsercy: "\u0458",
      Jukcy: "\u0404",
      jukcy: "\u0454",
      Kappa: "\u039a",
      kappa: "\u03ba",
      kappav: "\u03f0",
      Kcedil: "\u0136",
      kcedil: "\u0137",
      Kcy: "\u041a",
      kcy: "\u043a",
      Kfr: "\ud835\udd0e",
      kfr: "\ud835\udd28",
      kgreen: "\u0138",
      KHcy: "\u0425",
      khcy: "\u0445",
      KJcy: "\u040c",
      kjcy: "\u045c",
      Kopf: "\ud835\udd42",
      kopf: "\ud835\udd5c",
      Kscr: "\ud835\udca6",
      kscr: "\ud835\udcc0",
      lAarr: "\u21da",
      Lacute: "\u0139",
      lacute: "\u013a",
      laemptyv: "\u29b4",
      lagran: "\u2112",
      Lambda: "\u039b",
      lambda: "\u03bb",
      lang: "\u27e8",
      Lang: "\u27ea",
      langd: "\u2991",
      langle: "\u27e8",
      lap: "\u2a85",
      Laplacetrf: "\u2112",
      laquo: "\xab",
      larrb: "\u21e4",
      larrbfs: "\u291f",
      larr: "\u2190",
      Larr: "\u219e",
      lArr: "\u21d0",
      larrfs: "\u291d",
      larrhk: "\u21a9",
      larrlp: "\u21ab",
      larrpl: "\u2939",
      larrsim: "\u2973",
      larrtl: "\u21a2",
      latail: "\u2919",
      lAtail: "\u291b",
      lat: "\u2aab",
      late: "\u2aad",
      lates: "\u2aad\ufe00",
      lbarr: "\u290c",
      lBarr: "\u290e",
      lbbrk: "\u2772",
      lbrace: "{",
      lbrack: "[",
      lbrke: "\u298b",
      lbrksld: "\u298f",
      lbrkslu: "\u298d",
      Lcaron: "\u013d",
      lcaron: "\u013e",
      Lcedil: "\u013b",
      lcedil: "\u013c",
      lceil: "\u2308",
      lcub: "{",
      Lcy: "\u041b",
      lcy: "\u043b",
      ldca: "\u2936",
      ldquo: "\u201c",
      ldquor: "\u201e",
      ldrdhar: "\u2967",
      ldrushar: "\u294b",
      ldsh: "\u21b2",
      le: "\u2264",
      lE: "\u2266",
      LeftAngleBracket: "\u27e8",
      LeftArrowBar: "\u21e4",
      leftarrow: "\u2190",
      LeftArrow: "\u2190",
      Leftarrow: "\u21d0",
      LeftArrowRightArrow: "\u21c6",
      leftarrowtail: "\u21a2",
      LeftCeiling: "\u2308",
      LeftDoubleBracket: "\u27e6",
      LeftDownTeeVector: "\u2961",
      LeftDownVectorBar: "\u2959",
      LeftDownVector: "\u21c3",
      LeftFloor: "\u230a",
      leftharpoondown: "\u21bd",
      leftharpoonup: "\u21bc",
      leftleftarrows: "\u21c7",
      leftrightarrow: "\u2194",
      LeftRightArrow: "\u2194",
      Leftrightarrow: "\u21d4",
      leftrightarrows: "\u21c6",
      leftrightharpoons: "\u21cb",
      leftrightsquigarrow: "\u21ad",
      LeftRightVector: "\u294e",
      LeftTeeArrow: "\u21a4",
      LeftTee: "\u22a3",
      LeftTeeVector: "\u295a",
      leftthreetimes: "\u22cb",
      LeftTriangleBar: "\u29cf",
      LeftTriangle: "\u22b2",
      LeftTriangleEqual: "\u22b4",
      LeftUpDownVector: "\u2951",
      LeftUpTeeVector: "\u2960",
      LeftUpVectorBar: "\u2958",
      LeftUpVector: "\u21bf",
      LeftVectorBar: "\u2952",
      LeftVector: "\u21bc",
      lEg: "\u2a8b",
      leg: "\u22da",
      leq: "\u2264",
      leqq: "\u2266",
      leqslant: "\u2a7d",
      lescc: "\u2aa8",
      les: "\u2a7d",
      lesdot: "\u2a7f",
      lesdoto: "\u2a81",
      lesdotor: "\u2a83",
      lesg: "\u22da\ufe00",
      lesges: "\u2a93",
      lessapprox: "\u2a85",
      lessdot: "\u22d6",
      lesseqgtr: "\u22da",
      lesseqqgtr: "\u2a8b",
      LessEqualGreater: "\u22da",
      LessFullEqual: "\u2266",
      LessGreater: "\u2276",
      lessgtr: "\u2276",
      LessLess: "\u2aa1",
      lesssim: "\u2272",
      LessSlantEqual: "\u2a7d",
      LessTilde: "\u2272",
      lfisht: "\u297c",
      lfloor: "\u230a",
      Lfr: "\ud835\udd0f",
      lfr: "\ud835\udd29",
      lg: "\u2276",
      lgE: "\u2a91",
      lHar: "\u2962",
      lhard: "\u21bd",
      lharu: "\u21bc",
      lharul: "\u296a",
      lhblk: "\u2584",
      LJcy: "\u0409",
      ljcy: "\u0459",
      llarr: "\u21c7",
      ll: "\u226a",
      Ll: "\u22d8",
      llcorner: "\u231e",
      Lleftarrow: "\u21da",
      llhard: "\u296b",
      lltri: "\u25fa",
      Lmidot: "\u013f",
      lmidot: "\u0140",
      lmoustache: "\u23b0",
      lmoust: "\u23b0",
      lnap: "\u2a89",
      lnapprox: "\u2a89",
      lne: "\u2a87",
      lnE: "\u2268",
      lneq: "\u2a87",
      lneqq: "\u2268",
      lnsim: "\u22e6",
      loang: "\u27ec",
      loarr: "\u21fd",
      lobrk: "\u27e6",
      longleftarrow: "\u27f5",
      LongLeftArrow: "\u27f5",
      Longleftarrow: "\u27f8",
      longleftrightarrow: "\u27f7",
      LongLeftRightArrow: "\u27f7",
      Longleftrightarrow: "\u27fa",
      longmapsto: "\u27fc",
      longrightarrow: "\u27f6",
      LongRightArrow: "\u27f6",
      Longrightarrow: "\u27f9",
      looparrowleft: "\u21ab",
      looparrowright: "\u21ac",
      lopar: "\u2985",
      Lopf: "\ud835\udd43",
      lopf: "\ud835\udd5d",
      loplus: "\u2a2d",
      lotimes: "\u2a34",
      lowast: "\u2217",
      lowbar: "_",
      LowerLeftArrow: "\u2199",
      LowerRightArrow: "\u2198",
      loz: "\u25ca",
      lozenge: "\u25ca",
      lozf: "\u29eb",
      lpar: "(",
      lparlt: "\u2993",
      lrarr: "\u21c6",
      lrcorner: "\u231f",
      lrhar: "\u21cb",
      lrhard: "\u296d",
      lrm: "\u200e",
      lrtri: "\u22bf",
      lsaquo: "\u2039",
      lscr: "\ud835\udcc1",
      Lscr: "\u2112",
      lsh: "\u21b0",
      Lsh: "\u21b0",
      lsim: "\u2272",
      lsime: "\u2a8d",
      lsimg: "\u2a8f",
      lsqb: "[",
      lsquo: "\u2018",
      lsquor: "\u201a",
      Lstrok: "\u0141",
      lstrok: "\u0142",
      ltcc: "\u2aa6",
      ltcir: "\u2a79",
      lt: "<",
      LT: "<",
      Lt: "\u226a",
      ltdot: "\u22d6",
      lthree: "\u22cb",
      ltimes: "\u22c9",
      ltlarr: "\u2976",
      ltquest: "\u2a7b",
      ltri: "\u25c3",
      ltrie: "\u22b4",
      ltrif: "\u25c2",
      ltrPar: "\u2996",
      lurdshar: "\u294a",
      luruhar: "\u2966",
      lvertneqq: "\u2268\ufe00",
      lvnE: "\u2268\ufe00",
      macr: "\xaf",
      male: "\u2642",
      malt: "\u2720",
      maltese: "\u2720",
      Map: "\u2905",
      map: "\u21a6",
      mapsto: "\u21a6",
      mapstodown: "\u21a7",
      mapstoleft: "\u21a4",
      mapstoup: "\u21a5",
      marker: "\u25ae",
      mcomma: "\u2a29",
      Mcy: "\u041c",
      mcy: "\u043c",
      mdash: "\u2014",
      mDDot: "\u223a",
      measuredangle: "\u2221",
      MediumSpace: "\u205f",
      Mellintrf: "\u2133",
      Mfr: "\ud835\udd10",
      mfr: "\ud835\udd2a",
      mho: "\u2127",
      micro: "\xb5",
      midast: "*",
      midcir: "\u2af0",
      mid: "\u2223",
      middot: "\xb7",
      minusb: "\u229f",
      minus: "\u2212",
      minusd: "\u2238",
      minusdu: "\u2a2a",
      MinusPlus: "\u2213",
      mlcp: "\u2adb",
      mldr: "\u2026",
      mnplus: "\u2213",
      models: "\u22a7",
      Mopf: "\ud835\udd44",
      mopf: "\ud835\udd5e",
      mp: "\u2213",
      mscr: "\ud835\udcc2",
      Mscr: "\u2133",
      mstpos: "\u223e",
      Mu: "\u039c",
      mu: "\u03bc",
      multimap: "\u22b8",
      mumap: "\u22b8",
      nabla: "\u2207",
      Nacute: "\u0143",
      nacute: "\u0144",
      nang: "\u2220\u20d2",
      nap: "\u2249",
      napE: "\u2a70\u0338",
      napid: "\u224b\u0338",
      napos: "\u0149",
      napprox: "\u2249",
      natural: "\u266e",
      naturals: "\u2115",
      natur: "\u266e",
      nbsp: "\xa0",
      nbump: "\u224e\u0338",
      nbumpe: "\u224f\u0338",
      ncap: "\u2a43",
      Ncaron: "\u0147",
      ncaron: "\u0148",
      Ncedil: "\u0145",
      ncedil: "\u0146",
      ncong: "\u2247",
      ncongdot: "\u2a6d\u0338",
      ncup: "\u2a42",
      Ncy: "\u041d",
      ncy: "\u043d",
      ndash: "\u2013",
      nearhk: "\u2924",
      nearr: "\u2197",
      neArr: "\u21d7",
      nearrow: "\u2197",
      ne: "\u2260",
      nedot: "\u2250\u0338",
      NegativeMediumSpace: "\u200b",
      NegativeThickSpace: "\u200b",
      NegativeThinSpace: "\u200b",
      NegativeVeryThinSpace: "\u200b",
      nequiv: "\u2262",
      nesear: "\u2928",
      nesim: "\u2242\u0338",
      NestedGreaterGreater: "\u226b",
      NestedLessLess: "\u226a",
      NewLine: "\n",
      nexist: "\u2204",
      nexists: "\u2204",
      Nfr: "\ud835\udd11",
      nfr: "\ud835\udd2b",
      ngE: "\u2267\u0338",
      nge: "\u2271",
      ngeq: "\u2271",
      ngeqq: "\u2267\u0338",
      ngeqslant: "\u2a7e\u0338",
      nges: "\u2a7e\u0338",
      nGg: "\u22d9\u0338",
      ngsim: "\u2275",
      nGt: "\u226b\u20d2",
      ngt: "\u226f",
      ngtr: "\u226f",
      nGtv: "\u226b\u0338",
      nharr: "\u21ae",
      nhArr: "\u21ce",
      nhpar: "\u2af2",
      ni: "\u220b",
      nis: "\u22fc",
      nisd: "\u22fa",
      niv: "\u220b",
      NJcy: "\u040a",
      njcy: "\u045a",
      nlarr: "\u219a",
      nlArr: "\u21cd",
      nldr: "\u2025",
      nlE: "\u2266\u0338",
      nle: "\u2270",
      nleftarrow: "\u219a",
      nLeftarrow: "\u21cd",
      nleftrightarrow: "\u21ae",
      nLeftrightarrow: "\u21ce",
      nleq: "\u2270",
      nleqq: "\u2266\u0338",
      nleqslant: "\u2a7d\u0338",
      nles: "\u2a7d\u0338",
      nless: "\u226e",
      nLl: "\u22d8\u0338",
      nlsim: "\u2274",
      nLt: "\u226a\u20d2",
      nlt: "\u226e",
      nltri: "\u22ea",
      nltrie: "\u22ec",
      nLtv: "\u226a\u0338",
      nmid: "\u2224",
      NoBreak: "\u2060",
      NonBreakingSpace: "\xa0",
      nopf: "\ud835\udd5f",
      Nopf: "\u2115",
      Not: "\u2aec",
      not: "\xac",
      NotCongruent: "\u2262",
      NotCupCap: "\u226d",
      NotDoubleVerticalBar: "\u2226",
      NotElement: "\u2209",
      NotEqual: "\u2260",
      NotEqualTilde: "\u2242\u0338",
      NotExists: "\u2204",
      NotGreater: "\u226f",
      NotGreaterEqual: "\u2271",
      NotGreaterFullEqual: "\u2267\u0338",
      NotGreaterGreater: "\u226b\u0338",
      NotGreaterLess: "\u2279",
      NotGreaterSlantEqual: "\u2a7e\u0338",
      NotGreaterTilde: "\u2275",
      NotHumpDownHump: "\u224e\u0338",
      NotHumpEqual: "\u224f\u0338",
      notin: "\u2209",
      notindot: "\u22f5\u0338",
      notinE: "\u22f9\u0338",
      notinva: "\u2209",
      notinvb: "\u22f7",
      notinvc: "\u22f6",
      NotLeftTriangleBar: "\u29cf\u0338",
      NotLeftTriangle: "\u22ea",
      NotLeftTriangleEqual: "\u22ec",
      NotLess: "\u226e",
      NotLessEqual: "\u2270",
      NotLessGreater: "\u2278",
      NotLessLess: "\u226a\u0338",
      NotLessSlantEqual: "\u2a7d\u0338",
      NotLessTilde: "\u2274",
      NotNestedGreaterGreater: "\u2aa2\u0338",
      NotNestedLessLess: "\u2aa1\u0338",
      notni: "\u220c",
      notniva: "\u220c",
      notnivb: "\u22fe",
      notnivc: "\u22fd",
      NotPrecedes: "\u2280",
      NotPrecedesEqual: "\u2aaf\u0338",
      NotPrecedesSlantEqual: "\u22e0",
      NotReverseElement: "\u220c",
      NotRightTriangleBar: "\u29d0\u0338",
      NotRightTriangle: "\u22eb",
      NotRightTriangleEqual: "\u22ed",
      NotSquareSubset: "\u228f\u0338",
      NotSquareSubsetEqual: "\u22e2",
      NotSquareSuperset: "\u2290\u0338",
      NotSquareSupersetEqual: "\u22e3",
      NotSubset: "\u2282\u20d2",
      NotSubsetEqual: "\u2288",
      NotSucceeds: "\u2281",
      NotSucceedsEqual: "\u2ab0\u0338",
      NotSucceedsSlantEqual: "\u22e1",
      NotSucceedsTilde: "\u227f\u0338",
      NotSuperset: "\u2283\u20d2",
      NotSupersetEqual: "\u2289",
      NotTilde: "\u2241",
      NotTildeEqual: "\u2244",
      NotTildeFullEqual: "\u2247",
      NotTildeTilde: "\u2249",
      NotVerticalBar: "\u2224",
      nparallel: "\u2226",
      npar: "\u2226",
      nparsl: "\u2afd\u20e5",
      npart: "\u2202\u0338",
      npolint: "\u2a14",
      npr: "\u2280",
      nprcue: "\u22e0",
      nprec: "\u2280",
      npreceq: "\u2aaf\u0338",
      npre: "\u2aaf\u0338",
      nrarrc: "\u2933\u0338",
      nrarr: "\u219b",
      nrArr: "\u21cf",
      nrarrw: "\u219d\u0338",
      nrightarrow: "\u219b",
      nRightarrow: "\u21cf",
      nrtri: "\u22eb",
      nrtrie: "\u22ed",
      nsc: "\u2281",
      nsccue: "\u22e1",
      nsce: "\u2ab0\u0338",
      Nscr: "\ud835\udca9",
      nscr: "\ud835\udcc3",
      nshortmid: "\u2224",
      nshortparallel: "\u2226",
      nsim: "\u2241",
      nsime: "\u2244",
      nsimeq: "\u2244",
      nsmid: "\u2224",
      nspar: "\u2226",
      nsqsube: "\u22e2",
      nsqsupe: "\u22e3",
      nsub: "\u2284",
      nsubE: "\u2ac5\u0338",
      nsube: "\u2288",
      nsubset: "\u2282\u20d2",
      nsubseteq: "\u2288",
      nsubseteqq: "\u2ac5\u0338",
      nsucc: "\u2281",
      nsucceq: "\u2ab0\u0338",
      nsup: "\u2285",
      nsupE: "\u2ac6\u0338",
      nsupe: "\u2289",
      nsupset: "\u2283\u20d2",
      nsupseteq: "\u2289",
      nsupseteqq: "\u2ac6\u0338",
      ntgl: "\u2279",
      Ntilde: "\xd1",
      ntilde: "\xf1",
      ntlg: "\u2278",
      ntriangleleft: "\u22ea",
      ntrianglelefteq: "\u22ec",
      ntriangleright: "\u22eb",
      ntrianglerighteq: "\u22ed",
      Nu: "\u039d",
      nu: "\u03bd",
      num: "#",
      numero: "\u2116",
      numsp: "\u2007",
      nvap: "\u224d\u20d2",
      nvdash: "\u22ac",
      nvDash: "\u22ad",
      nVdash: "\u22ae",
      nVDash: "\u22af",
      nvge: "\u2265\u20d2",
      nvgt: ">\u20d2",
      nvHarr: "\u2904",
      nvinfin: "\u29de",
      nvlArr: "\u2902",
      nvle: "\u2264\u20d2",
      nvlt: "<\u20d2",
      nvltrie: "\u22b4\u20d2",
      nvrArr: "\u2903",
      nvrtrie: "\u22b5\u20d2",
      nvsim: "\u223c\u20d2",
      nwarhk: "\u2923",
      nwarr: "\u2196",
      nwArr: "\u21d6",
      nwarrow: "\u2196",
      nwnear: "\u2927",
      Oacute: "\xd3",
      oacute: "\xf3",
      oast: "\u229b",
      Ocirc: "\xd4",
      ocirc: "\xf4",
      ocir: "\u229a",
      Ocy: "\u041e",
      ocy: "\u043e",
      odash: "\u229d",
      Odblac: "\u0150",
      odblac: "\u0151",
      odiv: "\u2a38",
      odot: "\u2299",
      odsold: "\u29bc",
      OElig: "\u0152",
      oelig: "\u0153",
      ofcir: "\u29bf",
      Ofr: "\ud835\udd12",
      ofr: "\ud835\udd2c",
      ogon: "\u02db",
      Ograve: "\xd2",
      ograve: "\xf2",
      ogt: "\u29c1",
      ohbar: "\u29b5",
      ohm: "\u03a9",
      oint: "\u222e",
      olarr: "\u21ba",
      olcir: "\u29be",
      olcross: "\u29bb",
      oline: "\u203e",
      olt: "\u29c0",
      Omacr: "\u014c",
      omacr: "\u014d",
      Omega: "\u03a9",
      omega: "\u03c9",
      Omicron: "\u039f",
      omicron: "\u03bf",
      omid: "\u29b6",
      ominus: "\u2296",
      Oopf: "\ud835\udd46",
      oopf: "\ud835\udd60",
      opar: "\u29b7",
      OpenCurlyDoubleQuote: "\u201c",
      OpenCurlyQuote: "\u2018",
      operp: "\u29b9",
      oplus: "\u2295",
      orarr: "\u21bb",
      Or: "\u2a54",
      or: "\u2228",
      ord: "\u2a5d",
      order: "\u2134",
      orderof: "\u2134",
      ordf: "\xaa",
      ordm: "\xba",
      origof: "\u22b6",
      oror: "\u2a56",
      orslope: "\u2a57",
      orv: "\u2a5b",
      oS: "\u24c8",
      Oscr: "\ud835\udcaa",
      oscr: "\u2134",
      Oslash: "\xd8",
      oslash: "\xf8",
      osol: "\u2298",
      Otilde: "\xd5",
      otilde: "\xf5",
      otimesas: "\u2a36",
      Otimes: "\u2a37",
      otimes: "\u2297",
      Ouml: "\xd6",
      ouml: "\xf6",
      ovbar: "\u233d",
      OverBar: "\u203e",
      OverBrace: "\u23de",
      OverBracket: "\u23b4",
      OverParenthesis: "\u23dc",
      para: "\xb6",
      parallel: "\u2225",
      par: "\u2225",
      parsim: "\u2af3",
      parsl: "\u2afd",
      part: "\u2202",
      PartialD: "\u2202",
      Pcy: "\u041f",
      pcy: "\u043f",
      percnt: "%",
      period: ".",
      permil: "\u2030",
      perp: "\u22a5",
      pertenk: "\u2031",
      Pfr: "\ud835\udd13",
      pfr: "\ud835\udd2d",
      Phi: "\u03a6",
      phi: "\u03c6",
      phiv: "\u03d5",
      phmmat: "\u2133",
      phone: "\u260e",
      Pi: "\u03a0",
      pi: "\u03c0",
      pitchfork: "\u22d4",
      piv: "\u03d6",
      planck: "\u210f",
      planckh: "\u210e",
      plankv: "\u210f",
      plusacir: "\u2a23",
      plusb: "\u229e",
      pluscir: "\u2a22",
      plus: "+",
      plusdo: "\u2214",
      plusdu: "\u2a25",
      pluse: "\u2a72",
      PlusMinus: "\xb1",
      plusmn: "\xb1",
      plussim: "\u2a26",
      plustwo: "\u2a27",
      pm: "\xb1",
      Poincareplane: "\u210c",
      pointint: "\u2a15",
      popf: "\ud835\udd61",
      Popf: "\u2119",
      pound: "\xa3",
      prap: "\u2ab7",
      Pr: "\u2abb",
      pr: "\u227a",
      prcue: "\u227c",
      precapprox: "\u2ab7",
      prec: "\u227a",
      preccurlyeq: "\u227c",
      Precedes: "\u227a",
      PrecedesEqual: "\u2aaf",
      PrecedesSlantEqual: "\u227c",
      PrecedesTilde: "\u227e",
      preceq: "\u2aaf",
      precnapprox: "\u2ab9",
      precneqq: "\u2ab5",
      precnsim: "\u22e8",
      pre: "\u2aaf",
      prE: "\u2ab3",
      precsim: "\u227e",
      prime: "\u2032",
      Prime: "\u2033",
      primes: "\u2119",
      prnap: "\u2ab9",
      prnE: "\u2ab5",
      prnsim: "\u22e8",
      prod: "\u220f",
      Product: "\u220f",
      profalar: "\u232e",
      profline: "\u2312",
      profsurf: "\u2313",
      prop: "\u221d",
      Proportional: "\u221d",
      Proportion: "\u2237",
      propto: "\u221d",
      prsim: "\u227e",
      prurel: "\u22b0",
      Pscr: "\ud835\udcab",
      pscr: "\ud835\udcc5",
      Psi: "\u03a8",
      psi: "\u03c8",
      puncsp: "\u2008",
      Qfr: "\ud835\udd14",
      qfr: "\ud835\udd2e",
      qint: "\u2a0c",
      qopf: "\ud835\udd62",
      Qopf: "\u211a",
      qprime: "\u2057",
      Qscr: "\ud835\udcac",
      qscr: "\ud835\udcc6",
      quaternions: "\u210d",
      quatint: "\u2a16",
      quest: "?",
      questeq: "\u225f",
      quot: '"',
      QUOT: '"',
      rAarr: "\u21db",
      race: "\u223d\u0331",
      Racute: "\u0154",
      racute: "\u0155",
      radic: "\u221a",
      raemptyv: "\u29b3",
      rang: "\u27e9",
      Rang: "\u27eb",
      rangd: "\u2992",
      range: "\u29a5",
      rangle: "\u27e9",
      raquo: "\xbb",
      rarrap: "\u2975",
      rarrb: "\u21e5",
      rarrbfs: "\u2920",
      rarrc: "\u2933",
      rarr: "\u2192",
      Rarr: "\u21a0",
      rArr: "\u21d2",
      rarrfs: "\u291e",
      rarrhk: "\u21aa",
      rarrlp: "\u21ac",
      rarrpl: "\u2945",
      rarrsim: "\u2974",
      Rarrtl: "\u2916",
      rarrtl: "\u21a3",
      rarrw: "\u219d",
      ratail: "\u291a",
      rAtail: "\u291c",
      ratio: "\u2236",
      rationals: "\u211a",
      rbarr: "\u290d",
      rBarr: "\u290f",
      RBarr: "\u2910",
      rbbrk: "\u2773",
      rbrace: "}",
      rbrack: "]",
      rbrke: "\u298c",
      rbrksld: "\u298e",
      rbrkslu: "\u2990",
      Rcaron: "\u0158",
      rcaron: "\u0159",
      Rcedil: "\u0156",
      rcedil: "\u0157",
      rceil: "\u2309",
      rcub: "}",
      Rcy: "\u0420",
      rcy: "\u0440",
      rdca: "\u2937",
      rdldhar: "\u2969",
      rdquo: "\u201d",
      rdquor: "\u201d",
      rdsh: "\u21b3",
      real: "\u211c",
      realine: "\u211b",
      realpart: "\u211c",
      reals: "\u211d",
      Re: "\u211c",
      rect: "\u25ad",
      reg: "\xae",
      REG: "\xae",
      ReverseElement: "\u220b",
      ReverseEquilibrium: "\u21cb",
      ReverseUpEquilibrium: "\u296f",
      rfisht: "\u297d",
      rfloor: "\u230b",
      rfr: "\ud835\udd2f",
      Rfr: "\u211c",
      rHar: "\u2964",
      rhard: "\u21c1",
      rharu: "\u21c0",
      rharul: "\u296c",
      Rho: "\u03a1",
      rho: "\u03c1",
      rhov: "\u03f1",
      RightAngleBracket: "\u27e9",
      RightArrowBar: "\u21e5",
      rightarrow: "\u2192",
      RightArrow: "\u2192",
      Rightarrow: "\u21d2",
      RightArrowLeftArrow: "\u21c4",
      rightarrowtail: "\u21a3",
      RightCeiling: "\u2309",
      RightDoubleBracket: "\u27e7",
      RightDownTeeVector: "\u295d",
      RightDownVectorBar: "\u2955",
      RightDownVector: "\u21c2",
      RightFloor: "\u230b",
      rightharpoondown: "\u21c1",
      rightharpoonup: "\u21c0",
      rightleftarrows: "\u21c4",
      rightleftharpoons: "\u21cc",
      rightrightarrows: "\u21c9",
      rightsquigarrow: "\u219d",
      RightTeeArrow: "\u21a6",
      RightTee: "\u22a2",
      RightTeeVector: "\u295b",
      rightthreetimes: "\u22cc",
      RightTriangleBar: "\u29d0",
      RightTriangle: "\u22b3",
      RightTriangleEqual: "\u22b5",
      RightUpDownVector: "\u294f",
      RightUpTeeVector: "\u295c",
      RightUpVectorBar: "\u2954",
      RightUpVector: "\u21be",
      RightVectorBar: "\u2953",
      RightVector: "\u21c0",
      ring: "\u02da",
      risingdotseq: "\u2253",
      rlarr: "\u21c4",
      rlhar: "\u21cc",
      rlm: "\u200f",
      rmoustache: "\u23b1",
      rmoust: "\u23b1",
      rnmid: "\u2aee",
      roang: "\u27ed",
      roarr: "\u21fe",
      robrk: "\u27e7",
      ropar: "\u2986",
      ropf: "\ud835\udd63",
      Ropf: "\u211d",
      roplus: "\u2a2e",
      rotimes: "\u2a35",
      RoundImplies: "\u2970",
      rpar: ")",
      rpargt: "\u2994",
      rppolint: "\u2a12",
      rrarr: "\u21c9",
      Rrightarrow: "\u21db",
      rsaquo: "\u203a",
      rscr: "\ud835\udcc7",
      Rscr: "\u211b",
      rsh: "\u21b1",
      Rsh: "\u21b1",
      rsqb: "]",
      rsquo: "\u2019",
      rsquor: "\u2019",
      rthree: "\u22cc",
      rtimes: "\u22ca",
      rtri: "\u25b9",
      rtrie: "\u22b5",
      rtrif: "\u25b8",
      rtriltri: "\u29ce",
      RuleDelayed: "\u29f4",
      ruluhar: "\u2968",
      rx: "\u211e",
      Sacute: "\u015a",
      sacute: "\u015b",
      sbquo: "\u201a",
      scap: "\u2ab8",
      Scaron: "\u0160",
      scaron: "\u0161",
      Sc: "\u2abc",
      sc: "\u227b",
      sccue: "\u227d",
      sce: "\u2ab0",
      scE: "\u2ab4",
      Scedil: "\u015e",
      scedil: "\u015f",
      Scirc: "\u015c",
      scirc: "\u015d",
      scnap: "\u2aba",
      scnE: "\u2ab6",
      scnsim: "\u22e9",
      scpolint: "\u2a13",
      scsim: "\u227f",
      Scy: "\u0421",
      scy: "\u0441",
      sdotb: "\u22a1",
      sdot: "\u22c5",
      sdote: "\u2a66",
      searhk: "\u2925",
      searr: "\u2198",
      seArr: "\u21d8",
      searrow: "\u2198",
      sect: "\xa7",
      semi: ";",
      seswar: "\u2929",
      setminus: "\u2216",
      setmn: "\u2216",
      sext: "\u2736",
      Sfr: "\ud835\udd16",
      sfr: "\ud835\udd30",
      sfrown: "\u2322",
      sharp: "\u266f",
      SHCHcy: "\u0429",
      shchcy: "\u0449",
      SHcy: "\u0428",
      shcy: "\u0448",
      ShortDownArrow: "\u2193",
      ShortLeftArrow: "\u2190",
      shortmid: "\u2223",
      shortparallel: "\u2225",
      ShortRightArrow: "\u2192",
      ShortUpArrow: "\u2191",
      shy: "\xad",
      Sigma: "\u03a3",
      sigma: "\u03c3",
      sigmaf: "\u03c2",
      sigmav: "\u03c2",
      sim: "\u223c",
      simdot: "\u2a6a",
      sime: "\u2243",
      simeq: "\u2243",
      simg: "\u2a9e",
      simgE: "\u2aa0",
      siml: "\u2a9d",
      simlE: "\u2a9f",
      simne: "\u2246",
      simplus: "\u2a24",
      simrarr: "\u2972",
      slarr: "\u2190",
      SmallCircle: "\u2218",
      smallsetminus: "\u2216",
      smashp: "\u2a33",
      smeparsl: "\u29e4",
      smid: "\u2223",
      smile: "\u2323",
      smt: "\u2aaa",
      smte: "\u2aac",
      smtes: "\u2aac\ufe00",
      SOFTcy: "\u042c",
      softcy: "\u044c",
      solbar: "\u233f",
      solb: "\u29c4",
      sol: "/",
      Sopf: "\ud835\udd4a",
      sopf: "\ud835\udd64",
      spades: "\u2660",
      spadesuit: "\u2660",
      spar: "\u2225",
      sqcap: "\u2293",
      sqcaps: "\u2293\ufe00",
      sqcup: "\u2294",
      sqcups: "\u2294\ufe00",
      Sqrt: "\u221a",
      sqsub: "\u228f",
      sqsube: "\u2291",
      sqsubset: "\u228f",
      sqsubseteq: "\u2291",
      sqsup: "\u2290",
      sqsupe: "\u2292",
      sqsupset: "\u2290",
      sqsupseteq: "\u2292",
      square: "\u25a1",
      Square: "\u25a1",
      SquareIntersection: "\u2293",
      SquareSubset: "\u228f",
      SquareSubsetEqual: "\u2291",
      SquareSuperset: "\u2290",
      SquareSupersetEqual: "\u2292",
      SquareUnion: "\u2294",
      squarf: "\u25aa",
      squ: "\u25a1",
      squf: "\u25aa",
      srarr: "\u2192",
      Sscr: "\ud835\udcae",
      sscr: "\ud835\udcc8",
      ssetmn: "\u2216",
      ssmile: "\u2323",
      sstarf: "\u22c6",
      Star: "\u22c6",
      star: "\u2606",
      starf: "\u2605",
      straightepsilon: "\u03f5",
      straightphi: "\u03d5",
      strns: "\xaf",
      sub: "\u2282",
      Sub: "\u22d0",
      subdot: "\u2abd",
      subE: "\u2ac5",
      sube: "\u2286",
      subedot: "\u2ac3",
      submult: "\u2ac1",
      subnE: "\u2acb",
      subne: "\u228a",
      subplus: "\u2abf",
      subrarr: "\u2979",
      subset: "\u2282",
      Subset: "\u22d0",
      subseteq: "\u2286",
      subseteqq: "\u2ac5",
      SubsetEqual: "\u2286",
      subsetneq: "\u228a",
      subsetneqq: "\u2acb",
      subsim: "\u2ac7",
      subsub: "\u2ad5",
      subsup: "\u2ad3",
      succapprox: "\u2ab8",
      succ: "\u227b",
      succcurlyeq: "\u227d",
      Succeeds: "\u227b",
      SucceedsEqual: "\u2ab0",
      SucceedsSlantEqual: "\u227d",
      SucceedsTilde: "\u227f",
      succeq: "\u2ab0",
      succnapprox: "\u2aba",
      succneqq: "\u2ab6",
      succnsim: "\u22e9",
      succsim: "\u227f",
      SuchThat: "\u220b",
      sum: "\u2211",
      Sum: "\u2211",
      sung: "\u266a",
      sup1: "\xb9",
      sup2: "\xb2",
      sup3: "\xb3",
      sup: "\u2283",
      Sup: "\u22d1",
      supdot: "\u2abe",
      supdsub: "\u2ad8",
      supE: "\u2ac6",
      supe: "\u2287",
      supedot: "\u2ac4",
      Superset: "\u2283",
      SupersetEqual: "\u2287",
      suphsol: "\u27c9",
      suphsub: "\u2ad7",
      suplarr: "\u297b",
      supmult: "\u2ac2",
      supnE: "\u2acc",
      supne: "\u228b",
      supplus: "\u2ac0",
      supset: "\u2283",
      Supset: "\u22d1",
      supseteq: "\u2287",
      supseteqq: "\u2ac6",
      supsetneq: "\u228b",
      supsetneqq: "\u2acc",
      supsim: "\u2ac8",
      supsub: "\u2ad4",
      supsup: "\u2ad6",
      swarhk: "\u2926",
      swarr: "\u2199",
      swArr: "\u21d9",
      swarrow: "\u2199",
      swnwar: "\u292a",
      szlig: "\xdf",
      Tab: "\t",
      target: "\u2316",
      Tau: "\u03a4",
      tau: "\u03c4",
      tbrk: "\u23b4",
      Tcaron: "\u0164",
      tcaron: "\u0165",
      Tcedil: "\u0162",
      tcedil: "\u0163",
      Tcy: "\u0422",
      tcy: "\u0442",
      tdot: "\u20db",
      telrec: "\u2315",
      Tfr: "\ud835\udd17",
      tfr: "\ud835\udd31",
      there4: "\u2234",
      therefore: "\u2234",
      Therefore: "\u2234",
      Theta: "\u0398",
      theta: "\u03b8",
      thetasym: "\u03d1",
      thetav: "\u03d1",
      thickapprox: "\u2248",
      thicksim: "\u223c",
      ThickSpace: "\u205f\u200a",
      ThinSpace: "\u2009",
      thinsp: "\u2009",
      thkap: "\u2248",
      thksim: "\u223c",
      THORN: "\xde",
      thorn: "\xfe",
      tilde: "\u02dc",
      Tilde: "\u223c",
      TildeEqual: "\u2243",
      TildeFullEqual: "\u2245",
      TildeTilde: "\u2248",
      timesbar: "\u2a31",
      timesb: "\u22a0",
      times: "\xd7",
      timesd: "\u2a30",
      tint: "\u222d",
      toea: "\u2928",
      topbot: "\u2336",
      topcir: "\u2af1",
      top: "\u22a4",
      Topf: "\ud835\udd4b",
      topf: "\ud835\udd65",
      topfork: "\u2ada",
      tosa: "\u2929",
      tprime: "\u2034",
      trade: "\u2122",
      TRADE: "\u2122",
      triangle: "\u25b5",
      triangledown: "\u25bf",
      triangleleft: "\u25c3",
      trianglelefteq: "\u22b4",
      triangleq: "\u225c",
      triangleright: "\u25b9",
      trianglerighteq: "\u22b5",
      tridot: "\u25ec",
      trie: "\u225c",
      triminus: "\u2a3a",
      TripleDot: "\u20db",
      triplus: "\u2a39",
      trisb: "\u29cd",
      tritime: "\u2a3b",
      trpezium: "\u23e2",
      Tscr: "\ud835\udcaf",
      tscr: "\ud835\udcc9",
      TScy: "\u0426",
      tscy: "\u0446",
      TSHcy: "\u040b",
      tshcy: "\u045b",
      Tstrok: "\u0166",
      tstrok: "\u0167",
      twixt: "\u226c",
      twoheadleftarrow: "\u219e",
      twoheadrightarrow: "\u21a0",
      Uacute: "\xda",
      uacute: "\xfa",
      uarr: "\u2191",
      Uarr: "\u219f",
      uArr: "\u21d1",
      Uarrocir: "\u2949",
      Ubrcy: "\u040e",
      ubrcy: "\u045e",
      Ubreve: "\u016c",
      ubreve: "\u016d",
      Ucirc: "\xdb",
      ucirc: "\xfb",
      Ucy: "\u0423",
      ucy: "\u0443",
      udarr: "\u21c5",
      Udblac: "\u0170",
      udblac: "\u0171",
      udhar: "\u296e",
      ufisht: "\u297e",
      Ufr: "\ud835\udd18",
      ufr: "\ud835\udd32",
      Ugrave: "\xd9",
      ugrave: "\xf9",
      uHar: "\u2963",
      uharl: "\u21bf",
      uharr: "\u21be",
      uhblk: "\u2580",
      ulcorn: "\u231c",
      ulcorner: "\u231c",
      ulcrop: "\u230f",
      ultri: "\u25f8",
      Umacr: "\u016a",
      umacr: "\u016b",
      uml: "\xa8",
      UnderBar: "_",
      UnderBrace: "\u23df",
      UnderBracket: "\u23b5",
      UnderParenthesis: "\u23dd",
      Union: "\u22c3",
      UnionPlus: "\u228e",
      Uogon: "\u0172",
      uogon: "\u0173",
      Uopf: "\ud835\udd4c",
      uopf: "\ud835\udd66",
      UpArrowBar: "\u2912",
      uparrow: "\u2191",
      UpArrow: "\u2191",
      Uparrow: "\u21d1",
      UpArrowDownArrow: "\u21c5",
      updownarrow: "\u2195",
      UpDownArrow: "\u2195",
      Updownarrow: "\u21d5",
      UpEquilibrium: "\u296e",
      upharpoonleft: "\u21bf",
      upharpoonright: "\u21be",
      uplus: "\u228e",
      UpperLeftArrow: "\u2196",
      UpperRightArrow: "\u2197",
      upsi: "\u03c5",
      Upsi: "\u03d2",
      upsih: "\u03d2",
      Upsilon: "\u03a5",
      upsilon: "\u03c5",
      UpTeeArrow: "\u21a5",
      UpTee: "\u22a5",
      upuparrows: "\u21c8",
      urcorn: "\u231d",
      urcorner: "\u231d",
      urcrop: "\u230e",
      Uring: "\u016e",
      uring: "\u016f",
      urtri: "\u25f9",
      Uscr: "\ud835\udcb0",
      uscr: "\ud835\udcca",
      utdot: "\u22f0",
      Utilde: "\u0168",
      utilde: "\u0169",
      utri: "\u25b5",
      utrif: "\u25b4",
      uuarr: "\u21c8",
      Uuml: "\xdc",
      uuml: "\xfc",
      uwangle: "\u29a7",
      vangrt: "\u299c",
      varepsilon: "\u03f5",
      varkappa: "\u03f0",
      varnothing: "\u2205",
      varphi: "\u03d5",
      varpi: "\u03d6",
      varpropto: "\u221d",
      varr: "\u2195",
      vArr: "\u21d5",
      varrho: "\u03f1",
      varsigma: "\u03c2",
      varsubsetneq: "\u228a\ufe00",
      varsubsetneqq: "\u2acb\ufe00",
      varsupsetneq: "\u228b\ufe00",
      varsupsetneqq: "\u2acc\ufe00",
      vartheta: "\u03d1",
      vartriangleleft: "\u22b2",
      vartriangleright: "\u22b3",
      vBar: "\u2ae8",
      Vbar: "\u2aeb",
      vBarv: "\u2ae9",
      Vcy: "\u0412",
      vcy: "\u0432",
      vdash: "\u22a2",
      vDash: "\u22a8",
      Vdash: "\u22a9",
      VDash: "\u22ab",
      Vdashl: "\u2ae6",
      veebar: "\u22bb",
      vee: "\u2228",
      Vee: "\u22c1",
      veeeq: "\u225a",
      vellip: "\u22ee",
      verbar: "|",
      Verbar: "\u2016",
      vert: "|",
      Vert: "\u2016",
      VerticalBar: "\u2223",
      VerticalLine: "|",
      VerticalSeparator: "\u2758",
      VerticalTilde: "\u2240",
      VeryThinSpace: "\u200a",
      Vfr: "\ud835\udd19",
      vfr: "\ud835\udd33",
      vltri: "\u22b2",
      vnsub: "\u2282\u20d2",
      vnsup: "\u2283\u20d2",
      Vopf: "\ud835\udd4d",
      vopf: "\ud835\udd67",
      vprop: "\u221d",
      vrtri: "\u22b3",
      Vscr: "\ud835\udcb1",
      vscr: "\ud835\udccb",
      vsubnE: "\u2acb\ufe00",
      vsubne: "\u228a\ufe00",
      vsupnE: "\u2acc\ufe00",
      vsupne: "\u228b\ufe00",
      Vvdash: "\u22aa",
      vzigzag: "\u299a",
      Wcirc: "\u0174",
      wcirc: "\u0175",
      wedbar: "\u2a5f",
      wedge: "\u2227",
      Wedge: "\u22c0",
      wedgeq: "\u2259",
      weierp: "\u2118",
      Wfr: "\ud835\udd1a",
      wfr: "\ud835\udd34",
      Wopf: "\ud835\udd4e",
      wopf: "\ud835\udd68",
      wp: "\u2118",
      wr: "\u2240",
      wreath: "\u2240",
      Wscr: "\ud835\udcb2",
      wscr: "\ud835\udccc",
      xcap: "\u22c2",
      xcirc: "\u25ef",
      xcup: "\u22c3",
      xdtri: "\u25bd",
      Xfr: "\ud835\udd1b",
      xfr: "\ud835\udd35",
      xharr: "\u27f7",
      xhArr: "\u27fa",
      Xi: "\u039e",
      xi: "\u03be",
      xlarr: "\u27f5",
      xlArr: "\u27f8",
      xmap: "\u27fc",
      xnis: "\u22fb",
      xodot: "\u2a00",
      Xopf: "\ud835\udd4f",
      xopf: "\ud835\udd69",
      xoplus: "\u2a01",
      xotime: "\u2a02",
      xrarr: "\u27f6",
      xrArr: "\u27f9",
      Xscr: "\ud835\udcb3",
      xscr: "\ud835\udccd",
      xsqcup: "\u2a06",
      xuplus: "\u2a04",
      xutri: "\u25b3",
      xvee: "\u22c1",
      xwedge: "\u22c0",
      Yacute: "\xdd",
      yacute: "\xfd",
      YAcy: "\u042f",
      yacy: "\u044f",
      Ycirc: "\u0176",
      ycirc: "\u0177",
      Ycy: "\u042b",
      ycy: "\u044b",
      yen: "\xa5",
      Yfr: "\ud835\udd1c",
      yfr: "\ud835\udd36",
      YIcy: "\u0407",
      yicy: "\u0457",
      Yopf: "\ud835\udd50",
      yopf: "\ud835\udd6a",
      Yscr: "\ud835\udcb4",
      yscr: "\ud835\udcce",
      YUcy: "\u042e",
      yucy: "\u044e",
      yuml: "\xff",
      Yuml: "\u0178",
      Zacute: "\u0179",
      zacute: "\u017a",
      Zcaron: "\u017d",
      zcaron: "\u017e",
      Zcy: "\u0417",
      zcy: "\u0437",
      Zdot: "\u017b",
      zdot: "\u017c",
      zeetrf: "\u2128",
      ZeroWidthSpace: "\u200b",
      Zeta: "\u0396",
      zeta: "\u03b6",
      zfr: "\ud835\udd37",
      Zfr: "\u2128",
      ZHcy: "\u0416",
      zhcy: "\u0436",
      zigrarr: "\u21dd",
      zopf: "\ud835\udd6b",
      Zopf: "\u2124",
      Zscr: "\ud835\udcb5",
      zscr: "\ud835\udccf",
      zwj: "\u200d",
      zwnj: "\u200c",
    },
    t =
      /[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4E\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,
    n = {};
  function s(e, r, t) {
    var o,
      i,
      a,
      c,
      l,
      u = "";
    for (
      "string" != typeof r && ((t = r), (r = s.defaultChars)),
        void 0 === t && (t = !0),
        l = (function (e) {
          var r,
            t,
            s = n[e];
          if (s) return s;
          for (s = n[e] = [], r = 0; r < 128; r++)
            (t = String.fromCharCode(r)),
              /^[0-9a-z]$/i.test(t)
                ? s.push(t)
                : s.push("%" + ("0" + r.toString(16).toUpperCase()).slice(-2));
          for (r = 0; r < e.length; r++) s[e.charCodeAt(r)] = e[r];
          return s;
        })(r),
        o = 0,
        i = e.length;
      o < i;
      o++
    )
      if (
        ((a = e.charCodeAt(o)),
        t &&
          37 === a &&
          o + 2 < i &&
          /^[0-9a-f]{2}$/i.test(e.slice(o + 1, o + 3)))
      )
        (u += e.slice(o, o + 3)), (o += 2);
      else if (a < 128) u += l[a];
      else if (a >= 55296 && a <= 57343) {
        if (
          a >= 55296 &&
          a <= 56319 &&
          o + 1 < i &&
          (c = e.charCodeAt(o + 1)) >= 56320 &&
          c <= 57343
        ) {
          (u += encodeURIComponent(e[o] + e[o + 1])), o++;
          continue;
        }
        u += "%EF%BF%BD";
      } else u += encodeURIComponent(e[o]);
    return u;
  }
  (s.defaultChars = ";/?:@&=+$,-_.!~*'()#"), (s.componentChars = "-_.!~*'()");
  var o = s,
    i = {};
  function a(e, r) {
    var t;
    return (
      "string" != typeof r && (r = a.defaultChars),
      (t = (function (e) {
        var r,
          t,
          n = i[e];
        if (n) return n;
        for (n = i[e] = [], r = 0; r < 128; r++)
          (t = String.fromCharCode(r)), n.push(t);
        for (r = 0; r < e.length; r++)
          n[(t = e.charCodeAt(r))] =
            "%" + ("0" + t.toString(16).toUpperCase()).slice(-2);
        return n;
      })(r)),
      e.replace(/(%[a-f0-9]{2})+/gi, function (e) {
        var r,
          n,
          s,
          o,
          i,
          a,
          c,
          l = "";
        for (r = 0, n = e.length; r < n; r += 3)
          (s = parseInt(e.slice(r + 1, r + 3), 16)) < 128
            ? (l += t[s])
            : 192 == (224 & s) &&
              r + 3 < n &&
              128 == (192 & (o = parseInt(e.slice(r + 4, r + 6), 16)))
            ? ((l +=
                (c = ((s << 6) & 1984) | (63 & o)) < 128
                  ? "\ufffd\ufffd"
                  : String.fromCharCode(c)),
              (r += 3))
            : 224 == (240 & s) &&
              r + 6 < n &&
              ((o = parseInt(e.slice(r + 4, r + 6), 16)),
              (i = parseInt(e.slice(r + 7, r + 9), 16)),
              128 == (192 & o) && 128 == (192 & i))
            ? ((l +=
                (c = ((s << 12) & 61440) | ((o << 6) & 4032) | (63 & i)) <
                  2048 ||
                (c >= 55296 && c <= 57343)
                  ? "\ufffd\ufffd\ufffd"
                  : String.fromCharCode(c)),
              (r += 6))
            : 240 == (248 & s) &&
              r + 9 < n &&
              ((o = parseInt(e.slice(r + 4, r + 6), 16)),
              (i = parseInt(e.slice(r + 7, r + 9), 16)),
              (a = parseInt(e.slice(r + 10, r + 12), 16)),
              128 == (192 & o) && 128 == (192 & i) && 128 == (192 & a))
            ? ((c =
                ((s << 18) & 1835008) |
                ((o << 12) & 258048) |
                ((i << 6) & 4032) |
                (63 & a)) < 65536 || c > 1114111
                ? (l += "\ufffd\ufffd\ufffd\ufffd")
                : ((c -= 65536),
                  (l += String.fromCharCode(
                    55296 + (c >> 10),
                    56320 + (1023 & c)
                  ))),
              (r += 9))
            : (l += "\ufffd");
        return l;
      })
    );
  }
  (a.defaultChars = ";/?:@&=+$,#"), (a.componentChars = "");
  var c = a;
  function l() {
    (this.protocol = null),
      (this.slashes = null),
      (this.auth = null),
      (this.port = null),
      (this.hostname = null),
      (this.hash = null),
      (this.search = null),
      (this.pathname = null);
  }
  var u = /^([a-z0-9.+-]+:)/i,
    p = /:[0-9]*$/,
    h = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,
    f = ["{", "}", "|", "\\", "^", "`"].concat([
      "<",
      ">",
      '"',
      "`",
      " ",
      "\r",
      "\n",
      "\t",
    ]),
    d = ["'"].concat(f),
    m = ["%", "/", "?", ";", "#"].concat(d),
    g = ["/", "?", "#"],
    _ = /^[+a-z0-9A-Z_-]{0,63}$/,
    b = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,
    k = { javascript: !0, "javascript:": !0 },
    v = {
      http: !0,
      https: !0,
      ftp: !0,
      gopher: !0,
      file: !0,
      "http:": !0,
      "https:": !0,
      "ftp:": !0,
      "gopher:": !0,
      "file:": !0,
    };
  (l.prototype.parse = function (e, r) {
    var t,
      n,
      s,
      o,
      i,
      a = e;
    if (((a = a.trim()), !r && 1 === e.split("#").length)) {
      var c = h.exec(a);
      if (c) return (this.pathname = c[1]), c[2] && (this.search = c[2]), this;
    }
    var l = u.exec(a);
    if (
      (l &&
        ((s = (l = l[0]).toLowerCase()),
        (this.protocol = l),
        (a = a.substr(l.length))),
      (r || l || a.match(/^\/\/[^@\/]+@[^@\/]+/)) &&
        (!(i = "//" === a.substr(0, 2)) ||
          (l && k[l]) ||
          ((a = a.substr(2)), (this.slashes = !0))),
      !k[l] && (i || (l && !v[l])))
    ) {
      var p,
        f,
        d = -1;
      for (t = 0; t < g.length; t++)
        -1 !== (o = a.indexOf(g[t])) && (-1 === d || o < d) && (d = o);
      for (
        -1 !== (f = -1 === d ? a.lastIndexOf("@") : a.lastIndexOf("@", d)) &&
          ((p = a.slice(0, f)), (a = a.slice(f + 1)), (this.auth = p)),
          d = -1,
          t = 0;
        t < m.length;
        t++
      )
        -1 !== (o = a.indexOf(m[t])) && (-1 === d || o < d) && (d = o);
      -1 === d && (d = a.length), ":" === a[d - 1] && d--;
      var C = a.slice(0, d);
      (a = a.slice(d)),
        this.parseHost(C),
        (this.hostname = this.hostname || "");
      var y =
        "[" === this.hostname[0] &&
        "]" === this.hostname[this.hostname.length - 1];
      if (!y) {
        var A = this.hostname.split(/\./);
        for (t = 0, n = A.length; t < n; t++) {
          var x = A[t];
          if (x && !x.match(_)) {
            for (var D = "", w = 0, E = x.length; w < E; w++)
              x.charCodeAt(w) > 127 ? (D += "x") : (D += x[w]);
            if (!D.match(_)) {
              var q = A.slice(0, t),
                S = A.slice(t + 1),
                F = x.match(b);
              F && (q.push(F[1]), S.unshift(F[2])),
                S.length && (a = S.join(".") + a),
                (this.hostname = q.join("."));
              break;
            }
          }
        }
      }
      this.hostname.length > 255 && (this.hostname = ""),
        y &&
          (this.hostname = this.hostname.substr(1, this.hostname.length - 2));
    }
    var L = a.indexOf("#");
    -1 !== L && ((this.hash = a.substr(L)), (a = a.slice(0, L)));
    var z = a.indexOf("?");
    return (
      -1 !== z && ((this.search = a.substr(z)), (a = a.slice(0, z))),
      a && (this.pathname = a),
      v[s] && this.hostname && !this.pathname && (this.pathname = ""),
      this
    );
  }),
    (l.prototype.parseHost = function (e) {
      var r = p.exec(e);
      r &&
        (":" !== (r = r[0]) && (this.port = r.substr(1)),
        (e = e.substr(0, e.length - r.length))),
        e && (this.hostname = e);
    });
  var C = {
      encode: o,
      decode: c,
      format: function (e) {
        var r = "";
        return (
          (r += e.protocol || ""),
          (r += e.slashes ? "//" : ""),
          (r += e.auth ? e.auth + "@" : ""),
          e.hostname && -1 !== e.hostname.indexOf(":")
            ? (r += "[" + e.hostname + "]")
            : (r += e.hostname || ""),
          (r += e.port ? ":" + e.port : ""),
          (r += e.pathname || ""),
          (r += e.search || ""),
          (r += e.hash || "")
        );
      },
      parse: function (e, r) {
        if (e && e instanceof l) return e;
        var t = new l();
        return t.parse(e, r), t;
      },
    },
    y =
      /[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,
    A = /[\0-\x1F\x7F-\x9F]/,
    x = /[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,
    D = {
      Any: y,
      Cc: A,
      Cf: /[\xAD\u0600-\u0605\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,
      P: t,
      Z: x,
    },
    w = (function (e, r, t) {
      return (
        e(
          (t = {
            path: r,
            exports: {},
            require: function (e, r) {
              return (function () {
                throw new Error(
                  "Dynamic requires are not currently supported by @rollup/plugin-commonjs"
                );
              })(null == r && t.path);
            },
          }),
          t.exports
        ),
        t.exports
      );
    })(function (e, n) {
      var s = Object.prototype.hasOwnProperty;
      function o(e, r) {
        return s.call(e, r);
      }
      function i(e) {
        return (
          !(e >= 55296 && e <= 57343) &&
          !(e >= 64976 && e <= 65007) &&
          65535 != (65535 & e) &&
          65534 != (65535 & e) &&
          !(e >= 0 && e <= 8) &&
          11 !== e &&
          !(e >= 14 && e <= 31) &&
          !(e >= 127 && e <= 159) &&
          !(e > 1114111)
        );
      }
      function a(e) {
        if (e > 65535) {
          var r = 55296 + ((e -= 65536) >> 10),
            t = 56320 + (1023 & e);
          return String.fromCharCode(r, t);
        }
        return String.fromCharCode(e);
      }
      var c = /\\([!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~])/g,
        l = new RegExp(
          c.source + "|" + /&([a-z#][a-z0-9]{1,31});/gi.source,
          "gi"
        ),
        u = /^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;
      var p = /[&<>"]/,
        h = /[&<>"]/g,
        f = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" };
      function d(e) {
        return f[e];
      }
      var m = /[.?*+^$[\]\\(){}|-]/g;
      (n.lib = {}),
        (n.lib.mdurl = C),
        (n.lib.ucmicro = D),
        (n.assign = function (e) {
          var r = Array.prototype.slice.call(arguments, 1);
          return (
            r.forEach(function (r) {
              if (r) {
                if ("object" != typeof r)
                  throw new TypeError(r + "must be object");
                Object.keys(r).forEach(function (t) {
                  e[t] = r[t];
                });
              }
            }),
            e
          );
        }),
        (n.isString = function (e) {
          return (
            "[object String]" ===
            (function (e) {
              return Object.prototype.toString.call(e);
            })(e)
          );
        }),
        (n.has = o),
        (n.unescapeMd = function (e) {
          return e.indexOf("\\") < 0 ? e : e.replace(c, "$1");
        }),
        (n.unescapeAll = function (e) {
          return e.indexOf("\\") < 0 && e.indexOf("&") < 0
            ? e
            : e.replace(l, function (e, t, n) {
                return (
                  t ||
                  (function (e, t) {
                    var n = 0;
                    return o(r, t)
                      ? r[t]
                      : 35 === t.charCodeAt(0) &&
                        u.test(t) &&
                        i(
                          (n =
                            "x" === t[1].toLowerCase()
                              ? parseInt(t.slice(2), 16)
                              : parseInt(t.slice(1), 10))
                        )
                      ? a(n)
                      : e;
                  })(e, n)
                );
              });
        }),
        (n.isValidEntityCode = i),
        (n.fromCodePoint = a),
        (n.escapeHtml = function (e) {
          return p.test(e) ? e.replace(h, d) : e;
        }),
        (n.arrayReplaceAt = function (e, r, t) {
          return [].concat(e.slice(0, r), t, e.slice(r + 1));
        }),
        (n.isSpace = function (e) {
          switch (e) {
            case 9:
            case 32:
              return !0;
          }
          return !1;
        }),
        (n.isWhiteSpace = function (e) {
          if (e >= 8192 && e <= 8202) return !0;
          switch (e) {
            case 9:
            case 10:
            case 11:
            case 12:
            case 13:
            case 32:
            case 160:
            case 5760:
            case 8239:
            case 8287:
            case 12288:
              return !0;
          }
          return !1;
        }),
        (n.isMdAsciiPunct = function (e) {
          switch (e) {
            case 33:
            case 34:
            case 35:
            case 36:
            case 37:
            case 38:
            case 39:
            case 40:
            case 41:
            case 42:
            case 43:
            case 44:
            case 45:
            case 46:
            case 47:
            case 58:
            case 59:
            case 60:
            case 61:
            case 62:
            case 63:
            case 64:
            case 91:
            case 92:
            case 93:
            case 94:
            case 95:
            case 96:
            case 123:
            case 124:
            case 125:
            case 126:
              return !0;
            default:
              return !1;
          }
        }),
        (n.isPunctChar = function (e) {
          return t.test(e);
        }),
        (n.escapeRE = function (e) {
          return e.replace(m, "\\$&");
        }),
        (n.normalizeReference = function (e) {
          return (
            (e = e.trim().replace(/\s+/g, " ")),
            "\u1e7e" === "\u1e9e".toLowerCase() &&
              (e = e.replace(/\u1e9e/g, "\xdf")),
            e.toLowerCase().toUpperCase()
          );
        });
    }),
    E = w.unescapeAll,
    q = w.unescapeAll,
    S = {
      parseLinkLabel: function (e, r, t) {
        var n,
          s,
          o,
          i,
          a = -1,
          c = e.posMax,
          l = e.pos;
        for (e.pos = r + 1, n = 1; e.pos < c; ) {
          if (93 === (o = e.src.charCodeAt(e.pos)) && 0 === --n) {
            s = !0;
            break;
          }
          if (((i = e.pos), e.md.inline.skipToken(e), 91 === o))
            if (i === e.pos - 1) n++;
            else if (t) return (e.pos = l), -1;
        }
        return s && (a = e.pos), (e.pos = l), a;
      },
      parseLinkDestination: function (e, r, t) {
        var n,
          s,
          o = r,
          i = { ok: !1, pos: 0, lines: 0, str: "" };
        if (60 === e.charCodeAt(r)) {
          for (r++; r < t; ) {
            if (10 === (n = e.charCodeAt(r))) return i;
            if (60 === n) return i;
            if (62 === n)
              return (
                (i.pos = r + 1), (i.str = E(e.slice(o + 1, r))), (i.ok = !0), i
              );
            92 === n && r + 1 < t ? (r += 2) : r++;
          }
          return i;
        }
        for (
          s = 0;
          r < t && 32 !== (n = e.charCodeAt(r)) && !(n < 32 || 127 === n);

        )
          if (92 === n && r + 1 < t) {
            if (32 === e.charCodeAt(r + 1)) break;
            r += 2;
          } else {
            if (40 === n && ++s > 32) return i;
            if (41 === n) {
              if (0 === s) break;
              s--;
            }
            r++;
          }
        return (
          o === r ||
            0 !== s ||
            ((i.str = E(e.slice(o, r))),
            (i.lines = 0),
            (i.pos = r),
            (i.ok = !0)),
          i
        );
      },
      parseLinkTitle: function (e, r, t) {
        var n,
          s,
          o = 0,
          i = r,
          a = { ok: !1, pos: 0, lines: 0, str: "" };
        if (r >= t) return a;
        if (34 !== (s = e.charCodeAt(r)) && 39 !== s && 40 !== s) return a;
        for (r++, 40 === s && (s = 41); r < t; ) {
          if ((n = e.charCodeAt(r)) === s)
            return (
              (a.pos = r + 1),
              (a.lines = o),
              (a.str = q(e.slice(i + 1, r))),
              (a.ok = !0),
              a
            );
          if (40 === n && 41 === s) return a;
          10 === n
            ? o++
            : 92 === n && r + 1 < t && (r++, 10 === e.charCodeAt(r) && o++),
            r++;
        }
        return a;
      },
    },
    F = w.assign,
    L = w.unescapeAll,
    z = w.escapeHtml,
    T = {};
  function I() {
    this.rules = F({}, T);
  }
  (T.code_inline = function (e, r, t, n, s) {
    var o = e[r];
    return "<code" + s.renderAttrs(o) + ">" + z(e[r].content) + "</code>";
  }),
    (T.code_block = function (e, r, t, n, s) {
      var o = e[r];
      return (
        "<pre" +
        s.renderAttrs(o) +
        "><code>" +
        z(e[r].content) +
        "</code></pre>\n"
      );
    }),
    (T.fence = function (e, r, t, n, s) {
      var o,
        i,
        a,
        c,
        l,
        u = e[r],
        p = u.info ? L(u.info).trim() : "",
        h = "",
        f = "";
      return (
        p && ((h = (a = p.split(/(\s+)/g))[0]), (f = a.slice(2).join(""))),
        0 ===
        (o =
          (t.highlight && t.highlight(u.content, h, f)) ||
          z(u.content)).indexOf("<pre")
          ? o + "\n"
          : p
          ? ((i = u.attrIndex("class")),
            (c = u.attrs ? u.attrs.slice() : []),
            i < 0
              ? c.push(["class", t.langPrefix + h])
              : ((c[i] = c[i].slice()), (c[i][1] += " " + t.langPrefix + h)),
            (l = { attrs: c }),
            "<pre><code" + s.renderAttrs(l) + ">" + o + "</code></pre>\n")
          : "<pre><code" + s.renderAttrs(u) + ">" + o + "</code></pre>\n"
      );
    }),
    (T.image = function (e, r, t, n, s) {
      var o = e[r];
      return (
        (o.attrs[o.attrIndex("alt")][1] = s.renderInlineAsText(
          o.children,
          t,
          n
        )),
        s.renderToken(e, r, t)
      );
    }),
    (T.hardbreak = function (e, r, t) {
      return t.xhtmlOut ? "<br />\n" : "<br>\n";
    }),
    (T.softbreak = function (e, r, t) {
      return t.breaks ? (t.xhtmlOut ? "<br />\n" : "<br>\n") : "\n";
    }),
    (T.text = function (e, r) {
      return z(e[r].content);
    }),
    (T.html_block = function (e, r) {
      return e[r].content;
    }),
    (T.html_inline = function (e, r) {
      return e[r].content;
    }),
    (I.prototype.renderAttrs = function (e) {
      var r, t, n;
      if (!e.attrs) return "";
      for (n = "", r = 0, t = e.attrs.length; r < t; r++)
        n += " " + z(e.attrs[r][0]) + '="' + z(e.attrs[r][1]) + '"';
      return n;
    }),
    (I.prototype.renderToken = function (e, r, t) {
      var n,
        s = "",
        o = !1,
        i = e[r];
      return i.hidden
        ? ""
        : (i.block && -1 !== i.nesting && r && e[r - 1].hidden && (s += "\n"),
          (s += (-1 === i.nesting ? "</" : "<") + i.tag),
          (s += this.renderAttrs(i)),
          0 === i.nesting && t.xhtmlOut && (s += " /"),
          i.block &&
            ((o = !0),
            1 === i.nesting &&
              r + 1 < e.length &&
              ("inline" === (n = e[r + 1]).type ||
                n.hidden ||
                (-1 === n.nesting && n.tag === i.tag)) &&
              (o = !1)),
          (s += o ? ">\n" : ">"));
    }),
    (I.prototype.renderInline = function (e, r, t) {
      for (var n, s = "", o = this.rules, i = 0, a = e.length; i < a; i++)
        void 0 !== o[(n = e[i].type)]
          ? (s += o[n](e, i, r, t, this))
          : (s += this.renderToken(e, i, r));
      return s;
    }),
    (I.prototype.renderInlineAsText = function (e, r, t) {
      for (var n = "", s = 0, o = e.length; s < o; s++)
        "text" === e[s].type
          ? (n += e[s].content)
          : "image" === e[s].type
          ? (n += this.renderInlineAsText(e[s].children, r, t))
          : "softbreak" === e[s].type && (n += "\n");
      return n;
    }),
    (I.prototype.render = function (e, r, t) {
      var n,
        s,
        o,
        i = "",
        a = this.rules;
      for (n = 0, s = e.length; n < s; n++)
        "inline" === (o = e[n].type)
          ? (i += this.renderInline(e[n].children, r, t))
          : void 0 !== a[o]
          ? (i += a[e[n].type](e, n, r, t, this))
          : (i += this.renderToken(e, n, r, t));
      return i;
    });
  var M = I;
  function R() {
    (this.__rules__ = []), (this.__cache__ = null);
  }
  (R.prototype.__find__ = function (e) {
    for (var r = 0; r < this.__rules__.length; r++)
      if (this.__rules__[r].name === e) return r;
    return -1;
  }),
    (R.prototype.__compile__ = function () {
      var e = this,
        r = [""];
      e.__rules__.forEach(function (e) {
        e.enabled &&
          e.alt.forEach(function (e) {
            r.indexOf(e) < 0 && r.push(e);
          });
      }),
        (e.__cache__ = {}),
        r.forEach(function (r) {
          (e.__cache__[r] = []),
            e.__rules__.forEach(function (t) {
              t.enabled &&
                ((r && t.alt.indexOf(r) < 0) || e.__cache__[r].push(t.fn));
            });
        });
    }),
    (R.prototype.at = function (e, r, t) {
      var n = this.__find__(e),
        s = t || {};
      if (-1 === n) throw new Error("Parser rule not found: " + e);
      (this.__rules__[n].fn = r),
        (this.__rules__[n].alt = s.alt || []),
        (this.__cache__ = null);
    }),
    (R.prototype.before = function (e, r, t, n) {
      var s = this.__find__(e),
        o = n || {};
      if (-1 === s) throw new Error("Parser rule not found: " + e);
      this.__rules__.splice(s, 0, {
        name: r,
        enabled: !0,
        fn: t,
        alt: o.alt || [],
      }),
        (this.__cache__ = null);
    }),
    (R.prototype.after = function (e, r, t, n) {
      var s = this.__find__(e),
        o = n || {};
      if (-1 === s) throw new Error("Parser rule not found: " + e);
      this.__rules__.splice(s + 1, 0, {
        name: r,
        enabled: !0,
        fn: t,
        alt: o.alt || [],
      }),
        (this.__cache__ = null);
    }),
    (R.prototype.push = function (e, r, t) {
      var n = t || {};
      this.__rules__.push({ name: e, enabled: !0, fn: r, alt: n.alt || [] }),
        (this.__cache__ = null);
    }),
    (R.prototype.enable = function (e, r) {
      Array.isArray(e) || (e = [e]);
      var t = [];
      return (
        e.forEach(function (e) {
          var n = this.__find__(e);
          if (n < 0) {
            if (r) return;
            throw new Error("Rules manager: invalid rule name " + e);
          }
          (this.__rules__[n].enabled = !0), t.push(e);
        }, this),
        (this.__cache__ = null),
        t
      );
    }),
    (R.prototype.enableOnly = function (e, r) {
      Array.isArray(e) || (e = [e]),
        this.__rules__.forEach(function (e) {
          e.enabled = !1;
        }),
        this.enable(e, r);
    }),
    (R.prototype.disable = function (e, r) {
      Array.isArray(e) || (e = [e]);
      var t = [];
      return (
        e.forEach(function (e) {
          var n = this.__find__(e);
          if (n < 0) {
            if (r) return;
            throw new Error("Rules manager: invalid rule name " + e);
          }
          (this.__rules__[n].enabled = !1), t.push(e);
        }, this),
        (this.__cache__ = null),
        t
      );
    }),
    (R.prototype.getRules = function (e) {
      return (
        null === this.__cache__ && this.__compile__(), this.__cache__[e] || []
      );
    });
  var B = R,
    N = /\r\n?|\n/g,
    O = /\0/g,
    P = w.arrayReplaceAt;
  function j(e) {
    return /^<\/a\s*>/i.test(e);
  }
  var U = /\+-|\.\.|\?\?\?\?|!!!!|,,|--/,
    V = /\((c|tm|r|p)\)/i,
    Z = /\((c|tm|r|p)\)/gi,
    G = { c: "\xa9", r: "\xae", p: "\xa7", tm: "\u2122" };
  function $(e, r) {
    return G[r.toLowerCase()];
  }
  function H(e) {
    var r,
      t,
      n = 0;
    for (r = e.length - 1; r >= 0; r--)
      "text" !== (t = e[r]).type || n || (t.content = t.content.replace(Z, $)),
        "link_open" === t.type && "auto" === t.info && n--,
        "link_close" === t.type && "auto" === t.info && n++;
  }
  function J(e) {
    var r,
      t,
      n = 0;
    for (r = e.length - 1; r >= 0; r--)
      "text" !== (t = e[r]).type ||
        n ||
        (U.test(t.content) &&
          (t.content = t.content
            .replace(/\+-/g, "\xb1")
            .replace(/\.{2,}/g, "\u2026")
            .replace(/([?!])\u2026/g, "$1..")
            .replace(/([?!]){4,}/g, "$1$1$1")
            .replace(/,{2,}/g, ",")
            .replace(/(^|[^-])---(?=[^-]|$)/gm, "$1\u2014")
            .replace(/(^|\s)--(?=\s|$)/gm, "$1\u2013")
            .replace(/(^|[^-\s])--(?=[^-\s]|$)/gm, "$1\u2013"))),
        "link_open" === t.type && "auto" === t.info && n--,
        "link_close" === t.type && "auto" === t.info && n++;
  }
  var W = w.isWhiteSpace,
    Y = w.isPunctChar,
    K = w.isMdAsciiPunct,
    Q = /['"]/,
    X = /['"]/g;
  function ee(e, r, t) {
    return e.substr(0, r) + t + e.substr(r + 1);
  }
  function re(e, r) {
    var t, n, s, o, i, a, c, l, u, p, h, f, d, m, g, _, b, k, v, C, y;
    for (v = [], t = 0; t < e.length; t++) {
      for (
        n = e[t], c = e[t].level, b = v.length - 1;
        b >= 0 && !(v[b].level <= c);
        b--
      );
      if (((v.length = b + 1), "text" === n.type)) {
        (i = 0), (a = (s = n.content).length);
        e: for (; i < a && ((X.lastIndex = i), (o = X.exec(s))); ) {
          if (
            ((g = _ = !0),
            (i = o.index + 1),
            (k = "'" === o[0]),
            (u = 32),
            o.index - 1 >= 0)
          )
            u = s.charCodeAt(o.index - 1);
          else
            for (
              b = t - 1;
              b >= 0 && "softbreak" !== e[b].type && "hardbreak" !== e[b].type;
              b--
            )
              if (e[b].content) {
                u = e[b].content.charCodeAt(e[b].content.length - 1);
                break;
              }
          if (((p = 32), i < a)) p = s.charCodeAt(i);
          else
            for (
              b = t + 1;
              b < e.length &&
              "softbreak" !== e[b].type &&
              "hardbreak" !== e[b].type;
              b++
            )
              if (e[b].content) {
                p = e[b].content.charCodeAt(0);
                break;
              }
          if (
            ((h = K(u) || Y(String.fromCharCode(u))),
            (f = K(p) || Y(String.fromCharCode(p))),
            (d = W(u)),
            (m = W(p)) ? (g = !1) : f && (d || h || (g = !1)),
            d ? (_ = !1) : h && (m || f || (_ = !1)),
            34 === p && '"' === o[0] && u >= 48 && u <= 57 && (_ = g = !1),
            g && _ && ((g = h), (_ = f)),
            g || _)
          ) {
            if (_)
              for (
                b = v.length - 1;
                b >= 0 && ((l = v[b]), !(v[b].level < c));
                b--
              )
                if (l.single === k && v[b].level === c) {
                  (l = v[b]),
                    k
                      ? ((C = r.md.options.quotes[2]),
                        (y = r.md.options.quotes[3]))
                      : ((C = r.md.options.quotes[0]),
                        (y = r.md.options.quotes[1])),
                    (n.content = ee(n.content, o.index, y)),
                    (e[l.token].content = ee(e[l.token].content, l.pos, C)),
                    (i += y.length - 1),
                    l.token === t && (i += C.length - 1),
                    (a = (s = n.content).length),
                    (v.length = b);
                  continue e;
                }
            g
              ? v.push({ token: t, pos: o.index, single: k, level: c })
              : _ && k && (n.content = ee(n.content, o.index, "\u2019"));
          } else k && (n.content = ee(n.content, o.index, "\u2019"));
        }
      }
    }
  }
  function te(e, r, t) {
    (this.type = e),
      (this.tag = r),
      (this.attrs = null),
      (this.map = null),
      (this.nesting = t),
      (this.level = 0),
      (this.children = null),
      (this.content = ""),
      (this.markup = ""),
      (this.info = ""),
      (this.meta = null),
      (this.block = !1),
      (this.hidden = !1);
  }
  (te.prototype.attrIndex = function (e) {
    var r, t, n;
    if (!this.attrs) return -1;
    for (t = 0, n = (r = this.attrs).length; t < n; t++)
      if (r[t][0] === e) return t;
    return -1;
  }),
    (te.prototype.attrPush = function (e) {
      this.attrs ? this.attrs.push(e) : (this.attrs = [e]);
    }),
    (te.prototype.attrSet = function (e, r) {
      var t = this.attrIndex(e),
        n = [e, r];
      t < 0 ? this.attrPush(n) : (this.attrs[t] = n);
    }),
    (te.prototype.attrGet = function (e) {
      var r = this.attrIndex(e),
        t = null;
      return r >= 0 && (t = this.attrs[r][1]), t;
    }),
    (te.prototype.attrJoin = function (e, r) {
      var t = this.attrIndex(e);
      t < 0
        ? this.attrPush([e, r])
        : (this.attrs[t][1] = this.attrs[t][1] + " " + r);
    });
  var ne = te;
  function se(e, r, t) {
    (this.src = e),
      (this.env = t),
      (this.tokens = []),
      (this.inlineMode = !1),
      (this.md = r);
  }
  se.prototype.Token = ne;
  var oe = se,
    ie = [
      [
        "normalize",
        function (e) {
          var r;
          (r = (r = e.src.replace(N, "\n")).replace(O, "\ufffd")), (e.src = r);
        },
      ],
      [
        "block",
        function (e) {
          var r;
          e.inlineMode
            ? (((r = new e.Token("inline", "", 0)).content = e.src),
              (r.map = [0, 1]),
              (r.children = []),
              e.tokens.push(r))
            : e.md.block.parse(e.src, e.md, e.env, e.tokens);
        },
      ],
      [
        "inline",
        function (e) {
          var r,
            t,
            n,
            s = e.tokens;
          for (t = 0, n = s.length; t < n; t++)
            "inline" === (r = s[t]).type &&
              e.md.inline.parse(r.content, e.md, e.env, r.children);
        },
      ],
      [
        "linkify",
        function (e) {
          var r,
            t,
            n,
            s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f,
            d,
            m,
            g,
            _,
            b,
            k = e.tokens;
          if (e.md.options.linkify)
            for (t = 0, n = k.length; t < n; t++)
              if ("inline" === k[t].type && e.md.linkify.pretest(k[t].content))
                for (f = 0, r = (s = k[t].children).length - 1; r >= 0; r--)
                  if ("link_close" !== (i = s[r]).type) {
                    if (
                      ("html_inline" === i.type &&
                        ((b = i.content),
                        /^<a[>\s]/i.test(b) && f > 0 && f--,
                        j(i.content) && f++),
                      !(f > 0) &&
                        "text" === i.type &&
                        e.md.linkify.test(i.content))
                    ) {
                      for (
                        l = i.content,
                          _ = e.md.linkify.match(l),
                          a = [],
                          h = i.level,
                          p = 0,
                          c = 0;
                        c < _.length;
                        c++
                      )
                        (d = _[c].url),
                          (m = e.md.normalizeLink(d)),
                          e.md.validateLink(m) &&
                            ((g = _[c].text),
                            (g = _[c].schema
                              ? "mailto:" !== _[c].schema || /^mailto:/i.test(g)
                                ? e.md.normalizeLinkText(g)
                                : e.md
                                    .normalizeLinkText("mailto:" + g)
                                    .replace(/^mailto:/, "")
                              : e.md
                                  .normalizeLinkText("http://" + g)
                                  .replace(/^http:\/\//, "")),
                            (u = _[c].index) > p &&
                              (((o = new e.Token("text", "", 0)).content =
                                l.slice(p, u)),
                              (o.level = h),
                              a.push(o)),
                            ((o = new e.Token("link_open", "a", 1)).attrs = [
                              ["href", m],
                            ]),
                            (o.level = h++),
                            (o.markup = "linkify"),
                            (o.info = "auto"),
                            a.push(o),
                            ((o = new e.Token("text", "", 0)).content = g),
                            (o.level = h),
                            a.push(o),
                            ((o = new e.Token("link_close", "a", -1)).level =
                              --h),
                            (o.markup = "linkify"),
                            (o.info = "auto"),
                            a.push(o),
                            (p = _[c].lastIndex));
                      p < l.length &&
                        (((o = new e.Token("text", "", 0)).content =
                          l.slice(p)),
                        (o.level = h),
                        a.push(o)),
                        (k[t].children = s = P(s, r, a));
                    }
                  } else
                    for (
                      r--;
                      s[r].level !== i.level && "link_open" !== s[r].type;

                    )
                      r--;
        },
      ],
      [
        "replacements",
        function (e) {
          var r;
          if (e.md.options.typographer)
            for (r = e.tokens.length - 1; r >= 0; r--)
              "inline" === e.tokens[r].type &&
                (V.test(e.tokens[r].content) && H(e.tokens[r].children),
                U.test(e.tokens[r].content) && J(e.tokens[r].children));
        },
      ],
      [
        "smartquotes",
        function (e) {
          var r;
          if (e.md.options.typographer)
            for (r = e.tokens.length - 1; r >= 0; r--)
              "inline" === e.tokens[r].type &&
                Q.test(e.tokens[r].content) &&
                re(e.tokens[r].children, e);
        },
      ],
    ];
  function ae() {
    this.ruler = new B();
    for (var e = 0; e < ie.length; e++) this.ruler.push(ie[e][0], ie[e][1]);
  }
  (ae.prototype.process = function (e) {
    var r, t, n;
    for (r = 0, t = (n = this.ruler.getRules("")).length; r < t; r++) n[r](e);
  }),
    (ae.prototype.State = oe);
  var ce = ae,
    le = w.isSpace;
  function ue(e, r) {
    var t = e.bMarks[r] + e.tShift[r],
      n = e.eMarks[r];
    return e.src.substr(t, n - t);
  }
  function pe(e) {
    var r,
      t = [],
      n = 0,
      s = e.length,
      o = !1,
      i = 0,
      a = "";
    for (r = e.charCodeAt(n); n < s; )
      124 === r &&
        (o
          ? ((a += e.substring(i, n - 1)), (i = n))
          : (t.push(a + e.substring(i, n)), (a = ""), (i = n + 1))),
        (o = 92 === r),
        n++,
        (r = e.charCodeAt(n));
    return t.push(a + e.substring(i)), t;
  }
  var he = w.isSpace,
    fe = w.isSpace,
    de = w.isSpace;
  function me(e, r) {
    var t, n, s, o;
    return (
      (n = e.bMarks[r] + e.tShift[r]),
      (s = e.eMarks[r]),
      (42 !== (t = e.src.charCodeAt(n++)) && 45 !== t && 43 !== t) ||
      (n < s && ((o = e.src.charCodeAt(n)), !de(o)))
        ? -1
        : n
    );
  }
  function ge(e, r) {
    var t,
      n = e.bMarks[r] + e.tShift[r],
      s = n,
      o = e.eMarks[r];
    if (s + 1 >= o) return -1;
    if ((t = e.src.charCodeAt(s++)) < 48 || t > 57) return -1;
    for (;;) {
      if (s >= o) return -1;
      if (!((t = e.src.charCodeAt(s++)) >= 48 && t <= 57)) {
        if (41 === t || 46 === t) break;
        return -1;
      }
      if (s - n >= 10) return -1;
    }
    return s < o && ((t = e.src.charCodeAt(s)), !de(t)) ? -1 : s;
  }
  var _e = w.normalizeReference,
    be = w.isSpace,
    ke =
      "<[A-Za-z][A-Za-z0-9\\-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*\\/?>",
    ve = "<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",
    Ce = {
      HTML_TAG_RE: new RegExp(
        "^(?:" +
          ke +
          "|" +
          ve +
          "|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|<[?][\\s\\S]*?[?]>|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"
      ),
      HTML_OPEN_CLOSE_TAG_RE: new RegExp("^(?:" + ke + "|" + ve + ")"),
    },
    ye = Ce.HTML_OPEN_CLOSE_TAG_RE,
    Ae = [
      [
        /^<(script|pre|style|textarea)(?=(\s|>|$))/i,
        /<\/(script|pre|style|textarea)>/i,
        !0,
      ],
      [/^<!--/, /-->/, !0],
      [/^<\?/, /\?>/, !0],
      [/^<![A-Z]/, />/, !0],
      [/^<!\[CDATA\[/, /\]\]>/, !0],
      [
        new RegExp(
          "^</?(" +
            [
              "address",
              "article",
              "aside",
              "base",
              "basefont",
              "blockquote",
              "body",
              "caption",
              "center",
              "col",
              "colgroup",
              "dd",
              "details",
              "dialog",
              "dir",
              "div",
              "dl",
              "dt",
              "fieldset",
              "figcaption",
              "figure",
              "footer",
              "form",
              "frame",
              "frameset",
              "h1",
              "h2",
              "h3",
              "h4",
              "h5",
              "h6",
              "head",
              "header",
              "hr",
              "html",
              "iframe",
              "legend",
              "li",
              "link",
              "main",
              "menu",
              "menuitem",
              "nav",
              "noframes",
              "ol",
              "optgroup",
              "option",
              "p",
              "param",
              "section",
              "source",
              "summary",
              "table",
              "tbody",
              "td",
              "tfoot",
              "th",
              "thead",
              "title",
              "tr",
              "track",
              "ul",
            ].join("|") +
            ")(?=(\\s|/?>|$))",
          "i"
        ),
        /^$/,
        !0,
      ],
      [new RegExp(ye.source + "\\s*$"), /^$/, !1],
    ],
    xe = w.isSpace,
    De = w.isSpace;
  function we(e, r, t, n) {
    var s, o, i, a, c, l, u, p;
    for (
      this.src = e,
        this.md = r,
        this.env = t,
        this.tokens = n,
        this.bMarks = [],
        this.eMarks = [],
        this.tShift = [],
        this.sCount = [],
        this.bsCount = [],
        this.blkIndent = 0,
        this.line = 0,
        this.lineMax = 0,
        this.tight = !1,
        this.ddIndent = -1,
        this.listIndent = -1,
        this.parentType = "root",
        this.level = 0,
        this.result = "",
        p = !1,
        i = a = l = u = 0,
        c = (o = this.src).length;
      a < c;
      a++
    ) {
      if (((s = o.charCodeAt(a)), !p)) {
        if (De(s)) {
          l++, 9 === s ? (u += 4 - (u % 4)) : u++;
          continue;
        }
        p = !0;
      }
      (10 !== s && a !== c - 1) ||
        (10 !== s && a++,
        this.bMarks.push(i),
        this.eMarks.push(a),
        this.tShift.push(l),
        this.sCount.push(u),
        this.bsCount.push(0),
        (p = !1),
        (l = 0),
        (u = 0),
        (i = a + 1));
    }
    this.bMarks.push(o.length),
      this.eMarks.push(o.length),
      this.tShift.push(0),
      this.sCount.push(0),
      this.bsCount.push(0),
      (this.lineMax = this.bMarks.length - 1);
  }
  (we.prototype.push = function (e, r, t) {
    var n = new ne(e, r, t);
    return (
      (n.block = !0),
      t < 0 && this.level--,
      (n.level = this.level),
      t > 0 && this.level++,
      this.tokens.push(n),
      n
    );
  }),
    (we.prototype.isEmpty = function (e) {
      return this.bMarks[e] + this.tShift[e] >= this.eMarks[e];
    }),
    (we.prototype.skipEmptyLines = function (e) {
      for (
        var r = this.lineMax;
        e < r && !(this.bMarks[e] + this.tShift[e] < this.eMarks[e]);
        e++
      );
      return e;
    }),
    (we.prototype.skipSpaces = function (e) {
      for (
        var r, t = this.src.length;
        e < t && ((r = this.src.charCodeAt(e)), De(r));
        e++
      );
      return e;
    }),
    (we.prototype.skipSpacesBack = function (e, r) {
      if (e <= r) return e;
      for (; e > r; ) if (!De(this.src.charCodeAt(--e))) return e + 1;
      return e;
    }),
    (we.prototype.skipChars = function (e, r) {
      for (var t = this.src.length; e < t && this.src.charCodeAt(e) === r; e++);
      return e;
    }),
    (we.prototype.skipCharsBack = function (e, r, t) {
      if (e <= t) return e;
      for (; e > t; ) if (r !== this.src.charCodeAt(--e)) return e + 1;
      return e;
    }),
    (we.prototype.getLines = function (e, r, t, n) {
      var s,
        o,
        i,
        a,
        c,
        l,
        u,
        p = e;
      if (e >= r) return "";
      for (l = new Array(r - e), s = 0; p < r; p++, s++) {
        for (
          o = 0,
            u = a = this.bMarks[p],
            c = p + 1 < r || n ? this.eMarks[p] + 1 : this.eMarks[p];
          a < c && o < t;

        ) {
          if (((i = this.src.charCodeAt(a)), De(i)))
            9 === i ? (o += 4 - ((o + this.bsCount[p]) % 4)) : o++;
          else {
            if (!(a - u < this.tShift[p])) break;
            o++;
          }
          a++;
        }
        l[s] =
          o > t
            ? new Array(o - t + 1).join(" ") + this.src.slice(a, c)
            : this.src.slice(a, c);
      }
      return l.join("");
    }),
    (we.prototype.Token = ne);
  var Ee = we,
    qe = [
      [
        "table",
        function (e, r, t, n) {
          var s, o, i, a, c, l, u, p, h, f, d, m, g, _, b, k, v, C;
          if (r + 2 > t) return !1;
          if (((l = r + 1), e.sCount[l] < e.blkIndent)) return !1;
          if (e.sCount[l] - e.blkIndent >= 4) return !1;
          if ((i = e.bMarks[l] + e.tShift[l]) >= e.eMarks[l]) return !1;
          if (124 !== (v = e.src.charCodeAt(i++)) && 45 !== v && 58 !== v)
            return !1;
          if (i >= e.eMarks[l]) return !1;
          if (
            124 !== (C = e.src.charCodeAt(i++)) &&
            45 !== C &&
            58 !== C &&
            !le(C)
          )
            return !1;
          if (45 === v && le(C)) return !1;
          for (; i < e.eMarks[l]; ) {
            if (
              124 !== (s = e.src.charCodeAt(i)) &&
              45 !== s &&
              58 !== s &&
              !le(s)
            )
              return !1;
            i++;
          }
          for (
            u = (o = ue(e, r + 1)).split("|"), f = [], a = 0;
            a < u.length;
            a++
          ) {
            if (!(d = u[a].trim())) {
              if (0 === a || a === u.length - 1) continue;
              return !1;
            }
            if (!/^:?-+:?$/.test(d)) return !1;
            58 === d.charCodeAt(d.length - 1)
              ? f.push(58 === d.charCodeAt(0) ? "center" : "right")
              : 58 === d.charCodeAt(0)
              ? f.push("left")
              : f.push("");
          }
          if (-1 === (o = ue(e, r).trim()).indexOf("|")) return !1;
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (
            ((u = pe(o)).length && "" === u[0] && u.shift(),
            u.length && "" === u[u.length - 1] && u.pop(),
            0 === (p = u.length) || p !== f.length)
          )
            return !1;
          if (n) return !0;
          for (
            _ = e.parentType,
              e.parentType = "table",
              k = e.md.block.ruler.getRules("blockquote"),
              (h = e.push("table_open", "table", 1)).map = m = [r, 0],
              (h = e.push("thead_open", "thead", 1)).map = [r, r + 1],
              (h = e.push("tr_open", "tr", 1)).map = [r, r + 1],
              a = 0;
            a < u.length;
            a++
          )
            (h = e.push("th_open", "th", 1)),
              f[a] && (h.attrs = [["style", "text-align:" + f[a]]]),
              ((h = e.push("inline", "", 0)).content = u[a].trim()),
              (h.children = []),
              (h = e.push("th_close", "th", -1));
          for (
            h = e.push("tr_close", "tr", -1),
              h = e.push("thead_close", "thead", -1),
              l = r + 2;
            l < t && !(e.sCount[l] < e.blkIndent);
            l++
          ) {
            for (b = !1, a = 0, c = k.length; a < c; a++)
              if (k[a](e, l, t, !0)) {
                b = !0;
                break;
              }
            if (b) break;
            if (!(o = ue(e, l).trim())) break;
            if (e.sCount[l] - e.blkIndent >= 4) break;
            for (
              (u = pe(o)).length && "" === u[0] && u.shift(),
                u.length && "" === u[u.length - 1] && u.pop(),
                l === r + 2 &&
                  ((h = e.push("tbody_open", "tbody", 1)).map = g = [r + 2, 0]),
                (h = e.push("tr_open", "tr", 1)).map = [l, l + 1],
                a = 0;
              a < p;
              a++
            )
              (h = e.push("td_open", "td", 1)),
                f[a] && (h.attrs = [["style", "text-align:" + f[a]]]),
                ((h = e.push("inline", "", 0)).content = u[a]
                  ? u[a].trim()
                  : ""),
                (h.children = []),
                (h = e.push("td_close", "td", -1));
            h = e.push("tr_close", "tr", -1);
          }
          return (
            g && ((h = e.push("tbody_close", "tbody", -1)), (g[1] = l)),
            (h = e.push("table_close", "table", -1)),
            (m[1] = l),
            (e.parentType = _),
            (e.line = l),
            !0
          );
        },
        ["paragraph", "reference"],
      ],
      [
        "code",
        function (e, r, t) {
          var n, s, o;
          if (e.sCount[r] - e.blkIndent < 4) return !1;
          for (s = n = r + 1; n < t; )
            if (e.isEmpty(n)) n++;
            else {
              if (!(e.sCount[n] - e.blkIndent >= 4)) break;
              s = ++n;
            }
          return (
            (e.line = s),
            ((o = e.push("code_block", "code", 0)).content =
              e.getLines(r, s, 4 + e.blkIndent, !1) + "\n"),
            (o.map = [r, e.line]),
            !0
          );
        },
      ],
      [
        "fence",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c,
            l,
            u,
            p = !1,
            h = e.bMarks[r] + e.tShift[r],
            f = e.eMarks[r];
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (h + 3 > f) return !1;
          if (126 !== (s = e.src.charCodeAt(h)) && 96 !== s) return !1;
          if (((c = h), (o = (h = e.skipChars(h, s)) - c) < 3)) return !1;
          if (
            ((u = e.src.slice(c, h)),
            (i = e.src.slice(h, f)),
            96 === s && i.indexOf(String.fromCharCode(s)) >= 0)
          )
            return !1;
          if (n) return !0;
          for (
            a = r;
            !(++a >= t) &&
            !(
              (h = c = e.bMarks[a] + e.tShift[a]) < (f = e.eMarks[a]) &&
              e.sCount[a] < e.blkIndent
            );

          )
            if (
              e.src.charCodeAt(h) === s &&
              !(
                e.sCount[a] - e.blkIndent >= 4 ||
                (h = e.skipChars(h, s)) - c < o ||
                (h = e.skipSpaces(h)) < f
              )
            ) {
              p = !0;
              break;
            }
          return (
            (o = e.sCount[r]),
            (e.line = a + (p ? 1 : 0)),
            ((l = e.push("fence", "code", 0)).info = i),
            (l.content = e.getLines(r + 1, a, o, !0)),
            (l.markup = u),
            (l.map = [r, e.line]),
            !0
          );
        },
        ["paragraph", "reference", "blockquote", "list"],
      ],
      [
        "blockquote",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f,
            d,
            m,
            g,
            _,
            b,
            k,
            v,
            C,
            y,
            A,
            x = e.lineMax,
            D = e.bMarks[r] + e.tShift[r],
            w = e.eMarks[r];
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (62 !== e.src.charCodeAt(D++)) return !1;
          if (n) return !0;
          for (
            a = h = e.sCount[r] + 1,
              32 === e.src.charCodeAt(D)
                ? (D++, a++, h++, (s = !1), (k = !0))
                : 9 === e.src.charCodeAt(D)
                ? ((k = !0),
                  (e.bsCount[r] + h) % 4 == 3
                    ? (D++, a++, h++, (s = !1))
                    : (s = !0))
                : (k = !1),
              f = [e.bMarks[r]],
              e.bMarks[r] = D;
            D < w && ((o = e.src.charCodeAt(D)), he(o));

          )
            9 === o ? (h += 4 - ((h + e.bsCount[r] + (s ? 1 : 0)) % 4)) : h++,
              D++;
          for (
            d = [e.bsCount[r]],
              e.bsCount[r] = e.sCount[r] + 1 + (k ? 1 : 0),
              l = D >= w,
              _ = [e.sCount[r]],
              e.sCount[r] = h - a,
              b = [e.tShift[r]],
              e.tShift[r] = D - e.bMarks[r],
              C = e.md.block.ruler.getRules("blockquote"),
              g = e.parentType,
              e.parentType = "blockquote",
              p = r + 1;
            p < t &&
            ((A = e.sCount[p] < e.blkIndent),
            !((D = e.bMarks[p] + e.tShift[p]) >= (w = e.eMarks[p])));
            p++
          )
            if (62 !== e.src.charCodeAt(D++) || A) {
              if (l) break;
              for (v = !1, i = 0, c = C.length; i < c; i++)
                if (C[i](e, p, t, !0)) {
                  v = !0;
                  break;
                }
              if (v) {
                (e.lineMax = p),
                  0 !== e.blkIndent &&
                    (f.push(e.bMarks[p]),
                    d.push(e.bsCount[p]),
                    b.push(e.tShift[p]),
                    _.push(e.sCount[p]),
                    (e.sCount[p] -= e.blkIndent));
                break;
              }
              f.push(e.bMarks[p]),
                d.push(e.bsCount[p]),
                b.push(e.tShift[p]),
                _.push(e.sCount[p]),
                (e.sCount[p] = -1);
            } else {
              for (
                a = h = e.sCount[p] + 1,
                  32 === e.src.charCodeAt(D)
                    ? (D++, a++, h++, (s = !1), (k = !0))
                    : 9 === e.src.charCodeAt(D)
                    ? ((k = !0),
                      (e.bsCount[p] + h) % 4 == 3
                        ? (D++, a++, h++, (s = !1))
                        : (s = !0))
                    : (k = !1),
                  f.push(e.bMarks[p]),
                  e.bMarks[p] = D;
                D < w && ((o = e.src.charCodeAt(D)), he(o));

              )
                9 === o
                  ? (h += 4 - ((h + e.bsCount[p] + (s ? 1 : 0)) % 4))
                  : h++,
                  D++;
              (l = D >= w),
                d.push(e.bsCount[p]),
                (e.bsCount[p] = e.sCount[p] + 1 + (k ? 1 : 0)),
                _.push(e.sCount[p]),
                (e.sCount[p] = h - a),
                b.push(e.tShift[p]),
                (e.tShift[p] = D - e.bMarks[p]);
            }
          for (
            m = e.blkIndent,
              e.blkIndent = 0,
              (y = e.push("blockquote_open", "blockquote", 1)).markup = ">",
              y.map = u = [r, 0],
              e.md.block.tokenize(e, r, p),
              (y = e.push("blockquote_close", "blockquote", -1)).markup = ">",
              e.lineMax = x,
              e.parentType = g,
              u[1] = e.line,
              i = 0;
            i < b.length;
            i++
          )
            (e.bMarks[i + r] = f[i]),
              (e.tShift[i + r] = b[i]),
              (e.sCount[i + r] = _[i]),
              (e.bsCount[i + r] = d[i]);
          return (e.blkIndent = m), !0;
        },
        ["paragraph", "reference", "blockquote", "list"],
      ],
      [
        "hr",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c = e.bMarks[r] + e.tShift[r],
            l = e.eMarks[r];
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (42 !== (s = e.src.charCodeAt(c++)) && 45 !== s && 95 !== s)
            return !1;
          for (o = 1; c < l; ) {
            if ((i = e.src.charCodeAt(c++)) !== s && !fe(i)) return !1;
            i === s && o++;
          }
          return (
            !(o < 3) &&
            (n ||
              ((e.line = r + 1),
              ((a = e.push("hr", "hr", 0)).map = [r, e.line]),
              (a.markup = Array(o + 1).join(String.fromCharCode(s)))),
            !0)
          );
        },
        ["paragraph", "reference", "blockquote", "list"],
      ],
      [
        "list",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f,
            d,
            m,
            g,
            _,
            b,
            k,
            v,
            C,
            y,
            A,
            x,
            D,
            w,
            E,
            q,
            S,
            F,
            L,
            z = !1,
            T = !0;
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (
            e.listIndent >= 0 &&
            e.sCount[r] - e.listIndent >= 4 &&
            e.sCount[r] < e.blkIndent
          )
            return !1;
          if (
            (n &&
              "paragraph" === e.parentType &&
              e.tShift[r] >= e.blkIndent &&
              (z = !0),
            (w = ge(e, r)) >= 0)
          ) {
            if (
              ((u = !0),
              (q = e.bMarks[r] + e.tShift[r]),
              (g = Number(e.src.slice(q, w - 1))),
              z && 1 !== g)
            )
              return !1;
          } else {
            if (!((w = me(e, r)) >= 0)) return !1;
            u = !1;
          }
          if (z && e.skipSpaces(w) >= e.eMarks[r]) return !1;
          if (((m = e.src.charCodeAt(w - 1)), n)) return !0;
          for (
            d = e.tokens.length,
              u
                ? ((L = e.push("ordered_list_open", "ol", 1)),
                  1 !== g && (L.attrs = [["start", g]]))
                : (L = e.push("bullet_list_open", "ul", 1)),
              L.map = f = [r, 0],
              L.markup = String.fromCharCode(m),
              b = r,
              E = !1,
              F = e.md.block.ruler.getRules("list"),
              C = e.parentType,
              e.parentType = "list";
            b < t;

          ) {
            for (
              D = w,
                _ = e.eMarks[b],
                l = k = e.sCount[b] + w - (e.bMarks[r] + e.tShift[r]);
              D < _;

            ) {
              if (9 === (s = e.src.charCodeAt(D)))
                k += 4 - ((k + e.bsCount[b]) % 4);
              else {
                if (32 !== s) break;
                k++;
              }
              D++;
            }
            if (
              ((c = (o = D) >= _ ? 1 : k - l) > 4 && (c = 1),
              (a = l + c),
              ((L = e.push("list_item_open", "li", 1)).markup =
                String.fromCharCode(m)),
              (L.map = p = [r, 0]),
              u && (L.info = e.src.slice(q, w - 1)),
              (x = e.tight),
              (A = e.tShift[r]),
              (y = e.sCount[r]),
              (v = e.listIndent),
              (e.listIndent = e.blkIndent),
              (e.blkIndent = a),
              (e.tight = !0),
              (e.tShift[r] = o - e.bMarks[r]),
              (e.sCount[r] = k),
              o >= _ && e.isEmpty(r + 1)
                ? (e.line = Math.min(e.line + 2, t))
                : e.md.block.tokenize(e, r, t, !0),
              (e.tight && !E) || (T = !1),
              (E = e.line - r > 1 && e.isEmpty(e.line - 1)),
              (e.blkIndent = e.listIndent),
              (e.listIndent = v),
              (e.tShift[r] = A),
              (e.sCount[r] = y),
              (e.tight = x),
              ((L = e.push("list_item_close", "li", -1)).markup =
                String.fromCharCode(m)),
              (b = r = e.line),
              (p[1] = b),
              (o = e.bMarks[r]),
              b >= t)
            )
              break;
            if (e.sCount[b] < e.blkIndent) break;
            if (e.sCount[r] - e.blkIndent >= 4) break;
            for (S = !1, i = 0, h = F.length; i < h; i++)
              if (F[i](e, b, t, !0)) {
                S = !0;
                break;
              }
            if (S) break;
            if (u) {
              if ((w = ge(e, b)) < 0) break;
              q = e.bMarks[b] + e.tShift[b];
            } else if ((w = me(e, b)) < 0) break;
            if (m !== e.src.charCodeAt(w - 1)) break;
          }
          return (
            ((L = u
              ? e.push("ordered_list_close", "ol", -1)
              : e.push("bullet_list_close", "ul", -1)).markup =
              String.fromCharCode(m)),
            (f[1] = b),
            (e.line = b),
            (e.parentType = C),
            T &&
              (function (e, r) {
                var t,
                  n,
                  s = e.level + 2;
                for (t = r + 2, n = e.tokens.length - 2; t < n; t++)
                  e.tokens[t].level === s &&
                    "paragraph_open" === e.tokens[t].type &&
                    ((e.tokens[t + 2].hidden = !0),
                    (e.tokens[t].hidden = !0),
                    (t += 2));
              })(e, d),
            !0
          );
        },
        ["paragraph", "reference", "blockquote"],
      ],
      [
        "reference",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f,
            d,
            m,
            g,
            _,
            b,
            k,
            v = 0,
            C = e.bMarks[r] + e.tShift[r],
            y = e.eMarks[r],
            A = r + 1;
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (91 !== e.src.charCodeAt(C)) return !1;
          for (; ++C < y; )
            if (93 === e.src.charCodeAt(C) && 92 !== e.src.charCodeAt(C - 1)) {
              if (C + 1 === y) return !1;
              if (58 !== e.src.charCodeAt(C + 1)) return !1;
              break;
            }
          for (
            a = e.lineMax,
              b = e.md.block.ruler.getRules("reference"),
              f = e.parentType,
              e.parentType = "reference";
            A < a && !e.isEmpty(A);
            A++
          )
            if (!(e.sCount[A] - e.blkIndent > 3 || e.sCount[A] < 0)) {
              for (_ = !1, l = 0, u = b.length; l < u; l++)
                if (b[l](e, A, a, !0)) {
                  _ = !0;
                  break;
                }
              if (_) break;
            }
          for (
            y = (g = e.getLines(r, A, e.blkIndent, !1).trim()).length, C = 1;
            C < y;
            C++
          ) {
            if (91 === (s = g.charCodeAt(C))) return !1;
            if (93 === s) {
              h = C;
              break;
            }
            (10 === s || (92 === s && ++C < y && 10 === g.charCodeAt(C))) &&
              v++;
          }
          if (h < 0 || 58 !== g.charCodeAt(h + 1)) return !1;
          for (C = h + 2; C < y; C++)
            if (10 === (s = g.charCodeAt(C))) v++;
            else if (!be(s)) break;
          if (!(d = e.md.helpers.parseLinkDestination(g, C, y)).ok) return !1;
          if (((c = e.md.normalizeLink(d.str)), !e.md.validateLink(c)))
            return !1;
          for (o = C = d.pos, i = v += d.lines, m = C; C < y; C++)
            if (10 === (s = g.charCodeAt(C))) v++;
            else if (!be(s)) break;
          for (
            d = e.md.helpers.parseLinkTitle(g, C, y),
              C < y && m !== C && d.ok
                ? ((k = d.str), (C = d.pos), (v += d.lines))
                : ((k = ""), (C = o), (v = i));
            C < y && ((s = g.charCodeAt(C)), be(s));

          )
            C++;
          if (C < y && 10 !== g.charCodeAt(C) && k)
            for (
              k = "", C = o, v = i;
              C < y && ((s = g.charCodeAt(C)), be(s));

            )
              C++;
          return (
            !(C < y && 10 !== g.charCodeAt(C)) &&
            !!(p = _e(g.slice(1, h))) &&
            (n ||
              (void 0 === e.env.references && (e.env.references = {}),
              void 0 === e.env.references[p] &&
                (e.env.references[p] = { title: k, href: c }),
              (e.parentType = f),
              (e.line = r + v + 1)),
            !0)
          );
        },
      ],
      [
        "html_block",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c = e.bMarks[r] + e.tShift[r],
            l = e.eMarks[r];
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (!e.md.options.html) return !1;
          if (60 !== e.src.charCodeAt(c)) return !1;
          for (
            a = e.src.slice(c, l), s = 0;
            s < Ae.length && !Ae[s][0].test(a);
            s++
          );
          if (s === Ae.length) return !1;
          if (n) return Ae[s][2];
          if (((o = r + 1), !Ae[s][1].test(a)))
            for (; o < t && !(e.sCount[o] < e.blkIndent); o++)
              if (
                ((c = e.bMarks[o] + e.tShift[o]),
                (l = e.eMarks[o]),
                (a = e.src.slice(c, l)),
                Ae[s][1].test(a))
              ) {
                0 !== a.length && o++;
                break;
              }
          return (
            (e.line = o),
            ((i = e.push("html_block", "", 0)).map = [r, o]),
            (i.content = e.getLines(r, o, e.blkIndent, !0)),
            !0
          );
        },
        ["paragraph", "reference", "blockquote"],
      ],
      [
        "heading",
        function (e, r, t, n) {
          var s,
            o,
            i,
            a,
            c = e.bMarks[r] + e.tShift[r],
            l = e.eMarks[r];
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          if (35 !== (s = e.src.charCodeAt(c)) || c >= l) return !1;
          for (o = 1, s = e.src.charCodeAt(++c); 35 === s && c < l && o <= 6; )
            o++, (s = e.src.charCodeAt(++c));
          return (
            !(o > 6 || (c < l && !xe(s))) &&
            (n ||
              ((l = e.skipSpacesBack(l, c)),
              (i = e.skipCharsBack(l, 35, c)) > c &&
                xe(e.src.charCodeAt(i - 1)) &&
                (l = i),
              (e.line = r + 1),
              ((a = e.push("heading_open", "h" + String(o), 1)).markup =
                "########".slice(0, o)),
              (a.map = [r, e.line]),
              ((a = e.push("inline", "", 0)).content = e.src
                .slice(c, l)
                .trim()),
              (a.map = [r, e.line]),
              (a.children = []),
              ((a = e.push("heading_close", "h" + String(o), -1)).markup =
                "########".slice(0, o))),
            !0)
          );
        },
        ["paragraph", "reference", "blockquote"],
      ],
      [
        "lheading",
        function (e, r, t) {
          var n,
            s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f = r + 1,
            d = e.md.block.ruler.getRules("paragraph");
          if (e.sCount[r] - e.blkIndent >= 4) return !1;
          for (
            h = e.parentType, e.parentType = "paragraph";
            f < t && !e.isEmpty(f);
            f++
          )
            if (!(e.sCount[f] - e.blkIndent > 3)) {
              if (
                e.sCount[f] >= e.blkIndent &&
                (c = e.bMarks[f] + e.tShift[f]) < (l = e.eMarks[f]) &&
                (45 === (p = e.src.charCodeAt(c)) || 61 === p) &&
                ((c = e.skipChars(c, p)), (c = e.skipSpaces(c)) >= l)
              ) {
                u = 61 === p ? 1 : 2;
                break;
              }
              if (!(e.sCount[f] < 0)) {
                for (s = !1, o = 0, i = d.length; o < i; o++)
                  if (d[o](e, f, t, !0)) {
                    s = !0;
                    break;
                  }
                if (s) break;
              }
            }
          return (
            !!u &&
            ((n = e.getLines(r, f, e.blkIndent, !1).trim()),
            (e.line = f + 1),
            ((a = e.push("heading_open", "h" + String(u), 1)).markup =
              String.fromCharCode(p)),
            (a.map = [r, e.line]),
            ((a = e.push("inline", "", 0)).content = n),
            (a.map = [r, e.line - 1]),
            (a.children = []),
            ((a = e.push("heading_close", "h" + String(u), -1)).markup =
              String.fromCharCode(p)),
            (e.parentType = h),
            !0)
          );
        },
      ],
      [
        "paragraph",
        function (e, r) {
          var t,
            n,
            s,
            o,
            i,
            a,
            c = r + 1,
            l = e.md.block.ruler.getRules("paragraph"),
            u = e.lineMax;
          for (
            a = e.parentType, e.parentType = "paragraph";
            c < u && !e.isEmpty(c);
            c++
          )
            if (!(e.sCount[c] - e.blkIndent > 3 || e.sCount[c] < 0)) {
              for (n = !1, s = 0, o = l.length; s < o; s++)
                if (l[s](e, c, u, !0)) {
                  n = !0;
                  break;
                }
              if (n) break;
            }
          return (
            (t = e.getLines(r, c, e.blkIndent, !1).trim()),
            (e.line = c),
            ((i = e.push("paragraph_open", "p", 1)).map = [r, e.line]),
            ((i = e.push("inline", "", 0)).content = t),
            (i.map = [r, e.line]),
            (i.children = []),
            (i = e.push("paragraph_close", "p", -1)),
            (e.parentType = a),
            !0
          );
        },
      ],
    ];
  function Se() {
    this.ruler = new B();
    for (var e = 0; e < qe.length; e++)
      this.ruler.push(qe[e][0], qe[e][1], { alt: (qe[e][2] || []).slice() });
  }
  (Se.prototype.tokenize = function (e, r, t) {
    for (
      var n,
        s = this.ruler.getRules(""),
        o = s.length,
        i = r,
        a = !1,
        c = e.md.options.maxNesting;
      i < t &&
      ((e.line = i = e.skipEmptyLines(i)), !(i >= t)) &&
      !(e.sCount[i] < e.blkIndent);

    ) {
      if (e.level >= c) {
        e.line = t;
        break;
      }
      for (n = 0; n < o && !s[n](e, i, t, !1); n++);
      (e.tight = !a),
        e.isEmpty(e.line - 1) && (a = !0),
        (i = e.line) < t && e.isEmpty(i) && ((a = !0), i++, (e.line = i));
    }
  }),
    (Se.prototype.parse = function (e, r, t, n) {
      var s;
      e &&
        ((s = new this.State(e, r, t, n)), this.tokenize(s, s.line, s.lineMax));
    }),
    (Se.prototype.State = Ee);
  var Fe = Se;
  function Le(e) {
    switch (e) {
      case 10:
      case 33:
      case 35:
      case 36:
      case 37:
      case 38:
      case 42:
      case 43:
      case 45:
      case 58:
      case 60:
      case 61:
      case 62:
      case 64:
      case 91:
      case 92:
      case 93:
      case 94:
      case 95:
      case 96:
      case 123:
      case 125:
      case 126:
        return !0;
      default:
        return !1;
    }
  }
  for (var ze = w.isSpace, Te = w.isSpace, Ie = [], Me = 0; Me < 256; Me++)
    Ie.push(0);
  "\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function (e) {
    Ie[e.charCodeAt(0)] = 1;
  });
  function Re(e, r) {
    var t,
      n,
      s,
      o,
      i,
      a = [],
      c = r.length;
    for (t = 0; t < c; t++)
      126 === (s = r[t]).marker &&
        -1 !== s.end &&
        ((o = r[s.end]),
        ((i = e.tokens[s.token]).type = "s_open"),
        (i.tag = "s"),
        (i.nesting = 1),
        (i.markup = "~~"),
        (i.content = ""),
        ((i = e.tokens[o.token]).type = "s_close"),
        (i.tag = "s"),
        (i.nesting = -1),
        (i.markup = "~~"),
        (i.content = ""),
        "text" === e.tokens[o.token - 1].type &&
          "~" === e.tokens[o.token - 1].content &&
          a.push(o.token - 1));
    for (; a.length; ) {
      for (
        n = (t = a.pop()) + 1;
        n < e.tokens.length && "s_close" === e.tokens[n].type;

      )
        n++;
      t !== --n &&
        ((i = e.tokens[n]), (e.tokens[n] = e.tokens[t]), (e.tokens[t] = i));
    }
  }
  var Be = {
    tokenize: function (e, r) {
      var t,
        n,
        s,
        o,
        i = e.pos,
        a = e.src.charCodeAt(i);
      if (r) return !1;
      if (126 !== a) return !1;
      if (
        ((s = (n = e.scanDelims(e.pos, !0)).length),
        (o = String.fromCharCode(a)),
        s < 2)
      )
        return !1;
      for (
        s % 2 && ((e.push("text", "", 0).content = o), s--), t = 0;
        t < s;
        t += 2
      )
        (e.push("text", "", 0).content = o + o),
          e.delimiters.push({
            marker: a,
            length: 0,
            jump: t / 2,
            token: e.tokens.length - 1,
            end: -1,
            open: n.can_open,
            close: n.can_close,
          });
      return (e.pos += n.length), !0;
    },
    postProcess: function (e) {
      var r,
        t = e.tokens_meta,
        n = e.tokens_meta.length;
      for (Re(e, e.delimiters), r = 0; r < n; r++)
        t[r] && t[r].delimiters && Re(e, t[r].delimiters);
    },
  };
  function Ne(e, r) {
    var t, n, s, o, i, a;
    for (t = r.length - 1; t >= 0; t--)
      (95 !== (n = r[t]).marker && 42 !== n.marker) ||
        (-1 !== n.end &&
          ((s = r[n.end]),
          (a =
            t > 0 &&
            r[t - 1].end === n.end + 1 &&
            r[t - 1].token === n.token - 1 &&
            r[n.end + 1].token === s.token + 1 &&
            r[t - 1].marker === n.marker),
          (i = String.fromCharCode(n.marker)),
          ((o = e.tokens[n.token]).type = a ? "strong_open" : "em_open"),
          (o.tag = a ? "strong" : "em"),
          (o.nesting = 1),
          (o.markup = a ? i + i : i),
          (o.content = ""),
          ((o = e.tokens[s.token]).type = a ? "strong_close" : "em_close"),
          (o.tag = a ? "strong" : "em"),
          (o.nesting = -1),
          (o.markup = a ? i + i : i),
          (o.content = ""),
          a &&
            ((e.tokens[r[t - 1].token].content = ""),
            (e.tokens[r[n.end + 1].token].content = ""),
            t--)));
  }
  var Oe = {
      tokenize: function (e, r) {
        var t,
          n,
          s = e.pos,
          o = e.src.charCodeAt(s);
        if (r) return !1;
        if (95 !== o && 42 !== o) return !1;
        for (n = e.scanDelims(e.pos, 42 === o), t = 0; t < n.length; t++)
          (e.push("text", "", 0).content = String.fromCharCode(o)),
            e.delimiters.push({
              marker: o,
              length: n.length,
              jump: t,
              token: e.tokens.length - 1,
              end: -1,
              open: n.can_open,
              close: n.can_close,
            });
        return (e.pos += n.length), !0;
      },
      postProcess: function (e) {
        var r,
          t = e.tokens_meta,
          n = e.tokens_meta.length;
        for (Ne(e, e.delimiters), r = 0; r < n; r++)
          t[r] && t[r].delimiters && Ne(e, t[r].delimiters);
      },
    },
    Pe = w.normalizeReference,
    je = w.isSpace,
    Ue = w.normalizeReference,
    Ve = w.isSpace,
    Ze =
      /^([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,
    Ge = /^([a-zA-Z][a-zA-Z0-9+.\-]{1,31}):([^<>\x00-\x20]*)$/,
    $e = Ce.HTML_TAG_RE;
  var He = w.has,
    Je = w.isValidEntityCode,
    We = w.fromCodePoint,
    Ye = /^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,
    Ke = /^&([a-z][a-z0-9]{1,31});/i;
  function Qe(e, r) {
    var t,
      n,
      s,
      o,
      i,
      a,
      c,
      l,
      u = {},
      p = r.length;
    for (t = 0; t < p; t++)
      if ((((s = r[t]).length = s.length || 0), s.close)) {
        for (
          u.hasOwnProperty(s.marker) ||
            (u[s.marker] = [-1, -1, -1, -1, -1, -1]),
            i = u[s.marker][(s.open ? 3 : 0) + (s.length % 3)],
            (n = t - s.jump - 1) < -1 && (n = -1),
            a = n;
          n > i;
          n -= o.jump + 1
        )
          if (
            (o = r[n]).marker === s.marker &&
            o.open &&
            o.end < 0 &&
            ((c = !1),
            (o.close || s.open) &&
              (o.length + s.length) % 3 == 0 &&
              ((o.length % 3 == 0 && s.length % 3 == 0) || (c = !0)),
            !c)
          ) {
            (l = n > 0 && !r[n - 1].open ? r[n - 1].jump + 1 : 0),
              (s.jump = t - n + l),
              (s.open = !1),
              (o.end = t),
              (o.jump = l),
              (o.close = !1),
              (a = -1);
            break;
          }
        -1 !== a && (u[s.marker][(s.open ? 3 : 0) + ((s.length || 0) % 3)] = a);
      }
  }
  var Xe = w.isWhiteSpace,
    er = w.isPunctChar,
    rr = w.isMdAsciiPunct;
  function tr(e, r, t, n) {
    (this.src = e),
      (this.env = t),
      (this.md = r),
      (this.tokens = n),
      (this.tokens_meta = Array(n.length)),
      (this.pos = 0),
      (this.posMax = this.src.length),
      (this.level = 0),
      (this.pending = ""),
      (this.pendingLevel = 0),
      (this.cache = {}),
      (this.delimiters = []),
      (this._prev_delimiters = []),
      (this.backticks = {}),
      (this.backticksScanned = !1);
  }
  (tr.prototype.pushPending = function () {
    var e = new ne("text", "", 0);
    return (
      (e.content = this.pending),
      (e.level = this.pendingLevel),
      this.tokens.push(e),
      (this.pending = ""),
      e
    );
  }),
    (tr.prototype.push = function (e, r, t) {
      this.pending && this.pushPending();
      var n = new ne(e, r, t),
        s = null;
      return (
        t < 0 &&
          (this.level--, (this.delimiters = this._prev_delimiters.pop())),
        (n.level = this.level),
        t > 0 &&
          (this.level++,
          this._prev_delimiters.push(this.delimiters),
          (this.delimiters = []),
          (s = { delimiters: this.delimiters })),
        (this.pendingLevel = this.level),
        this.tokens.push(n),
        this.tokens_meta.push(s),
        n
      );
    }),
    (tr.prototype.scanDelims = function (e, r) {
      var t,
        n,
        s,
        o,
        i,
        a,
        c,
        l,
        u,
        p = e,
        h = !0,
        f = !0,
        d = this.posMax,
        m = this.src.charCodeAt(e);
      for (
        t = e > 0 ? this.src.charCodeAt(e - 1) : 32;
        p < d && this.src.charCodeAt(p) === m;

      )
        p++;
      return (
        (s = p - e),
        (n = p < d ? this.src.charCodeAt(p) : 32),
        (c = rr(t) || er(String.fromCharCode(t))),
        (u = rr(n) || er(String.fromCharCode(n))),
        (a = Xe(t)),
        (l = Xe(n)) ? (h = !1) : u && (a || c || (h = !1)),
        a ? (f = !1) : c && (l || u || (f = !1)),
        r ? ((o = h), (i = f)) : ((o = h && (!f || c)), (i = f && (!h || u))),
        { can_open: o, can_close: i, length: s }
      );
    }),
    (tr.prototype.Token = ne);
  var nr = tr,
    sr = [
      [
        "text",
        function (e, r) {
          for (var t = e.pos; t < e.posMax && !Le(e.src.charCodeAt(t)); ) t++;
          return (
            t !== e.pos &&
            (r || (e.pending += e.src.slice(e.pos, t)), (e.pos = t), !0)
          );
        },
      ],
      [
        "newline",
        function (e, r) {
          var t,
            n,
            s = e.pos;
          if (10 !== e.src.charCodeAt(s)) return !1;
          for (
            t = e.pending.length - 1,
              n = e.posMax,
              r ||
                (t >= 0 && 32 === e.pending.charCodeAt(t)
                  ? t >= 1 && 32 === e.pending.charCodeAt(t - 1)
                    ? ((e.pending = e.pending.replace(/ +$/, "")),
                      e.push("hardbreak", "br", 0))
                    : ((e.pending = e.pending.slice(0, -1)),
                      e.push("softbreak", "br", 0))
                  : e.push("softbreak", "br", 0)),
              s++;
            s < n && ze(e.src.charCodeAt(s));

          )
            s++;
          return (e.pos = s), !0;
        },
      ],
      [
        "escape",
        function (e, r) {
          var t,
            n = e.pos,
            s = e.posMax;
          if (92 !== e.src.charCodeAt(n)) return !1;
          if (++n < s) {
            if ((t = e.src.charCodeAt(n)) < 256 && 0 !== Ie[t])
              return r || (e.pending += e.src[n]), (e.pos += 2), !0;
            if (10 === t) {
              for (
                r || e.push("hardbreak", "br", 0), n++;
                n < s && ((t = e.src.charCodeAt(n)), Te(t));

              )
                n++;
              return (e.pos = n), !0;
            }
          }
          return r || (e.pending += "\\"), e.pos++, !0;
        },
      ],
      [
        "backticks",
        function (e, r) {
          var t,
            n,
            s,
            o,
            i,
            a,
            c,
            l,
            u = e.pos;
          if (96 !== e.src.charCodeAt(u)) return !1;
          for (t = u, u++, n = e.posMax; u < n && 96 === e.src.charCodeAt(u); )
            u++;
          if (
            ((c = (s = e.src.slice(t, u)).length),
            e.backticksScanned && (e.backticks[c] || 0) <= t)
          )
            return r || (e.pending += s), (e.pos += c), !0;
          for (i = a = u; -1 !== (i = e.src.indexOf("`", a)); ) {
            for (a = i + 1; a < n && 96 === e.src.charCodeAt(a); ) a++;
            if ((l = a - i) === c)
              return (
                r ||
                  (((o = e.push("code_inline", "code", 0)).markup = s),
                  (o.content = e.src
                    .slice(u, i)
                    .replace(/\n/g, " ")
                    .replace(/^ (.+) $/, "$1"))),
                (e.pos = a),
                !0
              );
            e.backticks[l] = i;
          }
          return (
            (e.backticksScanned = !0), r || (e.pending += s), (e.pos += c), !0
          );
        },
      ],
      ["strikethrough", Be.tokenize],
      ["emphasis", Oe.tokenize],
      [
        "link",
        function (e, r) {
          var t,
            n,
            s,
            o,
            i,
            a,
            c,
            l,
            u = "",
            p = "",
            h = e.pos,
            f = e.posMax,
            d = e.pos,
            m = !0;
          if (91 !== e.src.charCodeAt(e.pos)) return !1;
          if (
            ((i = e.pos + 1),
            (o = e.md.helpers.parseLinkLabel(e, e.pos, !0)) < 0)
          )
            return !1;
          if ((a = o + 1) < f && 40 === e.src.charCodeAt(a)) {
            for (
              m = !1, a++;
              a < f && ((n = e.src.charCodeAt(a)), je(n) || 10 === n);
              a++
            );
            if (a >= f) return !1;
            if (
              ((d = a),
              (c = e.md.helpers.parseLinkDestination(e.src, a, e.posMax)).ok)
            ) {
              for (
                u = e.md.normalizeLink(c.str),
                  e.md.validateLink(u) ? (a = c.pos) : (u = ""),
                  d = a;
                a < f && ((n = e.src.charCodeAt(a)), je(n) || 10 === n);
                a++
              );
              if (
                ((c = e.md.helpers.parseLinkTitle(e.src, a, e.posMax)),
                a < f && d !== a && c.ok)
              )
                for (
                  p = c.str, a = c.pos;
                  a < f && ((n = e.src.charCodeAt(a)), je(n) || 10 === n);
                  a++
                );
            }
            (a >= f || 41 !== e.src.charCodeAt(a)) && (m = !0), a++;
          }
          if (m) {
            if (void 0 === e.env.references) return !1;
            if (
              (a < f && 91 === e.src.charCodeAt(a)
                ? ((d = a + 1),
                  (a = e.md.helpers.parseLinkLabel(e, a)) >= 0
                    ? (s = e.src.slice(d, a++))
                    : (a = o + 1))
                : (a = o + 1),
              s || (s = e.src.slice(i, o)),
              !(l = e.env.references[Pe(s)]))
            )
              return (e.pos = h), !1;
            (u = l.href), (p = l.title);
          }
          return (
            r ||
              ((e.pos = i),
              (e.posMax = o),
              (e.push("link_open", "a", 1).attrs = t = [["href", u]]),
              p && t.push(["title", p]),
              e.md.inline.tokenize(e),
              e.push("link_close", "a", -1)),
            (e.pos = a),
            (e.posMax = f),
            !0
          );
        },
      ],
      [
        "image",
        function (e, r) {
          var t,
            n,
            s,
            o,
            i,
            a,
            c,
            l,
            u,
            p,
            h,
            f,
            d,
            m = "",
            g = e.pos,
            _ = e.posMax;
          if (33 !== e.src.charCodeAt(e.pos)) return !1;
          if (91 !== e.src.charCodeAt(e.pos + 1)) return !1;
          if (
            ((a = e.pos + 2),
            (i = e.md.helpers.parseLinkLabel(e, e.pos + 1, !1)) < 0)
          )
            return !1;
          if ((c = i + 1) < _ && 40 === e.src.charCodeAt(c)) {
            for (
              c++;
              c < _ && ((n = e.src.charCodeAt(c)), Ve(n) || 10 === n);
              c++
            );
            if (c >= _) return !1;
            for (
              d = c,
                (u = e.md.helpers.parseLinkDestination(e.src, c, e.posMax))
                  .ok &&
                  ((m = e.md.normalizeLink(u.str)),
                  e.md.validateLink(m) ? (c = u.pos) : (m = "")),
                d = c;
              c < _ && ((n = e.src.charCodeAt(c)), Ve(n) || 10 === n);
              c++
            );
            if (
              ((u = e.md.helpers.parseLinkTitle(e.src, c, e.posMax)),
              c < _ && d !== c && u.ok)
            )
              for (
                p = u.str, c = u.pos;
                c < _ && ((n = e.src.charCodeAt(c)), Ve(n) || 10 === n);
                c++
              );
            else p = "";
            if (c >= _ || 41 !== e.src.charCodeAt(c)) return (e.pos = g), !1;
            c++;
          } else {
            if (void 0 === e.env.references) return !1;
            if (
              (c < _ && 91 === e.src.charCodeAt(c)
                ? ((d = c + 1),
                  (c = e.md.helpers.parseLinkLabel(e, c)) >= 0
                    ? (o = e.src.slice(d, c++))
                    : (c = i + 1))
                : (c = i + 1),
              o || (o = e.src.slice(a, i)),
              !(l = e.env.references[Ue(o)]))
            )
              return (e.pos = g), !1;
            (m = l.href), (p = l.title);
          }
          return (
            r ||
              ((s = e.src.slice(a, i)),
              e.md.inline.parse(s, e.md, e.env, (f = [])),
              ((h = e.push("image", "img", 0)).attrs = t =
                [
                  ["src", m],
                  ["alt", ""],
                ]),
              (h.children = f),
              (h.content = s),
              p && t.push(["title", p])),
            (e.pos = c),
            (e.posMax = _),
            !0
          );
        },
      ],
      [
        "autolink",
        function (e, r) {
          var t,
            n,
            s,
            o,
            i,
            a,
            c = e.pos;
          if (60 !== e.src.charCodeAt(c)) return !1;
          for (i = e.pos, a = e.posMax; ; ) {
            if (++c >= a) return !1;
            if (60 === (o = e.src.charCodeAt(c))) return !1;
            if (62 === o) break;
          }
          return (
            (t = e.src.slice(i + 1, c)),
            Ge.test(t)
              ? ((n = e.md.normalizeLink(t)),
                !!e.md.validateLink(n) &&
                  (r ||
                    (((s = e.push("link_open", "a", 1)).attrs = [["href", n]]),
                    (s.markup = "autolink"),
                    (s.info = "auto"),
                    ((s = e.push("text", "", 0)).content =
                      e.md.normalizeLinkText(t)),
                    ((s = e.push("link_close", "a", -1)).markup = "autolink"),
                    (s.info = "auto")),
                  (e.pos += t.length + 2),
                  !0))
              : !!Ze.test(t) &&
                ((n = e.md.normalizeLink("mailto:" + t)),
                !!e.md.validateLink(n) &&
                  (r ||
                    (((s = e.push("link_open", "a", 1)).attrs = [["href", n]]),
                    (s.markup = "autolink"),
                    (s.info = "auto"),
                    ((s = e.push("text", "", 0)).content =
                      e.md.normalizeLinkText(t)),
                    ((s = e.push("link_close", "a", -1)).markup = "autolink"),
                    (s.info = "auto")),
                  (e.pos += t.length + 2),
                  !0))
          );
        },
      ],
      [
        "html_inline",
        function (e, r) {
          var t,
            n,
            s,
            o = e.pos;
          return (
            !!e.md.options.html &&
            ((s = e.posMax),
            !(60 !== e.src.charCodeAt(o) || o + 2 >= s) &&
              !(
                33 !== (t = e.src.charCodeAt(o + 1)) &&
                63 !== t &&
                47 !== t &&
                !(function (e) {
                  var r = 32 | e;
                  return r >= 97 && r <= 122;
                })(t)
              ) &&
              !!(n = e.src.slice(o).match($e)) &&
              (r ||
                (e.push("html_inline", "", 0).content = e.src.slice(
                  o,
                  o + n[0].length
                )),
              (e.pos += n[0].length),
              !0))
          );
        },
      ],
      [
        "entity",
        function (e, t) {
          var n,
            s,
            o = e.pos,
            i = e.posMax;
          if (38 !== e.src.charCodeAt(o)) return !1;
          if (o + 1 < i)
            if (35 === e.src.charCodeAt(o + 1)) {
              if ((s = e.src.slice(o).match(Ye)))
                return (
                  t ||
                    ((n =
                      "x" === s[1][0].toLowerCase()
                        ? parseInt(s[1].slice(1), 16)
                        : parseInt(s[1], 10)),
                    (e.pending += Je(n) ? We(n) : We(65533))),
                  (e.pos += s[0].length),
                  !0
                );
            } else if ((s = e.src.slice(o).match(Ke)) && He(r, s[1]))
              return t || (e.pending += r[s[1]]), (e.pos += s[0].length), !0;
          return t || (e.pending += "&"), e.pos++, !0;
        },
      ],
    ],
    or = [
      [
        "balance_pairs",
        function (e) {
          var r,
            t = e.tokens_meta,
            n = e.tokens_meta.length;
          for (Qe(0, e.delimiters), r = 0; r < n; r++)
            t[r] && t[r].delimiters && Qe(0, t[r].delimiters);
        },
      ],
      ["strikethrough", Be.postProcess],
      ["emphasis", Oe.postProcess],
      [
        "text_collapse",
        function (e) {
          var r,
            t,
            n = 0,
            s = e.tokens,
            o = e.tokens.length;
          for (r = t = 0; r < o; r++)
            s[r].nesting < 0 && n--,
              (s[r].level = n),
              s[r].nesting > 0 && n++,
              "text" === s[r].type && r + 1 < o && "text" === s[r + 1].type
                ? (s[r + 1].content = s[r].content + s[r + 1].content)
                : (r !== t && (s[t] = s[r]), t++);
          r !== t && (s.length = t);
        },
      ],
    ];
  function ir() {
    var e;
    for (this.ruler = new B(), e = 0; e < sr.length; e++)
      this.ruler.push(sr[e][0], sr[e][1]);
    for (this.ruler2 = new B(), e = 0; e < or.length; e++)
      this.ruler2.push(or[e][0], or[e][1]);
  }
  (ir.prototype.skipToken = function (e) {
    var r,
      t,
      n = e.pos,
      s = this.ruler.getRules(""),
      o = s.length,
      i = e.md.options.maxNesting,
      a = e.cache;
    if (void 0 === a[n]) {
      if (e.level < i)
        for (
          t = 0;
          t < o && (e.level++, (r = s[t](e, !0)), e.level--, !r);
          t++
        );
      else e.pos = e.posMax;
      r || e.pos++, (a[n] = e.pos);
    } else e.pos = a[n];
  }),
    (ir.prototype.tokenize = function (e) {
      for (
        var r,
          t,
          n = this.ruler.getRules(""),
          s = n.length,
          o = e.posMax,
          i = e.md.options.maxNesting;
        e.pos < o;

      ) {
        if (e.level < i) for (t = 0; t < s && !(r = n[t](e, !1)); t++);
        if (r) {
          if (e.pos >= o) break;
        } else e.pending += e.src[e.pos++];
      }
      e.pending && e.pushPending();
    }),
    (ir.prototype.parse = function (e, r, t, n) {
      var s,
        o,
        i,
        a = new this.State(e, r, t, n);
      for (
        this.tokenize(a), i = (o = this.ruler2.getRules("")).length, s = 0;
        s < i;
        s++
      )
        o[s](a);
    }),
    (ir.prototype.State = nr);
  var ar = ir;
  function cr(e) {
    var r = Array.prototype.slice.call(arguments, 1);
    return (
      r.forEach(function (r) {
        r &&
          Object.keys(r).forEach(function (t) {
            e[t] = r[t];
          });
      }),
      e
    );
  }
  function lr(e) {
    return Object.prototype.toString.call(e);
  }
  function ur(e) {
    return "[object Function]" === lr(e);
  }
  function pr(e) {
    return e.replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&");
  }
  var hr = { fuzzyLink: !0, fuzzyEmail: !0, fuzzyIP: !1 };
  var fr = {
      "http:": {
        validate: function (e, r, t) {
          var n = e.slice(r);
          return (
            t.re.http ||
              (t.re.http = new RegExp(
                "^\\/\\/" +
                  t.re.src_auth +
                  t.re.src_host_port_strict +
                  t.re.src_path,
                "i"
              )),
            t.re.http.test(n) ? n.match(t.re.http)[0].length : 0
          );
        },
      },
      "https:": "http:",
      "ftp:": "http:",
      "//": {
        validate: function (e, r, t) {
          var n = e.slice(r);
          return (
            t.re.no_http ||
              (t.re.no_http = new RegExp(
                "^" +
                  t.re.src_auth +
                  "(?:localhost|(?:(?:" +
                  t.re.src_domain +
                  ")\\.)+" +
                  t.re.src_domain_root +
                  ")" +
                  t.re.src_port +
                  t.re.src_host_terminator +
                  t.re.src_path,
                "i"
              )),
            t.re.no_http.test(n)
              ? (r >= 3 && ":" === e[r - 3]) || (r >= 3 && "/" === e[r - 3])
                ? 0
                : n.match(t.re.no_http)[0].length
              : 0
          );
        },
      },
      "mailto:": {
        validate: function (e, r, t) {
          var n = e.slice(r);
          return (
            t.re.mailto ||
              (t.re.mailto = new RegExp(
                "^" + t.re.src_email_name + "@" + t.re.src_host_strict,
                "i"
              )),
            t.re.mailto.test(n) ? n.match(t.re.mailto)[0].length : 0
          );
        },
      },
    },
    dr =
      "biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|\u0440\u0444".split(
        "|"
      );
  function mr(e) {
    var r = (e.re = (function (e) {
        var r = {};
        return (
          (r.src_Any = y.source),
          (r.src_Cc = A.source),
          (r.src_Z = x.source),
          (r.src_P = t.source),
          (r.src_ZPCc = [r.src_Z, r.src_P, r.src_Cc].join("|")),
          (r.src_ZCc = [r.src_Z, r.src_Cc].join("|")),
          (r.src_pseudo_letter =
            "(?:(?![><\uff5c]|" + r.src_ZPCc + ")" + r.src_Any + ")"),
          (r.src_ip4 =
            "(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"),
          (r.src_auth = "(?:(?:(?!" + r.src_ZCc + "|[@/\\[\\]()]).)+@)?"),
          (r.src_port =
            "(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?"),
          (r.src_host_terminator =
            "(?=$|[><\uff5c]|" +
            r.src_ZPCc +
            ")(?!-|_|:\\d|\\.-|\\.(?!$|" +
            r.src_ZPCc +
            "))"),
          (r.src_path =
            "(?:[/?#](?:(?!" +
            r.src_ZCc +
            "|[><\uff5c]|[()[\\]{}.,\"'?!\\-]).|\\[(?:(?!" +
            r.src_ZCc +
            "|\\]).)*\\]|\\((?:(?!" +
            r.src_ZCc +
            "|[)]).)*\\)|\\{(?:(?!" +
            r.src_ZCc +
            '|[}]).)*\\}|\\"(?:(?!' +
            r.src_ZCc +
            '|["]).)+\\"|\\\'(?:(?!' +
            r.src_ZCc +
            "|[']).)+\\'|\\'(?=" +
            r.src_pseudo_letter +
            "|[-]).|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!" +
            r.src_ZCc +
            "|[.]).|" +
            (e && e["---"] ? "\\-(?!--(?:[^-]|$))(?:-*)|" : "\\-+|") +
            "\\,(?!" +
            r.src_ZCc +
            ").|\\!+(?!" +
            r.src_ZCc +
            "|[!]).|\\?(?!" +
            r.src_ZCc +
            "|[?]).)+|\\/)?"),
          (r.src_email_name =
            '[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*'),
          (r.src_xn = "xn--[a-z0-9\\-]{1,59}"),
          (r.src_domain_root =
            "(?:" + r.src_xn + "|" + r.src_pseudo_letter + "{1,63})"),
          (r.src_domain =
            "(?:" +
            r.src_xn +
            "|(?:" +
            r.src_pseudo_letter +
            ")|(?:" +
            r.src_pseudo_letter +
            "(?:-|" +
            r.src_pseudo_letter +
            "){0,61}" +
            r.src_pseudo_letter +
            "))"),
          (r.src_host =
            "(?:(?:(?:(?:" + r.src_domain + ")\\.)*" + r.src_domain + "))"),
          (r.tpl_host_fuzzy =
            "(?:" +
            r.src_ip4 +
            "|(?:(?:(?:" +
            r.src_domain +
            ")\\.)+(?:%TLDS%)))"),
          (r.tpl_host_no_ip_fuzzy =
            "(?:(?:(?:" + r.src_domain + ")\\.)+(?:%TLDS%))"),
          (r.src_host_strict = r.src_host + r.src_host_terminator),
          (r.tpl_host_fuzzy_strict = r.tpl_host_fuzzy + r.src_host_terminator),
          (r.src_host_port_strict =
            r.src_host + r.src_port + r.src_host_terminator),
          (r.tpl_host_port_fuzzy_strict =
            r.tpl_host_fuzzy + r.src_port + r.src_host_terminator),
          (r.tpl_host_port_no_ip_fuzzy_strict =
            r.tpl_host_no_ip_fuzzy + r.src_port + r.src_host_terminator),
          (r.tpl_host_fuzzy_test =
            "localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:" +
            r.src_ZPCc +
            "|>|$))"),
          (r.tpl_email_fuzzy =
            '(^|[><\uff5c]|"|\\(|' +
            r.src_ZCc +
            ")(" +
            r.src_email_name +
            "@" +
            r.tpl_host_fuzzy_strict +
            ")"),
          (r.tpl_link_fuzzy =
            "(^|(?![.:/\\-_@])(?:[$+<=>^`|\uff5c]|" +
            r.src_ZPCc +
            "))((?![$+<=>^`|\uff5c])" +
            r.tpl_host_port_fuzzy_strict +
            r.src_path +
            ")"),
          (r.tpl_link_no_ip_fuzzy =
            "(^|(?![.:/\\-_@])(?:[$+<=>^`|\uff5c]|" +
            r.src_ZPCc +
            "))((?![$+<=>^`|\uff5c])" +
            r.tpl_host_port_no_ip_fuzzy_strict +
            r.src_path +
            ")"),
          r
        );
      })(e.__opts__)),
      n = e.__tlds__.slice();
    function s(e) {
      return e.replace("%TLDS%", r.src_tlds);
    }
    e.onCompile(),
      e.__tlds_replaced__ ||
        n.push(
          "a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]"
        ),
      n.push(r.src_xn),
      (r.src_tlds = n.join("|")),
      (r.email_fuzzy = RegExp(s(r.tpl_email_fuzzy), "i")),
      (r.link_fuzzy = RegExp(s(r.tpl_link_fuzzy), "i")),
      (r.link_no_ip_fuzzy = RegExp(s(r.tpl_link_no_ip_fuzzy), "i")),
      (r.host_fuzzy_test = RegExp(s(r.tpl_host_fuzzy_test), "i"));
    var o = [];
    function i(e, r) {
      throw new Error('(LinkifyIt) Invalid schema "' + e + '": ' + r);
    }
    (e.__compiled__ = {}),
      Object.keys(e.__schemas__).forEach(function (r) {
        var t = e.__schemas__[r];
        if (null !== t) {
          var n = { validate: null, link: null };
          if (((e.__compiled__[r] = n), "[object Object]" === lr(t)))
            return (
              !(function (e) {
                return "[object RegExp]" === lr(e);
              })(t.validate)
                ? ur(t.validate)
                  ? (n.validate = t.validate)
                  : i(r, t)
                : (n.validate = (function (e) {
                    return function (r, t) {
                      var n = r.slice(t);
                      return e.test(n) ? n.match(e)[0].length : 0;
                    };
                  })(t.validate)),
              void (ur(t.normalize)
                ? (n.normalize = t.normalize)
                : t.normalize
                ? i(r, t)
                : (n.normalize = function (e, r) {
                    r.normalize(e);
                  }))
            );
          !(function (e) {
            return "[object String]" === lr(e);
          })(t)
            ? i(r, t)
            : o.push(r);
        }
      }),
      o.forEach(function (r) {
        e.__compiled__[e.__schemas__[r]] &&
          ((e.__compiled__[r].validate =
            e.__compiled__[e.__schemas__[r]].validate),
          (e.__compiled__[r].normalize =
            e.__compiled__[e.__schemas__[r]].normalize));
      }),
      (e.__compiled__[""] = {
        validate: null,
        normalize: function (e, r) {
          r.normalize(e);
        },
      });
    var a = Object.keys(e.__compiled__)
      .filter(function (r) {
        return r.length > 0 && e.__compiled__[r];
      })
      .map(pr)
      .join("|");
    (e.re.schema_test = RegExp(
      "(^|(?!_)(?:[><\uff5c]|" + r.src_ZPCc + "))(" + a + ")",
      "i"
    )),
      (e.re.schema_search = RegExp(
        "(^|(?!_)(?:[><\uff5c]|" + r.src_ZPCc + "))(" + a + ")",
        "ig"
      )),
      (e.re.pretest = RegExp(
        "(" +
          e.re.schema_test.source +
          ")|(" +
          e.re.host_fuzzy_test.source +
          ")|@",
        "i"
      )),
      (function (e) {
        (e.__index__ = -1), (e.__text_cache__ = "");
      })(e);
  }
  function gr(e, r) {
    var t = e.__index__,
      n = e.__last_index__,
      s = e.__text_cache__.slice(t, n);
    (this.schema = e.__schema__.toLowerCase()),
      (this.index = t + r),
      (this.lastIndex = n + r),
      (this.raw = s),
      (this.text = s),
      (this.url = s);
  }
  function _r(e, r) {
    var t = new gr(e, r);
    return e.__compiled__[t.schema].normalize(t, e), t;
  }
  function br(e, r) {
    if (!(this instanceof br)) return new br(e, r);
    var t;
    r ||
      ((t = e),
      Object.keys(t || {}).reduce(function (e, r) {
        return e || hr.hasOwnProperty(r);
      }, !1) && ((r = e), (e = {}))),
      (this.__opts__ = cr({}, hr, r)),
      (this.__index__ = -1),
      (this.__last_index__ = -1),
      (this.__schema__ = ""),
      (this.__text_cache__ = ""),
      (this.__schemas__ = cr({}, fr, e)),
      (this.__compiled__ = {}),
      (this.__tlds__ = dr),
      (this.__tlds_replaced__ = !1),
      (this.re = {}),
      mr(this);
  }
  (br.prototype.add = function (e, r) {
    return (this.__schemas__[e] = r), mr(this), this;
  }),
    (br.prototype.set = function (e) {
      return (this.__opts__ = cr(this.__opts__, e)), this;
    }),
    (br.prototype.test = function (e) {
      if (((this.__text_cache__ = e), (this.__index__ = -1), !e.length))
        return !1;
      var r, t, n, s, o, i, a, c;
      if (this.re.schema_test.test(e))
        for (
          (a = this.re.schema_search).lastIndex = 0;
          null !== (r = a.exec(e));

        )
          if ((s = this.testSchemaAt(e, r[2], a.lastIndex))) {
            (this.__schema__ = r[2]),
              (this.__index__ = r.index + r[1].length),
              (this.__last_index__ = r.index + r[0].length + s);
            break;
          }
      return (
        this.__opts__.fuzzyLink &&
          this.__compiled__["http:"] &&
          (c = e.search(this.re.host_fuzzy_test)) >= 0 &&
          (this.__index__ < 0 || c < this.__index__) &&
          null !==
            (t = e.match(
              this.__opts__.fuzzyIP
                ? this.re.link_fuzzy
                : this.re.link_no_ip_fuzzy
            )) &&
          ((o = t.index + t[1].length),
          (this.__index__ < 0 || o < this.__index__) &&
            ((this.__schema__ = ""),
            (this.__index__ = o),
            (this.__last_index__ = t.index + t[0].length))),
        this.__opts__.fuzzyEmail &&
          this.__compiled__["mailto:"] &&
          e.indexOf("@") >= 0 &&
          null !== (n = e.match(this.re.email_fuzzy)) &&
          ((o = n.index + n[1].length),
          (i = n.index + n[0].length),
          (this.__index__ < 0 ||
            o < this.__index__ ||
            (o === this.__index__ && i > this.__last_index__)) &&
            ((this.__schema__ = "mailto:"),
            (this.__index__ = o),
            (this.__last_index__ = i))),
        this.__index__ >= 0
      );
    }),
    (br.prototype.pretest = function (e) {
      return this.re.pretest.test(e);
    }),
    (br.prototype.testSchemaAt = function (e, r, t) {
      return this.__compiled__[r.toLowerCase()]
        ? this.__compiled__[r.toLowerCase()].validate(e, t, this)
        : 0;
    }),
    (br.prototype.match = function (e) {
      var r = 0,
        t = [];
      this.__index__ >= 0 &&
        this.__text_cache__ === e &&
        (t.push(_r(this, r)), (r = this.__last_index__));
      for (var n = r ? e.slice(r) : e; this.test(n); )
        t.push(_r(this, r)),
          (n = n.slice(this.__last_index__)),
          (r += this.__last_index__);
      return t.length ? t : null;
    }),
    (br.prototype.tlds = function (e, r) {
      return (
        (e = Array.isArray(e) ? e : [e]),
        r
          ? ((this.__tlds__ = this.__tlds__
              .concat(e)
              .sort()
              .filter(function (e, r, t) {
                return e !== t[r - 1];
              })
              .reverse()),
            mr(this),
            this)
          : ((this.__tlds__ = e.slice()),
            (this.__tlds_replaced__ = !0),
            mr(this),
            this)
      );
    }),
    (br.prototype.normalize = function (e) {
      e.schema || (e.url = "http://" + e.url),
        "mailto:" !== e.schema ||
          /^mailto:/i.test(e.url) ||
          (e.url = "mailto:" + e.url);
    }),
    (br.prototype.onCompile = function () {});
  var kr = br,
    vr = 2147483647,
    Cr = 36,
    yr = /^xn--/,
    Ar = /[^\x20-\x7E]/,
    xr = /[\x2E\u3002\uFF0E\uFF61]/g,
    Dr = {
      overflow: "Overflow: input needs wider integers to process",
      "not-basic": "Illegal input >= 0x80 (not a basic code point)",
      "invalid-input": "Invalid input",
    },
    wr = Math.floor,
    Er = String.fromCharCode;
  /*! https://mths.be/punycode v1.4.1 by @mathias */ function qr(e) {
    throw new RangeError(Dr[e]);
  }
  function Sr(e, r) {
    for (var t = e.length, n = []; t--; ) n[t] = r(e[t]);
    return n;
  }
  function Fr(e, r) {
    var t = e.split("@"),
      n = "";
    return (
      t.length > 1 && ((n = t[0] + "@"), (e = t[1])),
      n + Sr((e = e.replace(xr, ".")).split("."), r).join(".")
    );
  }
  function Lr(e) {
    for (var r, t, n = [], s = 0, o = e.length; s < o; )
      (r = e.charCodeAt(s++)) >= 55296 && r <= 56319 && s < o
        ? 56320 == (64512 & (t = e.charCodeAt(s++)))
          ? n.push(((1023 & r) << 10) + (1023 & t) + 65536)
          : (n.push(r), s--)
        : n.push(r);
    return n;
  }
  function zr(e) {
    return Sr(e, function (e) {
      var r = "";
      return (
        e > 65535 &&
          ((r += Er((((e -= 65536) >>> 10) & 1023) | 55296)),
          (e = 56320 | (1023 & e))),
        (r += Er(e))
      );
    }).join("");
  }
  function Tr(e, r) {
    return e + 22 + 75 * (e < 26) - ((0 != r) << 5);
  }
  function Ir(e, r, t) {
    var n = 0;
    for (e = t ? wr(e / 700) : e >> 1, e += wr(e / r); e > 455; n += Cr)
      e = wr(e / 35);
    return wr(n + (36 * e) / (e + 38));
  }
  function Mr(e) {
    var r,
      t,
      n,
      s,
      o,
      i,
      a,
      c,
      l,
      u,
      p,
      h = [],
      f = e.length,
      d = 0,
      m = 128,
      g = 72;
    for ((t = e.lastIndexOf("-")) < 0 && (t = 0), n = 0; n < t; ++n)
      e.charCodeAt(n) >= 128 && qr("not-basic"), h.push(e.charCodeAt(n));
    for (s = t > 0 ? t + 1 : 0; s < f; ) {
      for (
        o = d, i = 1, a = Cr;
        s >= f && qr("invalid-input"),
          ((c =
            (p = e.charCodeAt(s++)) - 48 < 10
              ? p - 22
              : p - 65 < 26
              ? p - 65
              : p - 97 < 26
              ? p - 97
              : Cr) >= Cr ||
            c > wr((vr - d) / i)) &&
            qr("overflow"),
          (d += c * i),
          !(c < (l = a <= g ? 1 : a >= g + 26 ? 26 : a - g));
        a += Cr
      )
        i > wr(vr / (u = Cr - l)) && qr("overflow"), (i *= u);
      (g = Ir(d - o, (r = h.length + 1), 0 == o)),
        wr(d / r) > vr - m && qr("overflow"),
        (m += wr(d / r)),
        (d %= r),
        h.splice(d++, 0, m);
    }
    return zr(h);
  }
  function Rr(e) {
    var r,
      t,
      n,
      s,
      o,
      i,
      a,
      c,
      l,
      u,
      p,
      h,
      f,
      d,
      m,
      g = [];
    for (h = (e = Lr(e)).length, r = 128, t = 0, o = 72, i = 0; i < h; ++i)
      (p = e[i]) < 128 && g.push(Er(p));
    for (n = s = g.length, s && g.push("-"); n < h; ) {
      for (a = vr, i = 0; i < h; ++i) (p = e[i]) >= r && p < a && (a = p);
      for (
        a - r > wr((vr - t) / (f = n + 1)) && qr("overflow"),
          t += (a - r) * f,
          r = a,
          i = 0;
        i < h;
        ++i
      )
        if (((p = e[i]) < r && ++t > vr && qr("overflow"), p == r)) {
          for (
            c = t, l = Cr;
            !(c < (u = l <= o ? 1 : l >= o + 26 ? 26 : l - o));
            l += Cr
          )
            (m = c - u),
              (d = Cr - u),
              g.push(Er(Tr(u + (m % d), 0))),
              (c = wr(m / d));
          g.push(Er(Tr(c, 0))), (o = Ir(t, f, n == s)), (t = 0), ++n;
        }
      ++t, ++r;
    }
    return g.join("");
  }
  function Br(e) {
    return Fr(e, function (e) {
      return yr.test(e) ? Mr(e.slice(4).toLowerCase()) : e;
    });
  }
  function Nr(e) {
    return Fr(e, function (e) {
      return Ar.test(e) ? "xn--" + Rr(e) : e;
    });
  }
  var Or = "1.4.1",
    Pr = { decode: Lr, encode: zr },
    jr = {
      version: Or,
      ucs2: Pr,
      toASCII: Nr,
      toUnicode: Br,
      encode: Rr,
      decode: Mr,
    },
    Ur = e(
      Object.freeze({
        __proto__: null,
        decode: Mr,
        encode: Rr,
        toUnicode: Br,
        toASCII: Nr,
        version: Or,
        ucs2: Pr,
        default: jr,
      })
    ),
    Vr = {
      default: {
        options: {
          html: !1,
          xhtmlOut: !1,
          breaks: !1,
          langPrefix: "language-",
          linkify: !1,
          typographer: !1,
          quotes: "\u201c\u201d\u2018\u2019",
          highlight: null,
          maxNesting: 100,
        },
        components: { core: {}, block: {}, inline: {} },
      },
      zero: {
        options: {
          html: !1,
          xhtmlOut: !1,
          breaks: !1,
          langPrefix: "language-",
          linkify: !1,
          typographer: !1,
          quotes: "\u201c\u201d\u2018\u2019",
          highlight: null,
          maxNesting: 20,
        },
        components: {
          core: { rules: ["normalize", "block", "inline"] },
          block: { rules: ["paragraph"] },
          inline: {
            rules: ["text"],
            rules2: ["balance_pairs", "text_collapse"],
          },
        },
      },
      commonmark: {
        options: {
          html: !0,
          xhtmlOut: !0,
          breaks: !1,
          langPrefix: "language-",
          linkify: !1,
          typographer: !1,
          quotes: "\u201c\u201d\u2018\u2019",
          highlight: null,
          maxNesting: 20,
        },
        components: {
          core: { rules: ["normalize", "block", "inline"] },
          block: {
            rules: [
              "blockquote",
              "code",
              "fence",
              "heading",
              "hr",
              "html_block",
              "lheading",
              "list",
              "reference",
              "paragraph",
            ],
          },
          inline: {
            rules: [
              "autolink",
              "backticks",
              "emphasis",
              "entity",
              "escape",
              "html_inline",
              "image",
              "link",
              "newline",
              "text",
            ],
            rules2: ["balance_pairs", "emphasis", "text_collapse"],
          },
        },
      },
    },
    Zr = /^(vbscript|javascript|file|data):/,
    Gr = /^data:image\/(gif|png|jpeg|webp);/;
  function $r(e) {
    var r = e.trim().toLowerCase();
    return !Zr.test(r) || !!Gr.test(r);
  }
  var Hr = ["http:", "https:", "mailto:"];
  function Jr(e) {
    var r = C.parse(e, !0);
    if (r.hostname && (!r.protocol || Hr.indexOf(r.protocol) >= 0))
      try {
        r.hostname = Ur.toASCII(r.hostname);
      } catch (e) {}
    return C.encode(C.format(r));
  }
  function Wr(e) {
    var r = C.parse(e, !0);
    if (r.hostname && (!r.protocol || Hr.indexOf(r.protocol) >= 0))
      try {
        r.hostname = Ur.toUnicode(r.hostname);
      } catch (e) {}
    return C.decode(C.format(r), C.decode.defaultChars + "%");
  }
  function Yr(e, r) {
    if (!(this instanceof Yr)) return new Yr(e, r);
    r || w.isString(e) || ((r = e || {}), (e = "default")),
      (this.inline = new ar()),
      (this.block = new Fe()),
      (this.core = new ce()),
      (this.renderer = new M()),
      (this.linkify = new kr()),
      (this.validateLink = $r),
      (this.normalizeLink = Jr),
      (this.normalizeLinkText = Wr),
      (this.utils = w),
      (this.helpers = w.assign({}, S)),
      (this.options = {}),
      this.configure(e),
      r && this.set(r);
  }
  return (
    (Yr.prototype.set = function (e) {
      return w.assign(this.options, e), this;
    }),
    (Yr.prototype.configure = function (e) {
      var r,
        t = this;
      if (w.isString(e) && !(e = Vr[(r = e)]))
        throw new Error('Wrong `markdown-it` preset "' + r + '", check name');
      if (!e) throw new Error("Wrong `markdown-it` preset, can't be empty");
      return (
        e.options && t.set(e.options),
        e.components &&
          Object.keys(e.components).forEach(function (r) {
            e.components[r].rules &&
              t[r].ruler.enableOnly(e.components[r].rules),
              e.components[r].rules2 &&
                t[r].ruler2.enableOnly(e.components[r].rules2);
          }),
        this
      );
    }),
    (Yr.prototype.enable = function (e, r) {
      var t = [];
      Array.isArray(e) || (e = [e]),
        ["core", "block", "inline"].forEach(function (r) {
          t = t.concat(this[r].ruler.enable(e, !0));
        }, this),
        (t = t.concat(this.inline.ruler2.enable(e, !0)));
      var n = e.filter(function (e) {
        return t.indexOf(e) < 0;
      });
      if (n.length && !r)
        throw new Error("MarkdownIt. Failed to enable unknown rule(s): " + n);
      return this;
    }),
    (Yr.prototype.disable = function (e, r) {
      var t = [];
      Array.isArray(e) || (e = [e]),
        ["core", "block", "inline"].forEach(function (r) {
          t = t.concat(this[r].ruler.disable(e, !0));
        }, this),
        (t = t.concat(this.inline.ruler2.disable(e, !0)));
      var n = e.filter(function (e) {
        return t.indexOf(e) < 0;
      });
      if (n.length && !r)
        throw new Error("MarkdownIt. Failed to disable unknown rule(s): " + n);
      return this;
    }),
    (Yr.prototype.use = function (e) {
      var r = [this].concat(Array.prototype.slice.call(arguments, 1));
      return e.apply(e, r), this;
    }),
    (Yr.prototype.parse = function (e, r) {
      if ("string" != typeof e)
        throw new Error("Input data should be a String");
      var t = new this.core.State(e, this, r);
      return this.core.process(t), t.tokens;
    }),
    (Yr.prototype.render = function (e, r) {
      return (
        (r = r || {}), this.renderer.render(this.parse(e, r), this.options, r)
      );
    }),
    (Yr.prototype.parseInline = function (e, r) {
      var t = new this.core.State(e, this, r);
      return (t.inlineMode = !0), this.core.process(t), t.tokens;
    }),
    (Yr.prototype.renderInline = function (e, r) {
      return (
        (r = r || {}),
        this.renderer.render(this.parseInline(e, r), this.options, r)
      );
    }),
    Yr
  );
});

function WriteCampaign(config) {
  const root = dom.qs(".page-ui");

  let hasSeenCampaign = window.localStorage.getItem(config.id);

  if (config === false || writeBuilder.active) return;

  // configure campaign
  showFlashMessage();

  if (hasSeenCampaign) return;

  window.resetCampaign = function () {
    window.localStorage.removeItem(config.id);
    window.location.reload();
  };

  root.classList.add("campaign");

  const isBar = false;
  if (isBar) root.classList.add("campaign-bar");

  const md = new markdownit({
    html: true,
    breaks: true,
    linkify: true,
  });

  const alert = dom.create({
    class: "campaign-alert",
    html: `
      <a href='${
        config.buttonUrl
      }' target='_blank' onclick='writeCampaign.click()'>
        <span class='campaign-icon'>${config.icon}</span>
        <span class='campaign-prompt'>${md.render(config.label)}</span>
      </a>
    `,
  });

  const close = dom.create({
    class: "campaign-alert-close",
    html: "×",
  });

  function closeCampaign() {
    root.classList.remove("campaign");
    window.localStorage.setItem(config.id, "true");
    hasSeenCampaign = true;
    showFlashMessage();
  }

  close.addEventListener("click", (e) => {
    e.stopPropagation();
    closeCampaign();
    writeLog("Close campaign", { props: { campaign: config.id } });
  });

  alert.addEventListener("click", (e) => {
    e.stopPropagation();
    closeCampaign();
    writeLog("Click campaign", { props: { campaign: config.id } });
  });

  function showFlashMessage() {
    if (window.location.pathname === "/campaign" && hasSeenCampaign) {
      writeFlash.show({
        message: `Campaign dismissed <a onclick='window.localStorage.removeItem("${config.id}"); window.location.reload();'>Show</a>`,
        duration: false,
      });
    }
  }

  alert.appendChild(close);
  root.appendChild(alert);
}

let dom = {
  create: function (attr = {}, parent) {
    var el = attr.el
      ? document.createElement(attr.el)
      : document.createElement("div");

    if (attr.el === "path" || attr.el === "svg") {
      el = document.createElementNS("http://www.w3.org/2000/svg", attr.el);
    }

    for (let key in attr) {
      var isAttr = key !== "el" && key !== "html";
      if (isAttr) el.setAttribute(key, attr[key]);
    }

    if (attr.html) el.innerHTML = attr.html;

    if (parent) parent.appendChild(el);

    return el;
  },
  empty: function (el) {
    el.innerHTML = "";
    return el;
  },
  qs: function (selector, ctx) {
    const el = ctx
      ? ctx.querySelector(selector)
      : document.querySelector(selector);
    return el;
  },
  qsa: function (selector, ctx) {
    const els = ctx
      ? Array.from(ctx.querySelectorAll(selector))
      : Array.from(document.querySelectorAll(selector));
    return els;
  },
  gid: function (id) {
    return document.getElementById(id);
  },
  update: function (type, value) {
    var els = Array.from(document.querySelectorAll(`[data-type=${type}]`));
    els.forEach((el) => (el.innerHTML = value));
  },
  body: document.body,
};

(function () {
  const dict = {
    "Your text will be cleared, are you sure?":
      "El texto será borrado ¿estás seguro?",
    "Text cleared": "Texto borrado",
    "Restore?": "¿Deshacer?",
    "Switch to darkmode": "Cambiar a modo oscuro",
    "Switch to lightmode": "Cambiar a modo claro",
    By: "Por",
    "to submit your prompt.": "para enviar tu ejercicio",
    "Blank Page": "Página en blanco",
    "Page is blank": "Página en blanco",
    "Number of words": "Número de palabras",
    Fullscreen: "Pantalla completa",
    Configure: "Ajustar",
    Preview: "Previsualizar",
    Spellcheck: "Corrector",
    Theme: "Esquema de colores",
    About: "Acerca de",
    "Start typing...": "Empieza a escribir...",
    "Word goal": "Objetivo de palabras",
    "Time limit": "Límite de tiempo",
    Word: "Palabra",
    Words: "Palabras",
    word: "palabra",
    words: "palabras",
    in: "en",
    Time: "Tiempo",
    min: "min",
    "Enter a": "Introduce un",
    "in minutes": "en minutos",
    "Your name": "Tu nombre",
    "Your email": "Tu email",
    "No time limit": "Sin límite de tiempo",
    "No goal": "Sin objetivo",
    "Write during": "Escribe durante",
    Write: "Escribe",
    "Write at least": "Escribe por lo menos",
    "Learn more": "Leer más",
    min: "min",
    sec: "seg",
    seconds: "segundos",
    "The time is up!": "¡Se acabó el tiempo!",
    Sending: "Enviando",
    "Sending reply to": "Enviando respuesta a",
    from: "desde",
    "Copied link to clipboard": "Enlace copiado al portapapeles",
    "You've written during": "Has escrito durante",
    minutes: "minutos",
    "You've reached": "Has alcanzado",
    "Pasting is not allowed": "No se permite copiar y pegar",
    "Copied to clipboard": "Texto copiado al portapapeles",
    "Copied all text to clipboard": "Texto copiado al portapapeles",
    "You ran out of time before completing the exercise. \n\n You'll have to start again.":
      "Se acabó el tiempo antes de completar el ejercicio. \n\n Tendrás que comenzar de nuevo.",
    "Log in or sign up to view this exercise":
      " Entra a tu cuenta o regístrate para poder ver este ejercicio",
    "Something went wrong, please submit your assignment again":
      "No se pudo enviar tu ejercicio, por favor inténtalo de nuevo",
    "Open in Blank Page": "Abrir en Blank Page",
    Anonymous: "Anónimo",
    "Assignment will be available on": "El ejercicio estará disponible el",
    "at midnight (local time)": "a la media noche (hora local)",
    "Assignment expired. It was due":
      "El ejercicio ha expirado. La fecha límite para enviarlo fue el",
    Submit: "Enviar",
    "for print": "para imprimir",
    "Your reply will be emailed to": "Tu ejercicio será enviado a",
    "Your submission is private. You can share it in the next step.":
      "Tu ejercicio es privado. Si quieres, puedes compartirlo en el siguiente paso.",
    "Create prompt (coming soon)": "Crear ejercicio (pronto)",
    Language: "Idioma",
    "Spellcheck enabled": "Corrector habilitado",
    "Spellcheck disabled": "Corrector deshabilitado",
    "https://blank.page/etc/thanks": "https://blank.page/etc/gracias",
    Color: "Color",
    "Time in minutes": "Tiempo en minutos",
    Update: "Actualizar",
    "Your email will be sent to": "Tu email se enviará a",
    "Retry?": "Reintentar",
    Copy: "Copiar",
    Save: "Guardar",
    Download: "Descargar",
    Clear: "Borrar",
    "before midnight (local time)": "antes de la media noche (hora local)",
    "Build prompt": "Crear ejercicio",
    "Update prompt": "Actualizar ejercicio",
    None: "Ninguno",
    "Content saved": "Texto guardado",
    "Copy URL": "Copiar URL",
    "Link destination (URL)": "Destino del enlace (URL)",
    "Destination is not a link": "El enlace no es válido",
    Undo: "Deshacer",
    Exercise: "Ejercicio",
    of: "de",
  };

  const englishWords = Object.keys(dict);
  const spanishWords = Object.values(dict);

  function t(key, reverse) {
    var lang = state.get("pageLanguage") || state.get("language");
    var englishWord = key;
    var spanishWord = dict[key];

    if (reverse) {
      englishWord = englishWords[spanishWords.indexOf(key)];
      spanishWord = key;
    }

    if (!englishWord || !spanishWord) {
      console.log("translation missing: " + key);
      return key;
    }

    const translation = lang === "en" ? key : dict[key]; // english input;
    return translation;
  }

  function tDate(date) {
    const monthNames = {
      January: "Enero",
      February: "Febrero",
      March: "Marzo",
      April: "Abril",
      May: "Mayo",
      June: "Junio",
      July: "Julio",
      August: "Agosto",
      September: "Septiembre",
      October: "Octubre",
      November: "Noviembre",
      December: "Diciembre",
    };
    var lang = typeof state === "undefined" ? "en" : state.get("pageLanguage");
    if (state.get("pageLanguage")) lang = state.get("pageLanguage");
    const months =
      lang === "en" ? Object.keys(monthNames) : Object.values(monthNames);
    const month = months[date.getMonth()];
    const day = date.getDate();
    const year = date.getFullYear();
    return lang === "en"
      ? `${month} ${day}, ${year}`
      : `${day} de ${month} ${year}`;
  }

  window.t = t;
  window.tDate = tDate;
})();

const utils = {};

utils.isMac = navigator.platform.toUpperCase().indexOf("MAC") >= 0;

utils.isMobile = function () {
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  console.log("isMobile", isMobile, navigator.userAgent);
  return /Mobi|Android/i.test(navigator.userAgent);
};

utils.generatePageUrl = function () {
  const courseId = state.get("pageCourseId");
  const pageUrl = `https://blank.page/${courseId}/${state.get("pageId")}`;
  return pageUrl;
};

utils.copyText = function (txt) {
  navigator.clipboard.writeText(txt).then(
    function () {
      writeFlash.show({ message: "Copied " + txt + " to clipboard" });
    },
    function (err) {
      writeFlash.show({ message: "Could not copy text: " + err });
    }
  );
};

utils.fixUrl = function (url) {
  if (!url) return "";
  if (url.startsWith("http")) return url;
  else return "http://" + url;
};

utils.linkHelper = function (txt, url) {
  if (txt === undefined) return dom.create();
  if (!url) return dom.create({ html: txt });
  return dom.create({ el: "a", href: url, html: txt, target: "_blank" });
};

utils.msToMin = function (ms) {
  return ms / 1000 / 60;
};

utils.minsToMs = function (mins) {
  return mins * 1000 * 60;
};

utils.msToString = function (ms) {
  const min = utils.msToMin(ms);
  return min > 1 ? `${min} ${t("minutes")}` : `${ms / 1000} ${t("seconds")}`;
};

utils.pickRandom = function (arr) {
  if (!arr) throw "Empty Array";
  return arr[Math.floor(Math.random() * arr.length)];
};

utils.dirify = function (word) {
  word = word.split(" ").join("-");
  word = word.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  word = word.replace(/[^a-zA-Z0-9-]/g, "");
  return word.toLowerCase();
};

utils.pluralize = function pluralize(word, wordCount) {
  return word + (wordCount === 1 ? "" : "s");
};

utils.wordCount = function (string) {
  if (!string) return 0;
  const arr = string.split(" ").map(function (word) {
    if (!word) return false;
    return word.split("\n");
  });
  return [].concat.apply([], arr).filter(Boolean).length;
};

utils.metaKey = function () {
  return navigator.platform.toUpperCase().indexOf("MAC") >= 0 ? "⌘" : "Ctrl + ";
};

utils.findGetParameter = function (parameterName) {
  var result = null,
    tmp = [];
  var items = location.search.substr(1).split("&");
  for (var index = 0; index < items.length; index++) {
    tmp = items[index].split("=");
    if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
  }
  return result;
};

utils.humanize = function () {
  const wordGoal = state.get("pageWordGoal");
  const timeLimit = state.get("pageTimeLimit");
  if (!wordGoal && !timeLimit) return "";
  if (!wordGoal && timeLimit)
    return `${t("Write during")} ${
      timeLimit > 60000
        ? utils.msToMin(timeLimit) + " min"
        : timeLimit / 1000 + " " + t("seconds")
    }`;
  if (wordGoal && !timeLimit)
    return `${t("Write")} ${wordGoal} ${t("word", true)}`;
  const secs = timeLimit / 1000;
  const label = secs > 60 ? `${secs / 60} ${t("min")}` : `${secs} ${t("sec")}`;

  return `${t("Write")} ${wordGoal} ${t("word", true)} ${t("in")} ${label}`;
};

utils.ajax = function (method, url, data, success, error) {
  var xhr = new XMLHttpRequest();
  xhr.open(method, url);
  xhr.setRequestHeader("Accept", "application/json");
  xhr.onreadystatechange = function () {
    if (xhr.readyState !== XMLHttpRequest.DONE) return;
    if (xhr.status === 200) {
      success(xhr.response, xhr.responseType);
    } else {
      error(xhr.status, xhr.response, xhr.responseType);
    }
  };
  xhr.send(data);
};

utils.throttle = _.throttle;
utils.debounce = _.debounce;

utils.download = function () {
  const data = writeSheet.getContent();
  if (!data) return false;
  const filename =
    state.get("pageTitle") ||
    data
      .split(" ")
      .filter((word, i) => i < 5)
      .join("-");
  const type = "text/plain";
  var file = new Blob([data], { type: type });
  writeLog("Download");
  if (window.navigator.msSaveOrOpenBlob)
    // IE10+
    window.navigator.msSaveOrOpenBlob(file, filename);
  else {
    // Others
    var a = document.createElement("a"),
      url = URL.createObjectURL(file);
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(function () {
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }, 0);
  }
};

utils.openFile = function (event) {
  var input = event.target;
  var reader = new FileReader();
  reader.onload = function () {
    var text = reader.result;
    writeSheet.setContent(text);
  };
  reader.readAsText(input.files[0]);
};

utils.simulateClick = function (elem) {
  // Create our event (with options)
  var evt = new MouseEvent("click", {
    bubbles: true,
    cancelable: true,
    view: window,
  });
  // If cancelled, don't dispatch our event
  var canceled = !elem.dispatchEvent(evt);
};

utils.isDev = function () {
  return (
    window.location.protocol === "file:" ||
    window.location.hostname === "localhost"
  );
};

utils.language = function () {
  var language = window.navigator.userLanguage || window.navigator.language;
  if (language.indexOf("-") !== -1) language = language.split("-")[0];
  return language || "en";
};

var ajax = {};

ajax.send = function (url, callback, method, data, async = true, credentials) {
  var x = new XMLHttpRequest();
  x.open(method, url, async);
  x.onreadystatechange = function () {
    if (x.readyState == 4) callback(x.responseText);
  };
  if (credentials) x.setRequestHeader("Authorization", "Basic " + credentials);
  if (method == "POST")
    x.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  x.send(data);
};

ajax.get = function (url, data, callback = function () {}, async) {
  var query = [];
  for (var key in data) {
    query.push(encodeURIComponent(key) + "=" + encodeURIComponent(data[key]));
  }
  var credentials = data.username
    ? window.btoa(data.username + ":" + data.password)
    : false;
  ajax.send(
    url + (query.length ? "?" + query.join("&") : ""),
    callback,
    "GET",
    null,
    async,
    credentials
  );
};

ajax.post = function (url, data, callback = function () {}, async) {
  var query = [];
  for (var key in data) {
    query.push(encodeURIComponent(key) + "=" + encodeURIComponent(data[key]));
  }
  var credentials = data.username
    ? window.btoa(data.username + ":" + data.password)
    : false;
  ajax.send(url, callback, "POST", query.join("&"), async, credentials);
};

utils.generateUID = function (size = 20) {
  return new Array(size).join().replace(/(.|$)/g, function () {
    return ((Math.random() * 36) | 0)
      .toString(36)
      [Math.random() < 0.5 ? "toString" : "toUpperCase"]();
  });
};

utils.isValidEmail = function (email) {
  return /^.+@.+\..+$/.test(email);
};
utils.isValidDate = function (date) {
  return date instanceof Date && isFinite(date);
};
utils.isObject = function (value) {
  return typeof value === "object" && value !== null;
};

utils.throttle = function (callback, limit = 1000) {
  var waiting = false; // Initially, we're not waiting
  return function () {
    // We return a throttled function
    if (!waiting) {
      // If we're not waiting
      callback.apply(this, arguments); // Execute users function
      waiting = true; // Prevent future invocations
      setTimeout(function () {
        // After a period of time
        waiting = false; // And allow future invocations
      }, limit);
    }
  };
};

utils.rulesToString = function (rules) {
  var message = "";

  if (rules.length > 1) {
    message = `${t("Write")} ${state.get("pageWordGoal")} ${t("words")} ${t(
      "in"
    )} ${utils.msToMin(state.get("pageTimeLimit"))} ${t("minutes")}`;
  } else
    message = rules.reduce((acc, rule) => {
      const prop = Object.keys(rule)[0];
      const val = Object.values(rule)[0];
      if (prop === "pageTimeLimit")
        return (
          acc +
          t("Write during") +
          " " +
          utils.msToMin(state.get("pageTimeLimit")) +
          " " +
          t("minutes") +
          "\n"
        );
      if (prop === "pageWordGoal")
        return (
          acc +
          t("Write at least") +
          " " +
          state.get("pageWordGoal") +
          " " +
          t("words") +
          "\n"
        );
    }, "");

  return message;
};

utils.getRules = function () {
  return ["pageTimeLimit", "pageWordGoal"]
    .map((key) => {
      if (!state.get(key)) return false;
      else return { [key]: state.get(key) };
    })
    .filter(Boolean);
};

utils.isEmbedded = function () {
  try {
    return window.self !== window.top;
  } catch (e) {
    return true;
  }
};

utils.debounce = function (func, wait, immediate) {
  var timeout;
  return function () {
    var context = this,
      args = arguments;
    var later = function () {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };
    var callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
};

utils.tryJson = function (jsonString) {
  try {
    var o = JSON.parse(jsonString);
    if (o && typeof o === "object") return o;
  } catch (e) {}

  return {};
};

var actions = {
  copy: (e) => {
    e.preventDefault();
    e.stopPropagation();
    writeConfigure.hide();
    const enabled = writeSheet.enabled();
    writeSheet.enable();
    writeSheet.select();
    document.execCommand("copy");
    writeSheet.deselect();
    if (utils.isMobile()) {
      setTimeout(() => {
        writeSheet.el().blur();
      }, 0);
    }
    writeFlash.show({ message: t("Copied all text to clipboard") });
    writeLog("Button Copy");
    writeCursor.reset();
    if (!enabled) writeSheet.disable();
  },
  spellcheck: (e) => {
    e.preventDefault();
    e.stopPropagation();
    writeConfigure.hide();
    const bool = state.set("spellcheck", !state.get("spellcheck"));
    writeLog("Spellcheck", { props: { type: bool ? "enabled" : "disabled" } });
    writeFlash.show({
      message: t("Spellcheck " + (bool ? "enabled" : "disabled")),
    });
  },
  preview: (e) => {
    e.preventDefault();
    e.stopPropagation();
    writeConfigure.hide();
    const bool = state.set("preview", !state.get("preview"));
    writeLog("Preview", {
      props: { type: bool ? "Enter preview" : "Exit preview" },
    });
    writePreview.toggle(bool);
    //if (bool) writeFlash.show({message: "Previewing"})
  },
  retry: (e) => {
    e.preventDefault();
    e.stopPropagation();
    writeConfigure.hide();
    // it's clear not retry

    const hasConfirmation =
      e.target.tagName === "A" ||
      state.get("pageTimeLimit") ||
      state.get("pageWordGoal");

    if (!hasConfirmation) {
      writeLog("Text cleared");
      write.reset({ undo: true });
    } else {
      const confirmation = confirm(
        t("Your text will be cleared, are you sure?")
      );
      if (!confirmation) return;
    }

    const failedFlashMessage = dom.gid("failed");
    writeLog("Button Retry");
    if (failedFlashMessage)
      failedFlashMessage.parentNode.removeChild(failedFlashMessage);
    write.reset();
  },
  clear: () => {
    e.preventDefault();
    write.clear();
  },
  restore: () => {
    Object.entries(write.buffer).forEach((keyVal) => {
      state.set(keyVal[0].split("-")[0], keyVal[1]);
    });
    writeSheet.setContent(state.get("pageContent"));
    writeLog("Text restored");
    writeFlash.hide();
  },
  fullscreen: () => {
    writeFullscreen.toggleFullscreen();
  },
  download: utils.download,
  copyUrl: () => {
    navigator.clipboard.writeText(window.location.href.split("?")[0]);
    writeFlash.show({ message: t("URL copied to clipboard") });
  },
};

// these are the homepage defaults which are overridden when a page is loaded

function WriteSettings() {
  const lang =
    navigator.language.substring(0, 2).toLowerCase() === "es" ? "es" : "en";
  const englishDescription = `
  🎵 Intro
  In the city where we ride,
  AK's got his name in lights,
  Always hitting targets right,
  Every day, and every night.

  🎵 Verse 1
  They call him AK 'cause 
  he don't fuckin' miss,
  Always sharp, never slips,
  When he wants it, goes for it,
  Bang-bang, never quits.

  AK's the one they talk about,
  Got the power, no doubt,
  When he's rolling through the crowd,
  You can hear them niggas shout out loud:

  🎵 Chorus
  AK don't miss, AK don't miss,
  When he takes aim, you know it's his,
  AK don't miss, AK don't miss,
  Straight shooter, always hits.

  🎵 Verse 2
  From the streets to the stage,
  AK's turning every page,
  Rising up, making waves,
  Setting fire, leaving blaze.

  Got the moves, got the style,
  Going strong, mile after mile,
  With a grin and a smile,
  He's been winning all the while.

  🎵 Chorus
  AK don't miss, AK don't miss,
  When he takes aim, you know it's his,
  AK don't miss, AK don't miss,
  Straight shooter, always hits.

  🎵 Bridge
  In the game, he's a legend, 
  rising to the top,
  Doesn't matter what it is, AK makes it pop,
  Focused, driven, with a heart of steel,
  When AK's in the zone, it's surreal.

  🎵 Chorus
  AK don't miss, AK don't miss,
  When he takes aim, you know it's his,
  AK don't miss, AK don't miss,
  Straight shooter, always hits.

  🎵 Outro
  In the city where we ride,
  AK's got his name in lights,
  Always hitting targets right,
  Every day, and every night.

  `;

  const spanishDescription = `
 Joder muchachos
`;

  const emptyIcon = `<svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-editor">
    <style>
        path { fill: black; }
        @media (prefers-color-scheme: dark) { path { fill: white; }}
    </style>
    <path d="M10 0H2C0.9 0 0 0.9 0 2V18C0 19.1 0.89 20 1.99 20H14C15.1 20 16 19.1 16 18V6L10 0ZM14 18H2V2H9V7H14V18Z"/>
  </svg>`;

  const populatedIcon = `<svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-editor">
    <style>
      path { fill: black; }
      @media (prefers-color-scheme: dark) { path { fill: white; }}
    </style>
    <path d="M4 14H12V16H4V14ZM4 10H12V12H4V10ZM10 0H2C0.9 0 0 0.9 0 2V18C0 19.1 0.89 20 1.99 20H14C15.1 20 16 19.1 16 18V6L10 0ZM14 18H2V2H9V7H14V18Z" />
  </svg>`;

  return {
    pageTitle:
      window.location.pathname.split("/").length - 1 > 1
        ? lang === "es"
          ? "Cargando..."
          : "Loading..."
        : lang === "es"
        ? "Página en blanco"
        : "Blank Page",
    pageTheme: "d", // [a,b,c,d,e,f,g]
    pageId: "",
    pageCourseId: "",
    pageCourseOrder: "",
    pagePlaceholder: "",
    pageDestinationEmail: "",
    pageRedirectUrl: "",
    pageConfirmationTitle: lang === "es" ? "¡Éxito!" : "Success!",
    pageConfirmationMessage:
      lang === "es" ? "Guardamos tu contenido" : "Your content was saved",
    pageConfirmationAction: "",
    pageConfirmationActionButtonLabel: "",
    pageConfirmationActionButtonUrl: "",
    pageSubmitLabel: "Submit",
    pageContent: "",
    pageDescription: lang === "es" ? englishDescription : spanishDescription,
    pageImageUrl: "",
    pageWordGoal: 0,
    pageTimeLimit: 0,
    pageLanguage: "",
    pageStartDate: false,
    pageEndDate: false,
    pageShare: false,
    pageDisablePaste: false,
    pageSpellcheck: false,
    pageDisableBackspace: false,
    pageSpaceId: 0,
    pageAuthorName: false,
    pageAuthorEmail: false,
    pageCreationDate: Date.now(),
    pageElapsed: 0,
    pageWordCount: 0,
    pageScroll: 0,
    pageSelectionStart: 1, //if set to zero causes text caret bug
    pageSelectionEnd: 1,
    pageVisited: false,
    pageUrl: "https://blank.page",
    darkmode: window.matchMedia
      ? window.matchMedia("(prefers-color-scheme: dark)").matches
      : false,
    language: lang,
    builder: false,
    keyboardIdle: 0,
    pageAuthorId: 0,
    belongsToExercise: "",
    userEmail: "",
    userName: "",
    spellcheck: false,
    preview: false,
    // not builder
    configureOptions: [
      {
        label: "Word goal",
        type: "pageWordGoal",
        cb: (val) => {
          writeLog("Word Goal", { props: { Count: val } });
          state.set("pageWordGoal", val);
        },
      },
      {
        label: "Time limit",
        type: "pageTimeLimit",
        cb: (val) => {
          writeLog("Time Limit", { props: { Mins: val } });
          state.set("pageTimeLimit", utils.minsToMs(val));
        },
      },
      {
        label: "Language",
        type: "pageLanguage",
        cb: (val) => {
          writeLog("Language", { props: { Language: val } });
          state.set("pageLanguage", val);
        },
      },
      // { label: "separator"},
      // { label: "Create prompt (coming soon)",  cb: (val)=> state.set("pageWordGoal", val)  }
    ],
    wordcountOptions: [
      {
        label: "Clear",
        shortcut: utils.isMac ? "⇧⌘X" : "Shift Ctrl—X",
        cb: actions.retry,
      },
      {
        label: "Copy",
        shortcut: utils.isMac ? "⇧⌘C" : "Shift Ctrl—C",
        cb: actions.copy,
      },
      {
        label: "Download",
        shortcut: utils.isMac ? "⌘S" : "Ctrl—S",
        cb: actions.download,
      },
    ],
    enDescription: englishDescription,
    esDescription: spanishDescription,
    emptyIcon: emptyIcon,
    populatedIcon: populatedIcon,
  };
}

const settings = new WriteSettings();

const dao = [
  // public, appears in builder

  // The title of the page
  {
    name: "pageTitle",
    label: "Title",
    type: "string",
    default: settings.pageTitle,
    private: false,
    save: false,
  },

  {
    name: "pageTheme",
    label: "Theme",
    type: "string",
    default: settings.pageTheme,
    private: false,
    save: false,
  },

  {
    name: "pageId",
    label: "URL",
    type: "id",
    default: settings.pageId,
    private: false,
    save: true,
  },

  {
    name: "pageCourseId",
    label: "Course ID",
    type: "string",
    default: settings.pageCourseId,
    private: false,
    save: false,
  },

  {
    name: "pageCourseOrder",
    label: "Order",
    type: "number",
    default: settings.pageCourseOrder,
    private: false,
    save: false,
  },

  // The prompt for this exercise
  {
    name: "pagePlaceholder",
    label: "Placeholder",
    type: "string",
    default: settings.pagePlaceholder,
    private: false,
    save: false,
  },

  {
    name: "pageDestinationEmail",
    label: "Email reply to",
    type: "email",
    default: settings.pageDestinationEmail,
    private: false,
    save: false,
  },

  // after the user submits, where do we send him?
  {
    name: "pageRedirectUrl",
    label: "Redirect after submission",
    type: "url",
    default: settings.pageRedirectUrl,
    private: false,
    save: false,
  },

  {
    name: "pageConfirmationAction",
    label: "Action",
    type: "string",
    default: settings.pageConfirmationAction,
    private: false,
    save: false,
  },

  {
    name: "pageConfirmationActionButtonLabel",
    label: "Button label",
    type: "string",
    default: settings.pageConfirmationActionButtonLabel,
    private: false,
    save: false,
  },

  {
    name: "pageConfirmationActionButtonUrl",
    label: "Button link",
    type: "string",
    default: settings.pageConfirmationActionButtonUrl,
    private: false,
    save: false,
  },

  {
    name: "pageConfirmationTitle",
    label: "Confirmation Title",
    type: "url",
    default: settings.pageConfirmationTitle,
    private: false,
    save: false,
  },

  {
    name: "pageConfirmationMessage",
    label: "Confirmation Message",
    type: "string",
    default: settings.pageConfirmationMessage,
    private: false,
    save: false,
  },

  // Text on the submit button
  {
    name: "pageSubmitLabel",
    label: "Submit button text",
    type: "url",
    default: settings.pageSubmitLabel,
    private: false,
    save: false,
  },

  // The content of the exercise
  {
    name: "pageContent",
    label: "Page Content",
    type: "string",
    default: settings.pageContent,
    private: true,
    save: true,
  },

  // The description of this exercise
  {
    name: "pageDescription",
    label: "Description",
    type: "string",
    default: settings.pageDescription,
    private: false,
    save: false,
  },
  // An accompanying image for the description
  // TODO change to pageDescriptionImageUrl
  {
    name: "pageImageUrl",
    label: "Description image",
    type: "url",
    default: settings.pageImageUrl,
    private: false,
    save: false,
  },
  // How many words are suggested for this exercise (soft requirement)
  {
    name: "pageWordGoal",
    label: "Word goal",
    type: "number",
    default: settings.pageWordGoal,
    private: false,
    save: true,
  },
  // How much time is allowed to complete the exercise
  {
    name: "pageTimeLimit",
    label: "Time limit",
    type: "number",
    default: settings.pageTimeLimit,
    private: false,
    save: true,
  },

  // The laguage of the page
  {
    name: "pageLanguage",
    label: "Language",
    type: "string",
    default: "",
    private: false,
    save: false,
  },

  // when the page is available for submissions
  {
    name: "pageStartDate",
    label: "Start date",
    type: "date",
    default: settings.pageStartDate,
    private: false,
    save: false,
  },

  // when the page is blocked for submissions
  {
    name: "pageEndDate",
    label: "End date",
    type: "date",
    default: settings.pageEndDate,
    private: false,
    save: false,
  },

  {
    name: "pageShare",
    label: "Enable sharing",
    type: "boolean",
    default: settings.pageShare,
    private: false,
    save: false,
  },

  // Can the user paste?
  {
    name: "pageDisablePaste",
    label: "Disable paste",
    type: "boolean",
    default: settings.pageDisablePaste,
    private: false,
    save: false,
  },

  // Enable spellcheck
  {
    name: "pageSpellcheck",
    label: "Enable spellcheck",
    type: "boolean",
    default: settings.pageSpellcheck,
    private: false,
    save: false,
  },

  // Disable backspace
  {
    name: "pageDisableBackspace",
    label: "Disable backspace",
    type: "boolean",
    default: settings.pageDisableBackspace,
    private: false,
    save: false,
  },

  // Page integration
  {
    name: "pageDestination",
    label: "Destination",
    type: "string",
    default: false,
    private: false,
    save: false,
  },

  /* Private, does not appear in builder */

  // author metadata
  {
    name: "pageAuthorName",
    label: "Page Author Name",
    type: "string",
    default: settings.pageAuthorName,
    private: true,
    save: true,
  },
  {
    name: "pageAuthorEmail",
    label: "Page Author Email",
    type: "email",
    default: settings.pageAuthorEmail,
    private: true,
    save: true,
  },

  // When this page was created
  {
    name: "pageCreationDate",
    label: "Page Creation Date",
    type: "string",
    default: settings.pageCreationDate,
    private: true,
    save: false,
  },
  // How many seconds have ellapsed since the user begun writing
  {
    name: "pageElapsed",
    label: "Page Elapsed",
    type: "number",
    default: settings.pageElapsed,
    private: true,
    save: true,
  },
  // How many words are in the exercise
  {
    name: "pageWordCount",
    label: "Page Word Count",
    type: "number",
    default: settings.pageWordCount,
    private: true,
    save: true,
  },
  // Scroll offset of the sheet
  {
    name: "pageScroll",
    label: "Page Scroll",
    type: "number",
    default: settings.pageScroll,
    private: true,
    save: true,
  },
  // Where does the selection start (or caret position)
  {
    name: "pageSelectionStart",
    label: "Page Selection Start",
    type: "number",
    default: settings.pageSelectionStart,
    private: true,
    save: true,
  },
  // Where the selection ends
  {
    name: "pageSelectionEnd",
    label: "Page Selection End",
    type: "number",
    default: settings.pageSelectionEnd,
    private: true,
    save: true,
  },

  // Page URL
  {
    name: "pageUrl",
    label: "Page URL",
    type: "url",
    default: settings.pageUrl,
    private: true,
    save: false,
  },

  // if it is the first time visitor we onboard them
  {
    name: "pageVisited",
    label: "Has visited before",
    type: "boolean",
    default: settings.pageVisited,
    private: true,
    save: true,
  },
  // system level fields
  {
    name: "darkmode",
    label: "Dark Mode",
    type: "boolean",
    default: settings.darkmode,
    private: true,
    save: true,
  },
  // internal, to display the builder sidebar
  {
    name: "builder",
    label: "Builder",
    type: "boolean",
    default: settings.builder,
    private: true,
    save: true,
  },

  // how many seconds have passed since the user typed something
  // mostly for showing UI, but we could also use it for stream of
  // thought exercises where you can't pause while writing.
  {
    name: "keyboardIdle",
    label: "Keyboard Idle",
    type: "number",
    default: settings.keyboardIdle,
    private: true,
    save: false,
  },

  // we need a page author
  {
    name: "pageAuthorId",
    label: "Page Author Id",
    type: "string",
    default: settings.pageAuthorId,
    private: true,
    save: false,
  },

  // in order to save completed exercises
  // in the correct exerciseId within a page
  {
    name: "belongsToExercise",
    label: "Belongs to exercise",
    type: "string",
    default: settings.belongsToExercise,
    private: true,
    save: false,
  },

  {
    name: "userEmail",
    label: "Email",
    type: "email",
    default: settings.userEmail,
    private: true,
    save: true,
  },

  {
    name: "userName",
    label: "Name",
    type: "string",
    default: settings.userName,
    private: true,
    save: true,
  },

  {
    name: "spellcheck",
    label: "Spellcheck",
    type: "boolean",
    default: settings.spellcheck,
    private: true,
    save: true,
  },

  // don't need to save previewing state
  {
    name: "preview",
    label: "Preview",
    type: "boolean",
    default: false,
    private: true,
    save: false,
  },

  // public editor default language
  {
    name: "language",
    label: "Language",
    type: "string",
    default: settings.language,
    private: true,
    save: true,
  },

  // enable/disable ai capabilities
  {
    name: "ai",
    label: "AI Assistant",
    type: "boolean",
    default: false,
    private: true,
    save: true,
  },
];

dao.forEach((thing) => {
  thing.clean = function (value) {
    if (thing.type === "number") return isNaN(value) ? 0 : parseInt(value, 10);
    if (thing.type === "string") return value || "";
    if (thing.type === "email") return value || "";
    if (thing.type === "boolean")
      return value === "true" || value === true ? true : false;
    if (thing.type === "url") return value || "";
    if (thing.type === "id") return value || 0;
    if (thing.type === "array")
      return Array.isArray(value) ? value : value ? value.split(",") : [];
    if (thing.type === "object")
      return utils.isObject(value) ? utils.tryJson(value) : {};
    if (thing.type === "date")
      return typeof value === "string" ? new Date(value) : value;
    else throw "type " + thing.type + " does not exist";
  };
});

const firebaseConfig = {
  apiKey: "AIzaSyDgl39lQ6_EpuukByX3wu9spYVeqyr0-nw",
  authDomain: "blankpage-2023.firebaseapp.com",
  projectId: "blankpage-2023",
  storageBucket: "blankpage-2023.appspot.com",
  messagingSenderId: "219853672617",
  appId: "1:219853672617:web:0b79aeae6706eb539799b8"
};

function FirebaseApp(config) {
  firebase.initializeApp(config);
  const db = firebase.firestore();

  function signIn(cb) {
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        state.set('pageAuthorId', user.uid);
        if (cb) cb();
      } else {
        return firebase
          .auth()
          .signInAnonymously()
          .then(function(user) {
            state.set('pageAuthorId', user.uid);
            if (cb) cb();
          })
          .catch(function(error) {
            console.error(error);
          });
      }
    });
  }

  // pages are saved from builder
  function saveExercise(data) {
    const docId = data.pageId;
    const user = firebase.auth().currentUser;
    const courseId = state.get("pageCourseId");
    if (!user) throw "No user";
    console.log("saving " + docId);

    const courseName = courses.find(course => course.courseId === courseId).name
    const courseRef = db.collection("courses").doc(courseId).set({name: courseName}, {merge: true});
    const pageRef = db.collection("courses").doc(courseId).collection("exercises").doc(docId);
    
    pageRef.get()
      .then(page => {
        if (page.exists) {
          const ok = confirm("This page already exists, should it be updated?");
          if (!ok) return Promise.reject("cancel"); 
          pageRef.set({
            ...data,
            pageAuthorId: user.uid,
          })
        }
        else {
          pageRef.set({
            ...data,
            pageAuthorId: user.uid,
          })
        }
      })
      .then(function(res) {
        if (res !== "cancel") window.open(data.pageUrl);
      })
      .catch(function(error) {
        if (res === "cancel") return;
        window.alert(
          'The page could not be saved',
        );
      });
     return docId
  }

  function saveCompletedExercise(data, cb) {
    const user = firebase.auth().currentUser;
    if (!user) throw "No user";
    console.log("saving: " + data.pageId + " in document " + data.belongsToExercise);
    db
      .collection("courses")
      .doc(data.pageCourseId)
      .collection("exercises")
      .doc(data.belongsToExercise)
      .collection("completed")
      .doc(data.pageId)
      .set({...data})
      .then(function(w) {
        cb("success")
      })
      .catch(function(error) {
        console.log(error)
        cb("error")
      });
     return data.pageId
  }

  function getCompletedExercise(courseId, pageId, exerciseId) {
    
    return db.collection("courses")
      .doc(courseId)
      .collection("exercises")
      .doc(pageId)
      .collection("completed")
      .doc(exerciseId)
      .get()
      .then(configure);
  }

  function countExercises(courseId){
    return db.collection("courses")
      .doc(courseId)
      .collection("exercises")
      .where("pageCourseOrder", ">", "0")
      .get().then(snap => {
        return snap.size
      });
  }

  function getExercises(courseId, name) {

    if (!courseId) return false;

    return db.collection("courses").doc(courseId).collection("exercises").orderBy('pageCourseOrder').get().then((querySnapshot) => {
      let content = `<div class="prompt-list">
        <div class="prompt-header">
          <h2>${name}</h2>
          <div>
           <a href="https://build.blank.page/${courseId}" class="button accent">${t("Build prompt")}</a> 
          </div>
        </div>
        <table class="prompt-table">
          <tr><th>Prompts</th><th colspan="2">Replies</th></tr>
      `;


      querySnapshot.forEach((doc) => {
        const data = doc.data();

        doc.ref.collection('completed').get().then(snap => {
          const link = dom.gid("replies-" + data.pageId);
          if (link) link.textContent = snap.size;
        });

        if (data.pageUrl) {
          content += `<tr>
            <td class="prompt-title"> ${parseInt(data.pageCourseOrder, 10) ? "<span>" + data.pageCourseOrder + "</span>" : ""} <a href="${data.pageUrl}">${data.pageTitle}</a></td>
            <td class="prompt-actions">
              <a target="_blank" href="${data.pageUrl.replace("https://blank.page/", "https://build.blank.page/")}">Edit</a>
              <a href="${data.pageUrl}" title="Copy link" onclick="event.preventDefault(); utils.copyText('${data.pageUrl}')">🔗</a>
            </td>
            <td><a href="${data.pageUrl}/replies" id="replies-${data.pageId}">--</a></td>
          </tr>
        `;
        }
        return data
      });

      content += `</table>
      </div>
      <div class="prompt-list-footer">
        <a href="https://cursos.blank.page/ayuda">Help</a>
        <a href="https://cursos.blank.page/contacto">Feedback</a>
      </div>`;

      writeSheet.setContent(content); 
      writeReader.enable(content);
      writePage.remove("loading");
      dom.qs(".header-icons").style.display = "none";
      dom.qs(".page-title").style.display = "none";
      state.set("pageTitle", "Writing prompts for " + name)
    });

  }

  function getCompletedExercises(courseId, pageId, exerciseId) {
    console.log("getCompletedExercises")
    return db.collection("courses")
      .doc(courseId)
      .collection("exercises")
      .doc(pageId)
      .collection("completed")
      .get()
      .then((querySnapshot) => {
        let content = "### " + pageId + "\n";
        content += "\n";
        content += "**Writing prompts**\n";
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          content += `* [${data.pageAuthorName}](${data.pageUrl})
`
          return data
        });

        writeSheet.setContent(content); 
        writeReader.enable(content); 
        state.set("pageTitle", "Replies for " + pageId)

      });
  }

  function getExercise(courseId, pageId) {

    if (!pageId || !courseId) return false;

    return db.collection("courses")
      .doc(courseId)
      .collection("exercises")
      .doc(pageId)
      .get()
      .then(configure);
  }

  function deleteExercise(courseId, pageId) {

    console.log(courseId, pageId);

    //if (!pageId || !courseId) return false;
//
    //return db.collection("courses")
    //  .doc(courseId)
    //  .collection("exercises")
    //  .doc(pageId)
    //  .get()
    //  .then(configure);
  }

  function configure(res) {
    const data = res.data();

    if (!data) {
      alert('Page does not exist');
      return window.location = window.location.origin
    }

    Object.keys(data).forEach(function(key) {
      // because we don't want to trigger a pageContent change through state
      if (key === "pageContent") { 
        writeSheet.setContent(data[key]); 
        writeReader.enable(data[key]); 
      }
      state.set(key, data[key]);
    });

    dom.qs("body").classList.remove("loading");

    writeBuilder.update();

    write.hydrate();
    writeSheet.focus();
  }

  this.signIn = signIn;
  this.getExercise = getExercise;
  this.deleteExercise = deleteExercise;
  this.getExercises = getExercises;
  this.countExercises = countExercises;
  this.getCompletedExercises = getCompletedExercises;
  this.getCompletedExercise = getCompletedExercise;
  this.saveExercise = saveExercise;
  this.saveCompletedExercise = saveCompletedExercise;
}

function State() {
  const _self = this;
  const paramId = window.location.pathname;
  const ID = "-" + (paramId || 0);
  const tenThousandThings = dao.map((thing) => thing.name);
  const saveableKeys = dao
    .filter((thing) => thing.save)
    .map((thing) => thing.name);

  this.data = _loadData();

  this.set = (key, val) => {
    key = key.split("-")[0] || key;
    if (tenThousandThings.indexOf(key) === -1)
      return console.warn(key + " not in dao");
    const archetype = dao.find((thing) => thing.name === key);
    val = _self.data[_getKey(key)] = archetype.clean(val);
    if (~saveableKeys.indexOf(key)) _save(_getKey(key), val);
    if (!_self[key]) return console.warn(key + " not implemented");
    _self[key](val);
    return val;
  };

  this.get = (key) => {
    return _self.data[_getKey(key)];
  };

  this.refresh = () => {
    dao.forEach((thing) => this[thing.name](this.get(thing.name)));
  };
  this.pageId = (id) => {};

  // assignments
  this.pageIntegration = (name) => {
    /* noop */
  };

  // page data
  this.pageCourseId = (id) => {
    /* noop */
  };
  this.pageCourseOrder = (id) => {
    /* noop */
  };
  this.pageAuthorId = (user) => {
    /* noop */
  };
  this.pageDestinationEmail = (email) => {
    /* writeSidebar.destinationEmail(email) */
  };
  this.pageUrl = (url) => {
    writeMeta.og("og:url", url);
  };
  this.pageAuthorEmail = (email) => {
    /* noop */
  };
  this.pageAuthorName = (name) => {
    writePage.pageAuthorName(name);
  };
  this.pageDescription = (desc) => {
    writeSidebar.description(desc);
  };
  this.pageTitle = (title) => {
    writeTitle.set(title);
    writeMeta.og("og:title", title);
  };
  this.pageImageUrl = (url) => {
    writeSidebar.image(url);
  };
  this.pagePlaceholder = (string) => {
    writeSheet.placeholder(string);
  };
  this.pageCreationDate = (date) => {
    /* noop */
  };
  this.pageWordCount = (val) => {
    writeCount.update();
  };
  this.pageRedirectUrl = (url) => {
    writePage.pageRedirectUrl(url);
  };
  this.pageTheme = (letter) => {
    writePage.pageTheme(letter);
  };
  this.pageShare = (bool) => {
    writePage.pageShare(bool);
  };
  this.pageDestination = (bool) => {};
  this.pageConfirmationTitle = (bool) => {};
  this.pageConfirmationMessage = (bool) => {};
  this.pageConfirmationAction = (bool) => {};
  this.pageConfirmationActionButtonLabel = (bool) => {};
  this.pageConfirmationActionButtonUrl = (bool) => {};

  // page constraints
  this.pageElapsed = (ms) => {
    writePage.tick(ms);
  };
  this.pageTimeLimit = (limit) => {
    writePage.setTimeLimit(limit);
  };
  this.pageDisablePaste = (bool) => {
    writePage.disablePaste(bool);
  };
  this.pageWordGoal = (goal) => {
    writePage.setWordGoal(goal);
  };
  this.pageScroll = (scroll) => {
    /* noop */
  };
  this.pageSelectionStart = (start) => {
    /* noop */
  };
  this.pageSelectionEnd = (end) => {
    writeSheet.scrollToBottom(end);
  };
  this.pageSpellcheck = (bool) => {
    writeSheet.spellcheck(bool);
  };
  this.pageStartDate = (date) => {
    writePage.setStartDate(date);
  };
  this.pageEndDate = (date) => {
    writePage.setEndDate(date);
  };
  this.pageDisableBackspace = (bool) => {
    /* noop */
  };
  this.pageLanguage = (lang) => {
    writePage.setLanguage(lang);
  };
  this.language = (lang) => {
    writePage.setLanguage(lang);
  };
  this.pageSubmitLabel = (string) => {
    writeSubmit.label(string);
  };
  this.pageVisited = (bool) => {
    /* noop */
  };
  this.darkmode = (bool) => {
    writePage.darkMode(bool);
  };
  this.pasted = () => {
    /* noop */
  };
  this.spellcheck = (bool) => {
    writeSheet.spellcheck(bool);
  };
  this.keyboardIdle = (ms) => {
    writePage.keyboardIdleTick(ms);
  };
  this.userEmail = (email) => {
    /* noop */
  };
  this.userName = (name) => {
    /* noop */
  };
  this.belongsToExercise = (pageSlug) => {
    /* noop */
  };
  this.preview = (bool) => {
    writePreview.toggle(bool);
  };
  this.builder = (bool) => {
    writeBuilder.toggle(bool);
  };
  this.ai = (bool) => {};

  this.pageContent = (value) => {
    state.set("pageWordCount", utils.wordCount(value));
    if (value) write.start();
    else writeSheet.clear();
    write.change();
  };

  this.clean = (warn = true) => {
    if (warn) {
      const confirmed = confirm(
        "Deletes all configuration and text, are you sure?"
      );
      if (!confirmed) return;
    }

    Object.keys(localStorage).forEach((key) => localStorage.removeItem(key));
    write.reset();
    window.location.reload();
  };

  // INNER UTILS

  function _save(key, val) {
    if (val === undefined || val === null)
      throw "wont save nuthin, " + key + " " + val;
    localStorage.setItem("write" + "-" + key, val.toString());
  }

  function _getKey(name) {
    const key =
      name.indexOf("page") !== -1 || name.indexOf("assignment") !== -1
        ? name + ID
        : name + "-0"; // system
    return key;
  }

  function _loadData() {
    const data = dao.map((thing) => {
      return {
        [_getKey(thing.name)]: _getValue(
          _getKey(thing.name),
          utils.findGetParameter(thing.name) || thing.default
        ),
      };
    });
    return Object.assign({}, ...data);
  }

  function _getValue(key, def) {
    const item = localStorage.getItem("write-" + key) || def;
    const archetype = dao.find((thing) => thing.name === key.split("-")[0]);
    if (archetype) return archetype.clean(item);
    else throw "Unkown archetype";
  }
}

function WriteCursor(selector) {
  // cant bind el because it is removed and replaced

  function select(start, end) {
    const el = dom.qs(selector);
    el.focus();
    if (!start) start = 0;
    if (!end) end = el.value.length;
    el.selectionStart = start;
    el.selectionEnd = end;
  }

  function trimSelection() {
    const el = dom.qs(selector);
    el.focus();
    let string = writeSheet.getSelection();
    if (/^\s|\s$/.test(string)) {
      string = string.trim();
      const content = writeSheet.getContent();
      const indexStart = content.indexOf(
        string,
        writeSheet.el().selectionStart
      );
      writeCursor.select(indexStart, string.length + indexStart);
    }
  }

  function hide(start, end) {
    const el = dom.qs(selector);
    el.blur();
    if (!start) start = 0;
    if (!end) end = el.value.length;
    el.selectionStart = start;
    el.selectionEnd = end;
  }

  function place(pos) {
    if (!pos) return;
    const el = dom.qs(selector);
    el.focus();
    el.selectionStart = pos;
    el.selectionEnd = pos;
  }

  function getPosition() {
    const el = dom.qs(selector);
    el.focus();
    return [el.selectionStart, el.selectionEnd];
  }

  function deselect() {
    if (window.getSelection) {
      window.getSelection().removeAllRanges();
    } else if (document.selection) {
      document.selection.empty();
    }
  }

  function reset() {
    select(state.get("pageSelectionStart"), state.get("pageSelectionEnd"));
    writeSheet.el().scrollTop = state.get("pageScroll");
  }

  function set() {
    const el = dom.qs(selector);
    state.set("pageSelectionStart", el.selectionStart);
    state.set("pageSelectionEnd", el.selectionEnd);
  }

  this.select = select;
  this.trimSelection = trimSelection;
  this.place = place;
  this.getPosition = getPosition;
  this.deselect = deselect;
  this.reset = reset;
  this.set = set;
  return this;
}

function WriteSheet() {
  var form = dom.create({ el: "form" }, dom.gid("page"));

  var el = dom.create(
    {
      el: "textarea",
      id: "sheet",
      tabindex: 0,
      class: "sheet",
    },
    form
  );

  function spellcheck(bool) {
    // in order for the spellcheck to properly show/hide underlines we need
    // to add/remove the textarea and readd event listeners.
    const spellcheckButton = dom.gid("spellcheck");
    spellcheckButton.classList.toggle("active", bool);
    const classNames = el.getAttribute("class");
    const ph = el.getAttribute("placeholder");
    const clone = el.cloneNode(true);
    el.parentNode.removeChild(el);
    el = clone;
    el.setAttribute("spellcheck", Boolean(bool));
    dom.gid("page").appendChild(el);

    // todo should remove addeventlisteners these upon deletion

    el.addEventListener("input", (e) => {
      const command =
        navigator.platform.toUpperCase().indexOf("MAC") >= 0
          ? e.metaKey
          : e.ctrlKey;
      const shift = e.shiftKey;

      const disableBackspace = state.get("pageDisableBackspace");
      if (e.inputType === "deleteContentBackward" && disableBackspace) {
        e.preventDefault();
        const content = state.get("pageContent");
        const lastChar = content[content.length - 1];
        const beforeLastChar = content[content.length - 2];
        if (lastChar === " " && beforeLastChar !== " ") {
          writeFlash.show({
            class: "deleting-not-allowed",
            duration: 2000,
            message: t("Deleting words is not allowed"),
          });
          el.value = content;
        }
      }

      state.set("pageContent", el.value);
    });

    const focus = _.debounce(function () {
      writePage.focus();
    }, 50);
    const activate = utils.throttle(function () {
      focus.cancel();
      writePage.activate();
    }, 750);

    // focus = writing mode
    // activate = ui mode

    // el.addEventListener("mousemove", focus);
    dom.gid("page-ui").addEventListener("mousemove", activate);
    el.addEventListener("focus", (e) => {
      focus();
    });

    el.addEventListener("paste", (e) => {
      cancelAnimatedScrolling(1000);
      if (writeSheet.protected) return writePage.pasteNotAllowed(e);
      state.set("pageContent", el.value);
      paste(e);
    });

    const scrollFn = utils.debounce(
      () => state.set("pageScroll", el.scrollTop),
      50
    );
    el.addEventListener("scroll", scrollFn);

    // set caret and scroll to the correct position on load
    cancelAnimatedScrolling(50);
    setTimeout(function () {
      if (writeBuilder.active) return;
      writeCursor.reset();
      scroll(state.get("pageScroll"));
    }, 0);
  }

  function paste(e) {
    var items = (e.clipboardData || e.originalEvent.clipboardData).items;

    for (index in items) {
      var item = items[index];

      // image upload
      if (item.kind === "file") {
        e.preventDefault();
        const clipboardData = e.clipboardData || window.clipboardData;
        var altText = clipboardData.getData("Text");
        var blob = item.getAsFile();
        var reader = new FileReader();
        reader.onload = function (e) {
          const dataUrl = e.target.result;
          pasteImage(dataUrl, altText);
        };
        reader.readAsDataURL(blob);
      }

      const isSelected = writeSheet.getSelection().length;
      // markdown links
      if (item.kind === "string" && isSelected) {
        const clipboardData = e.clipboardData || window.clipboardData;
        var url = clipboardData.getData("Text").trim();
        if (url.startsWith("http://") || url.startsWith("https://")) {
          // replace pasted text with markdown link
          e.preventDefault();
          const text = writeSheet.getSelection();
          const link = `[${text}](${url})`;
          writeLog("Paste URL", { props: { url: link } });
          writeSheet.replaceSelection(link);
        }
      }
    }
  }

  function placeholder(string) {
    if (!string || writeReader.enabled) return el.getAttribute("placeholder");
    writeMeta.og("og:description", string);
    writeMeta.set("description", string);
    el.setAttribute("placeholder", string);
  }

  function disable() {
    writeCursor.place(0);
    el.readOnly = true;
    el.classList.add("disabled");
  }

  function readonly(bool) {
    if (bool) el.setAttribute("readonly", "readonly");
    else el.removeAttribute("readonly");
  }

  function enable() {
    el.removeAttribute("readonly");
    el.classList.remove("disabled");
  }

  function scrollToBottom(caretPos) {
    // if there's a selection don't scroll to bottom
    if (el.selectionStart !== el.selectionEnd) return;
    if (caretPos === state.get("pageContent").length)
      el.scrollTop = el.scrollHeight;
  }

  function enabled() {
    return !el.readOnly;
  }
  function focus() {
    el.focus();
  }
  function blur() {
    el.blur();
  }
  function select() {
    el.select();
  }
  function deselect() {
    window.getSelection().removeAllRanges();
  }
  function setContent(text) {
    el.value = text;
  }
  function getSelection() {
    return el.value.substring(el.selectionStart, el.selectionEnd);
  }
  function getContent() {
    return el.value;
  }
  function tick(s) {
    /*not implemented yet*/
  }
  function idleTick(s) {
    /*not implemented yet*/
  }
  function clear() {
    el.value = "";
  }

  function replaceSelection(string) {
    document.execCommand("insertText", false, string);
    state.set("pageContent", state.get("pageContent"));
  }

  function pasteImage(data, altText) {
    firebaseApp.signIn(() => uploadImage(data));

    function uploadImage(data) {
      var storage = firebase.storage().ref();
      let uId =
        Date.now().toString(36) + Math.random().toString(36).substring(2);
      let fileExtension = false;

      writeLog("Paste upload denied", {
        props: { type: data.split(":")[1].split(";")[0] },
      });

      // file upload disabled because bandwidth

      // let fileExtension = data.includes("image/png") ? "png"
      //   : data.includes("image/jpeg") || data.includes("image/jpg") ? "jpg"
      //   : data.includes("image/svg") ? "svg"
      //   : data.includes("video/quicktime") ? "mov"
      //   : data.includes("video/mp4") ? "m4v"
      //   : false;
      if (!fileExtension) {
        writeFlash.show({
          class: "upload",
          duration: 2000,
          message: data.split(":")[1].split(";")[0] + " not allowed",
        });
        return false;
      }
      var fileName = uId + "." + fileExtension;
      var imageRef = storage.child(fileName);
      var uploadTask = imageRef.putString(data, "data_url");
      uploadTask.on(
        "state_changed",
        (snapshot) => {
          // Observe state change events such as progress, pause, and resume
          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
          var progress = (
            (snapshot.bytesTransferred / snapshot.totalBytes) *
            100
          ).toFixed(0);
          if (writeFlash.el.classList.contains("hidden")) {
            writeFlash.show({
              class: "upload",
              duration: 10000,
              message: progress + "% uploaded",
            });
          } else
            writeFlash.el.innerHTML = "<span>" + progress + "% uploaded</span>";

          switch (snapshot.state) {
            case firebase.storage.TaskState.PAUSED: // or 'paused'
              writeFlash.show({
                class: "upload",
                duration: 2000,
                message: "Upload is paused",
              });
              break;
            case firebase.storage.TaskState.RUNNING: // or 'running'
              break;
          }
        },
        (error) => {
          console.log(error);
        },
        () => {
          // Handle successful uploads on complete
          // For instance, get the download URL: https://firebasestorage.googleapis.com/...
          writeFlash.el.innerHTML;
          uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
            console.log(downloadURL);
            var img = new Image();
            img.src = downloadURL;
            writeFlash.hide();
            const message = `${getContent()}\n![${
              altText ? altText : "alt text"
            }](${downloadURL})`;
            setContent(message);
            state.set("pageContent", message);
          });
        }
      );
    }
  }

  function newLine() {
    document.execCommand("insertText", false, "\n");
    scroll(state.get("pageScroll"));
  }

  function newTab() {
    const start = el.selectionStart;
    const end = el.selectionEnd;
    const content = getSelection();
    const tabKey = "    ";
    document.execCommand("insertText", false, tabKey);
  }

  function cancelAnimatedScrolling(ms) {
    el.classList.add("jump");
    setTimeout(function () {
      el.classList.remove("jump");
    }, ms);
  }

  function scroll(amount) {
    cancelAnimatedScrolling(50);
    el.scrollTop = amount;
  }

  function toggle(bool) {
    el.style.display = bool ? "block" : "none";
  }

  function bold() {
    formatText("bold");
  }
  function italic() {
    formatText("italic");
  }

  function formatText(type) {
    const formatChar = type === "italic" ? "_" : "**";
    let selection = writeCursor.getPosition();
    const content = getContent();

    // remove
    const isItalic =
      type === "italic" &&
      getContent().slice(selection[0] - 1, selection[0]) === "_" &&
      getContent().slice(selection[1], selection[1] + 1) === "_";
    const isBold =
      type === "bold" &&
      getContent().slice(selection[0] - 2, selection[0]) === "**" &&
      getContent().slice(selection[1], selection[1] + 2) === "**";
    if (isItalic || isBold) {
      writeLog("Removed " + type);
      const selectedText = getSelection();
      writeCursor.select(
        selection[0] - formatChar.length,
        selection[1] + formatChar.length
      );
      writeSheet.replaceSelection(selectedText);
      writeSheet
        .el()
        .setSelectionRange(
          selection[0] - formatChar.length,
          selection[1] - formatChar.length
        );
      return;
    }

    // add
    writeCursor.trimSelection();
    selection = writeCursor.getPosition();
    const string = formatChar + writeSheet.getSelection() + formatChar;
    writeLog("Made " + type);
    writeSheet.replaceSelection(string);
    writeSheet
      .el()
      .setSelectionRange(
        selection[0] + formatChar.length,
        selection[1] + formatChar.length
      );
    writeCursor.set();
  }

  function insertLink() {
    let url = prompt(t("Link destination (URL)"));
    if (!url) return;
    url = utils.fixUrl(url);
    if (url.includes(" "))
      return writeFlash.show({ message: t("Destination is not a link") });
    // replace pasted text with markdown link
    const caretPos = writeCursor.getPosition();
    const notSelected = caretPos[0] === caretPos[1];
    const text = notSelected ? url : writeSheet.getSelection();
    const link = `[${text}](${url})`;
    writeLog("Insert URL", { props: { url: link } });
    writeSheet.replaceSelection(link);
    const startPos = writeCursor.getPosition()[0] - link.length + 1;
    const endPos = startPos + text.length;
    if (notSelected) writeCursor.select(startPos, endPos);
  }

  enable();
  spellcheck(state.get("spellcheck"));
  cancelAnimatedScrolling(50);
  scroll(state.get("pageScroll"));

  el.addEventListener("mouseup", writeCursor.set);
  el.addEventListener("selectionchange", writeCursor.set);

  this.focus = focus;
  this.spellcheck = spellcheck;
  this.placeholder = placeholder;
  this.disable = disable;
  this.enable = enable;
  this.enabled = enabled;
  this.readonly = readonly;
  this.select = select;
  this.getSelection = getSelection;
  this.replaceSelection = replaceSelection;
  this.deselect = deselect;
  this.setContent = setContent;
  this.paste = paste;
  this.pasteImage = pasteImage;
  this.tick = tick;
  this.getContent = getContent;
  this.el = function () {
    return el;
  };
  this.clear = clear;
  this.protected = false;
  this.scroll = scroll;
  this.scrollToBottom = scrollToBottom;
  this.cancelAnimatedScrolling = cancelAnimatedScrolling;
  this.toggle = toggle;
  this.newLine = newLine;
  this.newTab = newTab;
  this.insertLink = insertLink;
  this.bold = bold;
  this.italic = italic;
}

function WriteCount(selector) {
  const el = dom.qs(selector);
  if (!el) throw "el is missing";

  const wordCount = dom.create(
    {
      el: "span",
      class: "word-count",
      html: `0 ${t("words")}`,
    },
    el
  );

  const wpmCount = dom.create(
    {
      el: "span",
      class: "wpm-count",
      html: "0 wpm",
    },
    el
  );

  function hide() {
    el.classList.add("hidden");
  }

  function show() {
    el.classList.remove("hidden");
  }

  function update() {
    const count = state.get("pageWordCount");
    const elapsed = state.get("pageElapsed") / 1000;
    wordCount.innerHTML = `${count} ${t("words")}`;
    const wpmCountNumber =
      count > 2 && elapsed > 1
        ? `${Math.floor(count / (elapsed / 60))} wpm`
        : "0 wpm";
    wpmCount.innerHTML = wpmCountNumber;
  }

  this.update = update;
  this.show = show;
  this.hide = hide;
}

function Write(selector) {
  const el = dom.qs(selector);

  function hydrate(data = {}) {
    // rules
    const rules = utils.getRules();
    const isPrompt = state.get("pageCourseId");

    //translate
    writePage.setIcon(state.get("pageContent"));
    writePage.setLanguage(state.get("pageLanguage"));
    writePage.pageTheme(state.get("pageTheme"));
    // writeSidebar.destinationEmail(state.get("pageDestinationEmail"));
    writeSidebar.exerciseCount();
    writePage.setTitle();

    if (state.get("belongsToExercise")) {
      writeSidebar.toggle(false);
    }
    if (isPrompt) {
      writeSidebar.toggle(
        data.trigger !== "reset" &&
          !writeReader.enabled &&
          !state.get("pageContent").length
      );
      writeButtons.copy.toggle("hidden", true);
      writeButtons.download.toggle("hidden", true);
    } else {
    } // dig into localstorage to see if the homepage has been visited?

    const hasSubmit = state.get("pageCourseId");

    //share
    if (!dom.gid("social-share")) {
      if (state.get("pageShare") || writeBuilder.active) {
        dom.create(
          {
            el: "script",
            type: "text/javascript",
            id: "social-share",
            src: "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-60b20948966aec83",
          },
          document.body
        );
      }
    }

    if (writeReader.enabled) return hydrateReader();
    // if it's reader, it ends here

    const pageContent = state.get("pageContent") || "";

    //app
    writeSheet.cancelAnimatedScrolling(1000);
    writePage.toggle("populated", pageContent.length);
    writePage.toggle("empty", !pageContent.length);
    writePage.toggle("iframe", utils.isEmbedded());
    writePage.setWordGoal(state.get("pageWordGoal"));
    writePage.setTimeLimit(state.get("pageTimeLimit"));

    //sheet
    const content = state.get("pageContent");
    writeSheet.setContent(content);
    writeSheet.placeholder(state.get("pagePlaceholder"));
    writeSheet.focus();

    writeCount.update();
    writeProgress.update();

    // word count
    const wordCount = utils.wordCount(pageContent);
    state.set("pageWordCount", wordCount);

    //header
    state.set("pageTitle", state.get("pageTitle"));
    writePage.pageRedirectUrl(state.get("pageRedirectUrl"));

    if (hasSubmit) {
      writeConfigure.hide();
      writeConfigure.disable();
    }

    //timers
    elapsedTimer.set(state.get("pageElapsed"));

    //progress
    writeProgress.cancelTransitions();
    writeProgress.update();

    writeSubmit.applyRules(rules);

    if (!hasSubmit) writeSubmit.hide();
    else writeSubmit.show();

    writeSheet.focus();
    writePage.tick();
    if (pageContent.length) change();
  }

  function hydrateReader() {
    const param = window.location.search;
    writeAfterSubmit.build(param);
    writePage.activate();
    writeSheet.readonly(true);
  }

  function reset(attr = { undo: false }) {
    if (writeReader.enabled) return;

    if (attr.undo) {
      this.buffer = { ...state.data };
      writeSheet.select();
      document.execCommand("insertText", false, "");
      writeFlash.spawn({
        message: `${t(
          "Text cleared"
        )} <a onclick="javascript:actions.restore()">${t("Restore?")}</a>`,
        duration: false,
        class: "flash-restore",
      });
      if (utils.isMobile()) {
        setTimeout(() => {
          writeSheet.el().blur();
        }, 0);
      }
      return change();
    }

    const pageId = utils.generateUID();
    write.started = false;
    write.finished = false;
    state.set("pageContent", "");
    state.set("pageElapsed", 0);
    state.set("pageWordCount", 0);
    state.set("pageId", pageId);
    writeProgress.reset();
    elapsedTimer.stop();
    writeFlash.hide();
    writeSheet.enable();
    // todo shorten
    writePage.activate();
    writePage.remove("populated");
    writePage.remove("failed");
    writePage.remove("finished");
    write.hydrate({ trigger: "reset" });
  }

  function start() {
    if (write.started === true || writeReader.enabled) return;
    write.finished = false;
    elapsedTimer.start();
    write.started = true;
    change();
  }

  function change() {
    if (writeReader.enabled) return;
    const pageContent = state.get("pageContent");
    writePage.setIcon(pageContent);
    writePage.focus();
    writeConfigure.hide();

    // todo hack to reset the elapsed time after reload,
    // and delete
    if (!pageContent) state.set("pageElapsed", 0);
    if (
      !pageContent &&
      write.started &&
      !writeSheet.placeholder().includes(t("Sending"))
    )
      reset();

    const isEmpty = !pageContent.trim().length;
    const wordGoal = state.get("pageWordGoal");
    const count = state.get("pageWordCount");
    const timeLimit = state.get("pageTimeLimit");
    const elapsed = state.get("pageElapsed");

    const isFinished = wordGoal
      ? count > wordGoal
      : timeLimit
      ? elapsed > timeLimit
      : false;

    writeCount.update();
    writeAI.hide();
    if (isEmpty) writePage.activate();
    writePage.toggle("empty", isEmpty);
    writePage.toggle("populated", !isEmpty);
    writeProgress.update();
    writeCount.update();
    writePage.setTitle();

    if (isFinished) {
      var trigger = "wordGoal";
      if (timeLimit && elapsed > timeLimit) trigger = "timeLimit";
      write.finish(trigger);
    }
  }

  function finish(trigger) {
    if (write.finished === true) return;

    writeSubmit.enable();
    write.finished = true;
    writePage.add("finished");
    elapsedTimer.stop();

    const wordGoal = isNaN(state.get("pageWordGoal"))
      ? 0
      : state.get("pageWordGoal");
    const timeLimit = state.get("pageTimeLimit");
    const elapsed = state.get("pageElapsed");
    const wordCount = state.get("pageWordCount");

    writePage.activate();

    // todo this will not be restored when the challenge is reset
    state.set("pageDisableBackspace", false);

    if (trigger === "timeLimit") {
      writeSheet.disable();
      writeSheet.spellcheck(false);
      setTimeout(writeCursor.deselect, 0); // deselect
      writeSheet.disable();
      writeFlash.spawn({
        id: "failed",
        duration: false,
        message:
          `${t(
            "The time is up!"
          )}<a onclick="javascript:actions.retry(event)">${t("Retry?")}</a>` +
          " ",
      });

      if (state.get("pageWordCount") < state.get("pageWordGoal")) {
        writeSubmit.disable();
      }
    } else if (wordGoal && !writeBuilder.active) {
      setTimeout(function () {
        const message = `${t("You've reached")} ${wordGoal} ${t("words")}`;
        if (!writeReader.enabled)
          writeFlash.show({ duration: 3000, message: message });
        console.log(writeReader.enabled);
      }, 1000); // just so reader is enabled
    }
  }

  this.hydrate = hydrate;
  this.reset = reset;
  this.start = start;
  this.change = change;
  this.finish = finish;
  this.buffer = state.data;
  return this;
}

function WriteFlash(selector) {
  const el = dom.qs(selector);

  function show(attr) {
    el.classList.add(attr.class, "hidden");
    el.style.zIndex = 1000;
    if (attr.class) el.classList.add(attr.class);
    setTimeout(() => el.classList.remove("hidden"), 0);
    el.innerHTML = "<span>" + attr.message + "</span>";

    if (attr.duration !== false) {
      if (!attr.duration) attr.duration = 2000;
      setTimeout(hide, attr.duration);
    }

    dom.qsa(".flash-persistent").forEach((flashEl) => {
      flashEl.classList.add("hidden");
      setTimeout(function () {
        flashEl.classList.remove("hidden");
      }, attr.duration || 2000);
    });
  }

  function spawn(attr) {
    // don't know how to conditionally add the id
    const obj = attr.id
      ? { class: "flash hidden", id: attr.id }
      : { class: "flash hidden" };
    const clone = dom.gid(attr.id) || dom.create(obj, writePage.el);
    if (attr.duration === false) clone.classList.add("flash-persistent");
    if (attr.class) clone.classList.add(attr.class);
    setTimeout(() => clone.classList.remove("hidden"), 0);
    clone.innerHTML = "<span>" + attr.message + "</span>";

    if (attr.duration !== false) {
      if (!attr.duration) attr.duration = 2000;
      setTimeout(hide, attr.duration);
      setTimeout(function () {
        clone.parentNode.removeChild(clone);
      }, attr.duration + 10);
    }

    click(clone, attr.click);
  }

  function click(el, cb) {
    if (!cb) return (el.style.cursor = "default");
    el.style.cursor = "pointer";
    el.addEventListener("click", (e) => {
      e.stopPropagation();
      cb();
    });
  }

  function hide() {
    // todo hardcoded
    el.classList.remove("top");
    el.className = "flash hidden";
    el.style.zIndex = 0;
  }

  function clear() {
    span.innerHTML = "";
  }

  this.spawn = spawn;
  this.show = show;
  this.hide = hide;
  this.el = el;
}

function WriteTimer(elapsed, fn, fq) {
  var interval = null;
  if (!fq) fq = 500;

  function start() {
    if (interval) return;
    interval = setInterval(tick, fq);

    function tick() {
      if (!elapsed) elapsed = 0;
      elapsed += fq;
      if (fn) fn(elapsed);
    }
  }

  function reset() {
    stop();
    start();
  }

  function stop() {
    elapsed = 0;
    clearInterval(interval);
    interval = null;
  }

  function pause() {
    clearInterval(interval);
  }

  function set(s) {
    elapsed = s;
  }

  this.reset = reset;
  this.pause = pause;
  this.stop = stop;
  this.start = start;
  this.set = set;
}

function WriteFullscreen(selector) {
  const el = dom.qs(selector);
  const app = dom.qs("body");

  function detectFullscreen() {
    return (
      document["fullscreenElement"] ||
      document["webkitFullscreenElement"] ||
      document["mozFullScreenElement"] ||
      document["msFullscreenElement"]
    );
  }

  function fullscreenListener() {
    const isInFullscreen = detectFullscreen();
    app.classList.toggle("fullscreen", isInFullscreen);
  }

  /* todo DRY */

  /* View in fullscreen */
  function toggleFullscreen(e) {
    if (e) e.stopPropagation();

    const docEl = document.documentElement;
    const isInFullscreen = detectFullscreen();
    if (!isInFullscreen) {
      if (docEl.requestFullscreen) docEl.requestFullscreen();
      else if (docEl["mozRequestFullScreen"]) docEl["mozRequestFullScreen"]();
      else if (docEl["webkitRequestFullscreen"])
        docEl["webkitRequestFullscreen"]();
      else if (docEl["msRequestFullscreen"]) docEl["msRequestFullscreen"]();
    } else {
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document["webkitExitFullscreen"])
        document["webkitExitFullscreen"]();
      else if (document["mozCancelFullScreen"])
        document["mozCancelFullScreen"]();
      else if (document["msExitFullscreen"]) document["msExitFullscreen"]();
    }

    writeLog("Fullscreen", {
      props: { type: !isInFullscreen ? "Enter" : "Exit" },
    });

    writeSheet.focus();
  }

  function enterFullscreen() {
    const docEl = document.documentElement;
    const isInFullscreen = detectFullscreen();
    if (isInFullscreen) return false;

    if (docEl.requestFullscreen) docEl.requestFullscreen();
    else if (docEl["mozRequestFullScreen"]) docEl["mozRequestFullScreen"]();
    else if (docEl["webkitRequestFullscreen"])
      docEl["webkitRequestFullscreen"]();
    else if (docEl["msRequestFullscreen"]) docEl["msRequestFullscreen"]();
    writeLog("Fullscreen", { props: { type: "Enter" } });
    writeSheet.focus();
  }

  function exitFullscreen() {
    const docEl = document.documentElement;
    const isInFullscreen = detectFullscreen();
    if (!isInFullscreen) return false;

    if (document.exitFullscreen) document.exitFullscreen();
    else if (document["webkitExitFullscreen"])
      document["webkitExitFullscreen"]();
    else if (document["mozCancelFullScreen"]) document["mozCancelFullScreen"]();
    else if (document["msExitFullscreen"]) document["msExitFullscreen"]();
    writeLog("Fullscreen", { props: { type: "Exit" } });
    writeSheet.focus();
  }

  ["", "webkit", "moz", "ms"].forEach((prefix) => {
    document.addEventListener(prefix + "fullscreenchange", fullscreenListener);
  });

  this.toggleFullscreen = toggleFullscreen;
  this.enterFullscreen = enterFullscreen;
  this.exitFullscreen = exitFullscreen;
  return this;
}

function WriteSubmit(selector) {
  const el = dom.qs(selector);

  el.addEventListener("click", submit);

  function applyRules(rules) {
    if (!rules || !rules.length) return enable();
    // [ {pageTimeLimit: 20}, {pageWordGoal: 20}, ]
    const failed = rules.filter((rule) => {
      const prop = Object.keys(rule)[0];
      const val = Object.values(rule)[0];
      // todo change when there are more conditions
      if (prop === "pageTimeLimit") return false;
      const condition =
        prop === "pageTimeLimit"
          ? state.get("pageElapsed")
          : state.get("pageWordCount");
      return rule[prop] > condition;
    });
    if (failed.length) disable(failed);
    else enable();
  }

  function enable() {
    el.classList.remove("locked", "disabled");
    el.removeAttribute("data-tooltip");
  }

  function disable() {
    const rules = utils.getRules();
    const tooltip = utils.rulesToString(rules);
    el.setAttribute(
      "data-tooltip",
      tooltip + " " + t("to submit your prompt.")
    );
    el.classList.add("locked");
  }

  function toggle(bool) {
    // todo obviously wrong
    const hasTimeLimit = Boolean(bool);
    if (hasTimeLimit) disable();
    else enable();
  }

  function submit() {
    if (el.classList.contains("locked")) return;

    if (document.body.classList.contains("failed")) {
      const confirmed = confirm(
        t(
          "You ran out of time before completing the exercise. \n\n You'll have to start again."
        )
      );
      if (!confirmed) return;
      return reset();
    }

    dom.qs("#counter").style.display = "none";
    el.classList.add("locked");

    writePreview.toggle(false);

    const courseId = state.get("pageCourseId");

    // prompt for name and email
    const email = prompt(t("Your email"), state.get("userEmail"));
    if (!email) return enable();
    if (!utils.isValidEmail(email)) {
      //retrigger process, bad email
      enable();
      submit();
    }

    const name =
      email !== state.get("userEmail")
        ? prompt(t("Your name"), state.get("userName"))
        : state.get("userName");
    if (!name) return enable();
    state.set("userName", name);
    state.set("userEmail", email);
    state.set("pageAuthorName", name);
    state.set("pageAuthorEmail", email);

    const md = new markdownit();
    const url = window.location.href.split("/");
    const lastSegment = url.pop() || url.pop(); // handle potential trailing slash

    state.set("belongsToExercise", lastSegment);
    state.set("pageId", utils.generateUID());
    state.set(
      "pageUrl",
      `https://blank.page/${courseId}/${state.get(
        "belongsToExercise"
      )}/${state.get("pageId")}`
    );

    // todo just forward all the data?
    const blankpageData = {
      pageId: state.get("pageId"),
      pageAuthorEmail: state.get("pageAuthorEmail"),
      pageAuthorName: state.get("pageAuthorName") || t("Anonymous"),
      pageDestinationEmail: state.get("pageDestinationEmail"),
      pageContent: state.get("pageContent"),
      pageDescription: state.get("pageDescription"),
      pageImageUrl: state.get("pageImageUrl"),
      pagePlaceholder: state.get("pagePlaceholder"),
      pageTimeLimit: state.get("pageTimeLimit"),
      pageTitle:
        state.get("pageTitle") +
        " — " +
        t("By").toLowerCase() +
        " " +
        (state.get("pageAuthorName") || t("Anonymous")),
      pageWordGoal: state.get("pageWordGoal"),
      pageCreationDate: Date.now(),
      pageCourseId: state.get("pageCourseId"),
      pageRedirectUrl: state.get("pageRedirectUrl"),
      pageTheme: state.get("pageTheme"),
      pageConfirmationAction: state.get("pageConfirmationAction"),
      pageConfirmationActionButtonLabel: state.get(
        "pageConfirmationActionButtonLabel"
      ),
      pageConfirmationActionButtonUrl: state.get(
        "pageConfirmationActionButtonUrl"
      ),
      pageConfirmationTitle: state.get("pageConfirmationTitle"),
      pageConfirmationMessage: state.get("pageConfirmationMessage"),
      pageUrl: state.get("pageUrl"),
      belongsToExercise: state.get("belongsToExercise"),
    };

    const mailgunData = {
      pageTitle: state.get("pageTitle"),
      pageContent: state.get("pageContent"),
      pageContentHtml: md.render(state.get("pageContent")),
      pageAuthorEmail: state.get("pageAuthorEmail"),
      pageAuthorName: state.get("pageAuthorName") || t("Anonymous"),
      pageDestinationEmail: state.get("pageDestinationEmail"),
      pagePlaceholder: state.get("pagePlaceholder"),
      pageUrl: state.get("pageUrl"),
      pageParentUrl: state
        .get("pageUrl")
        .substring(0, state.get("pageUrl").lastIndexOf("/")),
    };

    const openInBlankPage = `<p><a href="https://blank.page/${courseId}/${state.get(
      "belongsToExercise"
    )}/${state.get("pageId")}">
        ${t("Open in Blank Page")} →
       </a></p>`;

    const circleData = {
      community_id: 2344,
      space_id: state.get("assignmentSpaceId"),
      body: blankpageData.pageContentHtml + openInBlankPage,
      is_comments_enabled: true,
      is_liking_enabled: false,
      is_truncation_disabled: false,
      hide_meta_info: false,
      user_email: blankpageData.pageAuthorEmail,
    };

    const sendToCircle = new Promise((resolve) => {
      if (!circleData.space_id) return resolve("success");
      ajax.post("/.netlify/functions/sendToCircle", circleData, resolve);
    });

    const sendToFirebase = new Promise((resolve) => {
      firebaseApp.saveCompletedExercise(blankpageData, resolve);
    });

    const sendToMailgun = new Promise((resolve, reject) => {
      if (!blankpageData.pageAuthorEmail) reject("No email provided");
      else {
        ajax.post("/.netlify/functions/sendmail", mailgunData, resolve);
      }
    });

    //    const sendToFirebase = new Promise((resolve) => { return resolve("success"); });
    //    const sendToMailgun = new Promise((resolve, reject) => { return resolve("success"); });

    var message = t("Sending") + "...";
    writeSheet.placeholder(message);

    // sending flash message
    //if (state.get("pageDestinationEmail"))
    //  message = `${t("Sending reply to")} ${state.get("pageDestinationEmail")} ${t("from")} ${state.get("pageAuthorEmail")}`;
    //
    //writeFlash.spawn({
    //  message: message,
    //  duration: false,
    //  class: "sending"
    //});

    const i = setInterval(
      () => writeSheet.placeholder(writeSheet.placeholder() + "."),
      200
    );
    // Promise.all([sendToMailgun, sendToFirebase])
    Promise.all([sendToMailgun, sendToFirebase])
      .then((values) => {
        const errors = values.map((msg) => {
          const success = msg.includes("success");
          if (!success) {
            console.log(msg);
            if (msg.includes("(")) msg = msg.split("(")[0];
            writeFlash.show({
              class: "error",
              duration: 10000,
              message: msg,
            });
          }
          return !success;
        });
        const hasErrors = errors.filter(Boolean).length;

        if (!hasErrors) {
          // clear content, then redirect
          state.set("pageContent", "");
          writeSheet.setContent("");

          const integration =
            state.get("pageDestination") === "Reader"
              ? false
              : state.get("pageConfirmationAction");
          let redirectUrl =
            state.get("pageRedirectUrl") ||
            `${state.get("pageUrl")}/${blankpageData.pageId}`;
          if (redirectUrl === state.get("pageRedirectUrl"))
            window.location = redirectUrl;
          else window.location = `${redirectUrl}?${integration || "saved"}`;
        } else catchError();
      })
      // TODO these resolves will not actually fail if there's an error
      // but I do not know how to implement at this time.
      .catch(catchError);

    function catchError(error) {
      clearInterval(i);
      console.log(error);
      el.classList.remove("locked");
      writeSheet.setContent(state.get("pageContent"));
      writeSheet.placeholder(state.get("pagePlaceholder"));
      window.alert(
        t("Something went wrong, please submit your assignment again")
      );
    }
  }

  function label(label) {
    if (!label) return (label = settings.pageSubmitLabel);
    el.textContent = label;
  }

  function hide() {
    el.classList.add("hidden");
  }

  function show() {
    el.classList.remove("hidden");
  }

  this.toggle = toggle;
  this.label = label;
  this.applyRules = applyRules;
  this.disable = disable;
  this.enable = enable;
  this.submit = submit;
  this.hide = hide;
  this.show = show;
}

function WriteProgress(selector) {
  const el = dom.qs(selector);

  const wordGoalProgress = dom.create({ class: "progress-bar wordGoal" }, el);
  const timeLimitProgress = dom.create({ class: "progress-bar timeLimit" }, el);

  function reset() {
    cancelTransitions();
    wordGoalProgress.removeAttribute("style");
    timeLimitProgress.removeAttribute("style");
  }

  function cancelTransitions() {
    el.classList.add("no-transition");
    setTimeout(function () {
      el.classList.remove("no-transition");
    }, 10);
  }

  function offsetBar(elapsed, total) {
    var pct = total === 0 ? -100 : Math.min((elapsed / total) * 100 - 100, 0);
    return "translate(" + pct + "%, 0)";
  }

  function parse(bar) {
    if (!bar.style.transform) return 0;
    return parseFloat(bar.style.transform.split("%")[0].split("(")[1]);
  }

  function update() {
    const elapsed = state.get("pageElapsed");
    const timeLimit = state.get("pageTimeLimit");
    const words = state.get("pageWordCount");
    const wordGoal = state.get("pageWordGoal");
    const isChallenge = Boolean(timeLimit || wordGoal);
    const isBehind = !timeLimit
      ? false
      : !wordGoal
      ? true
      : Boolean(elapsed / timeLimit > words / wordGoal);
    el.classList.toggle("hide", !isChallenge);
    el.classList.toggle("alert", isBehind);
    timeLimitProgress.style.transform = offsetBar(elapsed, timeLimit);
    wordGoalProgress.style.transform = offsetBar(words, wordGoal);
  }

  function hide() {
    el.classList.add("hide");
  }
  function show() {
    el.classList.remove("hide");
  }

  this.reset = reset;
  this.update = update;
  this.hide = hide;
  this.show = show;
  this.cancelTransitions = cancelTransitions;
}

function WriteSelect(selector, options) {
  if (!options) throw "options are required";

  const _self = this;
  const triggerElement = dom.qs(selector);
  const el = dom.create(
    { class: "select " + selector.slice(1) },
    triggerElement
  );

  function render() {
    if (selector === "#configure") {
      // trigger element is blue if timelimit or wordgoal are set
      triggerElement.classList.toggle(
        "active",
        state.get("pageTimeLimit") || state.get("pageWordGoal")
      );
    }

    let optionGroupEl =
      dom.qs(".select-options", el) || dom.create({ class: "select-options" });
    dom.empty(optionGroupEl);

    options.forEach((option) => {
      if (option.label === "separator")
        return dom.create({ class: "select-separator" }, optionGroupEl);

      const optionEl = dom.create(
        {
          class:
            "select-option option-" +
            (option.type || utils.dirify(option.label)),
          html: `<div class='select-option-label'>${t(option.label)}</div>`,
        },
        optionGroupEl
      );

      if (selector === "#configure")
        return renderConfigureOption(option, optionEl);

      optionEl.addEventListener("click", function (e) {
        hide();
        return option.cb(e);
      });

      if (option.shortcut)
        dom.create(
          { class: "select-option-value", html: option.shortcut },
          optionEl
        );
    });

    el.appendChild(optionGroupEl);
  }

  function renderConfigureOption(option, optionEl) {
    function validate(type, val) {
      if (type === "pageTimeLimit" || type === "pageWordGoal") {
        if (isNaN(val) || val < 0) return false;
      }
      return true;
    }

    function getValue(e) {
      if (e) e.stopPropagation();
      const props = {
        pageWordGoal: {
          label: t("Number of words"),
          default: state.get("pageWordGoal") || 500,
        },
        pageTimeLimit: {
          label: t("Time in minutes"),
          default: utils.msToMin(state.get("pageTimeLimit")) || 10,
        },
        pageLanguage: {
          label: t("Language") + "(en/es)",
          default: state.get("pageLanguage"),
        },
      };

      let val = prompt(props[option.type].label, props[option.type].default);
      hide(500);
      if (val === null) return false;
      if (val === "") val = 0;
      if (!validate(option.type, val)) {
        getValue();
        return false;
      }
      return option.cb(val);
    }

    var value = option.type ? state.get(option.type) : "";
    const isPrompt = state.get("pageCourseId");
    const caret =
      '<svg width="6" height="10" xmlns="http://www.w3.org/2000/svg"><path d="M.195 9.471a.667.667 0 010-.942L3.724 5 .195 1.471A.667.667 0 011.138.53l4 4c.26.26.26.682 0 .942l-4 4a.667.667 0 01-.943 0z" /></svg>';
    if (value == 0) value = isPrompt ? t("None") : caret;
    else
      value = `
      <div class='select-option-clear' onclick="javascript:event.stopPropagation();state.set('${
        option.type
      }', 0)">&times;</div>
      <div class='select-option-value-value'>
        ${option.type === "pageTimeLimit" ? utils.msToMin(value) : value}
      </div>`;
    dom.create({ class: "select-option-value", html: value }, optionEl);
    optionEl.addEventListener("click", getValue);
  }

  render();

  function show() {
    el.classList.add("open");
    triggerElement.classList.add("open");
    // hack to remove > caret if already started writing on free editor
    const isPrompt = state.get("pageCourseId");
    if (!isPrompt) {
      if (state.get("pageContent").length) {
        const timeLimit = state.get("pageTimeLimit");
        const wordGoal = state.get("pageWordGoal");
        if (!timeLimit)
          dom.qs(".option-pageTimeLimit .select-option-value").innerHTML =
            t("None");
        if (!wordGoal)
          dom.qs(".option-pageWordGoal .select-option-value").innerHTML =
            t("None");
      } else {
        const caret =
          '<svg width="6" height="10" xmlns="http://www.w3.org/2000/svg"><path d="M.195 9.471a.667.667 0 010-.942L3.724 5 .195 1.471A.667.667 0 011.138.53l4 4c.26.26.26.682 0 .942l-4 4a.667.667 0 01-.943 0z" /></svg>';
        const timeLimit = state.get("pageTimeLimit");
        const wordGoal = state.get("pageWordGoal");
        if (!timeLimit)
          dom.qs(".option-pageTimeLimit .select-option-value").innerHTML =
            caret;
        if (!wordGoal)
          dom.qs(".option-pageWordGoal .select-option-value").innerHTML = caret;
      }
    }
  }

  function hide(to = 0) {
    setTimeout(function () {
      el.classList.remove("open");
      triggerElement.classList.remove("open");
    }, to);
  }

  function toggle(className, bool) {
    triggerElement.classList.toggle(className, bool);
  }

  function enable() {
    triggerElement.classList.toggle("disabled", false);
    el.classList.toggle("disabled", false);
  }

  function disable() {
    triggerElement.classList.toggle("disabled", true);
    el.classList.toggle("disabled", false);
  }

  triggerElement.addEventListener("click", function (e) {
    e.stopPropagation();
    if (triggerElement.classList.contains("open")) hide();
    else show();
  });

  this.render = render;
  this.show = show;
  this.hide = hide;
  this.enable = enable;
  this.disable = disable;
  this.toggle = toggle;

  return this;
}

var DarkMode = function (selector) {
  const el = dom.qs(selector);

  el.addEventListener("click", toggleDarkMode);

  function toggleDarkMode(e) {
    e.stopPropagation();
    var isDark = state.get("darkmode");
    writePage.pageTheme(state.get("pageTheme"));
    state.set("darkmode", !isDark);
    writeLog("Color mode switch", {
      props: { type: state.get("darkmode") ? "dark" : "light" },
    });
    writeButtons.darkmode.translate(
      !isDark ? "Switch to lightmode" : "Switch to darkmode"
    );
  }

  this.toggleDarkMode = toggleDarkMode;

  state.set("darkmode", state.get("darkmode"));
};

function WriteButton(selector, txt, shortcut, cb) {
  const el = dom.qs(selector);
  el.addEventListener("click", cb);

  function toggle(className, bool) {
    if (bool === undefined) console.error("define bool in toggle button");
    el.classList.toggle(className, bool);
  }

  function translate(newText) {
    // todo better handle exceptions
    const label = state.get("pageSubmitLabel");
    if (el.id === "submit" && label !== "Submit" && label !== "Enviar") return;

    if (newText) txt = newText;
    const isIcon = el.children.length > 0;
    if (isIcon) el.setAttribute("title", t(txt) + " " + shortcut);
    else {
      el.setAttribute("title", shortcut);
      el.innerHTML = t(txt);
    }
  }

  translate();

  this.toggle = toggle;
  this.translate = translate;
}

(function () {
  let lastKeyPressedTime = 0;
  const timeBetweenKeyPresses = 300; // Time in milliseconds to consider a double press
  let userTouched = false;
  window.addEventListener("keydown", function (e) {
    const key = e.key;
    const command =
      navigator.platform.toUpperCase().indexOf("MAC") >= 0
        ? e.metaKey
        : e.ctrlKey;
    const enter = e.key === "Enter" || e.key === "Return";
    const commandLabel =
      navigator.platform.toUpperCase().indexOf("MAC") >= 0 ? "⌘" : "Ctrl";
    const shift = e.shiftKey;
    const backspace = key === "Delete" || key === "Backspace";

    // track if user typed something

    if (!userTouched) {
      if (!e.metaKey && !e.ctrlKey) {
        writeLog("User wrote something");
        userTouched = true;
      }
    }

    if (enter) {
      if (window.document.activeElement === writeSheet.el()) {
        e.preventDefault();
        writeSheet.newLine();
      }
    }

    if (key === "Tab") {
      e.preventDefault();
      writeSheet.newTab();
    }

    if (key === "s" && command) {
      e.preventDefault();
      utils.download();
    }

    if (key === "o" && command) {
      e.preventDefault();
      utils.simulateClick(dom.gid("open"));
    }

    if (shift && key === "c" && command) {
      actions.copy(e);
    }

    if (shift && key === "x" && command) {
      actions.retry(e);
    }

    if (shift && key === "z" && command) {
      e.preventDefault();
    }

    if (key === "d" && command) {
      e.preventDefault();
      state.set("darkmode", !state.get("darkmode"));
    }

    if (key === "k" && command && shift) {
      actions.spellcheck(e);
    }

    if (key === "k" && command && !shift) {
      writeSheet.insertLink();
    }

    if (key === "b" && command) {
      writeSheet.bold();
    }

    if (key === "i" && command) {
      e.preventDefault();
      writeSheet.italic();
    }

    if (key === "p" && command && !shift) {
      e.preventDefault();
      if (writeReader.enabled) return;
      const showPreview = !state.get("preview");
      state.set("preview", showPreview);
      if (showPreview) {
        writeFlash.show({
          class: "shortcut-tip",
          duration: 2000,
          message: `${commandLabel} + Shift + P ${t("for print")}`,
        });
      }
    }

    if (key === "p" && command && shift) {
      window.print();
    }

    if (key === "l" && command && shift) {
      e.preventDefault();
      writeDarkmode.toggleDarkMode(e);
    }

    if (key === "Enter" && command) {
      e.preventDefault();
      writeSubmit.submit();
    }

    if (key === "Escape") {
      const currentTime = new Date().getTime();
      const timeSinceLastKeyPress = currentTime - lastKeyPressedTime;

      if (timeSinceLastKeyPress < timeBetweenKeyPresses) {
        // Key pressed twice in quick succession
        writeAI.show();
      }

      lastKeyPressedTime = currentTime;
      e.preventDefault();
      writeSidebar.toggle(false);
    }

    if (key === "e" && command && !shift) {
      e.preventDefault();
      const enterLanguage = state.get("pageLanguage") === "en" ? "es" : "en";
      state.set("pageLanguage", enterLanguage);
    }

    if (key === "e" && command && shift) {
      e.preventDefault();
      if (!state.get("pageCourseId")) return;
      writeBuilder.toggle(!dom.body.classList.contains("panel-open"));
    }

    if (!event.getModifierState(e.key)) writeSidebar.toggle(false);
  });

  window.addEventListener("keyup", function (e) {
    if (!event.getModifierState(e.key) && !writeBuilder.active)
      writeCursor.set();
  });

  dom.qsa(".metaKey").forEach(function (metaKey) {
    metaKey.innerHTML = utils.metaKey();
  });
})();

function WritePreview() {
  var md = new markdownit({
    html: true,
    breaks: true,
    linkify: true,
  });

  var el = dom.create(
    { el: "article", id: "preview", class: "preview hidden" },
    writePage.el
  );

  // todo refactor
  const button = dom.gid("markdown");
  if (!el) throw "Preview initialized without el";

  function toggle(bool, content) {
    const isPreviewing = bool;
    button.classList.toggle("active", isPreviewing);
    writeSheet.toggle(!isPreviewing);
    if (isPreviewing) {
      el.innerHTML =
        md.render(content || state.get("pageContent")) ||
        `<div class="preview-empty">${t("Page is blank")}</div>`;
    } else if (!writeBuilder.active) {
      writeCursor.reset();
    }
    el.classList.toggle("hidden", !isPreviewing);
  }

  this.toggle = toggle;
  return this;
}

var courses = [
  {
    name: "Tests",
    courseId: "test",
  },

  {
    name: "Blank Page",
    courseId: "p",
  },

  {
    name: "Cafe de los viernes",
    courseId: "cafe",
  },

  {
    name: "Beta",
    courseId: "beta",
  },

  {
    name: "Trigger.dev",
    courseId: "trigger",
  },
];

function Builder() {
  const _self = this;

  const things = dao
    .filter((thing) => !thing.private)
    .map(function (thing) {
      return {
        name: thing.name,
        value: state.get(thing.name),
        label: thing.label,
        type: thing.type,
      };
    });

  const sections = {
    Setup: [
      "pageTitle",
      "pageId",
      "pageCourseId",
      "pageLanguage",
      "pageTheme",
      "pageCourseOrder",
    ],
    Content: ["pagePlaceholder", "pageDescription", "pageImageUrl"],
    Conditions: [
      "pageWordGoal",
      "pageTimeLimit",
      "pageStartDate",
      "pageEndDate",
    ],
    Outcome: [
      "pageSubmitLabel",
      "pageDestinationEmail",
      "pageDestination",
      "pageRedirectUrl",
      "pageConfirmationAction",
      "pageConfirmationTitle",
      "pageConfirmationMessage",
      "pageConfirmationActionButtonLabel",
      "pageConfirmationActionButtonUrl",
    ],
    Advanced: [],
  };

  // add everything else into advanced
  const categorizedThings = [].concat.apply([], Object.values(sections));
  sections.Advanced = things
    .filter((thing) => {
      return !categorizedThings.find((thingName) => thing.name === thingName);
    })
    .map((thing) => thing.name);

  state.set("pageId", utils.generateUID());

  const panel = dom.create(
    {
      class: "panel",
      id: "panel",
      html: ` <div class="container">
              <div class="panel-header">
              <div class="panel-title">Page Builder</div>  
               <div class="action submit button" id="publish">Publish</div>
              </div>
              <div class="panel-body"></div>
             </div>`,
    },
    document.body
  );

  var panelEl = panel.querySelector(".panel-body");
  panel.addEventListener("click", (e) => e.stopPropagation());

  for (key in sections) {
    const section = sections[key];
    const fieldset = dom.create(
      { el: "fieldset", class: key.toLowerCase() },
      panelEl
    );
    const legend = dom.create({ el: "legend", html: key }, fieldset);
    section.forEach((thingName) => {
      const thing = things.find((thing) => thingName === thing.name);
      if (!thing) console.error(thingName + " not found");
      else createField(thing, fieldset);
    });
  }

  function getPlaceholder(key) {
    const dict = {
      pageTitle: "Untitled",
      pageCourseOrder: "None",
      pagePlaceholder: t("Start typing..."),
      pageDescription: "This page is about...",
      pageWordGoal: "0",
      pageTimeLimit: "0",
      pageImageUrl: "https://...",
      pageDestinationEmail: "example@gmail.com",
      pageRedirectUrl: "https://...",
      pageSubmitLabel: t("Submit"),
      pageConfirmationActionButtonUrl: "https://...",
    };

    if (dict[key]) return dict[key];
    else return "";
  }

  function createField(thing, fieldset) {
    if (thing.name === "pageId") thing.value = utils.generateUID();
    const field = dom.create(
      { class: `field active admin ${thing.name}` },
      fieldset
    );
    const label = dom.create(
      { el: "label", class: "field-label", for: thing.name, html: thing.label },
      field
    );
    const fieldValue = dom.create({ class: "field-value" }, field);

    if (thing.name === "pageCourseId") {
      createCourseDropdown(thing, fieldValue);
    } else if (thing.name === "pageLanguage")
      createLanguageDropdown(thing, fieldValue);
    else if (thing.type === "boolean") createToggle(thing, fieldValue);
    else if (thing.name === "pageTheme") createAccentColor(thing, fieldValue);
    else if (thing.name === "pagePlaceholder")
      createTextarea(thing, fieldValue);
    else if (thing.name === "pageDescription")
      createTextarea(thing, fieldValue);
    else if (thing.name === "pageDestination")
      createDestinationsDropdown(thing, fieldValue);
    else if (thing.name === "pageConfirmationMessage")
      createTextarea(thing, fieldValue);
    else if (thing.name === "pageConfirmationAction")
      createConfirmationActions(thing, fieldValue);
    else createTextfield(thing, fieldValue);
  }

  function createTextfield(thing, fieldValue) {
    let value = setValue(thing.name, thing.value);

    if (thing.name === "pageStartDate" || thing.name === "pageEndDate") {
      if (!utils.isValidDate(value)) value = convertDate(value);
    }

    const textField = dom.create(
      {
        el: "input",
        value: thing.value ? value : thing.value || "",
        class: "field-input",
        name: thing.name,
        type: /number|email|date/.test(thing.type) ? thing.type : "text",
        placeholder: thing.placeholder || getPlaceholder(thing.name),
      },
      fieldValue
    );

    if (thing.type === "number") {
      textField.setAttribute("min", 0);
    }

    if (thing.type === "date") {
      const clear = dom.create(
        {
          html: "×",
          class: "field-clear",
        },
        fieldValue
      );
      clear.addEventListener("click", function (e) {
        clear.previousSibling.value = "";
        render(e);
      });
    }

    textField.addEventListener("input", (e) => {
      e.stopPropagation();
      render(e);
    });
    textField.addEventListener("keydown", (e) => {
      e.stopPropagation();
      render(e);
    });
    textField.addEventListener("focus", (e) => {
      e.stopPropagation();
      render(e);
    });

    if (thing.name === "pageSubmitLabel") {
      textField.addEventListener("focus", (e) => {
        write.finish();
        writeSubmit.show();
      });
      textField.addEventListener("blur", (e) => {
        state.set("pageContent", "");
        write.reset();
        writeSidebar.toggle(false);
        writeSubmit.hide();
      });
    }
  }

  function createTextarea(thing, fieldValue) {
    let value = setValue(thing.name, thing.value);

    // don't display pageDescription if it's the default
    if (thing.name === "pageDescription") {
      const lang = state.get("pageLanguage") || "es";
      if (value === settings[lang === "es" ? "esDescription" : "enDescription"])
        value = "";
    }

    const textField = dom.create(
      {
        el: "textarea",
        value: thing.value ? value : thing.value,
        html: thing.value ? value : thing.value,
        class: "field-input",
        name: thing.name,
        placeholder: getPlaceholder(thing.name),
      },
      fieldValue
    );

    textField.addEventListener("input", (e) => {
      e.stopPropagation();
      render(e);
    });
    textField.addEventListener("keydown", (e) => {
      e.stopPropagation();
      render(e);
    });
  }

  function createAccentColor(thing, fieldValue) {
    const value = setValue(thing.name, thing.value);
    fieldValue.classList.add("field-select");
    var selectField = dom.create(
      {
        el: "select",
        class: "shortcut field-input",
        value: thing.value,
        name: thing.name,
      },
      fieldValue
    );

    const letters = {
      a: "Red",
      b: "Orange",
      c: "Green",
      d: "Blue",
      e: "Grapes",
      f: "Purple",
      g: "Pink",
    };
    Object.keys(letters).forEach((letter) =>
      dom.create(
        { el: "option", value: letter, html: letters[letter] },
        selectField
      )
    );
    selectField.selectedIndex = Object.keys(letters).indexOf(value);
    selectField.addEventListener("change", (e) => {
      const selectedValue =
        selectField.children[selectField.selectedIndex].value;
      selectField.setAttribute("value", selectedValue);
      render(e);
    });
    selectField.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  }

  function createToggle(thing, fieldValue) {
    const value = setValue(thing.name, thing.value);
    const onOffSwitch = dom.create({ class: "onoffswitch" }, fieldValue);
    const checkboxField = dom.create(
      {
        el: "input",
        type: "checkbox",
        name: thing.name,
        id: "check-" + thing.name,
        value: value,
        class: "onoffswitch-checkbox field-input",
      },
      onOffSwitch
    );
    if (value) checkboxField.setAttribute("checked", true);
    else checkboxField.removeAttribute("checked");
    const label = dom.create(
      {
        el: "label",
        for: "check-" + thing.name,
        class: "onoffswitch-label",
      },
      onOffSwitch
    );
    checkboxField.addEventListener("change", function (e) {
      const value = checkboxField.checked;
      checkboxField.setAttribute("value", value);
      render(e);
    });
    checkboxField.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  }

  function createLanguageDropdown(thing, fieldValue) {
    const value = setValue(thing.name, thing.value) || "en";
    fieldValue.classList.add("field-select");
    var selectField = dom.create(
      {
        el: "select",
        class: "shortcut field-input",
        value: thing.value,
        name: thing.name,
      },
      fieldValue
    );
    ["en", "es"].forEach((lang) =>
      dom.create({ el: "option", value: lang, html: lang }, selectField)
    );
    selectField.selectedIndex = value === "en" ? 0 : 1;
    selectField.addEventListener("change", (e) => {
      const selectedValue =
        selectField.children[selectField.selectedIndex].value;
      selectField.setAttribute("value", selectedValue);
      render(e);
    });
    selectField.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  }

  function getValue(name, value) {
    if (value === "false") value = false;
    return name === "pageTimeLimit" ? value * 1000 * 60 : value;
  }

  dom.gid("publish").addEventListener("click", saveExercise);

  function daoToFirebase(things) {
    var fbThings = things
      .map((thing) => {
        const inputValue = getInputValue(thing.name);
        const isEmpty = inputValue === "";
        const value = isEmpty ? false : inputValue;
        return value || value === 0 ? { [thing.name]: value } : false;
      })
      .filter(Boolean)
      .reduce(function (result, current) {
        return Object.assign(result, current);
      }, {});
    return fbThings;
  }

  function saveExercise() {
    const data = daoToFirebase(things);
    data.pageUrl = `https://blank.page/${data.pageCourseId}/${data.pageId}`;
    if (JSON.stringify(data) === JSON.stringify({}))
      return alert("Page is not configured");
    firebaseApp.saveExercise(data);
  }

  function getInputValue(name) {
    var value = dom.qs(".field-input[name=" + name + "]").value;
    if (name.indexOf("Url") != -1) value = utils.fixUrl(value);
    if (name === "pageTimeLimit") value = value * 60 * 1000;
    if (name === "pageCourseOrder" && value === "") value = 0;
    if (name === "pageWordGoal" && value === "") value = 0;
    return value;
  }

  function render(e) {
    dom.qsa(".field-input").forEach((input) => {
      const thing = things.find((thing) => input.name === thing.name);
      if (!thing) return;

      var value = getValue(thing.name, input.value);

      // when the user updates the title, the slug is updated
      if (thing.name === "pageTitle" && e && e.target.name === "pageTitle") {
        set("pageId", utils.dirify(value));
      }

      // set the address bar
      if (thing.name === "pageId" && state.get("pageTitle") !== "Blank Page") {
        setTimeout(function () {
          window.history.pushState(
            "",
            "",
            `/${state.get("pageCourseId")}/${state.get("pageId")}`
          );
        }, 0);
      }

      const isModal = [
        "pageConfirmationAction",
        "pageConfirmationTitle",
        "pageConfirmationMessage",
        "pageConfirmationActionButtonLabel",
        "pageConfirmationActionButtonUrl",
      ].includes(e.srcElement.name);

      if (!isModal) writeShare.hide();
      else {
        const selectField = dom.qs("[name='pageConfirmationAction']");
        const selectedValue =
          selectField.children[selectField.selectedIndex].value;
        writeAfterSubmit.build("?" + selectedValue);
      }

      //const isSidebar = [
      //  "pageDescription",
      //  "pageImageUrl"
      //].includes(e.srcElement.name);

      //writeSidebar.toggle(isSidebar);

      state.set(thing.name, value);
    });
  }

  function convertDate(value) {
    const d = new Date(value);
    if (utils.isValidDate(value)) {
      return new Date(value).toISOString().split("T")[0];
    } else return "";
  }

  function set(key, value) {
    const el = dom.qs(`*[name=${key}]`);
    if (key === "pageStartDate" || key === "pageEndDate") {
      value = convertDate(value);
    }
    if (el) {
      el.value = setValue(key, value);
      if (el.getAttribute("type") === "checkbox") {
        if (value) el.setAttribute("checked", value);
        else el.removeAttribute("checked");
      }
    }
  }

  function update() {
    dom.gid("publish").innerHTML = "Update";
    const things = dao
      .filter((thing) => !thing.private)
      .map(function (thing) {
        return {
          name: thing.name,
          value: state.get(thing.name),
          label: thing.label,
          type: thing.type,
        };
      });
    things.forEach((thing) => {
      if (thing.name === "pageDestination") {
        dom
          .qs("fieldset.outcome")
          .setAttribute("outcome", utils.dirify(thing.value));
      }
      if (thing.name === "pageConfirmationAction") {
        dom
          .qs("fieldset.outcome")
          .setAttribute("action", utils.dirify(thing.value));
      }
      set(thing.name, thing.value);
    });
  }

  function setValue(name, value) {
    if (value === "false") value = false;
    if (value === "true") value = true;

    // fix urls without protocol
    if (
      value &&
      utils.isObject(value) &&
      name.indexOf("Url") != -1 &&
      !value.startsWith("http")
    )
      value = "http://" + value;

    // convert ms to minutes
    if (name === "pageTimeLimit") value = value / 1000 / 60;

    if (name === "pageWordGoal") {
      value = parseInt(value, 10);
    }

    return value;
  }

  function createConfirmationActions(thing, fieldValue) {
    const value = setValue(thing.name, thing.value) || "en";
    fieldValue.classList.add("field-select");
    var selectField = dom.create(
      {
        el: "select",
        class: "shortcut field-input",
        value: thing.value,
        name: thing.name,
      },
      fieldValue
    );

    writeAfterSubmit.services.forEach((service) => {
      dom.create(
        { el: "option", value: service.value, html: service.name },
        selectField
      );
    });

    const fieldset = selectField.closest("fieldset");
    fieldset.setAttribute("action", writeAfterSubmit.services[0].value);

    selectField.addEventListener("change", (e) => {
      const selectedValue =
        selectField.children[selectField.selectedIndex].value;
      fieldset.setAttribute("action", selectedValue);
      writeAfterSubmit.build("?" + selectedValue);
      render(e);
    });
    selectField.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  }

  function createDestinationsDropdown(thing, fieldValue) {
    const value = setValue(thing.name, thing.value);
    fieldValue.classList.add("field-select");

    var selectField = dom.create(
      {
        el: "select",
        class: "shortcut field-input",
        value: thing.value,
        name: thing.name,
      },
      fieldValue
    );

    const fieldset = selectField.closest("fieldset");

    var selectFieldDetails = dom.create(
      {
        class: "field-details",
      },
      fieldValue.parentNode
    );

    const services = ["Reader", "Reader with message", "Redirect to URL"];

    fieldset.setAttribute("outcome", utils.dirify(services[0]));

    services.forEach((service, i) => {
      dom.create({ el: "option", value: service, html: service }, selectField);
    });

    selectField.selectedIndex = services.includes(fieldValue)
      ? services.indexOf(fieldValue)
      : 0;

    selectField.addEventListener("change", (e) => {
      dom.empty(selectFieldDetails);
      const selectedValue =
        selectField.children[selectField.selectedIndex].value;
      fieldset.setAttribute("outcome", utils.dirify(selectedValue));
      if (selectedValue === "Reader") {
        writeShare.hide();
      }
      if (selectedValue === "Redirect to URL") {
        fieldset.querySelector('[name="pageRedirectUrl"]').focus();
      }
      if (selectedValue === "Reader with message") {
        writeAfterSubmit.build("?custom");
      }
      selectField.setAttribute("value", selectedValue);
    });
  }

  function createCourseDropdown(thing, fieldValue) {
    const value = setValue(thing.name, thing.value);
    fieldValue.classList.add("field-select");
    var selectField = dom.create(
      {
        el: "select",
        class: "shortcut field-input",
        value: thing.value,
        name: thing.name,
      },
      fieldValue
    );
    courses.forEach((course, i) => {
      dom.create(
        { el: "option", value: course.courseId, html: course.courseId },
        selectField
      );
    });
    selectField.selectedIndex =
      isNaN(thing.value) || thing.value > courses.length - 1
        ? 0
        : parseInt(thing.value, 10);
    selectField.addEventListener("change", (e) => {
      const selectedValue =
        selectField.children[selectField.selectedIndex].value;
      selectField.setAttribute(
        "value",
        selectedValue === "0" ? "" : selectedValue
      );
      render(e);
    });
  }

  this.update = update;
  this.set = set;
  this.render = render;
  this.toggle = function (bool) {
    dom.body.classList.toggle("panel-open", bool);
    _self.active = bool;
  };
  this.active = false;
  this.toggle(window.location.href.includes("build."));

  // single courseId
  setTimeout(function () {
    if (!_self.active) return;
    var paths = window.location.pathname.split("/").filter(Boolean);
    const course = paths.find((path) =>
      courses.find((course) => course.courseId === path)
    );
    const loc = window.location.href.replace("build.", "");
    if (course) {
      state.set("pageCourseId", course);
      const fieldEl = dom.qs(".field.pageCourseId");
      fieldEl.style.display = "none";
      const selectEl = dom.qs(".field-input", fieldEl);
      selectEl.setAttribute("value", course);
      selectEl.selectedIndex =
        Array.from(selectEl.options).findIndex(
          (option) => option.textContent === course
        ) || 0;

      dom.create(
        {
          el: "a",
          href: "https://blank.page/" + course + "/",
          html: "Dashboard →",
          class: "dashboard-link",
        },
        document.body
      );
    }
  }, 0);
}

/* Currently disabled */

// function createSpacesDropdown(thing, fieldValue){
//   let spaces;
//   const value = setValue(thing.name, thing.value);
//   const selectField = dom.create({
//     el: "select",
//     class: "shortcut field-input",
//     value: thing.value,
//     name: thing.name,
//     html: "<option value='0'>Does not belong to course</option>"
//   }, fieldValue);
//
//   function callback(data){
//     spaces = JSON.parse(data);
//     console.log(spaces)
//     if (spaces.status === "unauthorized") return false;
//     const spaceGroups = spaces.reduce(function (r, a) {
//         r[a.space_group_name] = r[a.space_group_name] || [];
//         r[a.space_group_name].push(a);
//         return r;
//     }, Object.create(null));
//
//     selectField.innerHTML = "<option value='0'>Does not belong to space</option>";
//     selectField.addEventListener("click", (e) =>{e.stopPropagation();})
//
//     const frag = document.createDocumentFragment();
//
//     for (key in spaceGroups) {
//       const optgroup = dom.create({el: "optgroup", label: key}, frag);
//       spaceGroups[key].forEach(space => {
//         dom.create({el: "option", value: space.id, html: space.name}, optgroup)
//       });
//     }
//     selectField.appendChild(frag);
//
//   }
//
//   //ajax.get("/.netlify/functions/spaces", {}, callback);
//
//   selectField.selectedIndex = isNaN(thing.value) ? 0 : parseInt(thing.value, 10);
//
//   selectField.addEventListener("change", (e) => {
//     const spaceId = parseInt(selectField.value, 10);
//     const space = spaces.find(space => space.id === spaceId);
//     dom.qs("input[name=assignmentRedirectUrl]").value = space ? space.url : "";
//     render(e);
//   });
// }

function WritePage(selector) {
  const el = dom.qs(selector);

  function add(className) {
    dom.body.classList.add(className);
  }
  function remove(className) {
    dom.body.classList.remove(className);
  }
  function toggle(className, bool) {
    dom.body.classList.toggle(className, bool);
  }

  function tick(s) {
    const timeLimit = state.get("pageTimeLimit");
    if (!timeLimit || writeReader.enabled) return;
    writeCount.update();
    writeProgress.update();
    if (state.get("pageElapsed") > state.get("pageTimeLimit")) {
      writePage.finished = false;
      write.finish("timeLimit");
    } else {
      writeSubmit.disable();
    }
  }

  function _displayRules() {
    const rules = utils.getRules();
    const message = utils.rulesToString(rules);
    writeFlash.spawn({
      id: "flash-rules",
      message,
      duration: false,
    });
  }

  function setWordGoal(value) {
    writeConfigure.render();
    _displayRules();
  }

  function setTimeLimit(value) {
    writeConfigure.render();
    _displayRules();
  }

  function setTitle() {
    const content = state.get("pageContent");
    document.title = content ? content.substring(0, 32) : t("Blank Page");
  }

  function setWpmLimit(value) {
    const label = value > 0 ? value + " WPM" : "WPM";
    //dom.update("timeLimit", label);
  }

  function darkMode(bool = false) {
    document.body.classList.toggle("inverted", bool);
  }

  function pageAuthorName(name) {
    if (!name) return;
    writeMeta.og("article:author", name);
    var span = dom.qs("#author");
    span.innerHTML = t("By") + " " + name;
  }

  function pageRedirectUrl() {
    // todo ?
  }

  function getCourse(courseId) {
    const course =
      courses.find((course) => course.courseId === courseId) || courses[0];
    return course;
  }

  function setLanguage(lang) {
    dom.body.setAttribute("lang", lang);
    writeCount.update();
    writeSheet.placeholder(
      state.get("pagePlaceholder") || t("Start typing...")
    );
    writeConfigure.render();
    writeCounterSelect.render();
    writeSubmit.label(state.get("pageSubmitLabel"));

    if (!state.get("pageCourseId")) {
      state.set(
        "pageDescription",
        lang === "es" ? settings.esDescription : settings.enDescription
      );
    }

    setTimeLimit(state.get("pageTimeLimit"));
    setWordGoal(state.get("pageWordGoal"));
    for (button in writeButtons) {
      writeButtons[button].translate();
    }
  }

  function setIcon(content) {
    const linkEl = dom.qs("link[rel=icon]");
    const iconIsEmpty = linkEl.getAttribute("data-type") === "empty";

    // updating the link is expensive to only do if needed
    if (!content && iconIsEmpty) return;
    if (content && !iconIsEmpty) return;

    linkEl.setAttribute("data-type", content ? "populated" : "empty");
    const svg = content ? settings.populatedIcon : settings.emptyIcon;
    linkEl.setAttribute("href", `data:image/svg+xml,${encodeURI(svg)}`);
    writeTitle.icon(svg);
  }

  function disablePaste(bool) {
    writeSheet.protected = bool;
  }

  // actions
  function pasteNotAllowed(e) {
    e.preventDefault();
    writeFlash.show({
      class: "paste-not-allowed",
      duration: 2000,
      message: t("Pasting is not allowed"),
    });
    return false;
  }

  function keyboardIdleTick(s) {
    // noop
  }

  function copyurl() {
    var dummy = document.createElement("input");
    var url = window.location.href;
    document.body.appendChild(dummy);
    dummy.value = url;
    dummy.select();
    document.execCommand("copy");
    document.body.removeChild(dummy);
    writeFlash.show({
      class: "copied-to-clipboard",
      duration: 2000,
      message: t("Copied link to clipboard"),
    });
  }

  function share() {
    const text = state.get("pageContent");
    const email = prompt("Email it to:", "example@mail.com");
    const url = `mailto:${email}?subject=${encodeURIComponent(
      "Written in blank.page"
    )}&body=${encodeURIComponent(text)}`;
    if (email) window.open(url);
  }

  function comment() {
    writeComments.show();
  }

  function setStartDate(date) {
    const isValid = utils.isValidDate(date);
    if (!isValid) {
      writeSheet.setContent(state.get("pageContent"));
      writeSheet.enable();
      writePreview.toggle(false);
      return;
    }
    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
    date = new Date(date.getTime() + userTimezoneOffset);
    const currentDate = new Date();
    if (currentDate.getTime() < date.getTime()) {
      // todo improve
      dom.gid("flash-rules").style.display = "none";
      dom.gid("markdown").style.display = "none";
      writeSidebar.toggle(false, { block: true });

      setTimeout(function () {
        const content = `${t("Assignment will be available on")} ${tDate(
          date
        )}.`;
        writePreview.toggle(true, content);
      }, 10);
    } else {
      writeSheet.setContent(state.get("pageContent"));
      writeSheet.enable();
    }
  }

  function setEndDate(date) {
    const isValid = date instanceof Date && isFinite(date);
    if (!isValid) {
      writeSheet.setContent(state.get("pageContent"));
      writeSheet.enable();
      writePreview.toggle(false);
      return;
    }
    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
    date = new Date(date.getTime() + userTimezoneOffset);
    const currentDate = new Date();
    if (currentDate.getTime() > date.getTime() || !isValid) {
      dom.gid("flash-rules").style.display = "none";
      dom.gid("markdown").style.display = "none";
      writeSidebar.toggle(false, { block: true });

      setTimeout(function () {
        const content = `${t("Page expired. It was due")} ${tDate(date)} ${t(
          "before midnight (local time)"
        )}`;
        writePreview.toggle(true, content);
      }, 10);
    } else {
      writeSheet.setContent(state.get("pageContent"));
      writeSheet.enable();
    }
  }

  function pageTheme(letter) {
    const inverted = state.get("darkmode");
    const style =
      inverted && !writeBuilder.active
        ? document.body.style
        : document.documentElement.style;
    const steps = [...Array(16).keys()];
    steps.forEach((number) => {
      style.setProperty("--accent" + number, `rgb(var(--${letter}${number}))`);
    });
  }

  function pageShare(bool) {
    toggle("social-show", bool);
  }

  function activate() {
    el.classList.add("ui-active");
  }

  function focus() {
    const exceptions =
      dom.body.classList.contains("finished") || dom.qs(".select.open");
    if (exceptions) return;

    // todo: hack to disable focus mode when page is empty
    const pageContent = state.get("pageContent");
    if (!pageContent || pageContent === "") {
      return;
    }

    el.classList.remove("ui-active");
  }

  this.activate = activate;
  this.focus = focus;
  this.pasteNotAllowed = pasteNotAllowed;
  this.copyurl = copyurl;
  this.share = share;
  this.setLanguage = setLanguage;
  this.add = add;
  this.remove = remove;
  this.tick = tick;
  this.keyboardIdleTick = keyboardIdleTick;
  this.toggle = toggle;
  this.disablePaste = disablePaste;
  this.setTimeLimit = setTimeLimit;
  this.setWordGoal = setWordGoal;
  this.darkMode = darkMode;
  this.pageAuthorName = pageAuthorName;
  this.pageRedirectUrl = pageRedirectUrl;
  this.getCourse = getCourse;
  this.setStartDate = setStartDate;
  this.setEndDate = setEndDate;
  this.setIcon = setIcon;
  this.pageTheme = pageTheme;
  this.pageShare = pageShare;
  this.comment = comment;
  this.download = utils.download;
  this.setTitle = setTitle;
  this.isBlocked = false;
  this.markdown = () => state.set("preview", !state.get("preview"));
  this.el = el;
}

function WriteModal(config = { dismissable: true, fade: true }) {
  const overlay = dom.create(
    {
      class:
        "modal-overlay hidden" +
        (!config.fade ? " modal-overlay-no-transition" : ""),
    },
    writePage.el
  );
  const el = dom.create({ class: `modal ${config.class || ""}` }, overlay);
  const content = dom.create({ class: "modal-content" }, el);

  if (config.dismissable) {
    const close = dom.create({ class: "modal-close", html: "×" }, el);
    [overlay, close].forEach((el) => {
      el.addEventListener("click", (e) => {
        e.stopPropagation();
        hide();
      });
    });
  }

  el.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  function show() {
    overlay.classList.remove("hidden");
    setTimeout(function () {
      el.classList.add("modal-animate");
    }, 1);
  }

  function hide() {
    el.classList.remove("modal-animate");
    overlay.classList.add("hidden");
  }

  function html(blob) {
    content.innerHTML = blob;
  }

  this.show = show;
  this.hide = hide;
  this.html = html;
  this.content = content;
}

function WriteReader() {
  function enable(content) {
    this.enabled = true;
    writePreview.toggle(true, content);
    writePage.pageAuthorName(
      state.get("pageAuthorName") || state.get("pageAuthorEmail")
    );
    writeProgress.hide();
    writePage.add("reader");
    writeSubmit.hide();

    const hContainer =
      dom.gid("hypothesis") ||
      dom.create(
        { id: "hypothesis", class: "panel inverted-undo hidden" },
        document.body
      );

    window.hypothesisConfig = function () {
      const accentColor = window.getComputedStyle(
        dom.gid("submit")
      ).backgroundColor;

      return {
        showHighlights: true,
        theme: "clean",
        branding: {
          accentColor: accentColor,
          appBackgroundColor: "white",
          ctaBackgroundColor: accentColor,
          ctaTextColor: "white",
          selectionFontFamily:
            '"SF Mono", "Monaco", "Inconsolata", "Fira Mono", "Droid Sans Mono", "Source Code Pro", monospace',
        },
        externalContainerSelector: "#hypothesis",
        onLayoutChange: function (e) {
          if (!hContainer.classList.contains("hidden") && !e.expanded) return;
          hContainer.classList.toggle("hidden", !e.expanded);
          const isHidden = hContainer.classList.contains("hidden");
          dom.gid("preview").classList.toggle("show-annotations", !isHidden);
        },
      };
    };

    var script = document.createElement("script");
    script.onload = hypothesLoaded;
    script.src = "//hypothes.is/embed.js";
    script.async = true;
    document.head.appendChild(script);
  }

  function hypothesLoaded(e) {
    // already created
    if (dom.gid("comment")) return true;

    dom.gid("hypothesis").addEventListener("click", (e) => e.stopPropagation());

    const commentIcon = dom.create({
      id: "comment",
      class: "comment header-icon",
    });

    dom.qs(".header-icons").prepend(commentIcon);

    const svgCommentIcon = dom.create(
      {
        el: "svg",
        width: 24,
        height: 24,
        xmlns: "http://www.w3.org/2000/svg",
        viewBox: "0 0 24 24",
      },
      commentIcon
    );

    const commentCount = dom.create(
      {
        class: "comment-count",
        "data-hypothesis-annotation-count": true,
      },
      commentIcon
    );

    observe(commentCount);

    dom.create(
      {
        el: "path",
        d: "M4 4h16v12H5.17L4 17.17V4m0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4zm2 10h12v2H6v-2zm0-3h12v2H6V9zm0-3h12v2H6V6z",
      },
      svgCommentIcon
    );

    commentIcon.addEventListener("click", function (e) {
      e.stopPropagation();
      dom.gid("hypothesis").classList.toggle("hidden");
      const isHidden = dom.gid("hypothesis").classList.contains("hidden");
      commentIcon.classList.toggle("open", !isHidden);
      dom.gid("preview").classList.toggle("show-annotations", !isHidden);
    });

    dom.body.addEventListener("click", function () {
      dom.gid("hypothesis").classList.add("hidden");
      dom.gid("comment").classList.remove("open");
    });
  }

  function observe(targetNode) {
    // Options for the observer (which mutations to observe)
    const config = { attributes: true, childList: true, subtree: true };

    // Callback function to execute when mutations are observed
    const callback = function (mutationsList, observer) {
      // Use traditional 'for loops' for IE 11
      for (const mutation of mutationsList) {
        if (mutation.type === "childList") {
          targetNode.classList.toggle("empty", targetNode.textContent === "0");
        }
      }
    };

    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(callback);

    // Start observing the target node for configured mutations
    observer.observe(targetNode, config);
  }

  this.enabled = false;
  this.enable = enable;
  return this;
}

function WriteMeta() {
  function og(tag, value) {
    const el = document.querySelector(`meta[property="${tag}"]`);
    if (!el) throw "Meta tag property " + tag + " not found";
    if (!value) return;
    el.setAttribute("content", value);
  }

  function set(tag, value) {
    const el = document.querySelector(`meta[name="${tag}"]`);
    if (!el) throw "Meta tag property " + tag + " not found";
    if (!value) return;
    el.setAttribute("content", value);
  }

  this.set = set;
  this.og = og;
  return this;
}

document.addEventListener("DOMContentLoaded", function() {
  const toggleButton = document.getElementById("contrast");
  toggleButton.addEventListener("click", function() {
    document.body.classList.toggle("light-mode");
  });
});

function WriteSidebar() {
  const _self = this;
  const page = dom.gid("page");

  const sidebar = dom.create(
    {
      class: "sidebar",
      id: "sidebar",
      html: ` 
        <div class="sidebar-overlay"></div>
        <div class="sidebar-close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" />
          </svg>
        </div>
        <div class="container">
          <div class="sidebar-content">
            <div id="page-title-txt"></div>
            <div id="sidebar-image" class="sidebar-image"></div>
            <div id="sidebar-body" class="sidebar-body"></div>
            <div id="sidebar-footer" class="sidebar-footer"></div>
          </div>
          <div id="container-footer" class="container-footer tw">
            <div class="pb-4 flex gap-x-8 items-center">
              <div class="max-w-[80px] ml-8"> <!-- Adjusted width and margin-left -->
                <a href="https://github.com/AKDontMiss?tab=repositories" onclick="writeLog('Sidebar BMAC Logo Clicked')" target="_blank">
                  <img class="block dark:hidden" src="miss.jpeg" style="width: 60px;"/> 
                  <img class="hidden dark:block" src="miss.jpeg" style="width: 60px;"/> 
                </a>
              </div>
            </div>
            <p class="text-sm">AK all the way bram</p>
            <div id="container-footer-text"></div>
          </div>
        </div>
      `,
    },
    page
  );
  

  sidebar.addEventListener("click", (e) => e.stopPropagation());

  const closeSidebar = (e) => {
    e.preventDefault();
    toggle(false);
  };
  dom.qs(".sidebar-overlay").addEventListener("click", closeSidebar);
  dom.qs(".sidebar-close").addEventListener("click", closeSidebar);

  function toggle(bool, opts = {}) {
    if (opts.block) {
      this.blocked = true;
      dom.gid("page-title").style.pointerEvents = "none";
    }
    const open = bool;
    if (open) {
      if (this.blocked) return;
      page.classList.add("sidebar-open");
      writePage.activate();
    } else {
      page.classList.remove("sidebar-open", "panel-open");
      if (state.get("pageVisited")) return;
      state.set("pageVisited", true);
      state.set("pageTitle", state.get("pageTitle"));
    }
  }

  function description(txt) {
    const txtEl = dom.gid("sidebar-body");
    const md = new markdownit({
      html: true,
      breaks: true,
      linkify: true,
    });

    var defaultRender =
      md.renderer.rules.link_open ||
      function (tokens, idx, options, env, self) {
        return self.renderToken(tokens, idx, options);
      };

    md.renderer.rules.link_open = function (tokens, idx, options, env, self) {
      // If you are sure other plugins can't add `target` - drop check below
      var aIndex = tokens[idx].attrIndex("target");

      if (aIndex < 0) {
        tokens[idx].attrPush(["target", "_blank"]); // add new attribute
      } else {
        tokens[idx].attrs[aIndex][1] = "_blank"; // replace value of existing attr
      }

      // pass token to default renderer.
      return defaultRender(tokens, idx, options, env, self);
    };

    txtEl.innerHTML = md.render(txt);
    fitVid();
  }

  function fitVid() {
    // List of Video Vendors embeds you want to support
    var players = ['iframe[src*="youtube.com"]', 'iframe[src*="vimeo.com"]'];

    // Select videos
    var fitVids = document.querySelectorAll(players.join(","));

    // If there are videos on the page...
    if (fitVids.length) {
      // Loop through videos
      for (var i = 0; i < fitVids.length; i++) {
        // Get Video Information
        var fitVid = fitVids[i];
        var width = fitVid.getAttribute("width");
        var height = fitVid.getAttribute("height");
        var aspectRatio = height / width;
        var parentDiv = fitVid.parentNode;

        // Wrap it in a DIV
        var div = document.createElement("div");
        div.className = "video-wrapper";
        div.style.paddingBottom = aspectRatio * 100 + "%";
        parentDiv.insertBefore(div, fitVid);
        fitVid.remove();
        div.appendChild(fitVid);

        // Clear height/width from fitVid
        fitVid.removeAttribute("height");
        fitVid.removeAttribute("width");
      }
    }
  }

  function image(url) {
    const container = dom.gid("sidebar-image");

    // prevent this from reloading on builder

    const img = dom.qs("img", container);

    if (!img && url) {
      const img = dom.create({ el: "img", src: url, alt: "" }, container);
      writeMeta.og("og:image", url);
    } else if (!url) {
      dom.empty(container);
    } else if (img.src !== url) {
      img.src = url;
    }
  }

  // not currently used, replaced by exerciseCount
  function destinationEmail(email) {
    const footerEl = dom.gid("container-footer");
    const hasSubmit = state.get("pageCourseId");
    footerEl.style.display = hasSubmit ? "block" : "none";
    const message = email
      ? `${t(
          "Your submission will be emailed to"
        )}<br /><a href="mailto:${email}">${email}</a>`
      : t("Your submission is private. You can share it in the next step.");
    dom.gid("container-footer-text").innerHTML = message;
  }

  function exerciseCount() {
    if (!state.get("pageCourseId")) return;
    const order = state.get("pageCourseOrder");
    const footerEl = dom.gid("container-footer");
    footerEl.style.display = order ? "block" : "none";
    if (!order) return destinationEmail(state.get("pageDestinationEmail"));
    const message = `${t("Exercise")} ${order} ${t(
      "of"
    )} <span id="exercise-count">--</span>`;
    dom.gid("container-footer-text").innerHTML = message;
    firebaseApp.countExercises(state.get("pageCourseId")).then((count) => {
      dom.gid("exercise-count").innerHTML = count;
    });
  }

  this.blocked = false;
  this.description = description;
  this.image = image;
  this.destinationEmail = destinationEmail;
  this.exerciseCount = exerciseCount;
  this.toggle = toggle;
}

function WriteTitle(selector) {
  const pageTitle = dom.qs(selector);

  function set(title) {
    const txtEl = dom.gid("page-title-txt");
    if (title !== settings.pageTitle) txtEl.textContent = title;
    document.title = title;
  }

  function icon(svg) {
    const existing = dom.qs("svg", pageTitle);
    existing.parentNode.removeChild(existing);
    const parser = new DOMParser();
    svg = parser.parseFromString(svg, "image/svg+xml");
    const svgStyles = dom.qs("style", svg);
    svgStyles.parentNode.removeChild(svgStyles);
    pageTitle.prepend(svg.documentElement);
  }

  pageTitle.addEventListener("click", (e) => {
    e.stopPropagation();
    e.preventDefault();
    // if you click on the icon with alt, it will fill the sidebar with the page content
    // as a hack/easter egg to preview the sidebar
    if (e.altKey) {
      state.set("pageDescription", writeSheet.getContent());
    }
    const isOpen = page.classList.contains("sidebar-open");
    writeLog("Sidebar", !isOpen);
    writeSidebar.toggle(!isOpen);
  });

  this.set = set;
  this.icon = icon;
}

function WriteAI() {
  const el = dom.create({ class: "input-box hidden" }, document.body);
  const ta = dom.create(
    { el: "textarea", placeholder: "Prompt Chat GPT 3.5" },
    el
  );

  ta.addEventListener("click", function (e) {
    e.stopPropagation();
  });

  ta.addEventListener("keydown", function (e) {
    e.stopPropagation();
    const key = e.key;
    const command =
      navigator.platform.toUpperCase().indexOf("MAC") >= 0
        ? e.metaKey
        : e.ctrlKey;
    const enter = e.key === "Enter" || e.key === "Return";
    const escape = e.key === "Escape";
    const shift = e.shiftKey;

    if (enter && !shift && !command) {
      e.preventDefault();
      prompt(ta.value);
    }

    if (escape) {
      hide();
    }
  });

  function prompt(text) {
    console.log(text);
    const settings = {
      messages: [{ role: "user", content: text }],
    };

    clear("");

    let count = 0;
    let increment = true;
    placeholder("Thinking...");
    const interval = setInterval(() => {
      count = increment ? count + 1 : count - 1;
      if (count === 3) increment = false;
      else if (count === 0) increment = true;
      const dots = Array(count).fill(".").join("");
      placeholder(placeholder() + dots);
    }, 200);

    function resolve(res, interval) {
      clearInterval(interval);
      if (res.indexOf("TimeoutError") === 0) {
        placeholder("Timed out, trying again...");
        return ajax.post(
          "/.netlify/functions/openai",
          { data: JSON.stringify(settings) },
          (res) => resolve(res, interval)
        );
      }
      if (writeSheet.getContent().trim()) {
        //existing content, use a separator
        res = writeSheet.getContent() + "\n\n---\n\n" + res;
      }

      writeSheet.setContent(res);
      clear();
      hide();
      placeholder("Prompt Chat GPT 3.5");
    }

    ajax.post(
      "/.netlify/functions/openai",
      { data: JSON.stringify(settings) },
      (res) => resolve(res, interval)
    );
  }

  function show() {
    el.classList.remove("hidden");
    ta.focus();
  }

  function hide() {
    el.classList.add("hidden");
    writeSheet.el().focus();
  }

  function clear() {
    ta.value = "";
  }

  function placeholder(val) {
    if (!val) return ta.getAttribute("placeholder");
    ta.setAttribute("placeholder", val);
  }

  this.show = show;
  this.hide = hide;
  this.clear = clear;
  this.prompt = prompt;
  this.placeholder = placeholder;
}

function WriteAfterSubmit() {
  const fbRenderFn = utils.debounce(
    () => FB.XFBML.parse(dom.gid("button-facebook").parentNode),
    200
  );
  const gcRenderFn = utils.debounce(
    () => gapi.sharetoclassroom.go(dom.gid("button-gclassroom").parentNode),
    200
  );
  const twRenderFn = utils.debounce(() => twttr.widgets.load(), 200);

  function build(param) {
    if (!param) return;

    // if (param === "?redirect") {
    //   const email = state.get("pageDestinationEmail") || state.get("pageAuthorEmail");
    //   writeFlash.show({
    //     message: `Response sent to ${email}`,
    //     duration: 4000
    //   });
    //   return;
    // }

    let integration =
      param.substring(1) === "saved" ? false : param.substring(1);

    // start integrations

    let content = `
        <h2>${state.get("pageConfirmationTitle")}</h2>
        ${markdown(state.get("pageConfirmationMessage"))}
    `;

    const buttons = {
      facebook: `
        <div id="button-facebook" class="fb-share-button" data-href="https://blank.page" data-layout="button" data-size="large">
          <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblank.page%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share on Facebook</a>
        </div>`,
      gclassroom: `
        <div class="g-sharetoclassroom" 
          id="button-gclassroom"
          data-title="by ${state.get("pageAuthorName")}" 
          data-onsharecomplete="writeAfterSubmit.shareComplete" 
          data-itemtype="assignment" 
          data-size="32" 
          data-url="${state.get("pageUrl")}"
        >
      `,
      twitter: `
        <a class="twitter-share-button"
            id="button-twitter"
            href="https://twitter.com/intent/tweet"
            data-size="large"
            data-text="I wrote this on blank.page"
            data-url="${state.get("pageUrl")}"
          >
          Tweet
        </a>`,
      custom: state.get("pageConfirmationActionButtonLabel")
        ? `<a id="button-custom" class="button accent" href="${
            state.get("pageConfirmationActionButtonUrl") || "#"
          }">
          ${state.get("pageConfirmationActionButtonLabel")}
          </a>
          <a class="button secondary" onclick="javascript:actions.copyUrl(event)">
            ${t("Copy URL")}
          </a>`
        : `<a class="button secondary" onclick="javascript:actions.copyUrl(event)">
            ${t("Copy URL")}
          </a>`,
    };

    const scripts = {
      facebook: {
        id: "script-facebook",
        el: "script",
        nonce: "SImoZ4S2",
        src: "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v12.0&appId=3359666180768236&autoLogAppEvents=1",
      },
      gclassroom: {
        id: "script-gclassroom",
        el: "script",
        src: "https://apis.google.com/js/platform.js",
      },
      twitter: {
        id: "script-twitter",
        el: "script",
        src: "https://platform.twitter.com/widgets.js",
      },
    };

    if (!integration) return writeFlash.show({ message: t("Content saved") });
    else if (buttons[integration])
      content += dom.create({
        class: "modal-footer",
        html: buttons[integration],
      }).outerHTML;

    if (scripts[integration] && !dom.gid("script-" + integration)) {
      if (integration === "gclassroom")
        dom.create(
          { el: "script", html: "window.___gcfg = { parsetags: 'explicit'};" },
          document.body
        );
      const script = dom.create(scripts[integration], document.body);
      if (integration === "gclassroom")
        script.onload = () =>
          gapi.sharetoclassroom.go(dom.gid("button-gclassroom").parentNode);
    } else writeShare.html(content);

    if (dom.gid("script-" + integration)) {
      if (integration === "twitter" && window.twttr) twRenderFn();
      if (integration === "facebook" && window.FB) fbRenderFn();
      if (integration === "gclassroom" && window.gapi) gcRenderFn();
    }

    writeShare.show();
  }

  function markdown(content) {
    const md = new markdownit({
      html: true,
      breaks: true,
      linkify: true,
    });

    var defaultRender =
      md.renderer.rules.link_open ||
      function (tokens, idx, options, env, self) {
        return self.renderToken(tokens, idx, options);
      };

    md.renderer.rules.link_open = function (tokens, idx, options, env, self) {
      // If you are sure other plugins can't add `target` - drop check below
      var aIndex = tokens[idx].attrIndex("target");

      if (aIndex < 0) {
        tokens[idx].attrPush(["target", "_blank"]); // add new attribute
      } else {
        tokens[idx].attrs[aIndex][1] = "_blank"; // replace value of existing attr
      }

      // pass token to default renderer.
      return defaultRender(tokens, idx, options, env, self);
    };

    return md.render(content);
  }

  function shareComplete() {
    const redirect = state.get("pageRedirectUrl");
    const link = redirect
      ? `<a href="#" onclick="function(){ writeShare.hide(); window.location=${redirect};}">Go to classroom</a>`
      : `<a href="#" onclick="writeShare.hide">Dismiss</a>`;
    content = `
        <h2>Your assignment was sent</h2>
        <div style="margin-top: var(--x4); text-align: center; color: var(--base9)">
          ${link}
        </div> 
    `;
    writeShare.html(content);
  }

  this.services = [
    { name: "Custom", value: "custom" },
    { name: "Google Classroom", value: "gclassroom" },
    { name: "Facebook", value: "facebook" },
    { name: "Twitter", value: "twitter" },
  ];

  this.build = build;
  this.shareComplete = shareComplete;
}

function WriteLog() {
  return function (key, props) {
    if (!window.plausible || writeBuilder.active) return;

    const dev = true;

    if (!props) {
      console.log("plausible", key);
      plausible(key);
    } else {
      console.log("plausible", key, props);
      plausible(key, props);
    }
  };
}

let state = new State();
let writeFlash = new WriteFlash("#flash");
let write = new Write();
let writeCursor = new WriteCursor("#sheet");
let writeSheet = new WriteSheet();
let writeCount = new WriteCount("#counter");
let writeTitle = new WriteTitle("#page-title");
let writeAfterSubmit = new WriteAfterSubmit();
let writeBuilder = new Builder();
let writeProgress = new WriteProgress("#progress");
let writeAI = new WriteAI();

let writeButtons = {
  copy: new WriteButton(
    "#copy",
    "Copy",
    utils.isMac ? "⇧⌘C" : "Shift Ctrl—C",
    actions.copy
  ),
  submit: new WriteButton(
    "#submit",
    "Submit",
    utils.isMac ? "⌘↵" : "Ctrl—Enter",
    actions.submit
  ),
  download: new WriteButton(
    "#download",
    "Save",
    utils.isMac ? "⌘S" : "Ctrl—S",
    actions.download
  ),
  darkmode: new WriteButton(
    "#contrast",
    "Switch to " + (state.get("darkmode") ? "lightmode" : "darkmode"),
    utils.isMac ? "⌘D" : "Ctrl—D",
    actions.darkmode
  ),
  fullscreen: new WriteButton(
    "#fullscreen",
    "Fullscreen",
    utils.isMac ? "⌃⌘F" : "F11",
    actions.fullscreen
  ),
  configure: new WriteButton("#configure", "Configure", ""),
  preview: new WriteButton(
    "#markdown",
    "Preview",
    utils.isMac ? "⌘P" : "Ctrl—P",
    actions.preview
  ),
  spellcheck: new WriteButton(
    "#spellcheck",
    "Spellcheck",
    utils.isMac ? "⇧⌘K" : "F7",
    actions.spellcheck
  ),
};

let writeFullscreen = new WriteFullscreen("#fullscreen");
let writePage = new WritePage("#page");
let writePreview = new WritePreview("#preview");
let writeSubmit = new WriteSubmit("#submit");
let writeReader = new WriteReader();
let writeDarkmode = new DarkMode("#contrast");
let writeMeta = new WriteMeta();
let writeSidebar = new WriteSidebar("#page");
let writeConfigure = new WriteSelect("#configure", settings.configureOptions);
let writeCounterSelect = new WriteSelect("#counter", settings.wordcountOptions);
let writeShare = new WriteModal();
let writeLog = new WriteLog();

window.writeLog = writeLog;

startApp();

function startApp() {
  console.log("start");
  let signInRequired =
    window.location.pathname !== "/" || window.location.href.indexOf("build.");
  window.firebaseApp = signInRequired ? new FirebaseApp(firebaseConfig) : false;
  let openFile = dom.gid("open").addEventListener("change", utils.openFile);

  //todo refactor
  const pathName =
    window.location.pathname !== "/"
      ? window.location.pathname.split("/")[1]
      : false;
  const course =
    courses.find((course) => course.courseId === pathName) || false;
  const pageId = course ? window.location.pathname.split("/")[2] : false;
  const exerciseId = course ? window.location.pathname.split("/")[3] : false;
  write.exerciseId = exerciseId;

  const afterSignIn = function () {
    if (!pageId && course && !writeBuilder.active)
      firebaseApp.getExercises(course.courseId, course.name);
    else if (pageId && !exerciseId)
      firebaseApp.getExercise(course.courseId, pageId);
    else if (exerciseId === "replies")
      firebaseApp.getCompletedExercises(course.courseId, pageId, exerciseId);
    else if (exerciseId)
      firebaseApp.getCompletedExercise(course.courseId, pageId, exerciseId);
    if (writeBuilder.active) {
      const pageTitle = pageId ? t("Update prompt") : t("Page Builder");
      document.title = pageTitle;
      dom.qs("body").classList.remove("loading");
    }
  };

  if (course || writeBuilder.active) {
    firebaseApp.signIn(afterSignIn);
  } else {
    writePage.toggle("loading", false);
    // todo this is just to test feasibility
    setTimeout(function () {
      writePage.toggle("empty", false);
    }, 0);
    writePage.focus();
  }

  // don't need to set timers for reader stuff
  if (writeReader.isEnabed) return false;

  window.elapsedTimer = new WriteTimer(
    state.get("pageElapsed"),
    function (elapsed) {
      state.set("pageElapsed", elapsed);
    },
    500
  );

  write.hydrate();
  writePage.activate();

  window.App.init(writeSheet);
}

document.body.addEventListener("click", () => {
  // writeConfigure.hide();
  // writeCounterSelect.hide();
  // writeAI.hide();
  // if (!writeReader.enabled) writeSheet.focus();
});

// window.addEventListener('beforeunload', function (e) {
//   const count = state.get("pageWordCount");
//   writeLog("Word Count on leave", {props: {count: count}});
// });

// Disable scrolling.
document.body.ontouchmove = function (e) {
  e.preventDefault();
};


"use strict";var App=(()=>{var Jf=Object.create;var ys=Object.defineProperty;var Xf=Object.getOwnPropertyDescriptor;var Qf=Object.getOwnPropertyNames;var eh=Object.getPrototypeOf,th=Object.prototype.hasOwnProperty;var fn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),oo=(t,e)=>{for(var n in e)ys(t,n,{get:e[n],enumerable:!0})},_c=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Qf(e))!th.call(t,s)&&s!==n&&ys(t,s,{get:()=>e[s],enumerable:!(r=Xf(e,s))||r.enumerable});return t};var rt=(t,e,n)=>(n=t!=null?Jf(eh(t)):{},_c(e||!t||!t.__esModule?ys(n,"default",{value:t,enumerable:!0}):n,t)),nh=t=>_c(ys({},"__esModule",{value:!0}),t);var _t=fn((hn,gc)=>{"use strict";var rh=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Bt=rh();gc.exports=hn=Bt.fetch;Bt.fetch&&(hn.default=Bt.fetch.bind(Bt));hn.Headers=Bt.Headers;hn.Request=Bt.Request;hn.Response=Bt.Response});var Ic=fn((Jv,wc)=>{var Ec=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};wc.exports=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return Ec()}try{return __global__||Ec()}finally{delete Object.prototype.__global__}}()});var xc=fn((Xv,ih)=>{ih.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors:["I\xF1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version:"1.0.34",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=4.0.0"},dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config:{verbose:!1},scripts:{test:"tape test/unit/*.js",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0"}});var Cc=fn((Qv,Tc)=>{Tc.exports=xc().version});var Ac=fn((eS,Rc)=>{var Ft;if(typeof globalThis=="object")Ft=globalThis;else try{Ft=Ic()}catch{}finally{if(!Ft&&typeof window<"u"&&(Ft=window),!Ft)throw new Error("Could not determine global this")}var br=Ft.WebSocket||Ft.MozWebSocket,oh=Cc();function kc(t,e){var n;return e?n=new br(t,e):n=new br(t),n}br&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(t){Object.defineProperty(kc,t,{get:function(){return br[t]}})});Rc.exports={w3cwebsocket:br?kc:null,version:oh}});var eu=fn((L0,qs)=>{(function(){"use strict";var t={}.hasOwnProperty,e="[native code]";function n(){for(var r=[],s=0;s<arguments.length;s++){var i=arguments[s];if(i){var o=typeof i;if(o==="string"||o==="number")r.push(i);else if(Array.isArray(i)){if(i.length){var a=n.apply(null,i);a&&r.push(a)}}else if(o==="object"){if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]")){r.push(i.toString());continue}for(var c in i)t.call(i,c)&&i[c]&&r.push(c)}}}return r.join(" ")}typeof qs<"u"&&qs.exports?(n.default=n,qs.exports=n):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return n}):window.classNames=n})()});var Ev={};oo(Ev,{init:()=>Sv});var yc=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>rt(_t())).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};var gr=class extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}},bs=class extends gr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},vs=class extends gr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},Ss=class extends gr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}};var sh=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},yr=class{constructor(e,{headers:n={},customFetch:r}={}){this.url=e,this.headers=n,this.fetch=yc(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return sh(this,void 0,void 0,function*(){try{let{headers:s,method:i,body:o}=n,a={},c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));let l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(h=>{throw new bs(h)}),u=l.headers.get("x-relay-error");if(u&&u==="true")throw new vs(l);if(!l.ok)throw new Ss(l);let d=((r=l.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield l.json():d==="application/octet-stream"?f=yield l.blob():d==="multipart/form-data"?f=yield l.formData():f=yield l.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}};var bc=rt(_t()),pn=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=bc.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,n){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c;let l=null,u=null,d=null,f=i.status,h=i.statusText;if(i.ok){if(this.method!=="HEAD"){let g=await i.text();g===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=g:u=JSON.parse(g))}let p=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),y=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");p&&y&&y.length>1&&(d=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,f=406,h="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let p=await i.text();try{l=JSON.parse(p),Array.isArray(l)&&i.status===404&&(u=[],l=null,f=200,h="OK")}catch{i.status===404&&p===""?(f=204,h="No Content"):l={message:p}}if(l&&this.isMaybeSingle&&(!((c=l?.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,f=200,h="OK"),l&&this.shouldThrowOnError)throw l}return{error:l,data:u,count:d,status:f,statusText:h}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,c;return{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=i?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,n)}};var mn=class extends pn{select(e){let n=!1,r=(e??"*").split("").map(s=>/\s/.test(s)&&!n?"":(s==='"'&&(n=!n),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:n=!0,nullsFirst:r,foreignTable:s}={}){let i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${n?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:n}={}){let r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,n,{foreignTable:r}={}){let s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${n-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:n=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){let a=[e?"analyze":null,n?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};var Ae=class extends mn{eq(e,n){return this.url.searchParams.append(e,`eq.${n}`),this}neq(e,n){return this.url.searchParams.append(e,`neq.${n}`),this}gt(e,n){return this.url.searchParams.append(e,`gt.${n}`),this}gte(e,n){return this.url.searchParams.append(e,`gte.${n}`),this}lt(e,n){return this.url.searchParams.append(e,`lt.${n}`),this}lte(e,n){return this.url.searchParams.append(e,`lte.${n}`),this}like(e,n){return this.url.searchParams.append(e,`like.${n}`),this}likeAllOf(e,n){return this.url.searchParams.append(e,`like(all).{${n.join(",")}}`),this}likeAnyOf(e,n){return this.url.searchParams.append(e,`like(any).{${n.join(",")}}`),this}ilike(e,n){return this.url.searchParams.append(e,`ilike.${n}`),this}ilikeAllOf(e,n){return this.url.searchParams.append(e,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(e,n){return this.url.searchParams.append(e,`ilike(any).{${n.join(",")}}`),this}is(e,n){return this.url.searchParams.append(e,`is.${n}`),this}in(e,n){let r=n.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cs.{${n.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(n)}`),this}containedBy(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cd.{${n.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(n)}`),this}rangeGt(e,n){return this.url.searchParams.append(e,`sr.${n}`),this}rangeGte(e,n){return this.url.searchParams.append(e,`nxl.${n}`),this}rangeLt(e,n){return this.url.searchParams.append(e,`sl.${n}`),this}rangeLte(e,n){return this.url.searchParams.append(e,`nxr.${n}`),this}rangeAdjacent(e,n){return this.url.searchParams.append(e,`adj.${n}`),this}overlaps(e,n){return typeof n=="string"?this.url.searchParams.append(e,`ov.${n}`):this.url.searchParams.append(e,`ov.{${n.join(",")}}`),this}textSearch(e,n,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");let o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${n}`),this}match(e){return Object.entries(e).forEach(([n,r])=>{this.url.searchParams.append(n,`eq.${r}`)}),this}not(e,n,r){return this.url.searchParams.append(e,`not.${n}.${r}`),this}or(e,{foreignTable:n}={}){let r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,n,r){return this.url.searchParams.append(e,`${n}.${r}`),this}};var _n=class{constructor(e,{headers:n={},schema:r,fetch:s}){this.url=e,this.headers=n,this.schema=r,this.fetch=s}select(e,{head:n=!1,count:r}={}){let s=n?"HEAD":"GET",i=!1,o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Ae({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:n,defaultToNull:r=!0}={}){let s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),n&&i.push(`count=${n}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){let o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){let a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ae({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:n,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){let o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(n!==void 0&&this.url.searchParams.set("on_conflict",n),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){let l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ae({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:n}={}){let r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),n&&s.push(`count=${n}`),this.headers.Prefer=s.join(","),new Ae({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let n="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ae({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var vc="1.8.5";var Sc={"X-Client-Info":`postgrest-js/${vc}`};var gn=class t{constructor(e,{headers:n={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Sc),n),this.schemaName=r,this.fetch=s}from(e){let n=new URL(`${this.url}/${e}`);return new _n(n,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,count:s}={}){let i,o=new URL(`${this.url}/rpc/${e}`),a;r?(i="HEAD",Object.entries(n).forEach(([l,u])=>{o.searchParams.append(l,`${u}`)})):(i="POST",a=n);let c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new Ae({method:i,url:o,headers:c,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var Pc=rt(Ac());var Nc="2.8.1";var Oc={"X-Client-Info":`realtime-js/${Nc}`},Dc="1.0.0",ws=1e4,Lc=1e3,yn;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(yn||(yn={}));var ge;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(ge||(ge={}));var Ee;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ee||(Ee={}));var Es;(function(t){t.websocket="websocket"})(Es||(Es={}));var gt;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(gt||(gt={}));var Gt=class{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var vr=class{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){let s=n.getUint8(1),i=n.getUint8(2),o=this.HEADER_LENGTH+2,a=r.decode(e.slice(o,o+s));o=o+s;let c=r.decode(e.slice(o,o+i));o=o+i;let l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}};var Ht=class{constructor(e,n,r={},s=ws){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var ao;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(ao||(ao={}));var bn=class t{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=t.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=t.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){let i=this.cloneDeep(e),o=this.transformState(n),a={},c={};return this.map(i,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{let d=i[l];if(d){let f=u.map(y=>y.presence_ref),h=d.map(y=>y.presence_ref),m=u.filter(y=>h.indexOf(y.presence_ref)<0),p=d.filter(y=>f.indexOf(y.presence_ref)<0);m.length>0&&(a[l]=m),p.length>0&&(c[l]=p)}else a[l]=u}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,n,r,s){let{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var l;let u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){let d=e[a].map(h=>h.presence_ref),f=u.filter(h=>d.indexOf(h.presence_ref)<0);e[a].unshift(...f)}r(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;let u=c.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=l,s(a,l,c),l.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{let s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var z;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(z||(z={}));var lo=(t,e,n={})=>{var r;let s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=ah(o,t,e,s),i),{})},ah=(t,e,n,r)=>{let s=e.find(a=>a.name===t),i=s?.type,o=n[t];return i&&!r.includes(i)?Uc(i,o):co(o)},Uc=(t,e)=>{if(t.charAt(0)==="_"){let n=t.slice(1,t.length);return dh(e,n)}switch(t){case z.bool:return ch(e);case z.float4:case z.float8:case z.int2:case z.int4:case z.int8:case z.numeric:case z.oid:return lh(e);case z.json:case z.jsonb:return uh(e);case z.timestamp:return fh(e);case z.abstime:case z.date:case z.daterange:case z.int4range:case z.int8range:case z.money:case z.reltime:case z.text:case z.time:case z.timestamptz:case z.timetz:case z.tsrange:case z.tstzrange:return co(e);default:return co(e)}},co=t=>t,ch=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},lh=t=>{if(typeof t=="string"){let e=parseFloat(t);if(!Number.isNaN(e))return e}return t},uh=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},dh=(t,e)=>{if(typeof t!="string")return t;let n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i,o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Uc(e,a))}return t},fh=t=>typeof t=="string"?t.replace(" ","T"):t;var uo;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(uo||(uo={}));var fo;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes"})(fo||(fo={}));var ho;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ho||(ho={}));var vn=class t{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=ge.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ht(this,Ee.join,this.params,this.timeout),this.rejoinTimer=new Gt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ge.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ge.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ge.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ge.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ee.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new bn(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,n=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:o}}=this.params;this._onError(l=>e&&e("CHANNEL_ERROR",l)),this._onClose(()=>e&&e("CLOSED"));let a={},c={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(l=>l.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",({postgres_changes:l})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),l===void 0){e&&e("SUBSCRIBED");return}else{let d=this.bindings.postgres_changes,f=(u=d?.length)!==null&&u!==void 0?u:0,h=[];for(let m=0;m<f;m++){let p=d[m],{filter:{event:y,schema:g,table:v,filter:I}}=p,S=l&&l[m];if(S&&S.event===y&&S.schema===g&&S.table===v&&S.filter===I)h.push(Object.assign(Object.assign({},p),{id:S.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=h,e&&e("SUBSCRIBED");return}}).receive("error",l=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){let{event:i,payload:o}=e,a={method:"POST",headers:{apikey:(r=this.socket.accessToken)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=n.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;let l=this._push(e.type,e,n.timeout||this.timeout);l.rateLimited&&i("rate limited"),e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ge.leaving;let n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ee.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let s=new Ht(this,Ee.leave,{},e);s.receive("ok",()=>{n(),r("ok")}).receive("timeout",()=>{n(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,n,r){let s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ht(this,e,n,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;let o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=Ee;if(r&&[a,c,l,u].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,n,r);if(n&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(h=>{var m,p,y;return((m=h.filter)===null||m===void 0?void 0:m.event)==="*"||((y=(p=h.filter)===null||p===void 0?void 0:p.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(h=>h.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(h=>{var m,p,y,g,v,I;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in h){let S=h.id,k=(m=h.filter)===null||m===void 0?void 0:m.event;return S&&((p=n.ids)===null||p===void 0?void 0:p.includes(S))&&(k==="*"||k?.toLocaleLowerCase()===((y=n.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{let S=(v=(g=h?.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return S==="*"||S===((I=n?.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===o}).map(h=>{if(typeof f=="object"&&"ids"in f){let m=f.data,{schema:p,table:y,commit_timestamp:g,type:v,errors:I}=m;f=Object.assign(Object.assign({},{schema:p,table:y,commit_timestamp:g,eventType:v,new:{},old:{},errors:I}),this._getPayloadRecords(m))}h.callback(f,r)})}_isClosed(){return this.state===ge.closed}_isJoined(){return this.state===ge.joined}_isJoining(){return this.state===ge.joining}_isLeaving(){return this.state===ge.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){let s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){let r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(s.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(let r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ee.close,{},e)}_onError(e){this._on(Ee.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ge.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=lo(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=lo(e.columns,e.old_record)),n}};var ph=()=>{},Sn=class{constructor(e,n){var r,s;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Oc,this.params={},this.timeout=ws,this.transport=Pc.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ph,this.conn=null,this.sendBuffer=[],this.serializer=new vr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this._resolveFetch=a=>{let c;return a?c=a:typeof fetch>"u"?c=(...l)=>Promise.resolve().then(()=>rt(_t())).then(({default:u})=>u(...l)):c=fetch,(...l)=>c(...l)},this.endPoint=`${e}/${Es.websocket}`,n?.params&&(this.params=n.params),n?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),n.headers)),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),n?.transport&&(this.transport=n.transport),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);let i=(r=n?.params)===null||r===void 0?void 0:r.eventsPerSecond;i&&(this.eventsPerSecondLimitMs=Math.floor(1e3/i));let o=(s=n?.params)===null||s===void 0?void 0:s.apikey;o&&(this.accessToken=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=n?.encode?n.encode:(a,c)=>c(JSON.stringify(a)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Gt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){let e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case yn.connecting:return gt.Connecting;case yn.open:return gt.Open;case yn.closing:return gt.Closing;default:return gt.Closed}}isConnected(){return this.connectionState()===gt.Open}channel(e,n={config:{}}){let r=new vn(`realtime:${e}`,n,this);return this.channels.push(r),r}push(e){let{topic:n,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};if(this.log("push",`${n} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(n=>{e&&n.updateJoinPayload({access_token:e}),n.joinedOnce&&n._isJoined()&&n._push(Ee.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Dc}))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:s,payload:i,ref:o}=n;(o&&o===this.pendingHeartbeatRef||s===i?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ee.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Lc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,n=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),n>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},n)),!1)}};var En=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function oe(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Is=class extends En{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}},Sr=class extends En{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}};var mh=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},xs=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>rt(_t())).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},Mc=()=>mh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>rt(_t()))).Response:Response});var wn=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},po=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),_h=(t,e)=>wn(void 0,void 0,void 0,function*(){let n=yield Mc();t instanceof n?t.json().then(r=>{e(new Is(po(r),t.status||500))}).catch(r=>{e(new Sr(po(r),r))}):e(new Sr(po(t),t))}),gh=(t,e,n,r)=>{let s={method:t,headers:e?.headers||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};function Ts(t,e,n,r,s,i){return wn(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(n,gh(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>_h(c,a))})})}function Er(t,e,n,r){return wn(this,void 0,void 0,function*(){return Ts(t,"GET",e,n,r)})}function Ve(t,e,n,r,s){return wn(this,void 0,void 0,function*(){return Ts(t,"POST",e,r,s,n)})}function Bc(t,e,n,r,s){return wn(this,void 0,void 0,function*(){return Ts(t,"PUT",e,r,s,n)})}function Cs(t,e,n,r,s){return wn(this,void 0,void 0,function*(){return Ts(t,"DELETE",e,r,s,n)})}var Ne=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},yh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Fc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},wr=class{constructor(e,n={},r,s){this.url=e,this.headers=n,this.bucketId=r,this.fetch=xs(s)}uploadOrUpdate(e,n,r,s){return Ne(this,void 0,void 0,function*(){try{let i,o=Object.assign(Object.assign({},Fc),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);let c=this._removeEmptyFolders(n),l=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{}));return u.ok?{data:{path:c},error:null}:{data:null,error:yield u.json()}}catch(i){if(oe(i))return{data:null,error:i};throw i}})}upload(e,n,r){return Ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,s){return Ne(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",n);try{let c,l=Object.assign({upsert:Fc.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u});return d.ok?{data:{path:i},error:null}:{data:null,error:yield d.json()}}catch(c){if(oe(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return Ne(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),r=yield Ve(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new En("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}})}update(e,n,r){return Ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n){return Ne(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n},{headers:this.headers}),error:null}}catch(r){if(oe(r))return{data:null,error:r};throw r}})}copy(e,n){return Ne(this,void 0,void 0,function*(){try{return{data:{path:(yield Ve(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n},{headers:this.headers})).Key},error:null}}catch(r){if(oe(r))return{data:null,error:r};throw r}})}createSignedUrl(e,n,r){return Ne(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Ve(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(oe(s))return{data:null,error:s};throw s}})}createSignedUrls(e,n,r){return Ne(this,void 0,void 0,function*(){try{let s=yield Ve(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(oe(s))return{data:null,error:s};throw s}})}download(e,n){return Ne(this,void 0,void 0,function*(){let s=typeof n?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(n?.transform||{}),o=i?`?${i}`:"";try{let a=this._getFinalPath(e);return{data:yield(yield Er(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(oe(a))return{data:null,error:a};throw a}})}getPublicUrl(e,n){let r=this._getFinalPath(e),s=[],i=n?.download?`download=${n.download===!0?"":n.download}`:"";i!==""&&s.push(i);let a=typeof n?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(n?.transform||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${l}`)}}}remove(e){return Ne(this,void 0,void 0,function*(){try{return{data:yield Cs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}})}list(e,n,r){return Ne(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},yh),n),{prefix:e||""});return{data:yield Ve(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(oe(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}};var Gc="2.5.4";var Hc={"X-Client-Info":`storage-js/${Gc}`};var In=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},Ir=class{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},Hc),n),this.fetch=xs(r)}listBuckets(){return In(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(oe(e))return{data:null,error:e};throw e}})}getBucket(e){return In(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return In(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(oe(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return In(this,void 0,void 0,function*(){try{return{data:yield Bc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(oe(r))return{data:null,error:r};throw r}})}emptyBucket(e){return In(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}})}deleteBucket(e){return In(this,void 0,void 0,function*(){try{return{data:yield Cs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}})}};var xr=class extends Ir{constructor(e,n={},r){super(e,n,r)}from(e){return new wr(this.url,this.headers,e,this.fetch)}};var $c="2.38.2";var Tr="";typeof Deno<"u"?Tr="deno":typeof document<"u"?Tr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Tr="react-native":Tr="node";var jc={"X-Client-Info":`supabase-js-${Tr}/${$c}`};var ks=rt(_t()),bh=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},vh=t=>{let e;return t?e=t:typeof fetch>"u"?e=ks.default:e=fetch,(...n)=>e(...n)},Sh=()=>typeof Headers>"u"?ks.Headers:Headers,zc=(t,e,n)=>{let r=vh(n),s=Sh();return(i,o)=>bh(void 0,void 0,void 0,function*(){var a;let c=(a=yield e())!==null&&a!==void 0?a:t,l=new s(o?.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:l}))})};function Yc(t){return t.replace(/\/$/,"")}function Wc(t,e){let{db:n,auth:r,realtime:s,global:i}=t,{db:o,auth:a,realtime:c,global:l}=e;return{db:Object.assign(Object.assign({},o),n),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),i)}}function qc(t){return Math.round(Date.now()/1e3)+t}function Vc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}var Ke=()=>typeof document<"u",$t={tested:!1,writable:!1},yt=()=>{if(!Ke())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($t.tested)return $t.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),$t.tested=!0,$t.writable=!0}catch{$t.tested=!0,$t.writable=!1}return $t.writable};function Rs(t){let e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}var As=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>rt(_t())).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},Kc=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",bt=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},kr=async(t,e)=>{let n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Ns=async(t,e)=>{await t.removeItem(e)};function Eh(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",r,s,i,o,a,c,l,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),r=o<<2|a>>4,s=(a&15)<<4|c>>2,i=(c&3)<<6|l,n=n+String.fromCharCode(r),c!=64&&s!=0&&(n=n+String.fromCharCode(s)),l!=64&&i!=0&&(n=n+String.fromCharCode(i));return n}var Cr=class t{constructor(){this.promise=new t.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}};Cr.promiseConstructor=Promise;function mo(t){let e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,n=t.split(".");if(n.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(n[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=n[1];return JSON.parse(Eh(r))}async function Zc(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Jc(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{let o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function wh(t){return("0"+t.toString(16)).substr(-2)}function jt(){let e=new Uint32Array(56);if(typeof crypto>"u"){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length,s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,wh).join("")}async function Ih(t){let n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}function xh(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function zt(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let n=await Ih(t);return xh(n)}var Rr=class extends Error{constructor(e,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n}};function U(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var Os=class extends Rr{constructor(e,n){super(e,n),this.name="AuthApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}};function Xc(t){return U(t)&&t.name==="AuthApiError"}var xn=class extends Rr{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}},vt=class extends Rr{constructor(e,n,r){super(e),this.name=n,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}},st=class extends vt{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}},Tn=class extends vt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}},Yt=class extends vt{constructor(e){super(e,"AuthInvalidCredentialsError",400)}},Wt=class extends vt{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Ar=class extends vt{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Cn=class extends vt{constructor(e,n){super(e,"AuthRetryableFetchError",n)}};function _o(t){return U(t)&&t.name==="AuthRetryableFetchError"}var Th=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n},Nr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Ch=[502,503,504];async function Qc(t){if(!Kc(t))throw new Cn(Nr(t),0);if(Ch.includes(t.status))throw new Cn(Nr(t),t.status);let e;try{e=await t.json()}catch(n){throw new xn(Nr(n),n)}throw new Os(Nr(e),t.status||500)}var kh=(t,e,n,r)=>{let s={method:t,headers:e?.headers||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function F(t,e,n,r){var s;let i=Object.assign({},r?.headers);r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);let a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Rh(t,e,n+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function Rh(t,e,n,r,s,i){let o=kh(e,r,s,i),a;try{a=await t(n,o)}catch(c){throw console.error(c),new Cn(Nr(c),0)}if(a.ok||await Qc(a),r?.noResolveJson)return a;try{return await a.json()}catch(c){await Qc(c)}}function it(t){var e;let n=null;Ah(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=qc(t.expires_in)));let r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Ze(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function el(t){return{data:t,error:null}}function tl(t){let{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,o=Th(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function nl(t){return t}function Ah(t){return t.access_token&&t.refresh_token&&t.expires_in}var Nh=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n},kn=class{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=As(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n="global"){try{return await F(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await F(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ze})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{let{options:n}=e,r=Nh(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await F(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:tl,redirectTo:n?.redirectTo})}catch(n){if(U(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await F(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ze})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,o,a,c;try{let l={nextPage:null,lastPage:0,total:0},u=await F(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:nl});if(u.error)throw u.error;let d=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(m=>{let p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(m.split(";")[1].split("=")[1]);l[`${y}Page`]=p}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(U(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await F(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ze})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){try{return await F(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ze})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){try{return await F(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ze})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{let{data:n,error:r}=await F(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(U(n))return{data:null,error:n};throw n}}async _deleteFactor(e){try{return{data:await F(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(U(n))return{data:null,error:n};throw n}}};var Ds="2.57.0";var rl="http://localhost:9999",sl="supabase.auth.token";var il={"X-Client-Info":`gotrue-js/${Ds}`},go=10;var ol={getItem:t=>yt()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{yt()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{yt()&&globalThis.localStorage.removeItem(t)}};function yo(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function al(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Oh={debug:!!(globalThis&&yt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Ls=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}};al();var Dh={url:rl,storageKey:sl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:il,flowType:"implicit",debug:!1},Or=30*1e3,cl=3;async function Lh(t,e,n){return await n()}var qt=class t{constructor(e){var n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&Ke()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let r=Object.assign(Object.assign({},Dh),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new kn({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=As(r.fetch),this.lock=r.lock||Lh,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:yt()?this.storage=ol:(this.memoryStorage={},this.storage=yo(this.memoryStorage)):(this.memoryStorage={},this.storage=yo(this.memoryStorage)),Ke()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ds}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{let e=Ke()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){let{data:n,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),await this._removeSession(),{error:r};let{session:s,redirectType:i}=n;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return U(e)?{error:e}:{error:new xn("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var n,r,s;try{await this._removeSession();let i;if("email"in e){let{email:u,password:d,options:f}=e,h=null,m=null;if(this.flowType==="pkce"){let p=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,p),h=await zt(p),m=p===h?"plain":"s256"}i=await F(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:h,code_challenge_method:m},xform:it})}else if("phone"in e){let{phone:u,password:d,options:f}=e;i=await F(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:it})}else throw new Yt("You must provide either an email or phone number and a password");let{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};let c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(U(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{await this._removeSession();let n;if("email"in e){let{email:i,password:o,options:a}=e;n=await F(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:it})}else if("phone"in e){let{phone:i,password:o,options:a}=e;n=await F(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:it})}else throw new Yt("You must provide either an email or phone number and a password");let{data:r,error:s}=n;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Tn}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(n){if(U(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let n=await kr(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=await F(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:it});return await Ns(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Tn}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})}async signInWithIdToken(e){await this._removeSession();try{let{options:n,provider:r,token:s,access_token:i,nonce:o}=e,a=await F(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:it}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Tn}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(n){if(U(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,s,i,o;try{if(await this._removeSession(),"email"in e){let{email:a,options:c}=e,l=null,u=null;if(this.flowType==="pkce"){let f=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,f),l=await zt(f),u=f===l?"plain":"s256"}let{error:d}=await F(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=c?.data)!==null&&n!==void 0?n:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){let{phone:a,options:c}=e,{data:l,error:u}=await F(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:u}}throw new Yt("You must provide either an email or phone number.")}catch(a){if(U(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);let{data:o,error:a}=await F(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:it});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");let c=o.session,l=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(U(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var n,r,s;try{await this._removeSession();let i=null,o=null;if(this.flowType==="pkce"){let a=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,a),i=await zt(a),o=a===i?"plain":"s256"}return await F(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:el})}catch(i){if(U(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new st;let{error:s}=await F(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(U(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();let n=`${this.url}/resend`;if("email"in e){let{email:r,type:s,options:i}=e,{error:o}=await F(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){let{phone:r,type:s,options:i}=e,{data:o,error:a}=await F(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Yt("You must provide either an email or phone number and a type")}catch(n){if(U(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){let s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,n=await kr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return{data:{session:e},error:null};let{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await F(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ze}):await this._useSession(async n=>{var r,s;let{data:i,error:o}=n;if(o)throw o;return await F(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:Ze})})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{let{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new st;let o=s.session,a=null,c=null;if(this.flowType==="pkce"&&e.email!=null){let d=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,d),a=await zt(d),c=d===a?"plain":"s256"}let{data:l,error:u}=await F(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:Ze});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return mo(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new st;let n=Date.now()/1e3,r=n,s=!0,i=null,o=mo(e.access_token);if(o.exp&&(r=o.exp,s=r<=n),s){let{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{let{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(n){if(U(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){let{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new st;let{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(U(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e){try{if(!Ke())throw new Wt("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Wt("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Ar("Not a valid PKCE flow url.");let n=Rs(window.location.href);if(e){if(!n.code)throw new Ar("No code detected.");let{data:v,error:I}=await this._exchangeCodeForSession(n.code);if(I)throw I;let S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:v.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new Wt(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});let{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=n;if(!i||!a||!o||!l)throw new Wt("No session defined in URL");let u=Math.round(Date.now()/1e3),d=parseInt(a),f=u+d;c&&(f=parseInt(c));let h=f-u;h*1e3<=Or&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);let m=f-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,f,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,f,u);let{data:p,error:y}=await this._getUser(i);if(y)throw y;let g={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:n.type},error:null}}catch(n){if(U(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantFlow(){let e=Rs(window.location.href);return!!(Ke()&&(e.access_token||e.error_description))}async _isPKCEFlow(){let e=Rs(window.location.href),n=await kr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;let{data:s,error:i}=n;if(i)return{error:i};let o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){let{error:a}=await this.admin.signOut(o,e);if(a&&!(Xc(a)&&(a.status===404||a.status===401)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ns(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){let n=Vc(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{let{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;if(this.flowType==="pkce"){let i=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,i),r=await zt(i),s=i===r?"plain":"s256"}try{return await F(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(U(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){let n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{let r=Date.now();return await Jc(async s=>(await Zc(s*200),this._debug(n,"refreshing attempt",s),await F(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:it})),(s,i,o)=>o&&o.error&&_o(o.error)&&Date.now()+(s+1)*200-r<Or)}catch(r){if(this._debug(n,"error",r),U(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){let r=await this._getUrlForProvider(e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Ke()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;let n="#_recoverAndRefresh()";this._debug(n,"begin");try{let r=await kr(this.storage,this.storageKey);if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}let s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+go;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${go}s`),i){if(this.autoRefreshToken&&r.refresh_token){let{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),_o(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new st;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Cr;let{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new st;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);let a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),U(i)){let o={session:null,error:i};return(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){let s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});let i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await this._persistSession(e)}_persistSession(e){return this._debug("#_persistSession()",e),bt(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ns(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ke()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Or);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async n=>{let{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let s=Math.floor((r.expires_at*1e3-e)/Or);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Or}ms, refresh threshold is ${cl} ticks`),s<=cl&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ls)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ke()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n){let r=[`provider=${encodeURIComponent(e)}`];if(n?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){let s=jt();await bt(this.storage,`${this.storageKey}-code-verifier`,s);let i=await zt(s),o=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",o);let a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(n?.queryParams){let s=new URLSearchParams(n.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;let{data:s,error:i}=n;return i?{data:null,error:i}:await F(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(U(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;let{data:i,error:o}=n;if(o)return{data:null,error:o};let{data:a,error:c}=await F(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(!((s=a?.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(n){if(U(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;let{data:s,error:i}=n;if(i)return{data:null,error:i};let{data:o,error:a}=await F(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(n){if(U(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;let{data:s,error:i}=n;return i?{data:null,error:i}:await F(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(U(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){let{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){let{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};let r=e?.factors||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;let{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let o=this._decodeJWT(s.access_token),a=null;o.aal&&(a=o.aal);let c=a;((r=(n=s.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");let u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}};qt.nextInstanceID=0;var Us=class extends qt{constructor(e){super(e)}};var Uh=function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},Ph={headers:jc},Mh={schema:"public"},Bh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Fh={},Dr=class{constructor(e,n,r){var s,i,o,a,c,l,u,d;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");let f=Yc(e);this.realtimeUrl=`${f}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${f}/auth/v1`,this.storageUrl=`${f}/storage/v1`,this.functionsUrl=`${f}/functions/v1`;let h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:Mh,realtime:Fh,auth:Object.assign(Object.assign({},Bh),{storageKey:h}),global:Ph},p=Wc(r??{},m);this.storageKey=(i=(s=p.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=p.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((c=p.auth)!==null&&c!==void 0?c:{},this.headers,(l=p.global)===null||l===void 0?void 0:l.fetch),this.fetch=zc(n,this._getAccessToken.bind(this),(u=p.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new gn(`${f}/rest/v1`,{headers:this.headers,schema:(d=p.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new yr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xr(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return Uh(this,void 0,void 0,function*(){let{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,debug:a},c,l){let u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Us({url:this.authUrl,headers:Object.assign(Object.assign({},u),c),storageKey:i,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:l})}_initRealtimeClient(e){return new Sn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var ll=(t,e,n)=>new Dr(t,e,n);var Fs,x,ml,Gh,Vt,ul,_l,bo,Hh,Rn={},gl=[],$h=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Gs=Array.isArray;function St(t,e){for(var n in e)t[n]=e[n];return t}function yl(t){var e=t.parentNode;e&&e.removeChild(t)}function Fe(t,e,n){var r,s,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Fs.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return Ps(t,o,r,s,null)}function Ps(t,e,n,r,s){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++ml};return s==null&&x.vnode!=null&&x.vnode(i),i}function le(t){return t.children}function Be(t,e){this.props=t,this.context=e}function Lr(t,e){if(e==null)return t.__?Lr(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__d||n.__e;return typeof t.type=="function"?Lr(t):null}function bl(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return bl(t)}}function dl(t){(!t.__d&&(t.__d=!0)&&Vt.push(t)&&!Ms.__r++||ul!==x.debounceRendering)&&((ul=x.debounceRendering)||_l)(Ms)}function Ms(){var t,e,n,r,s,i,o,a,c;for(Vt.sort(bo);t=Vt.shift();)t.__d&&(e=Vt.length,r=void 0,s=void 0,i=void 0,a=(o=(n=t).__v).__e,(c=n.__P)&&(r=[],s=[],(i=St({},o)).__v=o.__v+1,So(c,o,i,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[a]:null,r,a??Lr(o),o.__h,s),wl(r,o,s),o.__e!=a&&bl(o)),Vt.length>e&&Vt.sort(bo));Ms.__r=0}function vl(t,e,n,r,s,i,o,a,c,l,u){var d,f,h,m,p,y,g,v,I,S=0,k=r&&r.__k||gl,C=k.length,E=C,R=e.length;for(n.__k=[],d=0;d<R;d++)(m=n.__k[d]=(m=e[d])==null||typeof m=="boolean"||typeof m=="function"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?Ps(null,m,null,null,m):Gs(m)?Ps(le,{children:m},null,null,null):m.__b>0?Ps(m.type,m.props,m.key,m.ref?m.ref:null,m.__v):m)!=null?(m.__=n,m.__b=n.__b+1,(v=jh(m,k,g=d+S,E))===-1?h=Rn:(h=k[v]||Rn,k[v]=void 0,E--),So(t,m,h,s,i,o,a,c,l,u),p=m.__e,(f=m.ref)&&h.ref!=f&&(h.ref&&Eo(h.ref,null,m),u.push(f,m.__c||p,m)),p!=null&&(y==null&&(y=p),(I=h===Rn||h.__v===null)?v==-1&&S--:v!==g&&(v===g+1?S++:v>g?E>R-g?S+=v-g:S--:S=v<g&&v==g-1?v-g:0),g=d+S,typeof m.type!="function"||v===g&&h.__k!==m.__k?typeof m.type=="function"||v===g&&!I?m.__d!==void 0?(c=m.__d,m.__d=void 0):c=p.nextSibling:c=El(t,p,c):c=Sl(m,c,t),typeof n.type=="function"&&(n.__d=c))):(h=k[d])&&h.key==null&&h.__e&&(h.__e==c&&(h.__=r,c=Lr(h)),vo(h,h,!1),k[d]=null);for(n.__e=y,d=C;d--;)k[d]!=null&&(typeof n.type=="function"&&k[d].__e!=null&&k[d].__e==n.__d&&(n.__d=k[d].__e.nextSibling),vo(k[d],k[d]))}function Sl(t,e,n){for(var r,s=t.__k,i=0;s&&i<s.length;i++)(r=s[i])&&(r.__=t,e=typeof r.type=="function"?Sl(r,e,n):El(n,r.__e,e));return e}function Ur(t,e){return e=e||[],t==null||typeof t=="boolean"||(Gs(t)?t.some(function(n){Ur(n,e)}):e.push(t)),e}function El(t,e,n){return n==null||n.parentNode!==t?t.insertBefore(e,null):e==n&&e.parentNode!=null||t.insertBefore(e,n),e.nextSibling}function jh(t,e,n,r){var s=t.key,i=t.type,o=n-1,a=n+1,c=e[n];if(c===null||c&&s==c.key&&i===c.type)return n;if(r>(c!=null?1:0))for(;o>=0||a<e.length;){if(o>=0){if((c=e[o])&&s==c.key&&i===c.type)return o;o--}if(a<e.length){if((c=e[a])&&s==c.key&&i===c.type)return a;a++}}return-1}function zh(t,e,n,r,s){var i;for(i in n)i==="children"||i==="key"||i in e||Bs(t,i,null,n[i],r);for(i in e)s&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||n[i]===e[i]||Bs(t,i,e[i],n[i],r)}function fl(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||$h.test(e)?n:n+"px"}function Bs(t,e,n,r,s){var i;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||fl(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||fl(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/(PointerCapture)$|Capture$/,"$1")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=Date.now(),t.addEventListener(e,i?pl:hl,i)):t.removeEventListener(e,i?pl:hl,i);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e!=="rowSpan"&&e!=="colSpan"&&e!=="role"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,n))}}function hl(t){var e=this.l[t.type+!1];if(t.t){if(t.t<=e.u)return}else t.t=Date.now();return e(x.event?x.event(t):t)}function pl(t){return this.l[t.type+!0](x.event?x.event(t):t)}function So(t,e,n,r,s,i,o,a,c,l){var u,d,f,h,m,p,y,g,v,I,S,k,C,E,R,B=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(c=n.__h,a=e.__e=n.__e,e.__h=null,i=[a]),(u=x.__b)&&u(e);e:if(typeof B=="function")try{if(g=e.props,v=(u=B.contextType)&&r[u.__c],I=u?v?v.props.value:u.__:r,n.__c?y=(d=e.__c=n.__c).__=d.__E:("prototype"in B&&B.prototype.render?e.__c=d=new B(g,I):(e.__c=d=new Be(g,I),d.constructor=B,d.render=Wh),v&&v.sub(d),d.props=g,d.state||(d.state={}),d.context=I,d.__n=r,f=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),B.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=St({},d.__s)),St(d.__s,B.getDerivedStateFromProps(g,d.__s))),h=d.props,m=d.state,d.__v=e,f)B.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(B.getDerivedStateFromProps==null&&g!==h&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,I),!d.__e&&(d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,I)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(w){w&&(w.__=e)}),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,I),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(h,m,p)})}if(d.context=I,d.props=g,d.__P=t,d.__e=!1,k=x.__r,C=0,"prototype"in B&&B.prototype.render){for(d.state=d.__s,d.__d=!1,k&&k(e),u=d.render(d.props,d.state,d.context),E=0;E<d._sb.length;E++)d.__h.push(d._sb[E]);d._sb=[]}else do d.__d=!1,k&&k(e),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++C<25);d.state=d.__s,d.getChildContext!=null&&(r=St(St({},r),d.getChildContext())),f||d.getSnapshotBeforeUpdate==null||(p=d.getSnapshotBeforeUpdate(h,m)),vl(t,Gs(R=u!=null&&u.type===le&&u.key==null?u.props.children:u)?R:[R],e,n,r,s,i,o,a,c,l),d.base=e.__e,e.__h=null,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(w){e.__v=null,(c||i!=null)&&(e.__e=a,e.__h=!!c,i[i.indexOf(a)]=null),x.__e(w,e,n)}else i==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Yh(n.__e,e,n,r,s,i,o,c,l);(u=x.diffed)&&u(e)}function wl(t,e,n){for(var r=0;r<n.length;r++)Eo(n[r],n[++r],n[++r]);x.__c&&x.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(i){i.call(s)})}catch(i){x.__e(i,s.__v)}})}function Yh(t,e,n,r,s,i,o,a,c){var l,u,d,f=n.props,h=e.props,m=e.type,p=0;if(m==="svg"&&(s=!0),i!=null){for(;p<i.length;p++)if((l=i[p])&&"setAttribute"in l==!!m&&(m?l.localName===m:l.nodeType===3)){t=l,i[p]=null;break}}if(t==null){if(m===null)return document.createTextNode(h);t=s?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,h.is&&h),i=null,a=!1}if(m===null)f===h||a&&t.data===h||(t.data=h);else{if(i=i&&Fs.call(t.childNodes),u=(f=n.props||Rn).dangerouslySetInnerHTML,d=h.dangerouslySetInnerHTML,!a){if(i!=null)for(f={},p=0;p<t.attributes.length;p++)f[t.attributes[p].name]=t.attributes[p].value;(d||u)&&(d&&(u&&d.__html==u.__html||d.__html===t.innerHTML)||(t.innerHTML=d&&d.__html||""))}if(zh(t,h,f,s,a),d)e.__k=[];else if(vl(t,Gs(p=e.props.children)?p:[p],e,n,r,s&&m!=="foreignObject",i,o,i?i[0]:n.__k&&Lr(n,0),a,c),i!=null)for(p=i.length;p--;)i[p]!=null&&yl(i[p]);a||("value"in h&&(p=h.value)!==void 0&&(p!==t.value||m==="progress"&&!p||m==="option"&&p!==f.value)&&Bs(t,"value",p,f.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==t.checked&&Bs(t,"checked",p,f.checked,!1))}return t}function Eo(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){x.__e(r,n)}}function vo(t,e,n){var r,s;if(x.unmount&&x.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||Eo(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){x.__e(i,e)}r.base=r.__P=null,t.__c=void 0}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&vo(r[s],e,n||typeof t.type!="function");n||t.__e==null||yl(t.__e),t.__=t.__e=t.__d=void 0}function Wh(t,e,n){return this.constructor(t,n)}function An(t,e,n){var r,s,i,o;x.__&&x.__(t,e),s=(r=typeof n=="function")?null:n&&n.__k||e.__k,i=[],o=[],So(e,t=(!r&&n||e).__k=Fe(le,null,[t]),s||Rn,Rn,e.ownerSVGElement!==void 0,!r&&n?[n]:s?null:e.firstChild?Fs.call(e.childNodes):null,i,!r&&n?n:s?s.__e:e.firstChild,r,o),wl(i,t,o)}Fs=gl.slice,x={__e:function(t,e,n,r){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(t)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),o=s.__d),o)return s.__E=s}catch(a){t=a}throw t}},ml=0,Gh=function(t){return t!=null&&t.constructor===void 0},Be.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=St({},this.state),typeof t=="function"&&(t=t(St({},n),this.props)),t&&St(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),dl(this))},Be.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),dl(this))},Be.prototype.render=le,Vt=[],_l=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,bo=function(t,e){return t.__v.__b-e.__v.__b},Ms.__r=0,Hh=0;var Nn,Z,wo,Il,js=0,Nl=[],Hs=[],xl=x.__b,Tl=x.__r,Cl=x.diffed,kl=x.__c,Rl=x.unmount;function zs(t,e){x.__h&&x.__h(Z,t,js||e),js=0;var n=Z.__H||(Z.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:Hs}),n.__[t]}function J(t){return js=1,Ol(Ll,t)}function Ol(t,e,n){var r=zs(Nn++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):Ll(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=Z,!Z.u)){var s=function(a,c,l){if(!r.__c.__H)return!0;var u=r.__c.__H.__.filter(function(f){return f.__c});if(u.every(function(f){return!f.__N}))return!i||i.call(this,a,c,l);var d=!1;return u.forEach(function(f){if(f.__N){var h=f.__[0];f.__=f.__N,f.__N=void 0,h!==f.__[0]&&(d=!0)}}),!(!d&&r.__c.props===a)&&(!i||i.call(this,a,c,l))};Z.u=!0;var i=Z.shouldComponentUpdate,o=Z.componentWillUpdate;Z.componentWillUpdate=function(a,c,l){if(this.__e){var u=i;i=void 0,s(a,c,l),i=u}o&&o.call(this,a,c,l)},Z.shouldComponentUpdate=s}return r.__N||r.__}function Ge(t,e){var n=zs(Nn++,3);!x.__s&&xo(n.__H,e)&&(n.__=t,n.i=e,Z.__H.__h.push(n))}function Pr(t,e){var n=zs(Nn++,4);!x.__s&&xo(n.__H,e)&&(n.__=t,n.i=e,Z.__h.push(n))}function Kt(t){return js=5,Dl(function(){return{current:t}},[])}function Dl(t,e){var n=zs(Nn++,7);return xo(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function qh(){for(var t;t=Nl.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach($s),t.__H.__h.forEach(Io),t.__H.__h=[]}catch(e){t.__H.__h=[],x.__e(e,t.__v)}}x.__b=function(t){Z=null,xl&&xl(t)},x.__r=function(t){Tl&&Tl(t),Nn=0;var e=(Z=t.__c).__H;e&&(wo===Z?(e.__h=[],Z.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=Hs,n.__N=n.i=void 0})):(e.__h.forEach($s),e.__h.forEach(Io),e.__h=[],Nn=0)),wo=Z},x.diffed=function(t){Cl&&Cl(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Nl.push(e)!==1&&Il===x.requestAnimationFrame||((Il=x.requestAnimationFrame)||Vh)(qh)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==Hs&&(n.__=n.__V),n.i=void 0,n.__V=Hs})),wo=Z=null},x.__c=function(t,e){e.some(function(n){try{n.__h.forEach($s),n.__h=n.__h.filter(function(r){return!r.__||Io(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],x.__e(r,n.__v)}}),kl&&kl(t,e)},x.unmount=function(t){Rl&&Rl(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{$s(r)}catch(s){e=s}}),n.__H=void 0,e&&x.__e(e,n.__v))};var Al=typeof requestAnimationFrame=="function";function Vh(t){var e,n=function(){clearTimeout(r),Al&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);Al&&(e=requestAnimationFrame(n))}function $s(t){var e=Z,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),Z=e}function Io(t){var e=Z;t.__c=t.__(),Z=e}function xo(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Ll(t,e){return typeof e=="function"?e(t):e}var Kh=0;function b(t,e,n,r,s,i){var o,a,c={};for(a in e)a=="ref"?o=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Kh,__source:s,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return x.vnode&&x.vnode(l),l}function Ys(){return b("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:b("path",{d:"M14 1.41L12.59 0L7 5.59L1.41 0L0 1.41L5.59 7L0 12.59L1.41 14L7 8.41L12.59 14L14 12.59L8.41 7L14 1.41Z"})})}function Et(t){let[e,n]=J(t.show??!1),r=t.allowClose??!0;return Ge(()=>{t.show!==void 0&&n(t.show)},[t.show]),b("div",{className:`dark:bg-black dark:bg-opacity-80 bg-white bg-opacity-90 fixed inset-0 transition-opacity duration-500 ease-in-out ${e?"!opacity-100":"invisible opacity-0 -translate-y-full"}`,children:b("div",{className:"flex items-center justify-center h-screen",onClick:s=>{s.target===s.currentTarget&&r&&(n(!1),t.onClose&&t.onClose())},children:b("div",{className:`bg-gray-50 dark:bg-[#181822] dark:text-gray-50 rounded-lg shadow-sm w-4/5 min-w-[300px] p-6 border border-gray-200 dark:border-gray-950 ${t.className}`,children:[b("div",{className:"flex justify-between items-center",children:[t.title&&b("div",{className:"m-0 text-base font-bold pb-4",children:t.title}),r&&b("button",{onClick:()=>{n(!1),t.onClose&&t.onClose()},className:"hover:cursor-pointer hover:text-gray-400 text-gray-300 pb-4",children:b(Ys,{})})]}),b("div",{children:t.content})]})})})}function Ul(t){let[n,r]=J(Array(6).fill("")),s=Kt(null);function i(c){let l=document.getElementById(`otp-input-${c+1}`);l&&l.focus()}Pr(()=>{setTimeout(()=>s.current?.focus(),200)},[s]);function o(c){let l=document.getElementById(`otp-input-${c-1}`);l&&l.focus()}function a(c,l){let u=c.currentTarget.value;/[^0-9]/.test(u)||(u.length===1&&(n[l]=u,l<n.length-1&&u!==""&&i(l)),t.onChange&&t.onChange(n.join("")),r([...n]))}return b("div",{className:"flex justify-between gap-2",children:n.map((c,l)=>b("input",{id:`otp-input-${l}`,type:"text",ref:l===0?s:null,value:c,pattern:"\\d*",inputmode:"numeric",onPaste:u=>{if(u.clipboardData===null)return;u.preventDefault();let d=u.clipboardData.getData("text/plain");if(!/^[0-9]+$/.test(d))return;d.split("").slice(0,6).forEach((h,m)=>{n[0+m]=h}),r([...n]),t.onChange&&t.onChange(n.join(""))},onKeyDown:u=>{u.key==="ArrowLeft"&&l>0?o(l):u.key==="ArrowRight"&&l<n.length-1?i(l):u.key==="Backspace"?n[l]===""&&l>0?o(l):(n[l]="",r([...n])):/^[0-9]$/.test(u.key)&&(u.preventDefault(),n[l]=u.key,r([...n]),i(l)),t.onChange&&t.onChange(n.join(""))},onInput:u=>a(u,l),className:"font-bold text-center w-full block py-2 px-1 border-2 border-solid border-blue-400 rounded-lg focus:outline-none dark:bg-gray-800 mt-2 text-3xl focus:border-blue-500"},l))})}function Oe(t,e){let r={...{branch:"master"},...e};"plausible"in window&&typeof window.plausible=="function"&&window.plausible(t,{props:r}),window.location.hostname==="localhost"&&console.log("trackEvent",t,r)}function Yl(t,e){for(var n in e)t[n]=e[n];return t}function Pl(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Ml(t){this.props=t}(Ml.prototype=new Be).isPureReactComponent=!0,Ml.prototype.shouldComponentUpdate=function(t,e){return Pl(this.props,t)||Pl(this.state,e)};var Bl=x.__b;x.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Bl&&Bl(t)};var Xh=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Wl(t){function e(n){var r=Yl({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Xh,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Qh=x.__e;x.__e=function(t,e,n,r){if(t.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),s.__c(t,e)}Qh(t,e,n,r)};var Fl=x.unmount;function ql(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=Yl({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return ql(r,e,n)})),t}function Vl(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return Vl(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.insertBefore(t.__e,t.__d),t.__c.__e=!0,t.__c.__P=n)),t}function To(){this.__u=0,this.t=null,this.__b=null}function Kl(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Ws(){this.u=null,this.o=null}x.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&t.__h===!0&&(t.type=null),Fl&&Fl(t)},(To.prototype=new Be).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var s=Kl(r.__v),i=!1,o=function(){i||(i=!0,n.__R=null,s?s(a):a())};n.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var l=r.state.__a;r.__v.__k[0]=Vl(l,l.__c.__P,l.__c.__O)}var u;for(r.setState({__a:r.__b=null});u=r.t.pop();)u.forceUpdate()}},c=e.__h===!0;r.__u++||c||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(o,o)},To.prototype.componentWillUnmount=function(){this.t=[]},To.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=ql(this.__b,n,r.__O=r.__P)}this.__b=null}var s=e.__a&&Fe(le,null,t.fallback);return s&&(s.__h=null),[Fe(le,null,e.__a?null:t.children),s]};var Gl=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function ep(t){return this.getChildContext=function(){return t.context},t.children}function tp(t){var e=this,n=t.i;e.componentWillUnmount=function(){An(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),An(Fe(ep,{context:e.context},t.__v),e.l)}function Zl(t,e){var n=Fe(tp,{__v:t,i:e});return n.containerInfo=e,n}(Ws.prototype=new Be).__a=function(t){var e=this,n=Kl(e.__v),r=e.o.get(t);return r[0]++,function(s){var i=function(){e.props.revealOrder?(r.push(s),Gl(e,t,r)):s()};n?n(i):i()}},Ws.prototype.render=function(t){this.u=null,this.o=new Map;var e=Ur(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},Ws.prototype.componentDidUpdate=Ws.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){Gl(t,n,e)})};var np=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,rp=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,sp=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,ip=/[A-Z0-9]/g,op=typeof document<"u",ap=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};Be.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Be.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Hl=x.event;function cp(){}function lp(){return this.cancelBubble}function up(){return this.defaultPrevented}x.event=function(t){return Hl&&(t=Hl(t)),t.persist=cp,t.isPropagationStopped=lp,t.isDefaultPrevented=up,t.nativeEvent=t};var Jl,dp={enumerable:!1,configurable:!0,get:function(){return this.class}},$l=x.vnode;x.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,s={};for(var i in n){var o=n[i];if(!(i==="value"&&"defaultValue"in n&&o==null||op&&i==="children"&&r==="noscript"||i==="class"||i==="className")){var a=i.toLowerCase();i==="defaultValue"&&"value"in n&&n.value==null?i="value":i==="download"&&o===!0?o="":a==="ondoubleclick"?i="ondblclick":a!=="onchange"||r!=="input"&&r!=="textarea"||ap(n.type)?a==="onfocus"?i="onfocusin":a==="onblur"?i="onfocusout":sp.test(i)?i=a:r.indexOf("-")===-1&&rp.test(i)?i=i.replace(ip,"-$&").toLowerCase():o===null&&(o=void 0):a=i="oninput",a==="oninput"&&s[i=a]&&(i="oninputCapture"),s[i]=o}}r=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Ur(n.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),r=="select"&&s.defaultValue!=null&&(s.value=Ur(n.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",dp)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),e.props=s}(t),t.$$typeof=np,$l&&$l(t)};var jl=x.__r;x.__r=function(t){jl&&jl(t),Jl=t.__c};var zl=x.diffed;x.diffed=function(t){zl&&zl(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Jl=null};function hp({title:t,titleId:e,...n},r){return Fe("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":e},n),t?Fe("title",{id:e},t):null,Fe("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"}))}var pp=Wl(hp),Co=pp;function Xl(t){let{show:e}=t,[n,r]=J({step:"email",loading:!1,email:""}),[s,i]=J(""),o=Kt(null);function a(f){r(h=>({...h,loading:f}))}function c(){t.onClose()}Pr(()=>{setTimeout(()=>o.current?.focus(),200)},[o,e]);function l(f){if(f.target instanceof HTMLInputElement&&n.step==="email"){let h=f.target.value;r({...n,email:h})}}let u=async f=>{f.preventDefault();let m=f.target.email.value;a(!0);try{let{error:p}=await t.supabase.auth.signInWithOtp({email:m,options:{emailRedirectTo:window.location.href}});Oe("Email submitted"),r(p===null?{step:"otp",loading:!1,email:m}:{step:"email",loading:!1,email:m,error:p.message})}finally{a(!1)}},d=async f=>{a(!0);try{let{error:h}=await t.supabase.auth.verifyOtp({email:f,token:s,type:"email"});Oe("Verification code submitted"),h===null?(t.onLogin?.(),r({step:"email",loading:!1,email:f}),i("")):r({step:"otp",loading:!1,email:f,error:h.message})}finally{a(!1)}};return n.step==="email"?b(Et,{show:e,className:"max-w-sm",title:"Sign in to save",allowClose:!0,onClose:()=>c(),content:b(le,{children:[b("div",{className:"pb-4 leading-relaxed",children:"Enter your email to sign in and save \u2014 we'll send you a code to sign in."}),b("form",{onSubmit:u,children:[b("input",{className:"w-full block py-2 px-4 border-2 border-solid border-blue-400 rounded-lg text-base focus:outline-none dark:bg-gray-800 mt-2",ref:o,onChange:l,value:n.email,type:"email",name:"email",required:!0,placeholder:"Email address"}),n.error&&b("div",{className:"text-red-500 text-sm pt-2",children:n.error}),b("div",{className:"pt-6 flex",children:[b("a",{rel:"noreferrer",target:"_blank",href:"https://blank.page/cafe/channels/support",className:"ml-auto text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 dark:hover:text-underline py-2 pr-5 text-md font-medium hover:cursor-pointer",children:"Need help?"}),b("button",{type:"submit",disabled:n.loading,className:"disabled:opacity-50 disabled:pointer-events-none ml-1 bg-blue-600 text-white py-2 px-5 rounded-lg text-md font-medium hover:cursor-pointer hover:bg-black",children:n.loading?"Sending...":"Continue"})]})]})]})}):b(Et,{show:e,className:"max-w-sm",title:"Check your email",allowClose:!0,onClose:()=>{c()},content:b("form",{onSubmit:f=>{f.preventDefault(),d(n.email)},children:[b("div",{className:"pb-1 leading-relaxed",children:["We sent a code to"," ",b("span",{className:"font-semibold",children:n.email}),"."]}),b("div",{className:"pb-4 leading-relaxed",children:"Please be sure to check your spam folder too."}),b(Ul,{onChange:f=>i(f)}),n.error&&b("div",{className:"text-center text-red-500 text-sm pt-2",children:n.error}),b("div",{className:"pt-6 flex",children:[b("button",{rel:"noreferrer",target:"_blank",onClick:()=>{r({step:"email",email:n.email,loading:!1})},className:"-ml-2 mr-auto text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 dark:hover:text-underline py-2 pr-5 text-md font-medium hover:cursor-pointer inline-flex items-center",children:[b(Co,{className:"w-5 h-5 mt-[1px]"}),"Back"]}),b("a",{type:"submit",target:"_blank",rel:"noreferrer",href:"https://blank.page/cafe/channels/support",className:"ml-auto py-2 pr-5 text-md font-medium hover:cursor-pointer text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 dark:hover:text-underline",children:"Need help?"}),b("button",{type:"submit",disabled:n.loading,className:"disabled:opacity-50 disabled:pointer-events-none ml-1 bg-blue-600 text-white py-2 px-5 rounded-lg text-md font-medium hover:cursor-pointer hover:bg-black",children:n.loading?"Verifying...":"Verify"})]})]})})}function Ql(t){let[e,n]=J(new Date),[r,s]=J(!1);if(Ge(()=>{let i=setInterval(()=>{n(new Date)},1e3);function o(a){let c=document.getElementById("user-popup");c&&!c.contains(a.target)&&s(!1)}return document.body.addEventListener("click",o),()=>{clearInterval(i),document.body.removeEventListener("click",o)}},[s]),t.state.type==="LOADING_PAGE"||t.state.type==="LOADING_AUTH")return b("span",{children:"Loading..."});if("page"in t.state&&"user"in t.state){let i=null;if("errorMessage"in t.state)i=b("span",{className:"text-red-500",children:"Failed to save"});else if(t.state.type==="SAVING_PAGE")i="Saving...";else if(t.state.type==="MODIFIED_PAGE")i="Saving...";else{let o=Math.floor((e.getTime()-t.state.page.updatedAt.getTime())/1e3);o>3600*24?i=`Saved ${Math.floor(o/86400)}d ago`:o>3600?i=`Saved ${Math.floor(o/3600)}h ago`:o>60?i=`Saved ${Math.floor(o/60)}m ago`:i="Saved just now"}return b("div",{children:[b("a",{href:"#",onClick:o=>{o.stopPropagation(),o.preventDefault(),s(!r)},children:i}),r&&b("div",{id:"user-popup",className:"-mt-1 -ml-1 leading-none bg-white dark:bg-[#181822] rounded border border-gray-200 dark:border-none border-solid shadow-sm",children:[b("div",{className:"p-4 pb-2 text-gray-400",children:t.state.user.email}),b("div",{children:b("button",{className:"hover:underline text-red-500 p-4 pt-2",onClick:()=>t.handleSignOut(),children:"Logout"})})]})]})}else return b("a",{href:"#",onClick:i=>{i.preventDefault(),t.handleSignIn()},children:"Sign in to save"})}var tu=rt(eu());function ko(t){let{message:e}=t,[n,r]=J(t.show),[s,i]=J(!1),[o,a]=J(null);function c(){o!==null&&clearTimeout(o),t.onClose?.(),i(!0),setTimeout(()=>{r(!1),i(!1)},300)}function l(){if(t.dissapearAfter!==void 0){let u=setTimeout(()=>{c()},t.dissapearAfter);return a(u),u}return null}return Ge(()=>{t.show===!1&&c(),t.show===!0&&l()},[t.dissapearAfter,t.show]),n===!1?null:b("div",{onMouseEnter:()=>{o!==null&&clearTimeout(o)},onMouseLeave:()=>{l()},className:(0,tu.default)("fixed duration-300 bottom-[20px] left-1/2 bg-gray-900 rounded-lg text-white px-4 py-3 shadow-lg flex items-center translate-x-[-50%] max-w-[80vw] transition-opacity",{"opacity-0":s,"opacity-100":!s}),children:[b("div",{className:"pr-2 w-[300px]",children:e}),b("button",{className:"hover:text-white text-gray-400",onClick:()=>{c()},children:b(Ys,{})})]})}var nu=Object.prototype.toString;function Mr(t){switch(nu.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return we(t,Error)}}function On(t,e){return nu.call(t)===`[object ${e}]`}function Dn(t){return On(t,"ErrorEvent")}function Vs(t){return On(t,"DOMError")}function Ro(t){return On(t,"DOMException")}function ye(t){return On(t,"String")}function Ln(t){return t===null||typeof t!="object"&&typeof t!="function"}function He(t){return On(t,"Object")}function Zt(t){return typeof Event<"u"&&we(t,Event)}function Ao(t){return typeof Element<"u"&&we(t,Element)}function No(t){return On(t,"RegExp")}function Jt(t){return!!(t&&t.then&&typeof t.then=="function")}function Oo(t){return He(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function Br(t){return typeof t=="number"&&t!==t}function we(t,e){try{return t instanceof e}catch{return!1}}function Fr(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}function Je(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function Ks(t,e){if(!Array.isArray(t))return"";let n=[];for(let r=0;r<t.length;r++){let s=t[r];try{Fr(s)?n.push("[VueViewModel]"):n.push(String(s))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function ru(t,e,n=!1){return ye(t)?No(e)?e.test(t):ye(e)?n?t===e:t.includes(e):!1:!1}function Xe(t,e=[],n=!1){return e.some(r=>ru(t,r,n))}function Lo(t,e,n=250,r,s,i,o){if(!i.exception||!i.exception.values||!o||!we(o.originalException,Error))return;let a=i.exception.values.length>0?i.exception.values[i.exception.values.length-1]:void 0;a&&(i.exception.values=mp(Do(t,e,s,o.originalException,r,i.exception.values,a,0),n))}function Do(t,e,n,r,s,i,o,a){if(i.length>=n+1)return i;let c=[...i];if(we(r[s],Error)){su(o,a);let l=t(e,r[s]),u=c.length;iu(l,s,u,a),c=Do(t,e,n,r[s],s,[l,...c],l,u)}return Array.isArray(r.errors)&&r.errors.forEach((l,u)=>{if(we(l,Error)){su(o,a);let d=t(e,l),f=c.length;iu(d,`errors[${u}]`,f,a),c=Do(t,e,n,l,s,[d,...c],d,f)}}),c}function su(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,is_exception_group:!0,exception_id:e}}function iu(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function mp(t,e){return t.map(n=>(n.value&&(n.value=Je(n.value,e)),n))}function Zs(t){return t&&t.Math==Math?t:void 0}var $=typeof globalThis=="object"&&Zs(globalThis)||typeof window=="object"&&Zs(window)||typeof self=="object"&&Zs(self)||typeof global=="object"&&Zs(global)||function(){return this}()||{};function $e(){return $}function Gr(t,e,n){let r=n||$,s=r.__SENTRY__=r.__SENTRY__||{};return s[t]||(s[t]=e())}var Js=$e(),_p=80;function Ie(t,e={}){try{let n=t,r=5,s=[],i=0,o=0,a=" > ",c=a.length,l,u=Array.isArray(e)?e:e.keyAttrs,d=!Array.isArray(e)&&e.maxStringLength||_p;for(;n&&i++<r&&(l=gp(n,u),!(l==="html"||i>1&&o+s.length*c+l.length>=d));)s.push(l),o+=l.length,n=n.parentNode;return s.reverse().join(a)}catch{return"<unknown>"}}function gp(t,e){let n=t,r=[],s,i,o,a,c;if(!n||!n.tagName)return"";r.push(n.tagName.toLowerCase());let l=e&&e.length?e.filter(d=>n.getAttribute(d)).map(d=>[d,n.getAttribute(d)]):null;if(l&&l.length)l.forEach(d=>{r.push(`[${d[0]}="${d[1]}"]`)});else if(n.id&&r.push(`#${n.id}`),s=n.className,s&&ye(s))for(i=s.split(/\s+/),c=0;c<i.length;c++)r.push(`.${i[c]}`);let u=["aria-label","type","name","title","alt"];for(c=0;c<u.length;c++)o=u[c],a=n.getAttribute(o),a&&r.push(`[${o}="${a}"]`);return r.join("")}function Uo(){try{return Js.document.location.href}catch{return""}}function Po(t){return Js.document&&Js.document.querySelector?Js.document.querySelector(t):null}var yp="Sentry Logger ",Hr=["debug","info","warn","error","log","assert","trace"],Un={};function Xs(t){if(!("console"in $))return t();let e=$.console,n={},r=Object.keys(Un);r.forEach(s=>{let i=Un[s];n[s]=e[s],e[s]=i});try{return t()}finally{r.forEach(s=>{e[s]=n[s]})}}function bp(){let t=!1,e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?Hr.forEach(n=>{e[n]=(...r)=>{t&&Xs(()=>{$.console[n](`${yp}[${n}]:`,...r)})}}):Hr.forEach(n=>{e[n]=()=>{}}),e}var _=bp();var vp=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Sp(t){return t==="http"||t==="https"}function Qe(t,e=!1){let{host:n,path:r,pass:s,port:i,projectId:o,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&s?`:${s}`:""}@${n}${i?`:${i}`:""}/${r&&`${r}/`}${o}`}function ou(t){let e=vp.exec(t);if(!e){console.error(`Invalid Sentry Dsn: ${t}`);return}let[n,r,s="",i,o="",a]=e.slice(1),c="",l=a,u=l.split("/");if(u.length>1&&(c=u.slice(0,-1).join("/"),l=u.pop()),l){let d=l.match(/^\d+/);d&&(l=d[0])}return au({host:i,pass:s,path:c,projectId:l,port:o,protocol:n,publicKey:r})}function au(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function Ep(t){if(!(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__))return!0;let{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(o=>t[o]?!1:(_.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?Sp(r)?e&&isNaN(parseInt(e,10))?(_.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(_.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(_.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Qs(t){let e=typeof t=="string"?ou(t):au(t);if(!(!e||!Ep(e)))return e}var de=class extends Error{constructor(e,n="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=n}};function X(t,e,n){if(!(e in t))return;let r=t[e],s=n(r);typeof s=="function"&&ei(s,r),t[e]=s}function wt(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function ei(t,e){try{let n=e.prototype||{};t.prototype=e.prototype=n,wt(t,"__sentry_original__",e)}catch{}}function Xt(t){return t.__sentry_original__}function Bo(t){return Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}function ti(t){if(Mr(t))return{message:t.message,name:t.name,stack:t.stack,...lu(t)};if(Zt(t)){let e={type:t.type,target:cu(t.target),currentTarget:cu(t.currentTarget),...lu(t)};return typeof CustomEvent<"u"&&we(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function cu(t){try{return Ao(t)?Ie(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function lu(t){if(typeof t=="object"&&t!==null){let e={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function Fo(t,e=40){let n=Object.keys(ti(t));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=e)return Je(n[0],e);for(let r=n.length;r>0;r--){let s=n.slice(0,r).join(", ");if(!(s.length>e))return r===n.length?s:Je(s,e)}return""}function ue(t){return Mo(t,new Map)}function Mo(t,e){if(He(t)){let n=e.get(t);if(n!==void 0)return n;let r={};e.set(t,r);for(let s of Object.keys(t))typeof t[s]<"u"&&(r[s]=Mo(t[s],e));return r}if(Array.isArray(t)){let n=e.get(t);if(n!==void 0)return n;let r=[];return e.set(t,r),t.forEach(s=>{r.push(Mo(s,e))}),r}return t}var fu=50,uu=/\(error: (.*)\)/,du=/captureMessage|captureException/;function ni(...t){let e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0)=>{let s=[],i=n.split(`
`);for(let o=r;o<i.length;o++){let a=i[o];if(a.length>1024)continue;let c=uu.test(a)?a.replace(uu,"$1"):a;if(!c.match(/\S*Error: /)){for(let l of e){let u=l(c);if(u){s.push(u);break}}if(s.length>=fu)break}}return hu(s)}}function Ho(t){return Array.isArray(t)?ni(...t):t}function hu(t){if(!t.length)return[];let e=Array.from(t);return/sentryWrapped/.test(e[e.length-1].function||"")&&e.pop(),e.reverse(),du.test(e[e.length-1].function||"")&&(e.pop(),du.test(e[e.length-1].function||"")&&e.pop()),e.slice(0,fu).map(n=>({...n,filename:n.filename||e[e.length-1].filename,function:n.function||"?"}))}var Go="<anonymous>";function De(t){try{return!t||typeof t!="function"?Go:t.name||Go}catch{return Go}}var $o=$e();function ri(){if(!("fetch"in $o))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function $r(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function jo(){if(!ri())return!1;if($r($o.fetch))return!0;let t=!1,e=$o.document;if(e&&typeof e.createElement=="function")try{let n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=$r(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}var si=$e();function pu(){let t=si.chrome,e=t&&t.app&&t.app.runtime,n="history"in si&&!!si.history.pushState&&!!si.history.replaceState;return!e&&n}var ae=$e(),Le="__sentry_xhr_v2__",jr={},mu={};function wp(t){if(!mu[t])switch(mu[t]=!0,t){case"console":Ip();break;case"dom":Su();break;case"xhr":vu();break;case"fetch":xp();break;case"history":Tp();break;case"error":Ap();break;case"unhandledrejection":Np();break;default:(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("unknown instrumentation type:",t);return}}function q(t,e){jr[t]=jr[t]||[],jr[t].push(e),wp(t)}function je(t,e){if(!(!t||!jr[t]))for(let n of jr[t]||[])try{n(e)}catch(r){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${De(n)}
Error:`,r)}}function Ip(){"console"in $&&Hr.forEach(function(t){t in $.console&&X($.console,t,function(e){return Un[t]=e,function(...n){je("console",{args:n,level:t});let r=Un[t];r&&r.apply($.console,n)}})})}function xp(){jo()&&X($,"fetch",function(t){return function(...e){let{method:n,url:r}=bu(e),s={args:e,fetchData:{method:n,url:r},startTimestamp:Date.now()};return je("fetch",{...s}),t.apply($,e).then(i=>(je("fetch",{...s,endTimestamp:Date.now(),response:i}),i),i=>{throw je("fetch",{...s,endTimestamp:Date.now(),error:i}),i})}})}function zo(t,e){return!!t&&typeof t=="object"&&!!t[e]}function _u(t){return typeof t=="string"?t:t?zo(t,"url")?t.url:t.toString?t.toString():"":""}function bu(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){let[n,r]=t;return{url:_u(n),method:zo(r,"method")?String(r.method).toUpperCase():"GET"}}let e=t[0];return{url:_u(e),method:zo(e,"method")?String(e.method).toUpperCase():"GET"}}function vu(){if(!ae.XMLHttpRequest)return;let t=XMLHttpRequest.prototype;X(t,"open",function(e){return function(...n){let r=n[1],s=this[Le]={method:ye(n[0])?n[0].toUpperCase():n[0],url:n[1],request_headers:{}};ye(r)&&s.method==="POST"&&r.match(/sentry_key/)&&(this.__sentry_own_request__=!0);let i=()=>{let o=this[Le];if(o&&this.readyState===4){try{o.status_code=this.status}catch{}je("xhr",{args:n,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:this})}};return"onreadystatechange"in this&&typeof this.onreadystatechange=="function"?X(this,"onreadystatechange",function(o){return function(...a){return i(),o.apply(this,a)}}):this.addEventListener("readystatechange",i),X(this,"setRequestHeader",function(o){return function(...a){let[c,l]=a,u=this[Le];return u&&(u.request_headers[c.toLowerCase()]=l),o.apply(this,a)}}),e.apply(this,n)}}),X(t,"send",function(e){return function(...n){let r=this[Le];return r&&n[0]!==void 0&&(r.body=n[0]),je("xhr",{args:n,startTimestamp:Date.now(),xhr:this}),e.apply(this,n)}})}var ii;function Tp(){if(!pu())return;let t=ae.onpopstate;ae.onpopstate=function(...n){let r=ae.location.href,s=ii;if(ii=r,je("history",{from:s,to:r}),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){let s=r.length>2?r[2]:void 0;if(s){let i=ii,o=String(s);ii=o,je("history",{from:i,to:o})}return n.apply(this,r)}}X(ae.history,"pushState",e),X(ae.history,"replaceState",e)}var Cp=1e3,gu,oi;function kp(t,e){if(t.type!==e.type)return!1;try{if(t.target!==e.target)return!1}catch{}return!0}function Rp(t){if(t.type!=="keypress")return!1;try{let e=t.target;if(!e||!e.tagName)return!0;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)return!1}catch{}return!0}function yu(t,e=!1){return n=>{if(!n||n._sentryCaptured||Rp(n))return;wt(n,"_sentryCaptured",!0);let r=n.type==="keypress"?"input":n.type;(oi===void 0||!kp(oi,n))&&(t({event:n,name:r,global:e}),oi=n),clearTimeout(gu),gu=ae.setTimeout(()=>{oi=void 0},Cp)}}function Su(){if(!ae.document)return;let t=je.bind(null,"dom"),e=yu(t,!0);ae.document.addEventListener("click",e,!1),ae.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{let r=ae[n]&&ae[n].prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(X(r,"addEventListener",function(s){return function(i,o,a){if(i==="click"||i=="keypress")try{let c=this,l=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},u=l[i]=l[i]||{refCount:0};if(!u.handler){let d=yu(t);u.handler=d,s.call(this,i,d,a)}u.refCount++}catch{}return s.call(this,i,o,a)}}),X(r,"removeEventListener",function(s){return function(i,o,a){if(i==="click"||i=="keypress")try{let c=this,l=c.__sentry_instrumentation_handlers__||{},u=l[i];u&&(u.refCount--,u.refCount<=0&&(s.call(this,i,u.handler,a),u.handler=void 0,delete l[i]),Object.keys(l).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return s.call(this,i,o,a)}}))})}var ai=null;function Ap(){ai=ae.onerror,ae.onerror=function(t,e,n,r,s){return je("error",{column:r,error:s,line:n,msg:t,url:e}),ai&&!ai.__SENTRY_LOADER__?ai.apply(this,arguments):!1},ae.onerror.__SENTRY_INSTRUMENTED__=!0}var ci=null;function Np(){ci=ae.onunhandledrejection,ae.onunhandledrejection=function(t){return je("unhandledrejection",t),ci&&!ci.__SENTRY_LOADER__?ci.apply(this,arguments):!0},ae.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Eu(){let t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(s){if(t)return e.has(s)?!0:(e.add(s),!1);for(let i=0;i<e.length;i++)if(e[i]===s)return!0;return e.push(s),!1}function r(s){if(t)e.delete(s);else for(let i=0;i<e.length;i++)if(e[i]===s){e.splice(i,1);break}}return[n,r]}function K(){let t=$,e=t.crypto||t.msCrypto,n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>e.getRandomValues(new Uint8Array(1))[0])}catch{}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function wu(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function ze(t){let{message:e,event_id:n}=t;if(e)return e;let r=wu(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function Pn(t,e,n){let r=t.exception=t.exception||{},s=r.values=r.values||[],i=s[0]=s[0]||{};i.value||(i.value=e||""),i.type||(i.type=n||"Error")}function ot(t,e){let n=wu(t);if(!n)return;let r={type:"generic",handled:!0},s=n.mechanism;if(n.mechanism={...r,...s,...e},e&&"data"in e){let i={...s&&s.data,...e.data};n.mechanism.data=i}}function li(t){if(t&&t.__sentry_captured__)return!0;try{wt(t,"__sentry_captured__",!0)}catch{}return!1}function zr(t){return Array.isArray(t)?t:[t]}function Yo(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function Wo(){return"npm"}function Yr(){return!Yo()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function qo(t,e){return t.require(e)}function be(t,e=100,n=1/0){try{return ui("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function di(t,e=3,n=100*1024){let r=be(t,e);return Up(r)>n?di(t,e-1,n):r}function ui(t,e,n=1/0,r=1/0,s=Eu()){let[i,o]=s;if(e==null||["number","boolean","string"].includes(typeof e)&&!Br(e))return e;let a=Op(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;let c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(i(e))return"[Circular ~]";let l=e;if(l&&typeof l.toJSON=="function")try{let h=l.toJSON();return ui("",h,c-1,r,s)}catch{}let u=Array.isArray(e)?[]:{},d=0,f=ti(e);for(let h in f){if(!Object.prototype.hasOwnProperty.call(f,h))continue;if(d>=r){u[h]="[MaxProperties ~]";break}let m=f[h];u[h]=ui(h,m,c-1,r,s),d++}return o(e),u}function Op(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(Fr(e))return"[VueViewModel]";if(Oo(e))return"[SyntheticEvent]";if(typeof e=="number"&&e!==e)return"[NaN]";if(typeof e=="function")return`[Function: ${De(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;let n=Dp(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function Dp(t){let e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function Lp(t){return~-encodeURI(t).split(/%..|./).length}function Up(t){return Lp(JSON.stringify(t))}var at;(function(t){t[t.PENDING=0]="PENDING";let n=1;t[t.RESOLVED=n]="RESOLVED";let r=2;t[t.REJECTED=r]="REJECTED"})(at||(at={}));function Te(t){return new xe(e=>{e(t)})}function Qt(t){return new xe((e,n)=>{n(t)})}var xe=class t{constructor(e){t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this),this._state=at.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new t((r,s)=>{this._handlers.push([!1,i=>{if(!e)r(i);else try{r(e(i))}catch(o){s(o)}},i=>{if(!n)s(i);else try{r(n(i))}catch(o){s(o)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new t((n,r)=>{let s,i;return this.then(o=>{i=!1,s=o,e&&e()},o=>{i=!0,s=o,e&&e()}).then(()=>{if(i){r(s);return}n(s)})})}__init(){this._resolve=e=>{this._setResult(at.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(at.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===at.PENDING){if(Jt(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===at.PENDING)return;let e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===at.RESOLVED&&n[1](this._value),this._state===at.REJECTED&&n[2](this._value),n[0]=!0)})}}};function Vo(t){let e=[];function n(){return t===void 0||e.length<t}function r(o){return e.splice(e.indexOf(o),1)[0]}function s(o){if(!n())return Qt(new de("Not adding Promise because buffer limit was reached."));let a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function i(o){return new xe((a,c)=>{let l=e.length;if(!l)return a(!0);let u=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(d=>{Te(d).then(()=>{--l||(clearTimeout(u),a(!0))},c)})})}return{$:e,add:s,drain:i}}function Wr(t){if(!t)return{};let e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};let n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}var Iu=["fatal","error","warning","log","info","debug"];function Ko(t){return t==="warn"?"warning":Iu.includes(t)?t:"log"}var Tu=$e(),Jo={nowSeconds:()=>Date.now()/1e3};function Pp(){let{performance:t}=Tu;if(!t||!t.now)return;let e=Date.now()-t.now();return{now:()=>t.now(),timeOrigin:e}}function Mp(){try{return qo(module,"perf_hooks").performance}catch{return}}var Zo=Yr()?Mp():Pp(),xu=Zo===void 0?Jo:{nowSeconds:()=>(Zo.timeOrigin+Zo.now())/1e3},ct=Jo.nowSeconds.bind(Jo),Ye=xu.nowSeconds.bind(xu);var qr,fe=(()=>{let{performance:t}=Tu;if(!t||!t.now){qr="none";return}let e=3600*1e3,n=t.now(),r=Date.now(),s=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,i=s<e,o=t.timing&&t.timing.navigationStart,c=typeof o=="number"?Math.abs(o+n-r):e,l=c<e;return i||l?s<=c?(qr="timeOrigin",t.timeOrigin):(qr="navigationStart",o):(qr="dateNow",r)})();var Vr="baggage",Xo="sentry-",ku=/^sentry-/,Ru=8192;function Qo(t){if(!ye(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce((r,s)=>{let i=Cu(s);return{...r,...i}},{});else{if(!t)return;e=Cu(t)}let n=Object.entries(e).reduce((r,[s,i])=>{if(s.match(ku)){let o=s.slice(Xo.length);r[o]=i}return r},{});if(Object.keys(n).length>0)return n}function Kr(t){if(!t)return;let e=Object.entries(t).reduce((n,[r,s])=>(s&&(n[`${Xo}${r}`]=s),n),{});return Bp(e)}function Cu(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(e[n]=r,e),{})}function Bp(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],s)=>{let i=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=s===0?i:`${e},${i}`;return o.length>Ru?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}var Au=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ea(t){if(!t)return;let e=t.match(Au);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function ta(t,e){let n=ea(t),r=Qo(e),{traceId:s,parentSpanId:i,parentSampled:o}=n||{},a={traceId:s||K(),spanId:K().substring(16),sampled:o};return i&&(a.parentSpanId=i),r&&(a.dsc=r),{traceparentData:n,dynamicSamplingContext:r,propagationContext:a}}function Mn(t=K(),e=K().substring(16),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}function Ue(t,e=[]){return[t,e]}function ra(t,e){let[n,r]=t;return[n,[...r,e]]}function fi(t,e){let n=t[1];for(let r of n){let s=r[0].type;if(e(r,s))return!0}return!1}function na(t,e){return(e||new TextEncoder).encode(t)}function sa(t,e){let[n,r]=t,s=JSON.stringify(n);function i(o){typeof s=="string"?s=typeof o=="string"?s+o:[na(s,e),o]:s.push(typeof o=="string"?na(o,e):o)}for(let o of r){let[a,c]=o;if(i(`
${JSON.stringify(a)}
`),typeof c=="string"||c instanceof Uint8Array)i(c);else{let l;try{l=JSON.stringify(c)}catch{l=JSON.stringify(be(c))}i(l)}}return typeof s=="string"?s:Fp(s)}function Fp(t){let e=t.reduce((s,i)=>s+i.length,0),n=new Uint8Array(e),r=0;for(let s of t)n.set(s,r),r+=s.length;return n}function ia(t,e){let n=typeof t.data=="string"?na(t.data,e):t.data;return[ue({type:"attachment",length:n.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),n]}var Gp={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor"};function hi(t){return Gp[t]}function Bn(t){if(!t||!t.sdk)return;let{name:e,version:n}=t.sdk;return{name:e,version:n}}function Zr(t,e,n,r){let s=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:Qe(r)},...s&&{trace:ue({...s})}}}function oa(t,e,n){let r=[{type:"client_report"},{timestamp:n||ct(),discarded_events:t}];return Ue(e?{dsn:e}:{},[r])}function Nu(t,e=Date.now()){let n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;let r=Date.parse(`${t}`);return isNaN(r)?6e4:r-e}function Ou(t,e){return t[e]||t.all||0}function aa(t,e,n=Date.now()){return Ou(t,e)>n}function ca(t,{statusCode:e,headers:n},r=Date.now()){let s={...t},i=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(i)for(let a of i.trim().split(",")){let[c,l]=a.split(":",2),u=parseInt(c,10),d=(isNaN(u)?60:u)*1e3;if(!l)s.all=r+d;else for(let f of l.split(";"))s[f]=r+d}else o?s.all=r+Nu(o,r):e===429&&(s.all=r+60*1e3);return s}var Fn="production";function Jr(){return Gr("globalEventProcessors",()=>[])}function Hn(t){Jr().push(t)}function Gn(t,e,n,r=0){return new xe((s,i)=>{let o=t[r];if(e===null||typeof o!="function")s(e);else{let a=o({...e},n);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&o.id&&a===null&&_.log(`Event processor "${o.id}" dropped event`),Jt(a)?a.then(c=>Gn(t,c,n,r+1).then(s)).then(null,i):Gn(t,a,n,r+1).then(s).then(null,i)}})}function Du(t){let e=Ye(),n={sid:K(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Hp(n)};return t&&lt(n,t),n}function lt(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||Ye(),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:K()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{let n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function Lu(t,e){let n={};e?n={status:e}:t.status==="ok"&&(n={status:"exited"}),lt(t,n)}function Hp(t){return ue({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}var $p=100,It=class t{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Uu()}static clone(e){let n=new t;return e&&(n._breadcrumbs=[...e._breadcrumbs],n._tags={...e._tags},n._extra={...e._extra},n._contexts={...e._contexts},n._user=e._user,n._level=e._level,n._span=e._span,n._session=e._session,n._transactionName=e._transactionName,n._fingerprint=e._fingerprint,n._eventProcessors=[...e._eventProcessors],n._requestSession=e._requestSession,n._attachments=[...e._attachments],n._sdkProcessingMetadata={...e._sdkProcessingMetadata},n._propagationContext={...e._propagationContext}),n}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{},this._session&&lt(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSpan(e){return this._span=e,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){let e=this.getSpan();return e&&e.transaction}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;if(typeof e=="function"){let n=e(this);return n instanceof t?n:this}return e instanceof t?(this._tags={...this._tags,...e._tags},this._extra={...this._extra,...e._extra},this._contexts={...this._contexts,...e._contexts},e._user&&Object.keys(e._user).length&&(this._user=e._user),e._level&&(this._level=e._level),e._fingerprint&&(this._fingerprint=e._fingerprint),e._requestSession&&(this._requestSession=e._requestSession),e._propagationContext&&(this._propagationContext=e._propagationContext)):He(e)&&(e=e,this._tags={...this._tags,...e.tags},this._extra={...this._extra,...e.extra},this._contexts={...this._contexts,...e.contexts},e.user&&(this._user=e.user),e.level&&(this._level=e.level),e.fingerprint&&(this._fingerprint=e.fingerprint),e.requestSession&&(this._requestSession=e.requestSession),e.propagationContext&&(this._propagationContext=e.propagationContext)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=Uu(),this}addBreadcrumb(e,n){let r=typeof n=="number"?n:$p;if(r<=0)return this;let s={timestamp:ct(),...e},i=this._breadcrumbs;return i.push(s),this._breadcrumbs=i.length>r?i.slice(-r):i,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(e,n={},r){if(this._extra&&Object.keys(this._extra).length&&(e.extra={...this._extra,...e.extra}),this._tags&&Object.keys(this._tags).length&&(e.tags={...this._tags,...e.tags}),this._user&&Object.keys(this._user).length&&(e.user={...this._user,...e.user}),this._contexts&&Object.keys(this._contexts).length&&(e.contexts={...this._contexts,...e.contexts}),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts={trace:this._span.getTraceContext(),...e.contexts};let o=this._span.transaction;if(o){e.sdkProcessingMetadata={dynamicSamplingContext:o.getDynamicSamplingContext(),...e.sdkProcessingMetadata};let a=o.name;a&&(e.tags={transaction:a,...e.tags})}}this._applyFingerprint(e);let s=this._getBreadcrumbs(),i=[...e.breadcrumbs||[],...s];return e.breadcrumbs=i.length>0?i:void 0,e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...this._sdkProcessingMetadata,propagationContext:this._propagationContext},Gn([...r||[],...Jr(),...this._eventProcessors],e,n)}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}_getBreadcrumbs(){return this._breadcrumbs}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}_applyFingerprint(e){e.fingerprint=e.fingerprint?zr(e.fingerprint):[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}};function Uu(){return{traceId:K(),spanId:K().substring(16)}}var Pu=4,jp=100,$n=class{constructor(e,n=new It,r=Pu){this._version=r,this._stack=[{scope:n}],e&&this.bindClient(e)}isOlderThan(e){return this._version<e}bindClient(e){let n=this.getStackTop();n.client=e,e&&e.setupIntegrations&&e.setupIntegrations()}pushScope(){let e=It.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e}popScope(){return this.getStack().length<=1?!1:!!this.getStack().pop()}withScope(e){let n=this.pushScope();try{e(n)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(e,n){let r=this._lastEventId=n&&n.event_id?n.event_id:K(),s=new Error("Sentry syntheticException");return this._withClient((i,o)=>{i.captureException(e,{originalException:e,syntheticException:s,...n,event_id:r},o)}),r}captureMessage(e,n,r){let s=this._lastEventId=r&&r.event_id?r.event_id:K(),i=new Error(e);return this._withClient((o,a)=>{o.captureMessage(e,n,{originalException:e,syntheticException:i,...r,event_id:s},a)}),s}captureEvent(e,n){let r=n&&n.event_id?n.event_id:K();return e.type||(this._lastEventId=r),this._withClient((s,i)=>{s.captureEvent(e,{...n,event_id:r},i)}),r}lastEventId(){return this._lastEventId}addBreadcrumb(e,n){let{scope:r,client:s}=this.getStackTop();if(!s)return;let{beforeBreadcrumb:i=null,maxBreadcrumbs:o=jp}=s.getOptions&&s.getOptions()||{};if(o<=0)return;let c={timestamp:ct(),...e},l=i?Xs(()=>i(c,n)):c;l!==null&&(s.emit&&s.emit("beforeAddBreadcrumb",l,n),r.addBreadcrumb(l,o))}setUser(e){this.getScope().setUser(e)}setTags(e){this.getScope().setTags(e)}setExtras(e){this.getScope().setExtras(e)}setTag(e,n){this.getScope().setTag(e,n)}setExtra(e,n){this.getScope().setExtra(e,n)}setContext(e,n){this.getScope().setContext(e,n)}configureScope(e){let{scope:n,client:r}=this.getStackTop();r&&e(n)}run(e){let n=pi(this);try{e(this)}finally{pi(n)}}getIntegration(e){let n=this.getClient();if(!n)return null;try{return n.getIntegration(e)}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Cannot retrieve integration ${e.id} from the current Hub`),null}}startTransaction(e,n){let r=this._callExtensionMethod("startTransaction",e,n);if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&!r){let s=this.getClient();console.warn(s?`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':
Sentry.addTracingExtensions();
Sentry.init({...});
`:"Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")}return r}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(e=!1){if(e)return this.endSession();this._sendSessionUpdate()}endSession(){let n=this.getStackTop().scope,r=n.getSession();r&&Lu(r),this._sendSessionUpdate(),n.setSession()}startSession(e){let{scope:n,client:r}=this.getStackTop(),{release:s,environment:i=Fn}=r&&r.getOptions()||{},{userAgent:o}=$.navigator||{},a=Du({release:s,environment:i,user:n.getUser(),...o&&{userAgent:o},...e}),c=n.getSession&&n.getSession();return c&&c.status==="ok"&&lt(c,{status:"exited"}),this.endSession(),n.setSession(a),a}shouldSendDefaultPii(){let e=this.getClient(),n=e&&e.getOptions();return!!(n&&n.sendDefaultPii)}_sendSessionUpdate(){let{scope:e,client:n}=this.getStackTop(),r=e.getSession();r&&n&&n.captureSession&&n.captureSession(r)}_withClient(e){let{scope:n,client:r}=this.getStackTop();r&&e(r,n)}_callExtensionMethod(e,...n){let s=en().__SENTRY__;if(s&&s.extensions&&typeof s.extensions[e]=="function")return s.extensions[e].apply(this,n);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Extension method ${e} couldn't be found, doing nothing.`)}};function en(){return $.__SENTRY__=$.__SENTRY__||{extensions:{},hub:void 0},$}function pi(t){let e=en(),n=Xr(e);return la(e,t),n}function T(){let t=en();if(t.__SENTRY__&&t.__SENTRY__.acs){let e=t.__SENTRY__.acs.getCurrentHub();if(e)return e}return zp(t)}function zp(t=en()){return(!Yp(t)||Xr(t).isOlderThan(Pu))&&la(t,new $n),Xr(t)}function Yp(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function Xr(t){return Gr("hub",()=>new $n,t)}function la(t,e){if(!t)return!1;let n=t.__SENTRY__=t.__SENTRY__||{};return n.hub=e,!0}function We(t){return(t||T()).getScope().getTransaction()}var Mu=!1;function Bu(){Mu||(Mu=!0,q("error",ua),q("unhandledrejection",ua))}function ua(){let t=We();if(t){let e="internal_error";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}ua.tag="sentry_tracingErrorCallback";var jn=class{constructor(e=1e3){this._maxlen=e,this.spans=[]}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}},mi=class t{constructor(e={}){this.traceId=e.traceId||K(),this.spanId=e.spanId||K().substring(16),this.startTimestamp=e.startTimestamp||Ye(),this.tags=e.tags||{},this.data=e.data||{},this.instrumenter=e.instrumenter||"sentry",this.origin=e.origin||"manual",e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.name&&(this.description=e.name),e.status&&(this.status=e.status),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}get name(){return this.description||""}set name(e){this.setName(e)}startChild(e){let n=new t({...e,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n),n.transaction=this.transaction,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&n.transaction){let r=e&&e.op||"< unknown op >",s=n.transaction.name||"< unknown name >",i=n.transaction.spanId,o=`[Tracing] Starting '${r}' span on transaction '${s}' (${i}).`;n.transaction.metadata.spanMetadata[n.spanId]={logMessage:o},_.log(o)}return n}setTag(e,n){return this.tags={...this.tags,[e]:n},this}setData(e,n){return this.data={...this.data,[e]:n},this}setStatus(e){return this.status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e)),this.setData("http.response.status_code",e);let n=Fu(e);return n!=="unknown_error"&&this.setStatus(n),this}setName(e){this.description=e}isSuccess(){return this.status==="ok"}finish(e){if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){let{logMessage:n}=this.transaction.metadata.spanMetadata[this.spanId];n&&_.log(n.replace("Starting","Finishing"))}this.endTimestamp=typeof e=="number"?e:Ye()}toTraceparent(){return Mn(this.traceId,this.spanId,this.sampled)}toContext(){return ue({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(e){return this.data=e.data||{},this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=e.spanId||this.spanId,this.startTimestamp=e.startTimestamp||this.startTimestamp,this.status=e.status,this.tags=e.tags||{},this.traceId=e.traceId||this.traceId,this}getTraceContext(){return ue({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return ue({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId,origin:this.origin})}};function Fu(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}function xt(t,e,n){let r=e.getOptions(),{publicKey:s}=e.getDsn()||{},{segment:i}=n&&n.getUser()||{},o=ue({environment:r.environment||Fn,release:r.release,user_segment:i,public_key:s,trace_id:t});return e.emit&&e.emit("createDsc",o),o}var zn=class extends mi{constructor(e,n){super(e),delete this.description,this._measurements={},this._contexts={},this._hub=n||T(),this._name=e.name||"",this.metadata={source:"custom",...e.metadata,spanMetadata:{}},this._trimEnd=e.trimEnd,this.transaction=this;let r=this.metadata.dynamicSamplingContext;r&&(this._frozenDynamicSamplingContext={...r})}get name(){return this._name}set name(e){this.setName(e)}setName(e,n="custom"){this._name=e,this.metadata.source=n}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new jn(e)),this.spanRecorder.add(this)}setContext(e,n){n===null?delete this._contexts[e]:this._contexts[e]=n}setMeasurement(e,n,r=""){this._measurements[e]={value:n,unit:r}}setMetadata(e){this.metadata={...this.metadata,...e}}finish(e){let n=this._finishTransaction(e);if(n)return this._hub.captureEvent(n)}toContext(){let e=super.toContext();return ue({...e,name:this.name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this.name=e.name||"",this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;let e=this._hub||T(),n=e.getClient();if(!n)return{};let r=e.getScope(),s=xt(this.traceId,n,r),i=this.metadata.sampleRate;i!==void 0&&(s.sample_rate=`${i}`);let o=this.metadata.source;return o&&o!=="url"&&(s.transaction=this.name),this.sampled!==void 0&&(s.sampled=String(this.sampled)),s}setHub(e){this._hub=e}_finishTransaction(e){if(this.endTimestamp!==void 0)return;this.name||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(e);let n=this._hub.getClient();if(n&&n.emit&&n.emit("finishTransaction",this),this.sampled!==!0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),n&&n.recordDroppedEvent("sample_rate","transaction");return}let r=this.spanRecorder?this.spanRecorder.spans.filter(a=>a!==this&&a.endTimestamp):[];this._trimEnd&&r.length>0&&(this.endTimestamp=r.reduce((a,c)=>a.endTimestamp&&c.endTimestamp?a.endTimestamp>c.endTimestamp?a:c:a).endTimestamp);let s=this.metadata,i={contexts:{...this._contexts,trace:this.getTraceContext()},spans:r,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...s,dynamicSamplingContext:this.getDynamicSamplingContext()},...s.source&&{transaction_info:{source:s.source}}};return Object.keys(this._measurements).length>0&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),i.measurements=this._measurements),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),i}};var Wn={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},Wp="finishReason",Yn=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"],da=class extends jn{constructor(e,n,r,s){super(s),this._pushActivity=e,this._popActivity=n,this.transactionSpanId=r}add(e){e.spanId!==this.transactionSpanId&&(e.finish=n=>{e.endTimestamp=typeof n=="number"?n:Ye(),this._popActivity(e.spanId)},e.endTimestamp===void 0&&this._pushActivity(e.spanId)),super.add(e)}},Qr=class extends zn{constructor(e,n,r=Wn.idleTimeout,s=Wn.finalTimeout,i=Wn.heartbeatInterval,o=!1){super(e,n),this._idleHub=n,this._idleTimeout=r,this._finalTimeout=s,this._heartbeatInterval=i,this._onScope=o,this.activities={},this._heartbeatCounter=0,this._finished=!1,this._idleTimeoutCanceledPermanently=!1,this._beforeFinishCallbacks=[],this._finishReason=Yn[4],o&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),n.configureScope(a=>a.setSpan(this))),this._restartIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=Yn[3],this.finish())},this._finalTimeout)}finish(e=Ye()){if(this._finished=!0,this.activities={},this.op==="ui.action.click"&&this.setTag(Wp,this._finishReason),this.spanRecorder){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] finishing IdleTransaction",new Date(e*1e3).toISOString(),this.op);for(let n of this._beforeFinishCallbacks)n(this,e);this.spanRecorder.spans=this.spanRecorder.spans.filter(n=>{if(n.spanId===this.spanId)return!0;n.endTimestamp||(n.endTimestamp=e,n.setStatus("cancelled"),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(n,void 0,2)));let r=n.startTimestamp<e,s=(this._finalTimeout+this._idleTimeout)/1e3,i=n.endTimestamp-this.startTimestamp<s;if(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__){let o=JSON.stringify(n,void 0,2);r?i||_.log("[Tracing] discarding Span since it finished after Transaction final timeout",o):_.log("[Tracing] discarding Span since it happened after Transaction was finished",o)}return r&&i}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] No active IdleTransaction");if(this._onScope){let n=this._idleHub.getScope();n.getTransaction()===this&&n.setSpan(void 0)}return super.finish(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){let n=s=>{this._finished||this._pushActivity(s)},r=s=>{this._finished||this._popActivity(s)};this.spanRecorder=new da(n,r,this.spanId,e),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}cancelIdleTimeout(e,{restartOnChildSpanChange:n}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=n===!1,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,Object.keys(this.activities).length===0&&this._idleTimeoutCanceledPermanently&&(this._finishReason=Yn[5],this.finish(e)))}setFinishReason(e){this._finishReason=e}_restartIdleTimeout(e){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&(this._finishReason=Yn[1],this.finish(e))},this._idleTimeout)}_pushActivity(e){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] popActivity ${e}`),delete this.activities[e],(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){let n=Ye();this._idleTimeoutCanceledPermanently?(this._finishReason=Yn[5],this.finish(n)):this._restartIdleTimeout(n+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;let e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=Yn[0],this.finish()):this._pingHeartbeat()}_pingHeartbeat(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}};function qn(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;let e=T().getClient(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}function fa(t,e,n){if(!qn(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let r;return typeof e.tracesSampler=="function"?(r=e.tracesSampler(n),t.setMetadata({sampleRate:Number(r)})):n.parentSampled!==void 0?r=n.parentSampled:typeof e.tracesSampleRate<"u"?(r=e.tracesSampleRate,t.setMetadata({sampleRate:Number(r)})):(r=1,t.setMetadata({sampleRate:r})),qp(r)?r?(t.sampled=Math.random()<r,t.sampled?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(r)})`),t)):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function qp(t){return Br(t)||!(typeof t=="number"||typeof t=="boolean")?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}function Vp(){let e=this.getScope().getSpan();return e?{"sentry-trace":e.toTraceparent()}:{}}function Kp(t,e){let n=this.getClient(),r=n&&n.getOptions()||{},s=r.instrumenter||"sentry",i=t.instrumenter||"sentry";s!==i&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error(`A transaction was started with instrumenter=\`${i}\`, but the SDK is configured with the \`${s}\` instrumenter.
The transaction will not be sampled. Please use the ${s} instrumentation to start transactions.`),t.sampled=!1);let o=new zn(t,this);return o=fa(o,r,{parentSampled:t.parentSampled,transactionContext:t,...e}),o.sampled&&o.initSpanRecorder(r._experiments&&r._experiments.maxSpans),n&&n.emit&&n.emit("startTransaction",o),o}function _i(t,e,n,r,s,i,o){let a=t.getClient(),c=a&&a.getOptions()||{},l=new Qr(e,t,n,r,o,s);return l=fa(l,c,{parentSampled:e.parentSampled,transactionContext:e,...i}),l.sampled&&l.initSpanRecorder(c._experiments&&c._experiments.maxSpans),a&&a.emit&&a.emit("startTransaction",l),l}function gi(){let t=en();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=Kp),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Vp),Bu())}function tn(t,e){return T().captureException(t,{captureContext:e})}function yi(t,e){T().setContext(t,e)}function bi(t){T().withScope(t)}var Zp="7";function Jp(t){let e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function Xp(t){return`${Jp(t)}${t.projectId}/envelope/`}function Qp(t,e){return Bo({sentry_key:t.publicKey,sentry_version:Zp,...e&&{sentry_client:`${e.name}/${e.version}`}})}function Gu(t,e={}){let n=typeof e=="string"?e:e.tunnel,r=typeof e=="string"||!e._metadata?void 0:e._metadata.sdk;return n||`${Xp(t)}?${Qp(t,r)}`}function em(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function Hu(t,e,n,r){let s=Bn(n),i={sent_at:new Date().toISOString(),...s&&{sdk:s},...!!r&&e&&{dsn:Qe(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return Ue(i,[o])}function $u(t,e,n,r){let s=Bn(n),i=t.type&&t.type!=="replay_event"?t.type:"event";em(t,n&&n.sdk);let o=Zr(t,s,r,e);return delete t.sdkProcessingMetadata,Ue(o,[[{type:i},t]])}var ju=[];function tm(t){let e={};return t.forEach(n=>{let{name:r}=n,s=e[r];s&&!s.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.keys(e).map(n=>e[n])}function ha(t){let e=t.defaultIntegrations||[],n=t.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;Array.isArray(n)?r=[...e,...n]:typeof n=="function"?r=zr(n(e)):r=e;let s=tm(r),i=nm(s,o=>o.name==="Debug");if(i!==-1){let[o]=s.splice(i,1);s.push(o)}return s}function zu(t,e){let n={};return e.forEach(r=>{r&&pa(t,r,n)}),n}function pa(t,e,n){if(n[e.name]=e,ju.indexOf(e.name)===-1&&(e.setupOnce(Hn,T),ju.push(e.name)),t.on&&typeof e.preprocessEvent=="function"){let r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(s,i)=>r(s,i,t))}if(t.addEventProcessor&&typeof e.processEvent=="function"){let r=e.processEvent.bind(e),s=Object.assign((i,o)=>r(i,o,t),{id:e.name});t.addEventProcessor(s)}(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`Integration installed: ${e.name}`)}function nm(t,e){for(let n=0;n<t.length;n++)if(e(t[n])===!0)return n;return-1}function es(t,e,n,r,s){let{normalizeDepth:i=3,normalizeMaxBreadth:o=1e3}=t,a={...e,event_id:e.event_id||n.event_id||K(),timestamp:e.timestamp||ct()},c=n.integrations||t.integrations.map(f=>f.name);rm(a,t),om(a,c),e.type===void 0&&sm(a,t.stackParser);let l=r;n.captureContext&&(l=It.clone(l).update(n.captureContext));let u=Te(a),d=s&&s.getEventProcessors?s.getEventProcessors():[];if(l){if(l.getAttachments){let f=[...n.attachments||[],...l.getAttachments()];f.length&&(n.attachments=f)}u=l.applyToEvent(a,n,d)}else u=Gn([...d,...Jr()],a,n);return u.then(f=>(f&&im(f),typeof i=="number"&&i>0?am(f,i,o):f))}function rm(t,e){let{environment:n,release:r,dist:s,maxValueLength:i=250}=e;"environment"in t||(t.environment="environment"in e?n:Fn),t.release===void 0&&r!==void 0&&(t.release=r),t.dist===void 0&&s!==void 0&&(t.dist=s),t.message&&(t.message=Je(t.message,i));let o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=Je(o.value,i));let a=t.request;a&&a.url&&(a.url=Je(a.url,i))}var Yu=new WeakMap;function sm(t,e){let n=$._sentryDebugIds;if(!n)return;let r,s=Yu.get(e);s?r=s:(r=new Map,Yu.set(e,r));let i=Object.keys(n).reduce((o,a)=>{let c,l=r.get(a);l?c=l:(c=e(a),r.set(a,c));for(let u=c.length-1;u>=0;u--){let d=c[u];if(d.filename){o[d.filename]=n[a];break}}return o},{});try{t.exception.values.forEach(o=>{o.stacktrace.frames.forEach(a=>{a.filename&&(a.debug_id=i[a.filename])})})}catch{}}function im(t){let e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(s=>{s.debug_id&&(s.abs_path?e[s.abs_path]=s.debug_id:s.filename&&(e[s.filename]=s.debug_id),delete s.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];let n=t.debug_meta.images;Object.keys(e).forEach(r=>{n.push({type:"sourcemap",code_file:r,debug_id:e[r]})})}function om(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function am(t,e,n){if(!t)return null;let r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(s=>({...s,...s.data&&{data:be(s.data,e,n)}}))},...t.user&&{user:be(t.user,e,n)},...t.contexts&&{contexts:be(t.contexts,e,n)},...t.extra&&{extra:be(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=be(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(s=>(s.data&&(s.data=be(s.data,e,n)),s))),r}var Wu="Not capturing exception because it's already been captured.",ts=class{constructor(e){if(this._options=e,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Qs(e.dsn):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("No DSN provided, client will not send events."),this._dsn){let n=Gu(this._dsn,e);this._transport=e.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:n})}}captureException(e,n,r){if(li(e)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(Wu);return}let s=n&&n.event_id;return this._process(this.eventFromException(e,n).then(i=>this._captureEvent(i,n,r)).then(i=>{s=i})),s}captureMessage(e,n,r,s){let i=r&&r.event_id,o=Ln(e)?this.eventFromMessage(String(e),n,r):this.eventFromException(e,r);return this._process(o.then(a=>this._captureEvent(a,r,s)).then(a=>{i=a})),i}captureEvent(e,n,r){if(n&&n.originalException&&li(n.originalException)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(Wu);return}let s=n&&n.event_id;return this._process(this._captureEvent(e,n,r).then(i=>{s=i})),s}captureSession(e){typeof e.release!="string"?(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),lt(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){let n=this._transport;return n?this._isClientDoneProcessing(e).then(r=>n.flush(e).then(s=>r&&s)):Te(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}setupIntegrations(e){(e&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&(this._integrations=zu(this,this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(e){return this._integrations[e]}getIntegration(e){try{return this._integrations[e.id]||null}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Cannot retrieve integration ${e.id} from the current Client`),null}}addIntegration(e){pa(this,e,this._integrations)}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=$u(e,this._dsn,this._options._metadata,this._options.tunnel);for(let i of n.attachments||[])r=ra(r,ia(i,this._options.transportOptions&&this._options.transportOptions.textEncoder));let s=this._sendEnvelope(r);s&&s.then(i=>this.emit("afterSendEvent",e,i),null)}sendSession(e){let n=Hu(e,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){let s=`${e}:${n}`;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`Adding outcome: "${s}"`),this._outcomes[s]=this._outcomes[s]+1||1}}on(e,n){this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(n)}emit(e,...n){this._hooks[e]&&this._hooks[e].forEach(r=>r(...n))}_updateSessionFromEvent(e,n){let r=!1,s=!1,i=n.exception&&n.exception.values;if(i){s=!0;for(let c of i){let l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}let o=e.status==="ok";(o&&e.errors===0||o&&r)&&(lt(e,{...r&&{status:"crashed"},errors:e.errors||Number(s||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new xe(n=>{let r=0,s=1,i=setInterval(()=>{this._numProcessing==0?(clearInterval(i),n(!0)):(r+=s,e&&r>=e&&(clearInterval(i),n(!1)))},s)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r){let s=this.getOptions(),i=Object.keys(this._integrations);return!n.integrations&&i.length>0&&(n.integrations=i),this.emit("preprocessEvent",e,n),es(s,e,n,r,this).then(o=>{if(o===null)return o;let{propagationContext:a}=o.sdkProcessingMetadata||{};if(!(o.contexts&&o.contexts.trace)&&a){let{traceId:l,spanId:u,parentSpanId:d,dsc:f}=a;o.contexts={trace:{trace_id:l,span_id:u,parent_span_id:d},...o.contexts};let h=f||xt(l,this,r);o.sdkProcessingMetadata={dynamicSamplingContext:h,...o.sdkProcessingMetadata}}return o})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(s=>s.event_id,s=>{if(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__){let i=s;i.logLevel==="log"?_.log(i.message):_.warn(i)}})}_processEvent(e,n,r){let s=this.getOptions(),{sampleRate:i}=s,o=Vu(e),a=qu(e),c=e.type||"error",l=`before send for type \`${c}\``;if(a&&typeof i=="number"&&Math.random()>i)return this.recordDroppedEvent("sample_rate","error",e),Qt(new de(`Discarding event because it's not included in the random sample (sampling rate = ${i})`,"log"));let u=c==="replay_event"?"replay":c;return this._prepareEvent(e,n,r).then(d=>{if(d===null)throw this.recordDroppedEvent("event_processor",u,e),new de("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return d;let h=lm(s,d,n);return cm(h,l)}).then(d=>{if(d===null)throw this.recordDroppedEvent("before_send",u,e),new de(`${l} returned \`null\`, will not send event.`,"log");let f=r&&r.getSession();!o&&f&&this._updateSessionFromEvent(f,d);let h=d.transaction_info;if(o&&h&&d.transaction!==e.transaction){let m="custom";d.transaction_info={...h,source:m}}return this.sendEvent(d,n),d}).then(null,d=>{throw d instanceof de?d:(this.captureException(d,{data:{__sentry__:!0},originalException:d}),new de(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${d}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_sendEnvelope(e){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)return this._transport.send(e).then(null,n=>{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("Error while sending event:",n)});(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("Transport disabled")}_clearOutcomes(){let e=this._outcomes;return this._outcomes={},Object.keys(e).map(n=>{let[r,s]=n.split(":");return{reason:r,category:s,quantity:e[n]}})}};function cm(t,e){let n=`${e} must return \`null\` or a valid event.`;if(Jt(t))return t.then(r=>{if(!He(r)&&r!==null)throw new de(n);return r},r=>{throw new de(`${e} rejected with ${r}`)});if(!He(t)&&t!==null)throw new de(n);return t}function lm(t,e,n){let{beforeSend:r,beforeSendTransaction:s}=t;return qu(e)&&r?r(e,n):Vu(e)&&s?s(e,n):e}function qu(t){return t.type===void 0}function Vu(t){return t.type==="transaction"}function ma(t,e){e.debug===!0&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__?_.enable():console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle."));let n=T();n.getScope().update(e.initialScope);let s=new t(e);n.bindClient(s)}var um=30;function Vn(t,e,n=Vo(t.bufferSize||um)){let r={},s=o=>n.drain(o);function i(o){let a=[];if(fi(o,(d,f)=>{let h=hi(f);if(aa(r,h)){let m=Ku(d,f);t.recordDroppedEvent("ratelimit_backoff",h,m)}else a.push(d)}),a.length===0)return Te();let c=Ue(o[0],a),l=d=>{fi(c,(f,h)=>{let m=Ku(f,h);t.recordDroppedEvent(d,hi(h),m)})},u=()=>e({body:sa(c,t.textEncoder)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=ca(r,d),d),d=>{throw l("network_error"),d});return n.add(u).then(d=>d,d=>{if(d instanceof de)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("Skipped sending event because buffer is full."),l("queue_overflow"),Te();throw d})}return i.__sentry__baseTransport__=!0,{send:i,flush:s}}function Ku(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}var Tt="7.74.1";var nn={};oo(nn,{FunctionToString:()=>Kn,InboundFilters:()=>Zn});var Zu,Kn=class t{static __initStatic(){this.id="FunctionToString"}constructor(){this.name=t.id}setupOnce(){Zu=Function.prototype.toString;try{Function.prototype.toString=function(...e){let n=Xt(this)||this;return Zu.apply(n,e)}}catch{}}};Kn.__initStatic();var dm=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],fm=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],Zn=class t{static __initStatic(){this.id="InboundFilters"}constructor(e={}){this.name=t.id,this._options=e}setupOnce(e,n){}processEvent(e,n,r){let s=r.getOptions(),i=hm(this._options,s);return pm(e,i)?null:e}};Zn.__initStatic();function hm(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:dm],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[],...t.disableTransactionDefaults?[]:fm],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function pm(t,e){return e.ignoreInternal&&vm(t)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Event dropped due to being internal Sentry Error.
Event: ${ze(t)}`),!0):mm(t,e.ignoreErrors)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ze(t)}`),!0):_m(t,e.ignoreTransactions)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${ze(t)}`),!0):gm(t,e.denyUrls)?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ze(t)}.
Url: ${vi(t)}`),!0):ym(t,e.allowUrls)?!1:((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ze(t)}.
Url: ${vi(t)}`),!0)}function mm(t,e){return t.type||!e||!e.length?!1:bm(t).some(n=>Xe(n,e))}function _m(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;let n=t.transaction;return n?Xe(n,e):!1}function gm(t,e){if(!e||!e.length)return!1;let n=vi(t);return n?Xe(n,e):!1}function ym(t,e){if(!e||!e.length)return!0;let n=vi(t);return n?Xe(n,e):!0}function bm(t){let e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&e.length===0&&_.error(`Could not extract message for event ${ze(t)}`),e}function vm(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function Sm(t=[]){for(let e=t.length-1;e>=0;e--){let n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function vi(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?Sm(e):null}catch{return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error(`Cannot extract url for event ${ze(t)}`),null}}function _a(t,e){let n=e.getClient(),r=n&&n.getDsn(),s=n&&n.getOptions().tunnel;return wm(t,r)||Em(t,s)}function Em(t,e){return e?Ju(t)===Ju(e):!1}function wm(t,e){return e?t.includes(e.host):!1}function Ju(t){return t[t.length-1]==="/"?t.slice(0,-1):t}var D=$,ga=0;function ya(){return ga>0}function Bm(){ga++,setTimeout(()=>{ga--})}function Ct(t,e={},n){if(typeof t!="function")return t;try{let s=t.__sentry_wrapped__;if(s)return s;if(Xt(t))return t}catch{return t}let r=function(){let s=Array.prototype.slice.call(arguments);try{n&&typeof n=="function"&&n.apply(this,arguments);let i=s.map(o=>Ct(o,e));return t.apply(this,i)}catch(i){throw Bm(),bi(o=>{o.addEventProcessor(a=>(e.mechanism&&(Pn(a,void 0,void 0),ot(a,e.mechanism)),a.extra={...a.extra,arguments:s},a)),tn(i)}),i}};try{for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}catch{}ei(r,t),wt(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return t.name}})}catch{}return r}function Sa(t,e){let n=Ea(t,e),r={type:e&&e.name,value:$m(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function Fm(t,e,n,r){let i=T().getClient(),o=i&&i.getOptions().normalizeDepth,a={exception:{values:[{type:Zt(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:jm(e,{isUnhandledRejection:r})}]},extra:{__serialized__:di(e,o)}};if(n){let c=Ea(t,n);c.length&&(a.exception.values[0].stacktrace={frames:c})}return a}function ba(t,e){return{exception:{values:[Sa(t,e)]}}}function Ea(t,e){let n=e.stacktrace||e.stack||"",r=Hm(e);try{return t(n,r)}catch{}return[]}var Gm=/Minified React error #\d+;/i;function Hm(t){if(t){if(typeof t.framesToPop=="number")return t.framesToPop;if(Gm.test(t.message))return 1}return 0}function $m(t){let e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}function Xu(t,e,n,r){let s=n&&n.syntheticException||void 0,i=Si(t,e,s,r);return ot(i),i.level="error",n&&n.event_id&&(i.event_id=n.event_id),Te(i)}function Qu(t,e,n="info",r,s){let i=r&&r.syntheticException||void 0,o=va(t,e,i,s);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),Te(o)}function Si(t,e,n,r,s){let i;if(Dn(e)&&e.error)return ba(t,e.error);if(Vs(e)||Ro(e)){let o=e;if("stack"in e)i=ba(t,e);else{let a=o.name||(Vs(o)?"DOMError":"DOMException"),c=o.message?`${a}: ${o.message}`:a;i=va(t,c,n,r),Pn(i,c)}return"code"in o&&(i.tags={...i.tags,"DOMException.code":`${o.code}`}),i}return Mr(e)?ba(t,e):He(e)||Zt(e)?(i=Fm(t,e,n,s),ot(i,{synthetic:!0}),i):(i=va(t,e,n,r),Pn(i,`${e}`,void 0),ot(i,{synthetic:!0}),i)}function va(t,e,n,r){let s={message:e};if(r&&n){let i=Ea(t,n);i.length&&(s.exception={values:[{value:e,stacktrace:{frames:i}}]})}return s}function jm(t,{isUnhandledRejection:e}){let n=Fo(t),r=e?"promise rejection":"exception";return Dn(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:Zt(t)?`Event \`${zm(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function zm(t){try{let e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch{}}function ed(t,{metadata:e,tunnel:n,dsn:r}){let s={event_id:t.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:Qe(r)}},i=Ym(t);return Ue(s,[i])}function Ym(t){return[{type:"user_report"},t]}var Ei=class extends ts{constructor(e){let n=D.SENTRY_SDK_SOURCE||Wo();e._metadata=e._metadata||{},e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:`${n}:@sentry/browser`,version:Tt}],version:Tt},super(e),e.sendClientReports&&D.document&&D.document.addEventListener("visibilitychange",()=>{D.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return Xu(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return Qu(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("SDK not enabled, will not capture user feedback.");return}let n=ed(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}_flushOutcomes(){let e=this._clearOutcomes();if(e.length===0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("No outcomes to send");return}if(!this._dsn){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("No dsn provided, will not send outcomes");return}(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("Sending outcomes:",e);let n=oa(e,this._options.tunnel&&Qe(this._dsn));this._sendEnvelope(n)}};var ns;function td(){if(ns)return ns;if($r(D.fetch))return ns=D.fetch.bind(D);let t=D.document,e=D.fetch;if(t&&typeof t.createElement=="function")try{let n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n);let r=n.contentWindow;r&&r.fetch&&(e=r.fetch),t.head.removeChild(n)}catch(n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return ns=e.bind(D)}function nd(){ns=void 0}function rd(t,e=td()){let n=0,r=0;function s(i){let o=i.body.length;n+=o,r++;let a={body:i.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};try{return e(t.url,a).then(c=>(n-=o,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return nd(),n-=o,r--,Qt(c)}}return Vn(t,s)}var Wm=4;function sd(t){function e(n){return new xe((r,s)=>{let i=new XMLHttpRequest;i.onerror=s,i.onreadystatechange=()=>{i.readyState===Wm&&r({statusCode:i.status,headers:{"x-sentry-rate-limits":i.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":i.getResponseHeader("Retry-After")}})},i.open("POST",t.url);for(let o in t.headers)Object.prototype.hasOwnProperty.call(t.headers,o)&&i.setRequestHeader(o,t.headers[o]);i.send(n.body)})}return Vn(t,e)}var wi="?";var qm=30,Vm=40,Km=50;function wa(t,e,n,r){let s={filename:t,function:e,in_app:!0};return n!==void 0&&(s.lineno=n),r!==void 0&&(s.colno=r),s}var Zm=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Jm=/\((\S*)(?::(\d+))(?::(\d+))\)/,Xm=t=>{let e=Zm.exec(t);if(e){if(e[2]&&e[2].indexOf("eval")===0){let i=Jm.exec(e[2]);i&&(e[2]=i[1],e[3]=i[2],e[4]=i[3])}let[r,s]=od(e[1]||wi,e[2]);return wa(s,r,e[3]?+e[3]:void 0,e[4]?+e[4]:void 0)}},Qm=[qm,Xm],e_=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,t_=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,n_=t=>{let e=e_.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){let i=t_.exec(e[3]);i&&(e[1]=e[1]||"eval",e[3]=i[1],e[4]=i[2],e[5]="")}let r=e[3],s=e[1]||wi;return[s,r]=od(s,r),wa(r,s,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},r_=[Km,n_],s_=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,i_=t=>{let e=s_.exec(t);return e?wa(e[2],e[1]||wi,+e[3],e[4]?+e[4]:void 0):void 0},o_=[Vm,i_];var a_=[Qm,r_,o_],id=ni(...a_),od=(t,e)=>{let n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:wi,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]};var ut=class t{static __initStatic(){this.id="GlobalHandlers"}constructor(e){this.name=t.id,this._options={onerror:!0,onunhandledrejection:!0,...e},this._installFunc={onerror:c_,onunhandledrejection:l_}}setupOnce(){Error.stackTraceLimit=50;let e=this._options;for(let n in e){let r=this._installFunc[n];r&&e[n]&&(f_(n),r(),this._installFunc[n]=void 0)}}};ut.__initStatic();function c_(){q("error",t=>{let[e,n,r]=ld();if(!e.getIntegration(ut))return;let{msg:s,url:i,line:o,column:a,error:c}=t;if(ya()||c&&c.__sentry_own_request__)return;let l=c===void 0&&ye(s)?d_(s,i,o,a):ad(Si(n,c||s,void 0,r,!1),i,o,a);l.level="error",cd(e,c,l,"onerror")})}function l_(){q("unhandledrejection",t=>{let[e,n,r]=ld();if(!e.getIntegration(ut))return;let s=t;try{"reason"in t?s=t.reason:"detail"in t&&"reason"in t.detail&&(s=t.detail.reason)}catch{}if(ya()||s&&s.__sentry_own_request__)return!0;let i=Ln(s)?u_(s):Si(n,s,void 0,r,!0);i.level="error",cd(e,s,i,"onunhandledrejection")})}function u_(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}function d_(t,e,n,r){let s=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i,i=Dn(t)?t.message:t,o="Error",a=i.match(s);return a&&(o=a[1],i=a[2]),ad({exception:{values:[{type:o,value:i}]}},e,n,r)}function ad(t,e,n,r){let s=t.exception=t.exception||{},i=s.values=s.values||[],o=i[0]=i[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],l=isNaN(parseInt(r,10))?void 0:r,u=isNaN(parseInt(n,10))?void 0:n,d=ye(e)&&e.length>0?e:Uo();return c.length===0&&c.push({colno:l,filename:d,function:"?",in_app:!0,lineno:u}),t}function f_(t){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`Global Handler attached: ${t}`)}function cd(t,e,n,r){ot(n,{handled:!1,type:r}),t.captureEvent(n,{originalException:e})}function ld(){let t=T(),e=t.getClient(),n=e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1};return[t,n.stackParser,n.attachStacktrace]}var h_=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],rn=class t{static __initStatic(){this.id="TryCatch"}constructor(e){this.name=t.id,this._options={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e}}setupOnce(){this._options.setTimeout&&X(D,"setTimeout",ud),this._options.setInterval&&X(D,"setInterval",ud),this._options.requestAnimationFrame&&X(D,"requestAnimationFrame",p_),this._options.XMLHttpRequest&&"XMLHttpRequest"in D&&X(XMLHttpRequest.prototype,"send",m_);let e=this._options.eventTarget;e&&(Array.isArray(e)?e:h_).forEach(__)}};rn.__initStatic();function ud(t){return function(...e){let n=e[0];return e[0]=Ct(n,{mechanism:{data:{function:De(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function p_(t){return function(e){return t.apply(this,[Ct(e,{mechanism:{data:{function:"requestAnimationFrame",handler:De(t)},handled:!1,type:"instrument"}})])}}function m_(t){return function(...e){let n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(s=>{s in n&&typeof n[s]=="function"&&X(n,s,function(i){let o={mechanism:{data:{function:s,handler:De(i)},handled:!1,type:"instrument"}},a=Xt(i);return a&&(o.mechanism.data.handler=De(a)),Ct(i,o)})}),t.apply(this,e)}}function __(t){let e=D,n=e[t]&&e[t].prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(X(n,"addEventListener",function(r){return function(s,i,o){try{typeof i.handleEvent=="function"&&(i.handleEvent=Ct(i.handleEvent,{mechanism:{data:{function:"handleEvent",handler:De(i),target:t},handled:!1,type:"instrument"}}))}catch{}return r.apply(this,[s,Ct(i,{mechanism:{data:{function:"addEventListener",handler:De(i),target:t},handled:!1,type:"instrument"}}),o])}}),X(n,"removeEventListener",function(r){return function(s,i,o){let a=i;try{let c=a&&a.__sentry_wrapped__;c&&r.call(this,s,c,o)}catch{}return r.call(this,s,a,o)}}))}var Ii=1024,sn=class t{static __initStatic(){this.id="Breadcrumbs"}constructor(e){this.name=t.id,this.options={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e}}setupOnce(){if(this.options.console&&q("console",b_),this.options.dom&&q("dom",y_(this.options.dom)),this.options.xhr&&q("xhr",v_),this.options.fetch&&q("fetch",S_),this.options.history&&q("history",E_),this.options.sentry){let e=T().getClient();e&&e.on&&e.on("beforeSendEvent",g_)}}};sn.__initStatic();function g_(t){T().addBreadcrumb({category:`sentry.${t.type==="transaction"?"transaction":"event"}`,event_id:t.event_id,level:t.level,message:ze(t)},{event:t})}function y_(t){function e(n){let r,s=typeof t=="object"?t.serializeAttribute:void 0,i=typeof t=="object"&&typeof t.maxStringLength=="number"?t.maxStringLength:void 0;i&&i>Ii&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`\`dom.maxStringLength\` cannot exceed ${Ii}, but a value of ${i} was configured. Sentry will use ${Ii} instead.`),i=Ii),typeof s=="string"&&(s=[s]);try{let o=n.event;r=w_(o)?Ie(o.target,{keyAttrs:s,maxStringLength:i}):Ie(o,{keyAttrs:s,maxStringLength:i})}catch{r="<unknown>"}r.length!==0&&T().addBreadcrumb({category:`ui.${n.name}`,message:r},{event:n.event,name:n.name,global:n.global})}return e}function b_(t){let e={category:"console",data:{arguments:t.args,logger:"console"},level:Ko(t.level),message:Ks(t.args," ")};if(t.level==="assert")if(t.args[0]===!1)e.message=`Assertion failed: ${Ks(t.args.slice(1)," ")||"console.assert"}`,e.data.arguments=t.args.slice(1);else return;T().addBreadcrumb(e,{input:t.args,level:t.level})}function v_(t){let{startTimestamp:e,endTimestamp:n}=t,r=t.xhr[Le];if(!e||!n||!r)return;let{method:s,url:i,status_code:o,body:a}=r,c={method:s,url:i,status_code:o},l={xhr:t.xhr,input:a,startTimestamp:e,endTimestamp:n};T().addBreadcrumb({category:"xhr",data:c,type:"http"},l)}function S_(t){let{startTimestamp:e,endTimestamp:n}=t;if(n&&!(t.fetchData.url.match(/sentry_key/)&&t.fetchData.method==="POST"))if(t.error){let r=t.fetchData,s={data:t.error,input:t.args,startTimestamp:e,endTimestamp:n};T().addBreadcrumb({category:"fetch",data:r,level:"error",type:"http"},s)}else{let r={...t.fetchData,status_code:t.response&&t.response.status},s={input:t.args,response:t.response,startTimestamp:e,endTimestamp:n};T().addBreadcrumb({category:"fetch",data:r,type:"http"},s)}}function E_(t){let e=t.from,n=t.to,r=Wr(D.location.href),s=Wr(e),i=Wr(n);s.path||(s=r),r.protocol===i.protocol&&r.host===i.host&&(n=i.relative),r.protocol===s.protocol&&r.host===s.host&&(e=s.relative),T().addBreadcrumb({category:"navigation",data:{from:e,to:n}})}function w_(t){return!!t&&!!t.target}var I_="cause",x_=5,on=class t{static __initStatic(){this.id="LinkedErrors"}constructor(e={}){this.name=t.id,this._key=e.key||I_,this._limit=e.limit||x_}setupOnce(){}preprocessEvent(e,n,r){let s=r.getOptions();Lo(Sa,s.stackParser,s.maxValueLength,this._key,this._limit,e,n)}};on.__initStatic();var an=class t{static __initStatic(){this.id="HttpContext"}constructor(){this.name=t.id}setupOnce(){}preprocessEvent(e){if(!D.navigator&&!D.location&&!D.document)return;let n=e.request&&e.request.url||D.location&&D.location.href,{referrer:r}=D.document||{},{userAgent:s}=D.navigator||{},i={...e.request&&e.request.headers,...r&&{Referer:r},...s&&{"User-Agent":s}},o={...e.request,...n&&{url:n},headers:i};e.request=o}};an.__initStatic();var cn=class t{static __initStatic(){this.id="Dedupe"}constructor(){this.name=t.id}setupOnce(e,n){}processEvent(e){if(e.type)return e;try{if(T_(e,this._previousEvent))return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return this._previousEvent=e}};cn.__initStatic();function T_(t,e){return e?!!(C_(t,e)||k_(t,e)):!1}function C_(t,e){let n=t.message,r=e.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!pd(t,e)||!hd(t,e))}function k_(t,e){let n=dd(e),r=dd(t);return!(!n||!r||n.type!==r.type||n.value!==r.value||!pd(t,e)||!hd(t,e))}function hd(t,e){let n=fd(t),r=fd(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let s=0;s<r.length;s++){let i=r[s],o=n[s];if(i.filename!==o.filename||i.lineno!==o.lineno||i.colno!==o.colno||i.function!==o.function)return!1}return!0}function pd(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function dd(t){return t.exception&&t.exception.values&&t.exception.values[0]}function fd(t){let e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch{return}}var _d=[new nn.InboundFilters,new nn.FunctionToString,new rn,new sn,new ut,new on,new cn,new an];function Ia(t={}){t.defaultIntegrations===void 0&&(t.defaultIntegrations=_d),t.release===void 0&&(typeof __SENTRY_RELEASE__=="string"&&(t.release=__SENTRY_RELEASE__),D.SENTRY_RELEASE&&D.SENTRY_RELEASE.id&&(t.release=D.SENTRY_RELEASE.id)),t.autoSessionTracking===void 0&&(t.autoSessionTracking=!0),t.sendClientReports===void 0&&(t.sendClientReports=!0);let e={...t,stackParser:Ho(t.stackParser||id),integrations:ha(t),transport:t.transport||(ri()?rd:sd)};ma(Ei,e),t.autoSessionTracking&&R_()}function md(t){t.startSession({ignoreDuration:!0}),t.captureSession()}function R_(){if(typeof D.document>"u"){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Session tracking in non-browser environment with @sentry/browser is not supported.");return}let t=T();t.captureSession&&(md(t),q("history",({from:e,to:n})=>{e===void 0||e===n||md(T())}))}var xa={};oo(xa,{Breadcrumbs:()=>sn,Dedupe:()=>cn,GlobalHandlers:()=>ut,HttpContext:()=>an,LinkedErrors:()=>on,TryCatch:()=>rn});var G=$,Xa="sentryReplaySession",A_="replay_event",Qa="Unable to send Replay",N_=3e5,O_=9e5,D_=5e3,L_=5500,U_=6e4,P_=5e3,M_=3,xi=15e4,Ti=5e3,B_=3e3,F_=300,ec=2e7,G_=4999,H_=15e3,gd=36e5,re;(function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"})(re||(re={}));function $_(t){return t.nodeType===t.ELEMENT_NODE}function is(t){let e=t?.host;return e?.shadowRoot===t}function os(t){return Object.prototype.toString.call(t)==="[object ShadowRoot]"}function j_(t){return t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),t}function z_(t){let{cssText:e}=t;if(e.split('"').length<3)return e;let n=["@import",`url(${JSON.stringify(t.href)})`];return t.layerName===""?n.push("layer"):t.layerName&&n.push(`layer(${t.layerName})`),t.supportsText&&n.push(`supports(${t.supportsText})`),t.media.length&&n.push(t.media.mediaText),n.join(" ")+";"}function Oi(t){try{let e=t.rules||t.cssRules;return e?j_(Array.from(e,Gd).join("")):null}catch{return null}}function Gd(t){let e;if(W_(t))try{e=Oi(t.styleSheet)||z_(t)}catch{}else if(q_(t)&&t.selectorText.includes(":"))return Y_(t.cssText);return e||t.cssText}function Y_(t){let e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return t.replace(e,"$1\\$2")}function W_(t){return"styleSheet"in t}function q_(t){return"selectorText"in t}var Di=class{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(e){var n;if(!e)return-1;let r=(n=this.getMeta(e))===null||n===void 0?void 0:n.id;return r??-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){let n=this.getId(e);this.idNodeMap.delete(n),e.childNodes&&e.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,n){let r=n.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,n)}replace(e,n){let r=this.getNode(e);if(r){let s=this.nodeMetaMap.get(r);s&&this.nodeMetaMap.set(n,s)}this.idNodeMap.set(e,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function V_(){return new Di}function Yi({maskInputOptions:t,tagName:e,type:n}){return e==="OPTION"&&(e="SELECT"),!!(t[e.toLowerCase()]||n&&t[n]||n==="password"||e==="INPUT"&&!n&&t.text)}function cs({isMasked:t,element:e,value:n,maskInputFn:r}){let s=n||"";return t?(r&&(s=r(s,e)),"*".repeat(s.length)):s}function sr(t){return t.toLowerCase()}function Ra(t){return t.toUpperCase()}var yd="__rrweb_original__";function K_(t){let e=t.getContext("2d");if(!e)return!0;let n=50;for(let r=0;r<t.width;r+=n)for(let s=0;s<t.height;s+=n){let i=e.getImageData,o=yd in i?i[yd]:i;if(new Uint32Array(o.call(e,r,s,Math.min(n,t.width-r),Math.min(n,t.height-s)).data.buffer).some(c=>c!==0))return!1}return!0}function tc(t){let e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?sr(e):null}function Li(t,e,n){return e==="INPUT"&&(n==="radio"||n==="checkbox")?t.getAttribute("value")||"":t.value}var Z_=1,J_=new RegExp("[^a-z0-9-_:]"),ls=-2;function Hd(){return Z_++}function X_(t){if(t instanceof HTMLFormElement)return"form";let e=sr(t.tagName);return J_.test(e)?"div":e}function Q_(t){let e="";return t.indexOf("//")>-1?e=t.split("/").slice(0,3).join("/"):e=t.split("/")[0],e=e.split("?")[0],e}var Jn,bd,eg=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,tg=/^(?:[a-z+]+:)?\/\//i,ng=/^www\..*/i,rg=/^(data:)([^,]*),(.*)/i;function Ui(t,e){return(t||"").replace(eg,(n,r,s,i,o,a)=>{let c=s||o||a,l=r||i||"";if(!c)return n;if(tg.test(c)||ng.test(c))return`url(${l}${c}${l})`;if(rg.test(c))return`url(${l}${c}${l})`;if(c[0]==="/")return`url(${l}${Q_(e)+c}${l})`;let u=e.split("/"),d=c.split("/");u.pop();for(let f of d)f!=="."&&(f===".."?u.pop():u.push(f));return`url(${l}${u.join("/")}${l})`})}var sg=/^[^ \t\n\r\u000c]+/,ig=/^[, \t\n\r\u000c]+/;function og(t,e){if(e.trim()==="")return e;let n=0;function r(i){let o,a=i.exec(e.substring(n));return a?(o=a[0],n+=o.length,o):""}let s=[];for(;r(ig),!(n>=e.length);){let i=r(sg);if(i.slice(-1)===",")i=Qn(t,i.substring(0,i.length-1)),s.push(i);else{let o="";i=Qn(t,i);let a=!1;for(;;){let c=e.charAt(n);if(c===""){s.push((i+o).trim());break}else if(a)c===")"&&(a=!1);else if(c===","){n+=1,s.push((i+o).trim());break}else c==="("&&(a=!0);o+=c,n+=1}}}return s.join(", ")}function Qn(t,e){if(!e||e.trim()==="")return e;let n=t.createElement("a");return n.href=e,n.href}function ag(t){return!!(t.tagName==="svg"||t.ownerSVGElement)}function nc(){let t=document.createElement("a");return t.href="",t.href}function $d(t,e,n,r,s,i){return r&&(n==="src"||n==="href"&&!(e==="use"&&r[0]==="#")||n==="xlink:href"&&r[0]!=="#"||n==="background"&&(e==="table"||e==="td"||e==="th")?Qn(t,r):n==="srcset"?og(t,r):n==="style"?Ui(r,nc()):e==="object"&&n==="data"?Qn(t,r):typeof i=="function"?i(n,r,s):r)}function jd(t,e,n){return(t==="video"||t==="audio")&&e==="autoplay"}function cg(t,e,n,r){try{if(r&&t.matches(r))return!1;if(typeof e=="string"){if(t.classList.contains(e))return!0}else for(let s=t.classList.length;s--;){let i=t.classList[s];if(e.test(i))return!0}if(n)return t.matches(n)}catch{}return!1}function lg(t,e){for(let n=t.classList.length;n--;){let r=t.classList[n];if(e.test(r))return!0}return!1}function ln(t,e,n=1/0,r=0){return!t||t.nodeType!==t.ELEMENT_NODE||r>n?-1:e(t)?r:ln(t.parentNode,e,n,r+1)}function er(t,e){return n=>{let r=n;if(r===null)return!1;if(t){if(typeof t=="string"){if(r.matches(`.${t}`))return!0}else if(lg(r,t))return!0}return!!(e&&r.matches(e))}}function ir(t,e,n,r,s,i){try{let o=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(o===null)return!1;let a=-1,c=-1;if(i){if(c=ln(o,er(r,s)),c<0)return!0;a=ln(o,er(e,n),c>=0?c:1/0)}else{if(a=ln(o,er(e,n)),a<0)return!1;c=ln(o,er(r,s),a>=0?a:1/0)}return a>=0?c>=0?a<=c:!0:c>=0?!1:!!i}catch{}return!!i}function ug(t,e,n){let r=t.contentWindow;if(!r)return;let s=!1,i;try{i=r.document.readyState}catch{return}if(i!=="complete"){let a=setTimeout(()=>{s||(e(),s=!0)},n);t.addEventListener("load",()=>{clearTimeout(a),s=!0,e()});return}let o="about:blank";if(r.location.href!==o||t.src===o||t.src==="")return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}function dg(t,e,n){let r=!1,s;try{s=t.sheet}catch{return}if(s)return;let i=setTimeout(()=>{r||(e(),r=!0)},n);t.addEventListener("load",()=>{clearTimeout(i),r=!0,e()})}function fg(t,e){let{doc:n,mirror:r,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:a,maskAttributeFn:c,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f,inlineStylesheet:h,maskInputOptions:m={},maskTextFn:p,maskInputFn:y,dataURLOptions:g={},inlineImages:v,recordCanvas:I,keepIframeSrcFn:S,newlyAddedElement:k=!1}=e,C=hg(n,r);switch(t.nodeType){case t.DOCUMENT_NODE:return t.compatMode!=="CSS1Compat"?{type:re.Document,childNodes:[],compatMode:t.compatMode}:{type:re.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:re.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:C};case t.ELEMENT_NODE:return mg(t,{doc:n,blockClass:s,blockSelector:i,unblockSelector:o,inlineStylesheet:h,maskAttributeFn:c,maskInputOptions:m,maskInputFn:y,dataURLOptions:g,inlineImages:v,recordCanvas:I,keepIframeSrcFn:S,newlyAddedElement:k,rootId:C,maskAllText:a,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f});case t.TEXT_NODE:return pg(t,{maskAllText:a,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f,maskTextFn:p,maskInputOptions:m,maskInputFn:y,rootId:C});case t.CDATA_SECTION_NODE:return{type:re.CDATA,textContent:"",rootId:C};case t.COMMENT_NODE:return{type:re.Comment,textContent:t.textContent||"",rootId:C};default:return!1}}function hg(t,e){if(!e.hasNode(t))return;let n=e.getId(t);return n===1?void 0:n}function pg(t,e){var n;let{maskAllText:r,maskTextClass:s,unmaskTextClass:i,maskTextSelector:o,unmaskTextSelector:a,maskTextFn:c,maskInputOptions:l,maskInputFn:u,rootId:d}=e,f=t.parentNode&&t.parentNode.tagName,h=t.textContent,m=f==="STYLE"?!0:void 0,p=f==="SCRIPT"?!0:void 0,y=f==="TEXTAREA"?!0:void 0;if(m&&h){try{t.nextSibling||t.previousSibling||!((n=t.parentNode.sheet)===null||n===void 0)&&n.cssRules&&(h=Oi(t.parentNode.sheet))}catch(v){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${v}`,t)}h=Ui(h,nc())}p&&(h="SCRIPT_PLACEHOLDER");let g=ir(t,s,o,i,a,r);if(!m&&!p&&!y&&h&&g&&(h=c?c(h):h.replace(/[\S]/g,"*")),y&&h&&(l.textarea||g)&&(h=u?u(h,t.parentNode):h.replace(/[\S]/g,"*")),f==="OPTION"&&h){let v=Yi({type:null,tagName:f,maskInputOptions:l});h=cs({isMasked:ir(t,s,o,i,a,v),element:t,value:h,maskInputFn:u})}return{type:re.Text,textContent:h||"",isStyle:m,rootId:d}}function mg(t,e){let{doc:n,blockClass:r,blockSelector:s,unblockSelector:i,inlineStylesheet:o,maskInputOptions:a={},maskAttributeFn:c,maskInputFn:l,dataURLOptions:u={},inlineImages:d,recordCanvas:f,keepIframeSrcFn:h,newlyAddedElement:m=!1,rootId:p,maskAllText:y,maskTextClass:g,unmaskTextClass:v,maskTextSelector:I,unmaskTextSelector:S}=e,k=cg(t,r,s,i),C=X_(t),E={},R=t.attributes.length;for(let w=0;w<R;w++){let N=t.attributes[w];jd(C,N.name,N.value)||(E[N.name]=$d(n,C,sr(N.name),N.value,t,c))}if(C==="link"&&o){let w=Array.from(n.styleSheets).find(j=>j.href===t.href),N=null;w&&(N=Oi(w)),N&&(delete E.rel,delete E.href,E._cssText=Ui(N,w.href))}if(C==="style"&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){let w=Oi(t.sheet);w&&(E._cssText=Ui(w,nc()))}if(C==="input"||C==="textarea"||C==="select"||C==="option"){let w=t,N=tc(w),j=Li(w,Ra(C),N),ie=w.checked;if(N!=="submit"&&N!=="button"&&j){let ce=ir(w,g,I,v,S,Yi({type:N,tagName:Ra(C),maskInputOptions:a}));E.value=cs({isMasked:ce,element:w,value:j,maskInputFn:l})}ie&&(E.checked=ie)}if(C==="option"&&(t.selected&&!a.select?E.selected=!0:delete E.selected),C==="canvas"&&f){if(t.__context==="2d")K_(t)||(E.rr_dataURL=t.toDataURL(u.type,u.quality));else if(!("__context"in t)){let w=t.toDataURL(u.type,u.quality),N=document.createElement("canvas");N.width=t.width,N.height=t.height;let j=N.toDataURL(u.type,u.quality);w!==j&&(E.rr_dataURL=w)}}if(C==="img"&&d){Jn||(Jn=n.createElement("canvas"),bd=Jn.getContext("2d"));let w=t,N=w.crossOrigin;w.crossOrigin="anonymous";let j=()=>{w.removeEventListener("load",j);try{Jn.width=w.naturalWidth,Jn.height=w.naturalHeight,bd.drawImage(w,0,0),E.rr_dataURL=Jn.toDataURL(u.type,u.quality)}catch(ie){console.warn(`Cannot inline img src=${w.currentSrc}! Error: ${ie}`)}N?E.crossOrigin=N:w.removeAttribute("crossorigin")};w.complete&&w.naturalWidth!==0?j():w.addEventListener("load",j)}if((C==="audio"||C==="video")&&(E.rr_mediaState=t.paused?"paused":"played",E.rr_mediaCurrentTime=t.currentTime),m||(t.scrollLeft&&(E.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(E.rr_scrollTop=t.scrollTop)),k){let{width:w,height:N}=t.getBoundingClientRect();E={class:E.class,rr_width:`${w}px`,rr_height:`${N}px`}}C==="iframe"&&!h(E.src)&&(t.contentDocument||(E.rr_src=E.src),delete E.src);let B;try{customElements.get(C)&&(B=!0)}catch{}return{type:re.Element,tagName:C,attributes:E,childNodes:[],isSVG:ag(t)||void 0,needBlock:k,rootId:p,isCustom:B}}function Y(t){return t==null?"":t.toLowerCase()}function _g(t,e){if(e.comment&&t.type===re.Comment)return!0;if(t.type===re.Element){if(e.script&&(t.tagName==="script"||t.tagName==="link"&&(t.attributes.rel==="preload"||t.attributes.rel==="modulepreload")&&t.attributes.as==="script"||t.tagName==="link"&&t.attributes.rel==="prefetch"&&typeof t.attributes.href=="string"&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&(t.tagName==="link"&&t.attributes.rel==="shortcut icon"||t.tagName==="meta"&&(Y(t.attributes.name).match(/^msapplication-tile(image|color)$/)||Y(t.attributes.name)==="application-name"||Y(t.attributes.rel)==="icon"||Y(t.attributes.rel)==="apple-touch-icon"||Y(t.attributes.rel)==="shortcut icon")))return!0;if(t.tagName==="meta"){if(e.headMetaDescKeywords&&Y(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(Y(t.attributes.property).match(/^(og|twitter|fb):/)||Y(t.attributes.name).match(/^(og|twitter):/)||Y(t.attributes.name)==="pinterest"))return!0;if(e.headMetaRobots&&(Y(t.attributes.name)==="robots"||Y(t.attributes.name)==="googlebot"||Y(t.attributes.name)==="bingbot"))return!0;if(e.headMetaHttpEquiv&&t.attributes["http-equiv"]!==void 0)return!0;if(e.headMetaAuthorship&&(Y(t.attributes.name)==="author"||Y(t.attributes.name)==="generator"||Y(t.attributes.name)==="framework"||Y(t.attributes.name)==="publisher"||Y(t.attributes.name)==="progid"||Y(t.attributes.property).match(/^article:/)||Y(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&(Y(t.attributes.name)==="google-site-verification"||Y(t.attributes.name)==="yandex-verification"||Y(t.attributes.name)==="csrf-token"||Y(t.attributes.name)==="p:domain_verify"||Y(t.attributes.name)==="verify-v1"||Y(t.attributes.name)==="verification"||Y(t.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function tr(t,e){let{doc:n,mirror:r,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:f=!1,inlineStylesheet:h=!0,maskInputOptions:m={},maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOMOptions:v,dataURLOptions:I={},inlineImages:S=!1,recordCanvas:k=!1,onSerialize:C,onIframeLoad:E,iframeLoadTimeout:R=5e3,onStylesheetLoad:B,stylesheetLoadTimeout:w=5e3,keepIframeSrcFn:N=()=>!1,newlyAddedElement:j=!1}=e,{preserveWhiteSpace:ie=!0}=e,ce=fg(t,{doc:n,mirror:r,blockClass:s,blockSelector:i,maskAllText:a,unblockSelector:o,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,inlineStylesheet:h,maskInputOptions:m,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,dataURLOptions:I,inlineImages:S,recordCanvas:k,keepIframeSrcFn:N,newlyAddedElement:j});if(!ce)return console.warn(t,"not serialized"),null;let Se;r.hasNode(t)?Se=r.getId(t):_g(ce,v)||!ie&&ce.type===re.Text&&!ce.isStyle&&!ce.textContent.replace(/^\s+|\s+$/gm,"").length?Se=ls:Se=Hd();let H=Object.assign(ce,{id:Se});if(r.add(t,H),Se===ls)return null;C&&C(t);let Ce=!f;if(H.type===re.Element){Ce=Ce&&!H.needBlock,delete H.needBlock;let te=t.shadowRoot;te&&os(te)&&(H.isShadowHost=!0)}if((H.type===re.Document||H.type===re.Element)&&Ce){v.headWhitespace&&H.type===re.Element&&H.tagName==="head"&&(ie=!1);let te={doc:n,mirror:r,blockClass:s,blockSelector:i,maskAllText:a,unblockSelector:o,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:f,inlineStylesheet:h,maskInputOptions:m,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOMOptions:v,dataURLOptions:I,inlineImages:S,recordCanvas:k,preserveWhiteSpace:ie,onSerialize:C,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:B,stylesheetLoadTimeout:w,keepIframeSrcFn:N};for(let ke of Array.from(t.childNodes)){let Re=tr(ke,te);Re&&H.childNodes.push(Re)}if($_(t)&&t.shadowRoot)for(let ke of Array.from(t.shadowRoot.childNodes)){let Re=tr(ke,te);Re&&(os(t.shadowRoot)&&(Re.isShadow=!0),H.childNodes.push(Re))}}return t.parentNode&&is(t.parentNode)&&os(t.parentNode)&&(H.isShadow=!0),H.type===re.Element&&H.tagName==="iframe"&&ug(t,()=>{let te=t.contentDocument;if(te&&E){let ke=tr(te,{doc:te,mirror:r,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:h,maskInputOptions:m,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOMOptions:v,dataURLOptions:I,inlineImages:S,recordCanvas:k,preserveWhiteSpace:ie,onSerialize:C,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:B,stylesheetLoadTimeout:w,keepIframeSrcFn:N});ke&&E(t,ke)}},R),H.type===re.Element&&H.tagName==="link"&&H.attributes.rel==="stylesheet"&&dg(t,()=>{if(B){let te=tr(t,{doc:n,mirror:r,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:h,maskInputOptions:m,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOMOptions:v,dataURLOptions:I,inlineImages:S,recordCanvas:k,preserveWhiteSpace:ie,onSerialize:C,onIframeLoad:E,iframeLoadTimeout:R,onStylesheetLoad:B,stylesheetLoadTimeout:w,keepIframeSrcFn:N});te&&B(t,te)}},w),H}function gg(t,e){let{mirror:n=new Di,blockClass:r="rr-block",blockSelector:s=null,unblockSelector:i=null,maskAllText:o=!1,maskTextClass:a="rr-mask",unmaskTextClass:c=null,maskTextSelector:l=null,unmaskTextSelector:u=null,inlineStylesheet:d=!0,inlineImages:f=!1,recordCanvas:h=!1,maskAllInputs:m=!1,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOM:v=!1,dataURLOptions:I,preserveWhiteSpace:S,onSerialize:k,onIframeLoad:C,iframeLoadTimeout:E,onStylesheetLoad:R,stylesheetLoadTimeout:B,keepIframeSrcFn:w=()=>!1}=e||{};return tr(t,{doc:t,mirror:n,blockClass:r,blockSelector:s,unblockSelector:i,maskAllText:o,maskTextClass:a,unmaskTextClass:c,maskTextSelector:l,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:d,maskInputOptions:m===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:m===!1?{}:m,maskAttributeFn:p,maskTextFn:y,maskInputFn:g,slimDOMOptions:v===!0||v==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:v==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:v===!1?{}:v,dataURLOptions:I,inlineImages:f,recordCanvas:h,preserveWhiteSpace:S,onSerialize:k,onIframeLoad:C,iframeLoadTimeout:E,onStylesheetLoad:R,stylesheetLoadTimeout:B,keepIframeSrcFn:w,newlyAddedElement:!1})}function me(t,e,n=document){let r={capture:!0,passive:!0};return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}var Xn=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`,vd={map:{},getId(){return console.error(Xn),-1},getNode(){return console.error(Xn),null},removeNodeFromMap(){console.error(Xn)},has(){return console.error(Xn),!1},reset(){console.error(Xn)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(vd=new Proxy(vd,{get(t,e,n){return e==="map"&&console.error(Xn),Reflect.get(t,e,n)}}));function us(t,e,n={}){let r=null,s=0;return function(...i){let o=Date.now();!s&&n.leading===!1&&(s=o);let a=e-(o-s),c=this;a<=0||a>e?(r&&(clearTimeout(r),r=null),s=o,t.apply(c,i)):!r&&n.trailing!==!1&&(r=setTimeout(()=>{s=n.leading===!1?0:Date.now(),r=null,t.apply(c,i)},a))}}function Wi(t,e,n,r,s=window){let i=s.Object.getOwnPropertyDescriptor(t,e);return s.Object.defineProperty(t,e,r?n:{set(o){setTimeout(()=>{n.set.call(this,o)},0),i&&i.set&&i.set.call(this,o)}}),()=>Wi(t,e,i||{},!0)}function dr(t,e,n){try{if(!(e in t))return()=>{};let r=t[e],s=n(r);return typeof s=="function"&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__rrweb_original__:{enumerable:!1,value:r}})),t[e]=s,()=>{t[e]=r}}catch{return()=>{}}}var Pi=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(Pi=()=>new Date().getTime());function zd(t){var e,n,r,s,i,o;let a=t.document;return{left:a.scrollingElement?a.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:a?.documentElement.scrollLeft||((n=(e=a?.body)===null||e===void 0?void 0:e.parentElement)===null||n===void 0?void 0:n.scrollLeft)||((r=a?.body)===null||r===void 0?void 0:r.scrollLeft)||0,top:a.scrollingElement?a.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:a?.documentElement.scrollTop||((i=(s=a?.body)===null||s===void 0?void 0:s.parentElement)===null||i===void 0?void 0:i.scrollTop)||((o=a?.body)===null||o===void 0?void 0:o.scrollTop)||0}}function Yd(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function Wd(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function _e(t,e,n,r,s){if(!t)return!1;let i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!i)return!1;let o=er(e,n);if(!s){let l=r&&i.matches(r);return o(i)&&!l}let a=ln(i,o),c=-1;return a<0?!1:(r&&(c=ln(i,er(null,r))),a>-1&&c<0?!0:a<c)}function yg(t,e){return e.getId(t)!==-1}function Ta(t,e){return e.getId(t)===ls}function qd(t,e){if(is(t))return!1;let n=e.getId(t);return e.has(n)?t.parentNode&&t.parentNode.nodeType===t.DOCUMENT_NODE?!1:t.parentNode?qd(t.parentNode,e):!0:!0}function Aa(t){return!!t.changedTouches}function bg(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let n=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do if(this===n)return!0;while(n=n&&n.parentNode);return!1})}function Vd(t,e){return!!(t.nodeName==="IFRAME"&&e.getMeta(t))}function Kd(t,e){return!!(t.nodeName==="LINK"&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&t.getAttribute("rel")==="stylesheet"&&e.getMeta(t))}function Na(t){return!!t?.shadowRoot}var Oa=class{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){var n;return(n=this.styleIDMap.get(e))!==null&&n!==void 0?n:-1}has(e){return this.styleIDMap.has(e)}add(e,n){if(this.has(e))return this.getId(e);let r;return n===void 0?r=this.id++:r=n,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}};function Zd(t){var e,n;let r=null;return((n=(e=t.getRootNode)===null||e===void 0?void 0:e.call(t))===null||n===void 0?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&t.getRootNode().host&&(r=t.getRootNode().host),r}function vg(t){let e=t,n;for(;n=Zd(e);)e=n;return e}function Sg(t){let e=t.ownerDocument;if(!e)return!1;let n=vg(t);return e.contains(n)}function Jd(t){let e=t.ownerDocument;return e?e.contains(t)||Sg(t):!1}var O=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(O||{}),P=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t))(P||{}),ve=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(ve||{}),dt=(t=>(t[t.Mouse=0]="Mouse",t[t.Pen=1]="Pen",t[t.Touch=2]="Touch",t))(dt||{}),or=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(or||{});function Sd(t){return"__ln"in t}var Da=class{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let n=this.head;for(let r=0;r<e;r++)n=n?.next||null;return n}addNode(e){let n={value:e,previous:null,next:null};if(e.__ln=n,e.previousSibling&&Sd(e.previousSibling)){let r=e.previousSibling.__ln.next;n.next=r,n.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=n,r&&(r.previous=n)}else if(e.nextSibling&&Sd(e.nextSibling)&&e.nextSibling.__ln.previous){let r=e.nextSibling.__ln.previous;n.previous=r,n.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=n,r&&(r.next=n)}else this.head&&(this.head.previous=n),n.next=this.head,this.head=n;n.next===null&&(this.tail=n),this.length++}removeNode(e){let n=e.__ln;this.head&&(n.previous?(n.previous.next=n.next,n.next?n.next.previous=n.previous:this.tail=n.previous):(this.head=n.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}},Ed=(t,e)=>`${t}@${e}`,La=class{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;let e=[],n=new Set,r=new Da,s=c=>{let l=c,u=ls;for(;u===ls;)l=l&&l.nextSibling,u=l&&this.mirror.getId(l);return u},i=c=>{if(!c.parentNode||!Jd(c))return;let l=is(c.parentNode)?this.mirror.getId(Zd(c)):this.mirror.getId(c.parentNode),u=s(c);if(l===-1||u===-1)return r.addNode(c);let d=tr(c,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:f=>{Vd(f,this.mirror)&&this.iframeManager.addIframe(f),Kd(f,this.mirror)&&this.stylesheetManager.trackLinkElement(f),Na(c)&&this.shadowDomManager.addShadowRoot(c.shadowRoot,this.doc)},onIframeLoad:(f,h)=>{this.iframeManager.attachIframe(f,h),this.shadowDomManager.observeAttachShadow(f)},onStylesheetLoad:(f,h)=>{this.stylesheetManager.attachLinkElement(f,h)}});d&&(e.push({parentId:l,nextId:u,node:d}),n.add(d.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(let c of this.movedSet)wd(this.removes,c,this.mirror)&&!this.movedSet.has(c.parentNode)||i(c);for(let c of this.addedSet)!Id(this.droppedSet,c)&&!wd(this.removes,c,this.mirror)||Id(this.movedSet,c)?i(c):this.droppedSet.add(c);let o=null;for(;r.length;){let c=null;if(o){let l=this.mirror.getId(o.value.parentNode),u=s(o.value);l!==-1&&u!==-1&&(c=o)}if(!c){let l=r.tail;for(;l;){let u=l;if(l=l.previous,u){let d=this.mirror.getId(u.value.parentNode);if(s(u.value)===-1)continue;if(d!==-1){c=u;break}else{let h=u.value;if(h.parentNode&&h.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let m=h.parentNode.host;if(this.mirror.getId(m)!==-1){c=u;break}}}}}}if(!c){for(;r.head;)r.removeNode(r.head.value);break}o=c.previous,r.removeNode(c.value),i(c.value)}let a={texts:this.texts.map(c=>({id:this.mirror.getId(c.node),value:c.value})).filter(c=>!n.has(c.id)).filter(c=>this.mirror.has(c.id)),attributes:this.attributes.map(c=>{let{attributes:l}=c;if(typeof l.style=="string"){let u=JSON.stringify(c.styleDiff),d=JSON.stringify(c._unchangedStyles);u.length<l.style.length&&(u+d).split("var(").length===l.style.split("var(").length&&(l.style=c.styleDiff)}return{id:this.mirror.getId(c.node),attributes:l}}).filter(c=>!n.has(c.id)).filter(c=>this.mirror.has(c.id)),removes:this.removes,adds:e};!a.texts.length&&!a.attributes.length&&!a.removes.length&&!a.adds.length||(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(a))},this.processMutation=e=>{if(Ta(e.target,this.mirror))return;let n;try{n=document.implementation.createHTMLDocument()}catch{n=this.doc}switch(e.type){case"characterData":{let r=e.target.textContent;!_e(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&r!==e.oldValue&&this.texts.push({value:ir(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&r?this.maskTextFn?this.maskTextFn(r):r.replace(/[\S]/g,"*"):r,node:e.target});break}case"attributes":{let r=e.target,s=e.attributeName,i=e.target.getAttribute(s);if(s==="value"){let a=tc(r),c=r.tagName;i=Li(r,c,a);let l=Yi({maskInputOptions:this.maskInputOptions,tagName:c,type:a}),u=ir(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,l);i=cs({isMasked:u,element:r,value:i,maskInputFn:this.maskInputFn})}if(_e(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||i===e.oldValue)return;let o=this.attributes.find(a=>a.node===e.target);if(r.tagName==="IFRAME"&&s==="src"&&!this.keepIframeSrcFn(i))if(!r.contentDocument)s="rr_src";else return;if(o||(o={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(o)),s==="type"&&r.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&r.setAttribute("data-rr-is-password","true"),!jd(r.tagName,s)&&(o.attributes[s]=$d(this.doc,sr(r.tagName),sr(s),i,r,this.maskAttributeFn),s==="style")){let a=n.createElement("span");e.oldValue&&a.setAttribute("style",e.oldValue);for(let c of Array.from(r.style)){let l=r.style.getPropertyValue(c),u=r.style.getPropertyPriority(c);l!==a.style.getPropertyValue(c)||u!==a.style.getPropertyPriority(c)?u===""?o.styleDiff[c]=l:o.styleDiff[c]=[l,u]:o._unchangedStyles[c]=[l,u]}for(let c of Array.from(a.style))r.style.getPropertyValue(c)===""&&(o.styleDiff[c]=!1)}break}case"childList":{if(_e(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;e.addedNodes.forEach(r=>this.genAdds(r,e.target)),e.removedNodes.forEach(r=>{let s=this.mirror.getId(r),i=is(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);_e(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||Ta(r,this.mirror)||!yg(r,this.mirror)||(this.addedSet.has(r)?(Ua(this.addedSet,r),this.droppedSet.add(r)):this.addedSet.has(e.target)&&s===-1||qd(e.target,this.mirror)||(this.movedSet.has(r)&&this.movedMap[Ed(s,i)]?Ua(this.movedSet,r):this.removes.push({parentId:i,id:s,isShadow:is(e.target)&&os(e.target)?!0:void 0})),this.mapRemoves.push(r))});break}}},this.genAdds=(e,n)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!(this.addedSet.has(e)||this.movedSet.has(e))){if(this.mirror.hasNode(e)){if(Ta(e,this.mirror))return;this.movedSet.add(e);let r=null;n&&this.mirror.hasNode(n)&&(r=this.mirror.getId(n)),r&&r!==-1&&(this.movedMap[Ed(this.mirror.getId(e),r)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);_e(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(e.childNodes.forEach(r=>this.genAdds(r)),Na(e)&&e.shadowRoot.childNodes.forEach(r=>{this.processedNodeManager.add(r,this),this.genAdds(r,e)}))}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(n=>{this[n]=e[n]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}};function Ua(t,e){t.delete(e),e.childNodes.forEach(n=>Ua(t,n))}function wd(t,e,n){return t.length===0?!1:Xd(t,e,n)}function Xd(t,e,n){let{parentNode:r}=e;if(!r)return!1;let s=n.getId(r);return t.some(i=>i.id===s)?!0:Xd(t,r,n)}function Id(t,e){return t.size===0?!1:Qd(t,e)}function Qd(t,e){let{parentNode:n}=e;return n?t.has(n)?!0:Qd(t,n):!1}var as;function Eg(t){as=t}function wg(){as=void 0}var L=t=>as?(...n)=>{try{return t(...n)}catch(r){if(as&&as(r)===!0)return()=>{};throw r}}:t,un=[];function hs(t){try{if("composedPath"in t){let e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0]}catch{}return t&&t.target}function ef(t,e){var n,r;let s=new La;un.push(s),s.init(t);let i=window.MutationObserver||window.__rrMutationObserver,o=(r=(n=window?.Zone)===null||n===void 0?void 0:n.__symbol__)===null||r===void 0?void 0:r.call(n,"MutationObserver");o&&window[o]&&(i=window[o]);let a=new i(L(c=>{t.onMutation&&t.onMutation(c)===!1||s.processMutations.bind(s)(c)}));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function Ig({mousemoveCb:t,sampling:e,doc:n,mirror:r}){if(e.mousemove===!1)return()=>{};let s=typeof e.mousemove=="number"?e.mousemove:50,i=typeof e.mousemoveCallback=="number"?e.mousemoveCallback:500,o=[],a,c=us(L(d=>{let f=Date.now()-a;t(o.map(h=>(h.timeOffset-=f,h)),d),o=[],a=null}),i),l=L(us(L(d=>{let f=hs(d),{clientX:h,clientY:m}=Aa(d)?d.changedTouches[0]:d;a||(a=Pi()),o.push({x:h,y:m,id:r.getId(f),timeOffset:Pi()-a}),c(typeof DragEvent<"u"&&d instanceof DragEvent?P.Drag:d instanceof MouseEvent?P.MouseMove:P.TouchMove)}),s,{trailing:!1})),u=[me("mousemove",l,n),me("touchmove",l,n),me("drag",l,n)];return L(()=>{u.forEach(d=>d())})}function xg({mouseInteractionCb:t,doc:e,mirror:n,blockClass:r,blockSelector:s,unblockSelector:i,sampling:o}){if(o.mouseInteraction===!1)return()=>{};let a=o.mouseInteraction===!0||o.mouseInteraction===void 0?{}:o.mouseInteraction,c=[],l=null,u=d=>f=>{let h=hs(f);if(_e(h,r,s,i,!0))return;let m=null,p=d;if("pointerType"in f){switch(f.pointerType){case"mouse":m=dt.Mouse;break;case"touch":m=dt.Touch;break;case"pen":m=dt.Pen;break}m===dt.Touch?ve[d]===ve.MouseDown?p="TouchStart":ve[d]===ve.MouseUp&&(p="TouchEnd"):dt.Pen}else Aa(f)&&(m=dt.Touch);m!==null?(l=m,(p.startsWith("Touch")&&m===dt.Touch||p.startsWith("Mouse")&&m===dt.Mouse)&&(m=null)):ve[d]===ve.Click&&(m=l,l=null);let y=Aa(f)?f.changedTouches[0]:f;if(!y)return;let g=n.getId(h),{clientX:v,clientY:I}=y;L(t)(Object.assign({type:ve[p],id:g,x:v,y:I},m!==null&&{pointerType:m}))};return Object.keys(ve).filter(d=>Number.isNaN(Number(d))&&!d.endsWith("_Departed")&&a[d]!==!1).forEach(d=>{let f=sr(d),h=u(d);if(window.PointerEvent)switch(ve[d]){case ve.MouseDown:case ve.MouseUp:f=f.replace("mouse","pointer");break;case ve.TouchStart:case ve.TouchEnd:return}c.push(me(f,h,e))}),L(()=>{c.forEach(d=>d())})}function tf({scrollCb:t,doc:e,mirror:n,blockClass:r,blockSelector:s,unblockSelector:i,sampling:o}){let a=L(us(L(c=>{let l=hs(c);if(!l||_e(l,r,s,i,!0))return;let u=n.getId(l);if(l===e&&e.defaultView){let d=zd(e.defaultView);t({id:u,x:d.left,y:d.top})}else t({id:u,x:l.scrollLeft,y:l.scrollTop})}),o.scroll||100));return me("scroll",a,e)}function Tg({viewportResizeCb:t},{win:e}){let n=-1,r=-1,s=L(us(L(()=>{let i=Yd(),o=Wd();(n!==i||r!==o)&&(t({width:Number(o),height:Number(i)}),n=i,r=o)}),200));return me("resize",s,e)}function xd(t,e){let n=Object.assign({},t);return e||delete n.userTriggered,n}var Cg=["INPUT","TEXTAREA","SELECT"],Td=new WeakMap;function kg({inputCb:t,doc:e,mirror:n,blockClass:r,blockSelector:s,unblockSelector:i,ignoreClass:o,ignoreSelector:a,maskInputOptions:c,maskInputFn:l,sampling:u,userTriggeredOnInput:d,maskTextClass:f,unmaskTextClass:h,maskTextSelector:m,unmaskTextSelector:p}){function y(E){let R=hs(E),B=E.isTrusted,w=R&&Ra(R.tagName);if(w==="OPTION"&&(R=R.parentElement),!R||!w||Cg.indexOf(w)<0||_e(R,r,s,i,!0))return;let N=R;if(N.classList.contains(o)||a&&N.matches(a))return;let j=tc(R),ie=Li(N,w,j),ce=!1,Se=Yi({maskInputOptions:c,tagName:w,type:j}),H=ir(R,f,m,h,p,Se);(j==="radio"||j==="checkbox")&&(ce=R.checked),ie=cs({isMasked:H,element:R,value:ie,maskInputFn:l}),g(R,L(xd)({text:ie,isChecked:ce,userTriggered:B},d));let Ce=R.name;j==="radio"&&Ce&&ce&&e.querySelectorAll(`input[type="radio"][name="${Ce}"]`).forEach(te=>{if(te!==R){let ke=cs({isMasked:H,element:te,value:Li(te,w,j),maskInputFn:l});g(te,L(xd)({text:ke,isChecked:!ce,userTriggered:!1},d))}})}function g(E,R){let B=Td.get(E);if(!B||B.text!==R.text||B.isChecked!==R.isChecked){Td.set(E,R);let w=n.getId(E);L(t)(Object.assign(Object.assign({},R),{id:w}))}}let I=(u.input==="last"?["change"]:["input","change"]).map(E=>me(E,L(y),e)),S=e.defaultView;if(!S)return()=>{I.forEach(E=>E())};let k=S.Object.getOwnPropertyDescriptor(S.HTMLInputElement.prototype,"value"),C=[[S.HTMLInputElement.prototype,"value"],[S.HTMLInputElement.prototype,"checked"],[S.HTMLSelectElement.prototype,"value"],[S.HTMLTextAreaElement.prototype,"value"],[S.HTMLSelectElement.prototype,"selectedIndex"],[S.HTMLOptionElement.prototype,"selected"]];return k&&k.set&&I.push(...C.map(E=>Wi(E[0],E[1],{set(){L(y)({target:this,isTrusted:!1})}},!1,S))),L(()=>{I.forEach(E=>E())})}function Mi(t){let e=[];function n(r,s){if(Ci("CSSGroupingRule")&&r.parentRule instanceof CSSGroupingRule||Ci("CSSMediaRule")&&r.parentRule instanceof CSSMediaRule||Ci("CSSSupportsRule")&&r.parentRule instanceof CSSSupportsRule||Ci("CSSConditionRule")&&r.parentRule instanceof CSSConditionRule){let o=Array.from(r.parentRule.cssRules).indexOf(r);s.unshift(o)}else if(r.parentStyleSheet){let o=Array.from(r.parentStyleSheet.cssRules).indexOf(r);s.unshift(o)}return s}return n(t,e)}function kt(t,e,n){let r,s;return t?(t.ownerNode?r=e.getId(t.ownerNode):s=n.getId(t),{styleId:s,id:r}):{}}function Rg({styleSheetRuleCb:t,mirror:e,stylesheetManager:n},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};let s=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(s,{apply:L((u,d,f)=>{let[h,m]=f,{id:p,styleId:y}=kt(d,e,n.styleMirror);return(p&&p!==-1||y&&y!==-1)&&t({id:p,styleId:y,adds:[{rule:h,index:m}]}),u.apply(d,f)})});let i=r.CSSStyleSheet.prototype.deleteRule;r.CSSStyleSheet.prototype.deleteRule=new Proxy(i,{apply:L((u,d,f)=>{let[h]=f,{id:m,styleId:p}=kt(d,e,n.styleMirror);return(m&&m!==-1||p&&p!==-1)&&t({id:m,styleId:p,removes:[{index:h}]}),u.apply(d,f)})});let o;r.CSSStyleSheet.prototype.replace&&(o=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(o,{apply:L((u,d,f)=>{let[h]=f,{id:m,styleId:p}=kt(d,e,n.styleMirror);return(m&&m!==-1||p&&p!==-1)&&t({id:m,styleId:p,replace:h}),u.apply(d,f)})}));let a;r.CSSStyleSheet.prototype.replaceSync&&(a=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(a,{apply:L((u,d,f)=>{let[h]=f,{id:m,styleId:p}=kt(d,e,n.styleMirror);return(m&&m!==-1||p&&p!==-1)&&t({id:m,styleId:p,replaceSync:h}),u.apply(d,f)})}));let c={};ki("CSSGroupingRule")?c.CSSGroupingRule=r.CSSGroupingRule:(ki("CSSMediaRule")&&(c.CSSMediaRule=r.CSSMediaRule),ki("CSSConditionRule")&&(c.CSSConditionRule=r.CSSConditionRule),ki("CSSSupportsRule")&&(c.CSSSupportsRule=r.CSSSupportsRule));let l={};return Object.entries(c).forEach(([u,d])=>{l[u]={insertRule:d.prototype.insertRule,deleteRule:d.prototype.deleteRule},d.prototype.insertRule=new Proxy(l[u].insertRule,{apply:L((f,h,m)=>{let[p,y]=m,{id:g,styleId:v}=kt(h.parentStyleSheet,e,n.styleMirror);return(g&&g!==-1||v&&v!==-1)&&t({id:g,styleId:v,adds:[{rule:p,index:[...Mi(h),y||0]}]}),f.apply(h,m)})}),d.prototype.deleteRule=new Proxy(l[u].deleteRule,{apply:L((f,h,m)=>{let[p]=m,{id:y,styleId:g}=kt(h.parentStyleSheet,e,n.styleMirror);return(y&&y!==-1||g&&g!==-1)&&t({id:y,styleId:g,removes:[{index:[...Mi(h),p]}]}),f.apply(h,m)})})}),L(()=>{r.CSSStyleSheet.prototype.insertRule=s,r.CSSStyleSheet.prototype.deleteRule=i,o&&(r.CSSStyleSheet.prototype.replace=o),a&&(r.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach(([u,d])=>{d.prototype.insertRule=l[u].insertRule,d.prototype.deleteRule=l[u].deleteRule})})}function nf({mirror:t,stylesheetManager:e},n){var r,s,i;let o=null;n.nodeName==="#document"?o=t.getId(n):o=t.getId(n.host);let a=n.nodeName==="#document"?(r=n.defaultView)===null||r===void 0?void 0:r.Document:(i=(s=n.ownerDocument)===null||s===void 0?void 0:s.defaultView)===null||i===void 0?void 0:i.ShadowRoot,c=a?.prototype?Object.getOwnPropertyDescriptor(a?.prototype,"adoptedStyleSheets"):void 0;return o===null||o===-1||!a||!c?()=>{}:(Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var l;return(l=c.get)===null||l===void 0?void 0:l.call(this)},set(l){var u;let d=(u=c.set)===null||u===void 0?void 0:u.call(this,l);if(o!==null&&o!==-1)try{e.adoptStyleSheets(l,o)}catch{}return d}}),L(()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}))}function Ag({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:n,stylesheetManager:r},{win:s}){let i=s.CSSStyleDeclaration.prototype.setProperty;s.CSSStyleDeclaration.prototype.setProperty=new Proxy(i,{apply:L((a,c,l)=>{var u;let[d,f,h]=l;if(n.has(d))return i.apply(c,[d,f,h]);let{id:m,styleId:p}=kt((u=c.parentRule)===null||u===void 0?void 0:u.parentStyleSheet,e,r.styleMirror);return(m&&m!==-1||p&&p!==-1)&&t({id:m,styleId:p,set:{property:d,value:f,priority:h},index:Mi(c.parentRule)}),a.apply(c,l)})});let o=s.CSSStyleDeclaration.prototype.removeProperty;return s.CSSStyleDeclaration.prototype.removeProperty=new Proxy(o,{apply:L((a,c,l)=>{var u;let[d]=l;if(n.has(d))return o.apply(c,[d]);let{id:f,styleId:h}=kt((u=c.parentRule)===null||u===void 0?void 0:u.parentStyleSheet,e,r.styleMirror);return(f&&f!==-1||h&&h!==-1)&&t({id:f,styleId:h,remove:{property:d},index:Mi(c.parentRule)}),a.apply(c,l)})}),L(()=>{s.CSSStyleDeclaration.prototype.setProperty=i,s.CSSStyleDeclaration.prototype.removeProperty=o})}function Ng({mediaInteractionCb:t,blockClass:e,blockSelector:n,unblockSelector:r,mirror:s,sampling:i,doc:o}){let a=L(l=>us(L(u=>{let d=hs(u);if(!d||_e(d,e,n,r,!0))return;let{currentTime:f,volume:h,muted:m,playbackRate:p}=d;t({type:l,id:s.getId(d),currentTime:f,volume:h,muted:m,playbackRate:p})}),i.media||500)),c=[me("play",a(0),o),me("pause",a(1),o),me("seeked",a(2),o),me("volumechange",a(3),o),me("ratechange",a(4),o)];return L(()=>{c.forEach(l=>l())})}function Og({fontCb:t,doc:e}){let n=e.defaultView;if(!n)return()=>{};let r=[],s=new WeakMap,i=n.FontFace;n.FontFace=function(c,l,u){let d=new i(c,l,u);return s.set(d,{family:c,buffer:typeof l!="string",descriptors:u,fontSource:typeof l=="string"?l:JSON.stringify(Array.from(new Uint8Array(l)))}),d};let o=dr(e.fonts,"add",function(a){return function(c){return setTimeout(L(()=>{let l=s.get(c);l&&(t(l),s.delete(c))}),0),a.apply(this,[c])}});return r.push(()=>{n.FontFace=i}),r.push(o),L(()=>{r.forEach(a=>a())})}function Dg(t){let{doc:e,mirror:n,blockClass:r,blockSelector:s,unblockSelector:i,selectionCb:o}=t,a=!0,c=L(()=>{let l=e.getSelection();if(!l||a&&l?.isCollapsed)return;a=l.isCollapsed||!1;let u=[],d=l.rangeCount||0;for(let f=0;f<d;f++){let h=l.getRangeAt(f),{startContainer:m,startOffset:p,endContainer:y,endOffset:g}=h;_e(m,r,s,i,!0)||_e(y,r,s,i,!0)||u.push({start:n.getId(m),startOffset:p,end:n.getId(y),endOffset:g})}o({ranges:u})});return c(),me("selectionchange",c)}function Lg({doc:t,customElementCb:e}){let n=t.defaultView;return!n||!n.customElements?()=>{}:dr(n.customElements,"define",function(s){return function(i,o,a){try{e({define:{name:i}})}catch{}return s.apply(this,[i,o,a])}})}function Ug(t,e){let{mutationCb:n,mousemoveCb:r,mouseInteractionCb:s,scrollCb:i,viewportResizeCb:o,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:u,canvasMutationCb:d,fontCb:f,selectionCb:h,customElementCb:m}=t;t.mutationCb=(...p)=>{e.mutation&&e.mutation(...p),n(...p)},t.mousemoveCb=(...p)=>{e.mousemove&&e.mousemove(...p),r(...p)},t.mouseInteractionCb=(...p)=>{e.mouseInteraction&&e.mouseInteraction(...p),s(...p)},t.scrollCb=(...p)=>{e.scroll&&e.scroll(...p),i(...p)},t.viewportResizeCb=(...p)=>{e.viewportResize&&e.viewportResize(...p),o(...p)},t.inputCb=(...p)=>{e.input&&e.input(...p),a(...p)},t.mediaInteractionCb=(...p)=>{e.mediaInteaction&&e.mediaInteaction(...p),c(...p)},t.styleSheetRuleCb=(...p)=>{e.styleSheetRule&&e.styleSheetRule(...p),l(...p)},t.styleDeclarationCb=(...p)=>{e.styleDeclaration&&e.styleDeclaration(...p),u(...p)},t.canvasMutationCb=(...p)=>{e.canvasMutation&&e.canvasMutation(...p),d(...p)},t.fontCb=(...p)=>{e.font&&e.font(...p),f(...p)},t.selectionCb=(...p)=>{e.selection&&e.selection(...p),h(...p)},t.customElementCb=(...p)=>{e.customElement&&e.customElement(...p),m(...p)}}function Pg(t,e={}){let n=t.doc.defaultView;if(!n)return()=>{};Ug(t,e);let r=ef(t,t.doc),s=Ig(t),i=xg(t),o=tf(t),a=Tg(t,{win:n}),c=kg(t),l=Ng(t),u=Rg(t,{win:n}),d=nf(t,t.doc),f=Ag(t,{win:n}),h=t.collectFonts?Og(t):()=>{},m=Dg(t),p=Lg(t),y=[];for(let g of t.plugins)y.push(g.observer(g.callback,n,g.options));return L(()=>{un.forEach(g=>g.reset()),r.disconnect(),s(),i(),o(),a(),c(),l(),u(),d(),f(),h(),m(),p(),y.forEach(g=>g())})}function Ci(t){return typeof window[t]<"u"}function ki(t){return!!(typeof window[t]<"u"&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}var Bi=class{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,n,r,s){let i=r||this.getIdToRemoteIdMap(e),o=s||this.getRemoteIdToIdMap(e),a=i.get(n);return a||(a=this.generateIdFn(),i.set(n,a),o.set(a,n)),a}getIds(e,n){let r=this.getIdToRemoteIdMap(e),s=this.getRemoteIdToIdMap(e);return n.map(i=>this.getId(e,i,r,s))}getRemoteId(e,n,r){let s=r||this.getRemoteIdToIdMap(e);if(typeof n!="number")return n;let i=s.get(n);return i||-1}getRemoteIds(e,n){let r=this.getRemoteIdToIdMap(e);return n.map(s=>this.getRemoteId(e,s,r))}reset(e){if(!e){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let n=this.iframeIdToRemoteIdMap.get(e);return n||(n=new Map,this.iframeIdToRemoteIdMap.set(e,n)),n}getRemoteIdToIdMap(e){let n=this.iframeRemoteIdToIdMap.get(e);return n||(n=new Map,this.iframeRemoteIdToIdMap.set(e,n)),n}},Pa=class{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Bi(Hd),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Bi(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,n){var r;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:n}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),(r=this.loadListener)===null||r===void 0||r.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){let n=e;if(n.data.type!=="rrweb"||n.origin!==n.data.origin||!e.source)return;let s=this.crossOriginIframeMap.get(e.source);if(!s)return;let i=this.transformCrossOriginEvent(s,n.data.event);i&&this.wrappedEmit(i,n.data.isCheckout)}transformCrossOriginEvent(e,n){var r;switch(n.type){case O.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(n.data.node,e);let s=n.data.node.id;return this.crossOriginIframeRootIdMap.set(e,s),this.patchRootIdOnNode(n.data.node,s),{timestamp:n.timestamp,type:O.IncrementalSnapshot,data:{source:P.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:n.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case O.Meta:case O.Load:case O.DomContentLoaded:return!1;case O.Plugin:return n;case O.Custom:return this.replaceIds(n.data.payload,e,["id","parentId","previousId","nextId"]),n;case O.IncrementalSnapshot:switch(n.data.source){case P.Mutation:return n.data.adds.forEach(s=>{this.replaceIds(s,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(s.node,e);let i=this.crossOriginIframeRootIdMap.get(e);i&&this.patchRootIdOnNode(s.node,i)}),n.data.removes.forEach(s=>{this.replaceIds(s,e,["parentId","id"])}),n.data.attributes.forEach(s=>{this.replaceIds(s,e,["id"])}),n.data.texts.forEach(s=>{this.replaceIds(s,e,["id"])}),n;case P.Drag:case P.TouchMove:case P.MouseMove:return n.data.positions.forEach(s=>{this.replaceIds(s,e,["id"])}),n;case P.ViewportResize:return!1;case P.MediaInteraction:case P.MouseInteraction:case P.Scroll:case P.CanvasMutation:case P.Input:return this.replaceIds(n.data,e,["id"]),n;case P.StyleSheetRule:case P.StyleDeclaration:return this.replaceIds(n.data,e,["id"]),this.replaceStyleIds(n.data,e,["styleId"]),n;case P.Font:return n;case P.Selection:return n.data.ranges.forEach(s=>{this.replaceIds(s,e,["start","end"])}),n;case P.AdoptedStyleSheet:return this.replaceIds(n.data,e,["id"]),this.replaceStyleIds(n.data,e,["styleIds"]),(r=n.data.styles)===null||r===void 0||r.forEach(s=>{this.replaceStyleIds(s,e,["styleId"])}),n}}return!1}replace(e,n,r,s){for(let i of s)!Array.isArray(n[i])&&typeof n[i]!="number"||(Array.isArray(n[i])?n[i]=e.getIds(r,n[i]):n[i]=e.getId(r,n[i]));return n}replaceIds(e,n,r){return this.replace(this.crossOriginIframeMirror,e,n,r)}replaceStyleIds(e,n,r){return this.replace(this.crossOriginIframeStyleMirror,e,n,r)}replaceIdOnNode(e,n){this.replaceIds(e,n,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(r=>{this.replaceIdOnNode(r,n)})}patchRootIdOnNode(e,n){e.type!==re.Document&&!e.rootId&&(e.rootId=n),"childNodes"in e&&e.childNodes.forEach(r=>{this.patchRootIdOnNode(r,n)})}},Ma=class{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,n){if(!os(e)||this.shadowDoms.has(e))return;this.shadowDoms.add(e);let r=ef(Object.assign(Object.assign({},this.bypassOptions),{doc:n,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e);this.restoreHandlers.push(()=>r.disconnect()),this.restoreHandlers.push(tf(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror}))),setTimeout(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(nf({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){!e.contentWindow||!e.contentDocument||this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,n){let r=this;this.restoreHandlers.push(dr(e.prototype,"attachShadow",function(s){return function(i){let o=s.call(this,i);return this.shadowRoot&&Jd(this)&&r.addShadowRoot(this.shadowRoot,n),o}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}};function Mg(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function Bg(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}var nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fg=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(rs=0;rs<nr.length;rs++)Fg[nr.charCodeAt(rs)]=rs;var rs,Gg=function(t){var e=new Uint8Array(t),n,r=e.length,s="";for(n=0;n<r;n+=3)s+=nr[e[n]>>2],s+=nr[(e[n]&3)<<4|e[n+1]>>4],s+=nr[(e[n+1]&15)<<2|e[n+2]>>6],s+=nr[e[n+2]&63];return r%3===2?s=s.substring(0,s.length-1)+"=":r%3===1&&(s=s.substring(0,s.length-2)+"=="),s},Cd=new Map;function Hg(t,e){let n=Cd.get(t);return n||(n=new Map,Cd.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}var rf=(t,e,n)=>{if(!t||!(of(t,e)||typeof t=="object"))return;let r=t.constructor.name,s=Hg(n,r),i=s.indexOf(t);return i===-1&&(i=s.length,s.push(t)),i};function Ai(t,e,n){if(t instanceof Array)return t.map(r=>Ai(r,e,n));if(t===null)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray)return{rr_type:t.constructor.name,args:[Object.values(t)]};if(t instanceof ArrayBuffer){let r=t.constructor.name,s=Gg(t);return{rr_type:r,base64:s}}else{if(t instanceof DataView)return{rr_type:t.constructor.name,args:[Ai(t.buffer,e,n),t.byteOffset,t.byteLength]};if(t instanceof HTMLImageElement){let r=t.constructor.name,{src:s}=t;return{rr_type:r,src:s}}else if(t instanceof HTMLCanvasElement){let r="HTMLImageElement",s=t.toDataURL();return{rr_type:r,src:s}}else{if(t instanceof ImageData)return{rr_type:t.constructor.name,args:[Ai(t.data,e,n),t.width,t.height]};if(of(t,e)||typeof t=="object"){let r=t.constructor.name,s=rf(t,e,n);return{rr_type:r,index:s}}}}return t}var sf=(t,e,n)=>[...t].map(r=>Ai(r,e,n)),of=(t,e)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(s=>typeof e[s]=="function").find(s=>t instanceof e[s]);function $g(t,e,n,r,s){let i=[],o=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(let a of o)try{if(typeof e.CanvasRenderingContext2D.prototype[a]!="function")continue;let c=dr(e.CanvasRenderingContext2D.prototype,a,function(l){return function(...u){return _e(this.canvas,n,r,s,!0)||setTimeout(()=>{let d=sf([...u],e,this);t(this.canvas,{type:or["2D"],property:a,args:d})},0),l.apply(this,u)}});i.push(c)}catch{let l=Wi(e.CanvasRenderingContext2D.prototype,a,{set(u){t(this.canvas,{type:or["2D"],property:a,args:[u],setter:!0})}});i.push(l)}return()=>{i.forEach(a=>a())}}function jg(t){return t==="experimental-webgl"?"webgl":t}function kd(t,e,n,r,s){let i=[];try{let o=dr(t.HTMLCanvasElement.prototype,"getContext",function(a){return function(c,...l){if(!_e(this,e,n,r,!0)){let u=jg(c);if("__context"in this||(this.__context=u),s&&["webgl","webgl2"].includes(u))if(l[0]&&typeof l[0]=="object"){let d=l[0];d.preserveDrawingBuffer||(d.preserveDrawingBuffer=!0)}else l.splice(0,1,{preserveDrawingBuffer:!0})}return a.apply(this,[c,...l])}});i.push(o)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{i.forEach(o=>o())}}function Rd(t,e,n,r,s,i,o,a){let c=[],l=Object.getOwnPropertyNames(t);for(let u of l)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(u))try{if(typeof t[u]!="function")continue;let d=dr(t,u,function(f){return function(...h){let m=f.apply(this,h);if(rf(m,a,this),"tagName"in this.canvas&&!_e(this.canvas,r,s,i,!0)){let p=sf([...h],a,this),y={type:e,property:u,args:p};n(this.canvas,y)}return m}});c.push(d)}catch{let f=Wi(t,u,{set(h){n(this.canvas,{type:e,property:u,args:[h],setter:!0})}});c.push(f)}return c}function zg(t,e,n,r,s,i){let o=[];return o.push(...Rd(e.WebGLRenderingContext.prototype,or.WebGL,t,n,r,s,i,e)),typeof e.WebGL2RenderingContext<"u"&&o.push(...Rd(e.WebGL2RenderingContext.prototype,or.WebGL2,t,n,r,s,i,e)),()=>{o.forEach(a=>a())}}function Yg(t,e){var n=atob(t);if(e){for(var r=new Uint8Array(n.length),s=0,i=n.length;s<i;++s)r[s]=n.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return n}function Wg(t,e,n){var r=e===void 0?null:e,s=n===void 0?!1:n,i=Yg(t,s),o=i.indexOf(`
`,10)+1,a=i.substring(o)+(r?"//# sourceMappingURL="+r:""),c=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(c)}function qg(t,e,n){var r;return function(i){return r=r||Wg(t,e,n),new Worker(r,i)}}var Vg=qg("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",null,!1),Ba=class{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(l,u)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(l)||this.pendingCanvasMutations.set(l,[]),this.pendingCanvasMutations.get(l).push(u)};let{sampling:n="all",win:r,blockClass:s,blockSelector:i,unblockSelector:o,recordCanvas:a,dataURLOptions:c}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,a&&n==="all"&&this.initCanvasMutationObserver(r,s,i,o),a&&typeof n=="number"&&this.initCanvasFPSObserver(n,r,s,i,o,{dataURLOptions:c})}initCanvasFPSObserver(e,n,r,s,i,o){let a=kd(n,r,s,i,!0),c=new Map,l=new Vg;l.onmessage=p=>{let{id:y}=p.data;if(c.set(y,!1),!("base64"in p.data))return;let{base64:g,type:v,width:I,height:S}=p.data;this.mutationCb({id:y,type:or["2D"],commands:[{property:"clearRect",args:[0,0,I,S]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:g}],type:v}]},0,0]}]})};let u=1e3/e,d=0,f,h=()=>{let p=[];return n.document.querySelectorAll("canvas").forEach(y=>{_e(y,r,s,i,!0)||p.push(y)}),p},m=p=>{if(d&&p-d<u){f=requestAnimationFrame(m);return}d=p,h().forEach(y=>Bg(this,void 0,void 0,function*(){var g;let v=this.mirror.getId(y);if(c.get(v))return;if(c.set(v,!0),["webgl","webgl2"].includes(y.__context)){let S=y.getContext(y.__context);((g=S?.getContextAttributes())===null||g===void 0?void 0:g.preserveDrawingBuffer)===!1&&S.clear(S.COLOR_BUFFER_BIT)}let I=yield createImageBitmap(y);l.postMessage({id:v,bitmap:I,width:y.width,height:y.height,dataURLOptions:o.dataURLOptions},[I])})),f=requestAnimationFrame(m)};f=requestAnimationFrame(m),this.resetObservers=()=>{a(),cancelAnimationFrame(f)}}initCanvasMutationObserver(e,n,r,s){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();let i=kd(e,n,r,s,!1),o=$g(this.processMutation.bind(this),e,n,r,s),a=zg(this.processMutation.bind(this),e,n,r,s,this.mirror);this.resetObservers=()=>{i(),o(),a()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){let e=n=>{this.rafStamps.latestId=n,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,n)=>{let r=this.mirror.getId(n);this.flushPendingCanvasMutationFor(n,r)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,n){if(this.frozen||this.locked)return;let r=this.pendingCanvasMutations.get(e);if(!r||n===-1)return;let s=r.map(o=>Mg(o,["type"])),{type:i}=r[0];this.mutationCb({id:n,type:i,commands:s}),this.pendingCanvasMutations.delete(e)}},Fa=class{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new Oa,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,n){"_cssText"in n.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:n.id,attributes:n.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,n){if(e.length===0)return;let r={id:n,styleIds:[]},s=[];for(let i of e){let o;this.styleMirror.has(i)?o=this.styleMirror.getId(i):(o=this.styleMirror.add(i),s.push({styleId:o,rules:Array.from(i.rules||CSSRule,(a,c)=>({rule:Gd(a),index:c}))})),r.styleIds.push(o)}s.length>0&&(r.styles=s),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}},Ga=class{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){requestAnimationFrame(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(e,n){let r=this.nodeMap.get(e);return r&&Array.from(r).some(s=>s!==n)}add(e,n){this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(n))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}};function ne(t){return Object.assign(Object.assign({},t),{timestamp:Pi()})}var Q,Ni,Ca,Fi=!1,qe=V_();function et(t={}){let{emit:e,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:s="rr-block",blockSelector:i=null,unblockSelector:o=null,ignoreClass:a="rr-ignore",ignoreSelector:c=null,maskAllText:l=!1,maskTextClass:u="rr-mask",unmaskTextClass:d=null,maskTextSelector:f=null,unmaskTextSelector:h=null,inlineStylesheet:m=!0,maskAllInputs:p,maskInputOptions:y,slimDOMOptions:g,maskAttributeFn:v,maskInputFn:I,maskTextFn:S,hooks:k,packFn:C,sampling:E={},dataURLOptions:R={},mousemoveWait:B,recordCanvas:w=!1,recordCrossOriginIframes:N=!1,recordAfter:j=t.recordAfter==="DOMContentLoaded"?t.recordAfter:"load",userTriggeredOnInput:ie=!1,collectFonts:ce=!1,inlineImages:Se=!1,plugins:H,keepIframeSrcFn:Ce=()=>!1,ignoreCSSAttributes:te=new Set([]),errorHandler:ke,onMutation:Re}=t;Eg(ke);let Dt=N?window.parent===window:!0,Lt=!1;if(!Dt)try{window.parent.document&&(Lt=!1)}catch{Lt=!0}if(Dt&&!e)throw new Error("emit function is required");B!==void 0&&E.mousemove===void 0&&(E.mousemove=B),qe.reset();let _r=p===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:y!==void 0?y:{},no=g===!0||g==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:g==="all",headMetaDescKeywords:g==="all"}:g||{};bg();let fc,ro=0,hc=A=>{for(let Me of H||[])Me.eventProcessor&&(A=Me.eventProcessor(A));return C&&!Lt&&(A=C(A)),A};Q=(A,Me)=>{var V;if(!((V=un[0])===null||V===void 0)&&V.isFrozen()&&A.type!==O.FullSnapshot&&!(A.type===O.IncrementalSnapshot&&A.data.source===P.Mutation)&&un.forEach(pe=>pe.unfreeze()),Dt)e?.(hc(A),Me);else if(Lt){let pe={type:"rrweb",event:hc(A),origin:window.location.origin,isCheckout:Me};window.parent.postMessage(pe,"*")}if(A.type===O.FullSnapshot)fc=A,ro=0;else if(A.type===O.IncrementalSnapshot){if(A.data.source===P.Mutation&&A.data.isAttachIframe)return;ro++;let pe=r&&ro>=r,Mt=n&&A.timestamp-fc.timestamp>n;(pe||Mt)&&Ni(!0)}};let _s=A=>{Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.Mutation},A)}))},pc=A=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.Scroll},A)})),mc=A=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.CanvasMutation},A)})),Zf=A=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.AdoptedStyleSheet},A)})),Ut=new Fa({mutationCb:_s,adoptedStyleSheetCb:Zf}),Pt=new Pa({mirror:qe,mutationCb:_s,stylesheetManager:Ut,recordCrossOriginIframes:N,wrappedEmit:Q});for(let A of H||[])A.getMirror&&A.getMirror({nodeMirror:qe,crossOriginIframeMirror:Pt.crossOriginIframeMirror,crossOriginIframeStyleMirror:Pt.crossOriginIframeStyleMirror});let so=new Ga;Ca=new Ba({recordCanvas:w,mutationCb:mc,win:window,blockClass:s,blockSelector:i,unblockSelector:o,mirror:qe,sampling:E.canvas,dataURLOptions:R});let gs=new Ma({mutationCb:_s,scrollCb:pc,bypassOptions:{onMutation:Re,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,inlineStylesheet:m,maskInputOptions:_r,dataURLOptions:R,maskAttributeFn:v,maskTextFn:S,maskInputFn:I,recordCanvas:w,inlineImages:Se,sampling:E,slimDOMOptions:no,iframeManager:Pt,stylesheetManager:Ut,canvasManager:Ca,keepIframeSrcFn:Ce,processedNodeManager:so},mirror:qe});Ni=(A=!1)=>{Q(ne({type:O.Meta,data:{href:window.location.href,width:Wd(),height:Yd()}}),A),Ut.reset(),gs.init(),un.forEach(V=>V.lock());let Me=gg(document,{mirror:qe,blockClass:s,blockSelector:i,unblockSelector:o,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,inlineStylesheet:m,maskAllInputs:_r,maskAttributeFn:v,maskInputFn:I,maskTextFn:S,slimDOM:no,dataURLOptions:R,recordCanvas:w,inlineImages:Se,onSerialize:V=>{Vd(V,qe)&&Pt.addIframe(V),Kd(V,qe)&&Ut.trackLinkElement(V),Na(V)&&gs.addShadowRoot(V.shadowRoot,document)},onIframeLoad:(V,pe)=>{Pt.attachIframe(V,pe),gs.observeAttachShadow(V)},onStylesheetLoad:(V,pe)=>{Ut.attachLinkElement(V,pe)},keepIframeSrcFn:Ce});if(!Me)return console.warn("Failed to snapshot the document");Q(ne({type:O.FullSnapshot,data:{node:Me,initialOffset:zd(window)}}),A),un.forEach(V=>V.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Ut.adoptStyleSheets(document.adoptedStyleSheets,qe.getId(document))};try{let A=[],Me=pe=>{var Mt;return L(Pg)({onMutation:Re,mutationCb:_s,mousemoveCb:(W,io)=>Q(ne({type:O.IncrementalSnapshot,data:{source:io,positions:W}})),mouseInteractionCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.MouseInteraction},W)})),scrollCb:pc,viewportResizeCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.ViewportResize},W)})),inputCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.Input},W)})),mediaInteractionCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.MediaInteraction},W)})),styleSheetRuleCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.StyleSheetRule},W)})),styleDeclarationCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.StyleDeclaration},W)})),canvasMutationCb:mc,fontCb:W=>Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.Font},W)})),selectionCb:W=>{Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.Selection},W)}))},customElementCb:W=>{Q(ne({type:O.IncrementalSnapshot,data:Object.assign({source:P.CustomElement},W)}))},blockClass:s,ignoreClass:a,ignoreSelector:c,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,maskInputOptions:_r,inlineStylesheet:m,sampling:E,recordCanvas:w,inlineImages:Se,userTriggeredOnInput:ie,collectFonts:ce,doc:pe,maskAttributeFn:v,maskInputFn:I,maskTextFn:S,keepIframeSrcFn:Ce,blockSelector:i,unblockSelector:o,slimDOMOptions:no,dataURLOptions:R,mirror:qe,iframeManager:Pt,stylesheetManager:Ut,shadowDomManager:gs,processedNodeManager:so,canvasManager:Ca,ignoreCSSAttributes:te,plugins:((Mt=H?.filter(W=>W.observer))===null||Mt===void 0?void 0:Mt.map(W=>({observer:W.observer,options:W.options,callback:io=>Q(ne({type:O.Plugin,data:{plugin:W.name,payload:io}}))})))||[]},k)};Pt.addLoadListener(pe=>{try{A.push(Me(pe.contentDocument))}catch(Mt){console.warn(Mt)}});let V=()=>{Ni(),A.push(Me(document)),Fi=!0};return document.readyState==="interactive"||document.readyState==="complete"?V():(A.push(me("DOMContentLoaded",()=>{Q(ne({type:O.DomContentLoaded,data:{}})),j==="DOMContentLoaded"&&V()})),A.push(me("load",()=>{Q(ne({type:O.Load,data:{}})),j==="load"&&V()},window))),()=>{A.forEach(pe=>pe()),so.destroy(),Fi=!1,wg()}}catch(A){console.warn(A)}}et.addCustomEvent=(t,e)=>{if(!Fi)throw new Error("please add custom event after start recording");Q(ne({type:O.Custom,data:{tag:t,payload:e}}))};et.freezePage=()=>{un.forEach(t=>t.freeze())};et.takeFullSnapshot=t=>{if(!Fi)throw new Error("please take full snapshot after start recording");Ni(t)};et.mirror=qe;function rc(t){return t>9999999999?t:t*1e3}function Kg(t){return t>9999999999?t/1e3:t}function qi(t,e){e.category!=="sentry.transaction"&&(["ui.click","ui.input"].includes(e.category)?t.triggerUserActivity():t.checkAndHandleExpiredSession(),t.addUpdate(()=>(t.throttledAddEvent({type:O.Custom,timestamp:(e.timestamp||0)*1e3,data:{tag:"breadcrumb",payload:be(e,10,1e3)}}),e.category==="console")))}var Zg="button,a";function sc(t){let e=af(t);return!e||!(e instanceof Element)?e:e.closest(Zg)||e}function af(t){return Jg(t)?t.target:t}function Jg(t){return typeof t=="object"&&!!t&&"target"in t}var Rt;function Xg(t){return Rt||(Rt=[],Qg()),Rt.push(t),()=>{let e=Rt?Rt.indexOf(t):-1;e>-1&&Rt.splice(e,1)}}function Qg(){X(G,"open",function(t){return function(...e){if(Rt)try{Rt.forEach(n=>n())}catch{}return t.apply(G,e)}})}function ey(t,e,n){t.handleClick(e,n)}var Ha=class{constructor(e,n,r=qi){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=n.timeout/1e3,this._threshold=n.threshold/1e3,this._scollTimeout=n.scrollTimeout/1e3,this._replay=e,this._ignoreSelector=n.ignoreSelector,this._addBreadcrumbEvent=r}addListeners(){let e=()=>{this._lastMutation=Ri()},n=()=>{this._lastScroll=Ri()},r=Xg(()=>{this._lastMutation=Ri()}),s=o=>{if(!o.target)return;let a=sc(o);a&&this._handleMultiClick(a)},i=new MutationObserver(e);i.observe(G.document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),G.addEventListener("scroll",n,{passive:!0}),G.addEventListener("click",s,{passive:!0}),this._teardown=()=>{G.removeEventListener("scroll",n),G.removeEventListener("click",s),r(),i.disconnect(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,n){if(ny(n,this._ignoreSelector)||!ry(e))return;let r={timestamp:Kg(e.timestamp),clickBreadcrumb:e,clickCount:0,node:n};this._clicks.some(s=>s.node===r.node&&Math.abs(s.timestamp-r.timestamp)<1)||(this._clicks.push(r),this._clicks.length===1&&this._scheduleCheckClicks())}_handleMultiClick(e){this._getClicks(e).forEach(n=>{n.clickCount++})}_getClicks(e){return this._clicks.filter(n=>n.node===e)}_checkClicks(){let e=[],n=Ri();this._clicks.forEach(r=>{!r.mutationAfter&&this._lastMutation&&(r.mutationAfter=r.timestamp<=this._lastMutation?this._lastMutation-r.timestamp:void 0),!r.scrollAfter&&this._lastScroll&&(r.scrollAfter=r.timestamp<=this._lastScroll?this._lastScroll-r.timestamp:void 0),r.timestamp+this._timeout<=n&&e.push(r)});for(let r of e){let s=this._clicks.indexOf(r);s>-1&&(this._generateBreadcrumbs(r),this._clicks.splice(s,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){let n=this._replay,r=e.scrollAfter&&e.scrollAfter<=this._scollTimeout,s=e.mutationAfter&&e.mutationAfter<=this._threshold,i=!r&&!s,{clickCount:o,clickBreadcrumb:a}=e;if(i){let c=Math.min(e.mutationAfter||this._timeout,this._timeout)*1e3,l=c<this._timeout*1e3?"mutation":"timeout",u={type:"default",message:a.message,timestamp:a.timestamp,category:"ui.slowClickDetected",data:{...a.data,url:G.location.href,route:n.getCurrentRoute(),timeAfterClickMs:c,endReason:l,clickCount:o||1}};this._addBreadcrumbEvent(n,u);return}if(o>1){let c={type:"default",message:a.message,timestamp:a.timestamp,category:"ui.multiClick",data:{...a.data,url:G.location.href,route:n.getCurrentRoute(),clickCount:o,metric:!0}};this._addBreadcrumbEvent(n,c)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout(()=>this._checkClicks(),1e3)}},ty=["A","BUTTON","INPUT"];function ny(t,e){return!!(!ty.includes(t.tagName)||t.tagName==="INPUT"&&!["submit","button"].includes(t.getAttribute("type")||"")||t.tagName==="A"&&(t.hasAttribute("download")||t.hasAttribute("target")&&t.getAttribute("target")!=="_self")||e&&t.matches(e))}function ry(t){return!!(t.data&&typeof t.data.nodeId=="number"&&t.timestamp)}function Ri(){return Date.now()/1e3}function ht(t){return{timestamp:Date.now()/1e3,type:"default",...t}}var Gi;(function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"})(Gi||(Gi={}));var sy=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled"]);function iy(t){let e={};for(let n in t)if(sy.has(n)){let r=n;(n==="data-testid"||n==="data-test-id")&&(r="testId"),e[r]=t[n]}return e}var oy=t=>e=>{if(!t.isEnabled())return;let n=ay(e);if(!n)return;let r=e.name==="click",s=r&&e.event;r&&t.clickDetector&&s&&!s.altKey&&!s.metaKey&&!s.ctrlKey&&!s.shiftKey&&ey(t.clickDetector,n,sc(e.event)),qi(t,n)};function cf(t,e){let n=et.mirror.getId(t),r=n&&et.mirror.getNode(n),s=r&&et.mirror.getMeta(r),i=s&&ly(s)?s:null;return{message:e,data:i?{nodeId:n,node:{id:n,tagName:i.tagName,textContent:Array.from(i.childNodes).map(o=>o.type===Gi.Text&&o.textContent).filter(Boolean).map(o=>o.trim()).join(""),attributes:iy(i.attributes)}}:{}}}function ay(t){let{target:e,message:n}=cy(t);return ht({category:`ui.${t.name}`,...cf(e,n)})}function cy(t){let e=t.name==="click",n,r=null;try{r=e?sc(t.event):af(t.event),n=Ie(r,{maxStringLength:200})||"<unknown>"}catch{n="<unknown>"}return{target:r,message:n}}function ly(t){return t.type===Gi.Element}function uy(t,e){if(!t.isEnabled())return;t.updateUserActivity();let n=dy(e);n&&qi(t,n)}function dy(t){let{metaKey:e,shiftKey:n,ctrlKey:r,altKey:s,key:i,target:o}=t;if(!o||fy(o)||!i)return null;let a=e||r||s,c=i.length===1;if(!a&&c)return null;let l=Ie(o,{maxStringLength:200})||"<unknown>",u=cf(o,l);return ht({category:"ui.keyDown",message:l,data:{...u.data,metaKey:e,shiftKey:n,ctrlKey:r,altKey:s,key:i}})}function fy(t){return t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable}var hy=["name","type","startTime","transferSize","duration"];function Ad(t){return function(e){return hy.every(n=>t[n]===e[n])}}function py(t,e){let[n,r,s]=t.reduce((c,l)=>(l.entryType==="navigation"?c[0].push(l):l.entryType==="largest-contentful-paint"?c[1].push(l):c[2].push(l),c),[[],[],[]]),i=[],o=[],a=r.length?r[r.length-1]:void 0;return e.forEach(c=>{if(c.entryType==="largest-contentful-paint"){(!a||a.startTime<c.startTime)&&(a=c);return}if(c.entryType==="navigation"){let l=c;c.duration>0&&!n.find(Ad(l))&&!o.find(Ad(l))&&o.push(l);return}i.push(c)}),[...a?[a]:[],...n,...s,...i,...o].sort((c,l)=>c.startTime-l.startTime)}function my(t){let e=r=>{let s=py(t.performanceEvents,r.getEntries());t.performanceEvents=s},n=new PerformanceObserver(e);return["element","event","first-input","largest-contentful-paint","layout-shift","longtask","navigation","paint","resource"].forEach(r=>{try{n.observe({type:r,buffered:!0})}catch{}}),n}var _y=`/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
function t(t){let e=t.length;for(;--e>=0;)t[e]=0}const e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Array(576);t(s);const r=new Array(60);t(r);const o=new Array(512);t(o);const l=new Array(256);t(l);const h=new Array(29);t(h);const d=new Array(30);function _(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}let f,c,u;function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}t(d);const m=t=>t<256?o[t]:o[256+(t>>>7)],b=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},g=(t,e,a)=>{t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},p=(t,e,a)=>{g(t,a[2*e],a[2*e+1])},k=(t,e)=>{let a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},v=(t,e,a)=>{const i=new Array(16);let n,s,r=0;for(n=1;n<=15;n++)r=r+a[n-1]<<1,i[n]=r;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=k(i[e]++,e))}},y=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},x=t=>{t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},z=(t,e,a,i)=>{const n=2*e,s=2*a;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[a]},A=(t,e,a)=>{const i=t.heap[a];let n=a<<1;for(;n<=t.heap_len&&(n<t.heap_len&&z(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!z(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i},E=(t,i,n)=>{let s,r,o,_,f=0;if(0!==t.sym_next)do{s=255&t.pending_buf[t.sym_buf+f++],s+=(255&t.pending_buf[t.sym_buf+f++])<<8,r=t.pending_buf[t.sym_buf+f++],0===s?p(t,r,i):(o=l[r],p(t,o+256+1,i),_=e[o],0!==_&&(r-=h[o],g(t,r,_)),s--,o=m(s),p(t,o,n),_=a[o],0!==_&&(s-=d[o],g(t,s,_)))}while(f<t.sym_next);p(t,256,i)},R=(t,e)=>{const a=e.dyn_tree,i=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems;let r,o,l,h=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<s;r++)0!==a[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,a[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=i[2*l+1]);for(e.max_code=h,r=t.heap_len>>1;r>=1;r--)A(t,a,r);l=s;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],A(t,a,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,a[2*l]=a[2*r]+a[2*o],t.depth[l]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,a[2*r+1]=a[2*o+1]=l,t.heap[1]=l++,A(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const a=e.dyn_tree,i=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,d,_,f,c,u,w=0;for(f=0;f<=15;f++)t.bl_count[f]=0;for(a[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)d=t.heap[h],f=a[2*a[2*d+1]+1]+1,f>l&&(f=l,w++),a[2*d+1]=f,d>i||(t.bl_count[f]++,c=0,d>=o&&(c=r[d-o]),u=a[2*d],t.opt_len+=u*(f+c),s&&(t.static_len+=u*(n[2*d+1]+c)));if(0!==w){do{for(f=l-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[l]--,w-=2}while(w>0);for(f=l;0!==f;f--)for(d=t.bl_count[f];0!==d;)_=t.heap[--h],_>i||(a[2*_+1]!==f&&(t.opt_len+=(f-a[2*_+1])*a[2*_],a[2*_+1]=f),d--)}})(t,e),v(a,h,t.bl_count)},Z=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=r,r=e[2*(i+1)+1],++o<l&&n===r||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4))},U=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),i=0;i<=a;i++)if(n=r,r=e[2*(i+1)+1],!(++o<l&&n===r)){if(o<h)do{p(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(p(t,n,t.bl_tree),o--),p(t,16,t.bl_tree),g(t,o-3,2)):o<=10?(p(t,17,t.bl_tree),g(t,o-3,3)):(p(t,18,t.bl_tree),g(t,o-11,7));o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4)}};let S=!1;const D=(t,e,a,i)=>{g(t,0+(i?1:0),3),x(t),b(t,a),b(t,~a),a&&t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a};var T=(t,e,a,i)=>{let o,l,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),R(t,t.l_desc),R(t,t.d_desc),h=(t=>{let e;for(Z(t,t.dyn_ltree,t.l_desc.max_code),Z(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*n[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),o=t.opt_len+3+7>>>3,l=t.static_len+3+7>>>3,l<=o&&(o=l)):o=l=a+5,a+4<=o&&-1!==e?D(t,e,a,i):4===t.strategy||l===o?(g(t,2+(i?1:0),3),E(t,s,r)):(g(t,4+(i?1:0),3),((t,e,a,i)=>{let s;for(g(t,e-257,5),g(t,a-1,5),g(t,i-4,4),s=0;s<i;s++)g(t,t.bl_tree[2*n[s]+1],3);U(t,t.dyn_ltree,e-1),U(t,t.dyn_dtree,a-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),E(t,t.dyn_ltree,t.dyn_dtree)),y(t),i&&x(t)},O={_tr_init:t=>{S||((()=>{let t,n,w,m,b;const g=new Array(16);for(w=0,m=0;m<28;m++)for(h[m]=w,t=0;t<1<<e[m];t++)l[w++]=m;for(l[w-1]=m,b=0,m=0;m<16;m++)for(d[m]=b,t=0;t<1<<a[m];t++)o[b++]=m;for(b>>=7;m<30;m++)for(d[m]=b<<7,t=0;t<1<<a[m]-7;t++)o[256+b++]=m;for(n=0;n<=15;n++)g[n]=0;for(t=0;t<=143;)s[2*t+1]=8,t++,g[8]++;for(;t<=255;)s[2*t+1]=9,t++,g[9]++;for(;t<=279;)s[2*t+1]=7,t++,g[7]++;for(;t<=287;)s[2*t+1]=8,t++,g[8]++;for(v(s,287,g),t=0;t<30;t++)r[2*t+1]=5,r[2*t]=k(t,5);f=new _(s,e,257,286,15),c=new _(r,a,0,30,15),u=new _(new Array(0),i,0,19,7)})(),S=!0),t.l_desc=new w(t.dyn_ltree,f),t.d_desc=new w(t.dyn_dtree,c),t.bl_desc=new w(t.bl_tree,u),t.bi_buf=0,t.bi_valid=0,y(t)},_tr_stored_block:D,_tr_flush_block:T,_tr_tally:(t,e,a)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=a,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(l[a]+256+1)]++,t.dyn_dtree[2*m(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{g(t,2,3),p(t,256,s),(t=>{16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var F=(t,e,a,i)=>{let n=65535&t|0,s=t>>>16&65535|0,r=0;for(;0!==a;){r=a>2e3?2e3:a,a-=r;do{n=n+e[i++]|0,s=s+n|0}while(--r);n%=65521,s%=65521}return n|s<<16|0};const L=new Uint32Array((()=>{let t,e=[];for(var a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e})());var N=(t,e,a,i)=>{const n=L,s=i+a;t^=-1;for(let a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t},I={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},B={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:C,_tr_stored_block:H,_tr_flush_block:M,_tr_tally:j,_tr_align:K}=O,{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:Y,Z_FULL_FLUSH:G,Z_FINISH:X,Z_BLOCK:W,Z_OK:q,Z_STREAM_END:J,Z_STREAM_ERROR:Q,Z_DATA_ERROR:V,Z_BUF_ERROR:$,Z_DEFAULT_COMPRESSION:tt,Z_FILTERED:et,Z_HUFFMAN_ONLY:at,Z_RLE:it,Z_FIXED:nt,Z_DEFAULT_STRATEGY:st,Z_UNKNOWN:rt,Z_DEFLATED:ot}=B,lt=(t,e)=>(t.msg=I[e],e),ht=t=>2*t-(t>4?9:0),dt=t=>{let e=t.length;for(;--e>=0;)t[e]=0},_t=t=>{let e,a,i,n=t.w_size;e=t.hash_size,i=e;do{a=t.head[--i],t.head[i]=a>=n?a-n:0}while(--e);e=n,i=e;do{a=t.prev[--i],t.prev[i]=a>=n?a-n:0}while(--e)};let ft=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask;const ct=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},ut=(t,e)=>{M(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ct(t.strm)},wt=(t,e)=>{t.pending_buf[t.pending++]=e},mt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},bt=(t,e,a,i)=>{let n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),a),1===t.state.wrap?t.adler=F(t.adler,e,n,a):2===t.state.wrap&&(t.adler=N(t.adler,e,n,a)),t.next_in+=n,t.total_in+=n,n)},gt=(t,e)=>{let a,i,n=t.max_chain_length,s=t.strstart,r=t.prev_length,o=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,d=t.w_mask,_=t.prev,f=t.strstart+258;let c=h[s+r-1],u=h[s+r];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(a=e,h[a+r]===u&&h[a+r-1]===c&&h[a]===h[s]&&h[++a]===h[s+1]){s+=2,a++;do{}while(h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&s<f);if(i=258-(f-s),s=f-258,i>r){if(t.match_start=e,r=i,i>=o)break;c=h[s+r-1],u=h[s+r]}}}while((e=_[e&d])>l&&0!=--n);return r<=t.lookahead?r:t.lookahead},pt=t=>{const e=t.w_size;let a,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),_t(t),i+=e),0===t.strm.avail_in)break;if(a=bt(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=a,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=ft(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=ft(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},kt=(t,e)=>{let a,i,n,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r=0,o=t.strm.avail_in;do{if(a=65535,n=t.bi_valid+42>>3,t.strm.avail_out<n)break;if(n=t.strm.avail_out-n,i=t.strstart-t.block_start,a>i+t.strm.avail_in&&(a=i+t.strm.avail_in),a>n&&(a=n),a<s&&(0===a&&e!==X||e===P||a!==i+t.strm.avail_in))break;r=e===X&&a===i+t.strm.avail_in?1:0,H(t,0,0,r),t.pending_buf[t.pending-4]=a,t.pending_buf[t.pending-3]=a>>8,t.pending_buf[t.pending-2]=~a,t.pending_buf[t.pending-1]=~a>>8,ct(t.strm),i&&(i>a&&(i=a),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,a-=i),a&&(bt(t.strm,t.strm.output,t.strm.next_out,a),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a)}while(0===r);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?4:e!==P&&e!==X&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(n=t.window_size-t.strstart,t.strm.avail_in>n&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,n+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),n>t.strm.avail_in&&(n=t.strm.avail_in),n&&(bt(t.strm,t.window,t.strstart,n),t.strstart+=n,t.insert+=n>t.w_size-t.insert?t.w_size-t.insert:n),t.high_water<t.strstart&&(t.high_water=t.strstart),n=t.bi_valid+42>>3,n=t.pending_buf_size-n>65535?65535:t.pending_buf_size-n,s=n>t.w_size?t.w_size:n,i=t.strstart-t.block_start,(i>=s||(i||e===X)&&e!==P&&0===t.strm.avail_in&&i<=n)&&(a=i>n?n:i,r=e===X&&0===t.strm.avail_in&&a===i?1:0,H(t,t.block_start,a,r),t.block_start+=a,ct(t.strm)),r?3:1)},vt=(t,e)=>{let a,i;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a)),t.match_length>=3)if(i=j(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ft(t,t.ins_h,t.window[t.strstart+1]);else i=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2},yt=(t,e)=>{let a,i,n;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a),t.match_length<=5&&(t.strategy===et||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=j(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ut(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=j(t,0,t.window[t.strstart-1]),i&&ut(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=j(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2};function xt(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}const zt=[new xt(0,0,0,0,kt),new xt(4,4,8,4,vt),new xt(4,5,16,8,vt),new xt(4,6,32,32,vt),new xt(4,4,16,16,yt),new xt(8,16,32,32,yt),new xt(8,16,128,128,yt),new xt(8,32,128,256,yt),new xt(32,128,258,1024,yt),new xt(32,258,258,4096,yt)];function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ot,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),dt(this.dyn_ltree),dt(this.dyn_dtree),dt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),dt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),dt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Et=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||42!==e.status&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&113!==e.status&&666!==e.status?1:0},Rt=t=>{if(Et(t))return lt(t,Q);t.total_in=t.total_out=0,t.data_type=rt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=-2,C(e),q},Zt=t=>{const e=Rt(t);var a;return e===q&&((a=t.state).window_size=2*a.w_size,dt(a.head),a.max_lazy_match=zt[a.level].max_lazy,a.good_match=zt[a.level].good_length,a.nice_match=zt[a.level].nice_length,a.max_chain_length=zt[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),e},Ut=(t,e,a,i,n,s)=>{if(!t)return Q;let r=1;if(e===tt&&(e=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>9||a!==ot||i<8||i>15||e<0||e>9||s<0||s>nt||8===i&&1!==r)return lt(t,Q);8===i&&(i=9);const o=new At;return t.state=o,o.strm=t,o.status=42,o.wrap=r,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=s,o.method=a,Zt(t)};var St={deflateInit:(t,e)=>Ut(t,e,ot,15,8,st),deflateInit2:Ut,deflateReset:Zt,deflateResetKeep:Rt,deflateSetHeader:(t,e)=>Et(t)||2!==t.state.wrap?Q:(t.state.gzhead=e,q),deflate:(t,e)=>{if(Et(t)||e>W||e<0)return t?lt(t,Q):Q;const a=t.state;if(!t.output||0!==t.avail_in&&!t.input||666===a.status&&e!==X)return lt(t,0===t.avail_out?$:Q);const i=a.last_flush;if(a.last_flush=e,0!==a.pending){if(ct(t),0===t.avail_out)return a.last_flush=-1,q}else if(0===t.avail_in&&ht(e)<=ht(i)&&e!==X)return lt(t,$);if(666===a.status&&0!==t.avail_in)return lt(t,$);if(42===a.status&&0===a.wrap&&(a.status=113),42===a.status){let e=ot+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=at||a.level<2?0:a.level<6?1:6===a.level?2:3,e|=i<<6,0!==a.strstart&&(e|=32),e+=31-e%31,mt(a,e),0!==a.strstart&&(mt(a,t.adler>>>16),mt(a,65535&t.adler)),t.adler=1,a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(57===a.status)if(t.adler=0,wt(a,31),wt(a,139),wt(a,8),a.gzhead)wt(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),wt(a,255&a.gzhead.time),wt(a,a.gzhead.time>>8&255),wt(a,a.gzhead.time>>16&255),wt(a,a.gzhead.time>>24&255),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(wt(a,255&a.gzhead.extra.length),wt(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=N(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,3),a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q;if(69===a.status){if(a.gzhead.extra){let e=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let n=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex+=n,ct(t),0!==a.pending)return a.last_flush=-1,q;e=0,i-=n}let n=new Uint8Array(a.gzhead.extra);a.pending_buf.set(n.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(ct(t),0!==a.pending))return a.last_flush=-1,q;wt(a,255&t.adler),wt(a,t.adler>>8&255),t.adler=0}if(a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(0!==t.avail_in||0!==a.lookahead||e!==P&&666!==a.status){let i=0===a.level?kt(a,e):a.strategy===at?((t,e)=>{let a;for(;;){if(0===t.lookahead&&(pt(t),0===t.lookahead)){if(e===P)return 1;break}if(t.match_length=0,a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):a.strategy===it?((t,e)=>{let a,i,n,s;const r=t.window;for(;;){if(t.lookahead<=258){if(pt(t),t.lookahead<=258&&e===P)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){s=t.strstart+258;do{}while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<s);t.match_length=258-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=j(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):zt[a.level].func(a,e);if(3!==i&&4!==i||(a.status=666),1===i||3===i)return 0===t.avail_out&&(a.last_flush=-1),q;if(2===i&&(e===Y?K(a):e!==W&&(H(a,0,0,!1),e===G&&(dt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ct(t),0===t.avail_out))return a.last_flush=-1,q}return e!==X?q:a.wrap<=0?J:(2===a.wrap?(wt(a,255&t.adler),wt(a,t.adler>>8&255),wt(a,t.adler>>16&255),wt(a,t.adler>>24&255),wt(a,255&t.total_in),wt(a,t.total_in>>8&255),wt(a,t.total_in>>16&255),wt(a,t.total_in>>24&255)):(mt(a,t.adler>>>16),mt(a,65535&t.adler)),ct(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?q:J)},deflateEnd:t=>{if(Et(t))return Q;const e=t.state.status;return t.state=null,113===e?lt(t,V):q},deflateSetDictionary:(t,e)=>{let a=e.length;if(Et(t))return Q;const i=t.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return Q;if(1===n&&(t.adler=F(t.adler,e,a,0)),i.wrap=0,a>=i.w_size){0===n&&(dt(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(a-i.w_size,a),0),e=t,a=i.w_size}const s=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,pt(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=ft(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,pt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=r,t.input=o,t.avail_in=s,i.wrap=n,q},deflateInfo:"pako deflate (from Nodeca project)"};const Dt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Tt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const e in a)Dt(a,e)&&(t[e]=a[e])}}return t},Ot=t=>{let e=0;for(let a=0,i=t.length;a<i;a++)e+=t[a].length;const a=new Uint8Array(e);for(let e=0,i=0,n=t.length;e<n;e++){let n=t[e];a.set(n,i),i+=n.length}return a};let Ft=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Ft=!1}const Lt=new Uint8Array(256);for(let t=0;t<256;t++)Lt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Lt[254]=Lt[254]=1;var Nt=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,i,n,s,r=t.length,o=0;for(n=0;n<r;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(o),s=0,n=0;s<o;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},It=(t,e)=>{const a=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,n;const s=new Array(2*a);for(n=0,i=0;i<a;){let e=t[i++];if(e<128){s[n++]=e;continue}let r=Lt[e];if(r>4)s[n++]=65533,i+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&i<a;)e=e<<6|63&t[i++],r--;r>1?s[n++]=65533:e<65536?s[n++]=e:(e-=65536,s[n++]=55296|e>>10&1023,s[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Ft)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a})(s,n)},Bt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let a=e-1;for(;a>=0&&128==(192&t[a]);)a--;return a<0||0===a?e:a+Lt[t[a]]>e?a:e};var Ct=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ht=Object.prototype.toString,{Z_NO_FLUSH:Mt,Z_SYNC_FLUSH:jt,Z_FULL_FLUSH:Kt,Z_FINISH:Pt,Z_OK:Yt,Z_STREAM_END:Gt,Z_DEFAULT_COMPRESSION:Xt,Z_DEFAULT_STRATEGY:Wt,Z_DEFLATED:qt}=B;function Jt(t){this.options=Tt({level:Xt,method:qt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=St.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==Yt)throw new Error(I[a]);if(e.header&&St.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Nt(e.dictionary):"[object ArrayBuffer]"===Ht.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=St.deflateSetDictionary(this.strm,t),a!==Yt)throw new Error(I[a]);this._dict_set=!0}}function Qt(t,e){const a=new Jt(e);if(a.push(t,!0),a.err)throw a.msg||I[a.err];return a.result}Jt.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Pt:Mt,"string"==typeof t?a.input=Nt(t):"[object ArrayBuffer]"===Ht.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(s===jt||s===Kt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(n=St.deflate(a,s),n===Gt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),n=St.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Yt;if(0!==a.avail_out){if(s>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Jt.prototype.onData=function(t){this.chunks.push(t)},Jt.prototype.onEnd=function(t){t===Yt&&(this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Vt={Deflate:Jt,deflate:Qt,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Qt(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Qt(t,e)},constants:B};var $t=function(t,e){let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z,A;const E=t.state;a=t.next_in,z=t.input,i=a+(t.avail_in-5),n=t.next_out,A=t.output,s=n-(e-t.avail_out),r=n+(t.avail_out-257),o=E.dmax,l=E.wsize,h=E.whave,d=E.wnext,_=E.window,f=E.hold,c=E.bits,u=E.lencode,w=E.distcode,m=(1<<E.lenbits)-1,b=(1<<E.distbits)-1;t:do{c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=u[f&m];e:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,0===p)A[n++]=65535&g;else{if(!(16&p)){if(0==(64&p)){g=u[(65535&g)+(f&(1<<p)-1)];continue e}if(32&p){E.mode=16191;break t}t.msg="invalid literal/length code",E.mode=16209;break t}k=65535&g,p&=15,p&&(c<p&&(f+=z[a++]<<c,c+=8),k+=f&(1<<p)-1,f>>>=p,c-=p),c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=w[f&b];a:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,!(16&p)){if(0==(64&p)){g=w[(65535&g)+(f&(1<<p)-1)];continue a}t.msg="invalid distance code",E.mode=16209;break t}if(v=65535&g,p&=15,c<p&&(f+=z[a++]<<c,c+=8,c<p&&(f+=z[a++]<<c,c+=8)),v+=f&(1<<p)-1,v>o){t.msg="invalid distance too far back",E.mode=16209;break t}if(f>>>=p,c-=p,p=n-s,v>p){if(p=v-p,p>h&&E.sane){t.msg="invalid distance too far back",E.mode=16209;break t}if(y=0,x=_,0===d){if(y+=l-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}else if(d<p){if(y+=l+d-p,p-=d,p<k){k-=p;do{A[n++]=_[y++]}while(--p);if(y=0,d<k){p=d,k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}}else if(y+=d-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}for(;k>2;)A[n++]=x[y++],A[n++]=x[y++],A[n++]=x[y++],k-=3;k&&(A[n++]=x[y++],k>1&&(A[n++]=x[y++]))}else{y=n-v;do{A[n++]=A[y++],A[n++]=A[y++],A[n++]=A[y++],k-=3}while(k>2);k&&(A[n++]=A[y++],k>1&&(A[n++]=A[y++]))}break}}break}}while(a<i&&n<r);k=c>>3,a-=k,c-=k<<3,f&=(1<<c)-1,t.next_in=a,t.next_out=n,t.avail_in=a<i?i-a+5:5-(a-i),t.avail_out=n<r?r-n+257:257-(n-r),E.hold=f,E.bits=c};const te=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ee=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ie=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ne=(t,e,a,i,n,s,r,o)=>{const l=o.bits;let h,d,_,f,c,u,w=0,m=0,b=0,g=0,p=0,k=0,v=0,y=0,x=0,z=0,A=null;const E=new Uint16Array(16),R=new Uint16Array(16);let Z,U,S,D=null;for(w=0;w<=15;w++)E[w]=0;for(m=0;m<i;m++)E[e[a+m]]++;for(p=l,g=15;g>=1&&0===E[g];g--);if(p>g&&(p=g),0===g)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(b=1;b<g&&0===E[b];b++);for(p<b&&(p=b),y=1,w=1;w<=15;w++)if(y<<=1,y-=E[w],y<0)return-1;if(y>0&&(0===t||1!==g))return-1;for(R[1]=0,w=1;w<15;w++)R[w+1]=R[w]+E[w];for(m=0;m<i;m++)0!==e[a+m]&&(r[R[e[a+m]]++]=m);if(0===t?(A=D=r,u=20):1===t?(A=te,D=ee,u=257):(A=ae,D=ie,u=0),z=0,m=0,w=b,c=s,k=p,v=0,_=-1,x=1<<p,f=x-1,1===t&&x>852||2===t&&x>592)return 1;for(;;){Z=w-v,r[m]+1<u?(U=0,S=r[m]):r[m]>=u?(U=D[r[m]-u],S=A[r[m]-u]):(U=96,S=0),h=1<<w-v,d=1<<k,b=d;do{d-=h,n[c+(z>>v)+d]=Z<<24|U<<16|S|0}while(0!==d);for(h=1<<w-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,m++,0==--E[w]){if(w===g)break;w=e[a+r[m]]}if(w>p&&(z&f)!==_){for(0===v&&(v=p),c+=b,k=w-v,y=1<<k;k+v<g&&(y-=E[k+v],!(y<=0));)k++,y<<=1;if(x+=1<<k,1===t&&x>852||2===t&&x>592)return 1;_=z&f,n[_]=p<<24|k<<16|c-s|0}}return 0!==z&&(n[c+z]=w-v<<24|64<<16|0),o.bits=p,0};const{Z_FINISH:se,Z_BLOCK:re,Z_TREES:oe,Z_OK:le,Z_STREAM_END:he,Z_NEED_DICT:de,Z_STREAM_ERROR:_e,Z_DATA_ERROR:fe,Z_MEM_ERROR:ce,Z_BUF_ERROR:ue,Z_DEFLATED:we}=B,me=16209,be=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function ge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pe=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<16180||e.mode>16211?1:0},ke=t=>{if(pe(t))return _e;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=16180,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,le},ve=t=>{if(pe(t))return _e;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,ke(t)},ye=(t,e)=>{let a;if(pe(t))return _e;const i=t.state;return e<0?(a=0,e=-e):(a=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?_e:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,ve(t))},xe=(t,e)=>{if(!t)return _e;const a=new ge;t.state=a,a.strm=t,a.window=null,a.mode=16180;const i=ye(t,e);return i!==le&&(t.state=null),i};let ze,Ae,Ee=!0;const Re=t=>{if(Ee){ze=new Int32Array(512),Ae=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ne(1,t.lens,0,288,ze,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ne(2,t.lens,0,32,Ae,0,t.work,{bits:5}),Ee=!1}t.lencode=ze,t.lenbits=9,t.distcode=Ae,t.distbits=5},Ze=(t,e,a,i)=>{let n;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(a-s.wsize,a),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(e.subarray(a-i,a-i+n),s.wnext),(i-=n)?(s.window.set(e.subarray(a-i,a),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var Ue={inflateReset:ve,inflateReset2:ye,inflateResetKeep:ke,inflateInit:t=>xe(t,15),inflateInit2:xe,inflate:(t,e)=>{let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z=0;const A=new Uint8Array(4);let E,R;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pe(t)||!t.output||!t.input&&0!==t.avail_in)return _e;a=t.state,16191===a.mode&&(a.mode=16192),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,_=o,f=l,x=le;t:for(;;)switch(a.mode){case 16180:if(0===a.wrap){a.mode=16192;break}for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(2&a.wrap&&35615===h){0===a.wbits&&(a.wbits=15),a.check=0,A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0),h=0,d=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",a.mode=me;break}if((15&h)!==we){t.msg="unknown compression method",a.mode=me;break}if(h>>>=4,d-=4,y=8+(15&h),0===a.wbits&&(a.wbits=y),y>15||y>a.wbits){t.msg="invalid window size",a.mode=me;break}a.dmax=1<<a.wbits,a.flags=0,t.adler=a.check=1,a.mode=512&h?16189:16191,h=0,d=0;break;case 16181:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.flags=h,(255&a.flags)!==we){t.msg="unknown compression method",a.mode=me;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=me;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16182;case 16182:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.time=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,A[2]=h>>>16&255,A[3]=h>>>24&255,a.check=N(a.check,A,4,0)),h=0,d=0,a.mode=16183;case 16183:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16184;case 16184:if(1024&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(c=a.length,c>o&&(c=o),c&&(a.head&&(y=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(s,s+c),y)),512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,a.length-=c),a.length))break t;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.name+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.comment+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(65535&a.check)){t.msg="header crc mismatch",a.mode=me;break}h=0,d=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=16191;break;case 16189:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}t.adler=a.check=be(h),h=0,d=0,a.mode=16190;case 16190:if(0===a.havedict)return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,de;t.adler=a.check=1,a.mode=16191;case 16191:if(e===re||e===oe)break t;case 16192:if(a.last){h>>>=7&d,d-=7&d,a.mode=16206;break}for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}switch(a.last=1&h,h>>>=1,d-=1,3&h){case 0:a.mode=16193;break;case 1:if(Re(a),a.mode=16199,e===oe){h>>>=2,d-=2;break t}break;case 2:a.mode=16196;break;case 3:t.msg="invalid block type",a.mode=me}h>>>=2,d-=2;break;case 16193:for(h>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",a.mode=me;break}if(a.length=65535&h,h=0,d=0,a.mode=16194,e===oe)break t;case 16194:a.mode=16195;case 16195:if(c=a.length,c){if(c>o&&(c=o),c>l&&(c=l),0===c)break t;n.set(i.subarray(s,s+c),r),o-=c,s+=c,l-=c,r+=c,a.length-=c;break}a.mode=16191;break;case 16196:for(;d<14;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.nlen=257+(31&h),h>>>=5,d-=5,a.ndist=1+(31&h),h>>>=5,d-=5,a.ncode=4+(15&h),h>>>=4,d-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=me;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.lens[Z[a.have++]]=7&h,h>>>=3,d-=3}for(;a.have<19;)a.lens[Z[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,E={bits:a.lenbits},x=ne(0,a.lens,0,19,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid code lengths set",a.mode=me;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(g<16)h>>>=m,d-=m,a.lens[a.have++]=g;else{if(16===g){for(R=m+2;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(h>>>=m,d-=m,0===a.have){t.msg="invalid bit length repeat",a.mode=me;break}y=a.lens[a.have-1],c=3+(3&h),h>>>=2,d-=2}else if(17===g){for(R=m+3;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=3+(7&h),h>>>=3,d-=3}else{for(R=m+7;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=11+(127&h),h>>>=7,d-=7}if(a.have+c>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=me;break}for(;c--;)a.lens[a.have++]=y}}if(a.mode===me)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=me;break}if(a.lenbits=9,E={bits:a.lenbits},x=ne(1,a.lens,0,a.nlen,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid literal/lengths set",a.mode=me;break}if(a.distbits=6,a.distcode=a.distdyn,E={bits:a.distbits},x=ne(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,E),a.distbits=E.bits,x){t.msg="invalid distances set",a.mode=me;break}if(a.mode=16199,e===oe)break t;case 16199:a.mode=16200;case 16200:if(o>=6&&l>=258){t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,$t(t,f),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,16191===a.mode&&(a.back=-1);break}for(a.back=0;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(b&&0==(240&b)){for(p=m,k=b,v=g;z=a.lencode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,a.length=g,0===b){a.mode=16205;break}if(32&b){a.back=-1,a.mode=16191;break}if(64&b){t.msg="invalid literal/length code",a.mode=me;break}a.extra=15&b,a.mode=16201;case 16201:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;z=a.distcode[h&(1<<a.distbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(0==(240&b)){for(p=m,k=b,v=g;z=a.distcode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,64&b){t.msg="invalid distance code",a.mode=me;break}a.offset=g,a.extra=15&b,a.mode=16203;case 16203:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=me;break}a.mode=16204;case 16204:if(0===l)break t;if(c=f-l,a.offset>c){if(c=a.offset-c,c>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=me;break}c>a.wnext?(c-=a.wnext,u=a.wsize-c):u=a.wnext-c,c>a.length&&(c=a.length),w=a.window}else w=n,u=r-a.offset,c=a.length;c>l&&(c=l),l-=c,a.length-=c;do{n[r++]=w[u++]}while(--c);0===a.length&&(a.mode=16200);break;case 16205:if(0===l)break t;n[r++]=a.length,l--,a.mode=16200;break;case 16206:if(a.wrap){for(;d<32;){if(0===o)break t;o--,h|=i[s++]<<d,d+=8}if(f-=l,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,r-f):F(a.check,n,f,r-f)),f=l,4&a.wrap&&(a.flags?h:be(h))!==a.check){t.msg="incorrect data check",a.mode=me;break}h=0,d=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=me;break}h=0,d=0}a.mode=16208;case 16208:x=he;break t;case me:x=fe;break t;case 16210:return ce;default:return _e}return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,(a.wsize||f!==t.avail_out&&a.mode<me&&(a.mode<16206||e!==se))&&Ze(t,t.output,t.next_out,f-t.avail_out),_-=t.avail_in,f-=t.avail_out,t.total_in+=_,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,t.next_out-f):F(a.check,n,f,t.next_out-f)),t.data_type=a.bits+(a.last?64:0)+(16191===a.mode?128:0)+(16199===a.mode||16194===a.mode?256:0),(0===_&&0===f||e===se)&&x===le&&(x=ue),x},inflateEnd:t=>{if(pe(t))return _e;let e=t.state;return e.window&&(e.window=null),t.state=null,le},inflateGetHeader:(t,e)=>{if(pe(t))return _e;const a=t.state;return 0==(2&a.wrap)?_e:(a.head=e,e.done=!1,le)},inflateSetDictionary:(t,e)=>{const a=e.length;let i,n,s;return pe(t)?_e:(i=t.state,0!==i.wrap&&16190!==i.mode?_e:16190===i.mode&&(n=1,n=F(n,e,a,0),n!==i.check)?fe:(s=Ze(t,e,a,a),s?(i.mode=16210,ce):(i.havedict=1,le)))},inflateInfo:"pako inflate (from Nodeca project)"};var Se=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const De=Object.prototype.toString,{Z_NO_FLUSH:Te,Z_FINISH:Oe,Z_OK:Fe,Z_STREAM_END:Le,Z_NEED_DICT:Ne,Z_STREAM_ERROR:Ie,Z_DATA_ERROR:Be,Z_MEM_ERROR:Ce}=B;function He(t){this.options=Tt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=Ue.inflateInit2(this.strm,e.windowBits);if(a!==Fe)throw new Error(I[a]);if(this.header=new Se,Ue.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Nt(e.dictionary):"[object ArrayBuffer]"===De.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=Ue.inflateSetDictionary(this.strm,e.dictionary),a!==Fe)))throw new Error(I[a])}He.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,r,o;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Oe:Te,"[object ArrayBuffer]"===De.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),s=Ue.inflate(a,r),s===Ne&&n&&(s=Ue.inflateSetDictionary(a,n),s===Fe?s=Ue.inflate(a,r):s===Be&&(s=Ne));a.avail_in>0&&s===Le&&a.state.wrap>0&&0!==t[a.next_in];)Ue.inflateReset(a),s=Ue.inflate(a,r);switch(s){case Ie:case Be:case Ne:case Ce:return this.onEnd(s),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||s===Le))if("string"===this.options.to){let t=Bt(a.output,a.next_out),e=a.next_out-t,n=It(a.output,t);a.next_out=e,a.avail_out=i-e,e&&a.output.set(a.output.subarray(t,t+e),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(s!==Fe||0!==o){if(s===Le)return s=Ue.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},He.prototype.onData=function(t){this.chunks.push(t)},He.prototype.onEnd=function(t){t===Fe&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const{Deflate:Me,deflate:je,deflateRaw:Ke,gzip:Pe}=Vt;var Ye=Me,Ge=je,Xe=B;const We=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const e=this._hasEvents?",":"";this.deflate.push(e+t,Xe.Z_SYNC_FLUSH),this._hasEvents=!0}finish(){if(this.deflate.push("]",Xe.Z_FINISH),this.deflate.err)throw this.deflate.err;const t=this.deflate.result;return this._init(),t}_init(){this._hasEvents=!1,this.deflate=new Ye,this.deflate.push("[",Xe.Z_NO_FLUSH)}},qe={clear:()=>{We.clear()},addEvent:t=>We.addEvent(t),finish:()=>We.finish(),compress:t=>function(t){return Ge(t)}(t)};addEventListener("message",(function(t){const e=t.data.method,a=t.data.id,i=t.data.arg;if(e in qe&&"function"==typeof qe[e])try{const t=qe[e](i);postMessage({id:a,method:e,success:!0,response:t})}catch(t){postMessage({id:a,method:e,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});`;function gy(){let t=new Blob([_y]);return URL.createObjectURL(t)}function he(t,e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(_.info(t),e&&lf(t))}function rr(t,e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(_.info(t),e&&setTimeout(()=>{lf(t)},0))}function lf(t){T().addBreadcrumb({category:"console",data:{logger:"replay"},level:"info",message:t},{level:"info"})}var ds=class extends Error{constructor(){super(`Event buffer exceeded maximum size of ${ec}.`)}},Hi=class{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){let n=JSON.stringify(e).length;if(this._totalSize+=n,this._totalSize>ec)throw new ds;this.events.push(e)}finish(){return new Promise(e=>{let n=this.events;this.clear(),e(JSON.stringify(n))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){let e=this.events.map(n=>n.timestamp).sort()[0];return e?rc(e):null}},$a=class{constructor(e){this._worker=e,this._id=0}ensureReady(){return this._ensureReadyPromise?this._ensureReadyPromise:(this._ensureReadyPromise=new Promise((e,n)=>{this._worker.addEventListener("message",({data:r})=>{r.success?e():n()},{once:!0}),this._worker.addEventListener("error",r=>{n(r)},{once:!0})}),this._ensureReadyPromise)}destroy(){he("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(e,n){let r=this._getAndIncrementId();return new Promise((s,i)=>{let o=({data:a})=>{let c=a;if(c.method===e&&c.id===r){if(this._worker.removeEventListener("message",o),!c.success){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay]",c.response),i(new Error("Error in compression worker"));return}s(c.response)}};this._worker.addEventListener("message",o),this._worker.postMessage({id:r,method:e,arg:n})})}_getAndIncrementId(){return this._id++}},ja=class{constructor(e){this._worker=new $a(e),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){let n=rc(e.timestamp);(!this._earliestTimestamp||n<this._earliestTimestamp)&&(this._earliestTimestamp=n);let r=JSON.stringify(e);return this._totalSize+=r.length,this._totalSize>ec?Promise.reject(new ds):this._sendEventToWorker(r)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear")}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){let e=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,e}},za=class{constructor(e){this._fallback=new Hi,this._compression=new ja(e),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch{he("[Replay] Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){let{events:e,hasCheckout:n}=this._fallback,r=[];for(let s of e)r.push(this._compression.addEvent(s));this._compression.hasCheckout=n,this._used=this._compression;try{await Promise.all(r)}catch(s){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("[Replay] Failed to add events when switching buffers.",s)}}};function yy({useCompression:t}){if(t&&window.Worker)try{let e=gy();he("[Replay] Using compression worker");let n=new Worker(e);return new za(n)}catch{he("[Replay] Failed to create compression worker")}return he("[Replay] Using simple buffer"),new Hi}function ic(){try{return"sessionStorage"in G&&!!G.sessionStorage}catch{return!1}}function by(t){vy(),t.session=void 0}function vy(){if(ic())try{G.sessionStorage.removeItem(Xa)}catch{}}function uf(t){return t===void 0?!1:Math.random()<t}function oc(t){if(ic())try{G.sessionStorage.setItem(Xa,JSON.stringify(t))}catch{}}function df(t){let e=Date.now(),n=t.id||K(),r=t.started||e,s=t.lastActivity||e,i=t.segmentId||0,o=t.sampled,a=t.previousSessionId;return{id:n,started:r,lastActivity:s,segmentId:i,sampled:o,previousSessionId:a}}function Sy(t,e){return uf(t)?"session":e?"buffer":!1}function Nd({sessionSampleRate:t,allowBuffering:e,stickySession:n=!1},{previousSessionId:r}={}){let s=Sy(t,e),i=df({sampled:s,previousSessionId:r});return n&&oc(i),i}function Ey(t){if(!ic())return null;try{let e=G.sessionStorage.getItem(Xa);if(!e)return null;let n=JSON.parse(e);return rr("[Replay] Loading existing session",t),df(n)}catch{return null}}function Ya(t,e,n=+new Date){return t===null||e===void 0||e<0?!0:e===0?!1:t+e<=n}function ff(t,{maxReplayDuration:e,sessionIdleExpire:n,targetTime:r=Date.now()}){return Ya(t.started,e,r)||Ya(t.lastActivity,n,r)}function hf(t,{sessionIdleExpire:e,maxReplayDuration:n}){return!(!ff(t,{sessionIdleExpire:e,maxReplayDuration:n})||t.sampled==="buffer"&&t.segmentId===0)}function ka({traceInternals:t,sessionIdleExpire:e,maxReplayDuration:n,previousSessionId:r},s){let i=s.stickySession&&Ey(t);return i?hf(i,{sessionIdleExpire:e,maxReplayDuration:n})?(rr("[Replay] Session in sessionStorage is expired, creating new one..."),Nd(s,{previousSessionId:i.id})):i:(rr("[Replay] Creating new session",t),Nd(s,{previousSessionId:r}))}var wy=5;function Iy(t){return t.type===O.Custom}function ac(t,e,n){return mf(t,e)?(pf(t,e,n),!0):!1}function xy(t,e,n){return mf(t,e)?pf(t,e,n):Promise.resolve(null)}async function pf(t,e,n){if(!t.eventBuffer)return null;try{n&&t.recordingMode==="buffer"&&t.eventBuffer.clear(),n&&(t.eventBuffer.hasCheckout=!0);let r=t.getOptions(),s=Ty(e,r.beforeAddRecordingEvent);return s?await t.eventBuffer.addEvent(s):void 0}catch(r){let s=r&&r instanceof ds?"addEventSizeExceeded":"addEvent";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error(r),await t.stop({reason:s});let i=T().getClient();i&&i.recordDroppedEvent("internal_sdk_error","replay")}}function mf(t,e){if(!t.eventBuffer||t.isPaused()||!t.isEnabled())return!1;let n=rc(e.timestamp);return n+t.timeouts.sessionIdlePause<Date.now()?!1:n>t.getContext().initialTimestamp+t.getOptions().maxReplayDuration?(he(`[Replay] Skipping event with timestamp ${n} because it is after maxReplayDuration`,t.getOptions()._experiments.traceInternals),!1):!0}function Ty(t,e){try{if(typeof e=="function"&&Iy(t))return e(t)}catch(n){return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",n),null}return t}function _f(t){return!t.type}function Wa(t){return t.type==="transaction"}function Cy(t){return t.type==="replay_event"}function gf(t){let e=Ay();return(n,r)=>{if(!t.isEnabled()||!_f(n)&&!Wa(n))return;let s=r&&r.statusCode;if(!(e&&(!s||s<200||s>=300))){if(Wa(n)){ky(t,n);return}Ry(t,n)}}}function ky(t,e){let n=t.getContext();e.contexts&&e.contexts.trace&&e.contexts.trace.trace_id&&n.traceIds.size<100&&n.traceIds.add(e.contexts.trace.trace_id)}function Ry(t,e){let n=t.getContext();e.event_id&&n.errorIds.size<100&&n.errorIds.add(e.event_id),t.recordingMode==="buffer"&&e.tags&&e.tags.replayId&&setTimeout(()=>{t.sendBufferedReplayOrFlush()})}function Ay(){let t=T().getClient();if(!t)return!1;let e=t.getTransport();return e&&e.send.__sentry__baseTransport__||!1}function Ny(t,e){return t.type||!t.exception||!t.exception.values||!t.exception.values.length?!1:e.originalException&&e.originalException.__rrweb__?!0:t.exception.values.some(n=>!n.stacktrace||!n.stacktrace.frames||!n.stacktrace.frames.length?!1:n.stacktrace.frames.some(r=>r.filename&&r.filename.includes("/rrweb/src/")))}function Oy(t,e){return t.recordingMode!=="buffer"||e.message===Qa||!e.exception||e.type?!1:uf(t.getOptions().errorSampleRate)}function Dy(t,e=!1){let n=e?gf(t):void 0;return Object.assign((r,s)=>t.isEnabled()?Cy(r)?(delete r.breadcrumbs,r):!_f(r)&&!Wa(r)||!t.checkAndHandleExpiredSession()?r:Ny(r,s)&&!t.getOptions()._experiments.captureExceptions?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Replay] Ignoring error from rrweb internals",r),null):((Oy(t,r)||t.recordingMode==="session")&&(r.tags={...r.tags,replayId:t.getSessionId()}),n&&n(r,{statusCode:200}),r):r,{id:"Replay"})}function Vi(t,e){return e.map(({type:n,start:r,end:s,name:i,data:o})=>{let a=t.throttledAddEvent({type:O.Custom,timestamp:r,data:{tag:"performanceSpan",payload:{op:n,description:i,startTimestamp:r,endTimestamp:s,data:o}}});return typeof a=="string"?Promise.resolve(null):a})}function Ly(t){let{from:e,to:n}=t,r=Date.now()/1e3;return{type:"navigation.push",start:r,end:r,name:n,data:{previous:e}}}function Uy(t){return e=>{if(!t.isEnabled())return;let n=Ly(e);n!==null&&(t.getContext().urls.push(n.name),t.triggerUserActivity(),t.addUpdate(()=>(Vi(t,[n]),!1)))}}function Py(t,e){return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&t.getOptions()._experiments.traceInternals?!1:_a(e,T())}function Ki(t,e){t.isEnabled()&&e!==null&&(Py(t,e.name)||t.addUpdate(()=>(Vi(t,[e]),!0)))}function My(t){let{startTimestamp:e,endTimestamp:n,fetchData:r,response:s}=t;if(!n)return null;let{method:i,url:o}=r;return{type:"resource.fetch",start:e/1e3,end:n/1e3,name:o,data:{method:i,statusCode:s?s.status:void 0}}}function By(t){return e=>{if(!t.isEnabled())return;let n=My(e);Ki(t,n)}}function Fy(t){let{startTimestamp:e,endTimestamp:n,xhr:r}=t,s=r[Le];if(!e||!n||!s)return null;let{method:i,url:o,status_code:a}=s;return o===void 0?null:{type:"resource.xhr",name:o,start:e/1e3,end:n/1e3,data:{method:i,statusCode:a}}}function Gy(t){return e=>{if(!t.isEnabled())return;let n=Fy(e);Ki(t,n)}}var At=10,cc=11,qa=12,pt=13,Va=14,ar=15,ft=20,Pe=21,Ka=22,cr=23,yf=["true","false","null"];function Hy(t,e){if(!e.length)return t;let n=t,r=e.length-1,s=e[r];n=$y(n,s);for(let i=r;i>=0;i--)switch(e[i]){case At:n=`${n}}`;break;case ft:n=`${n}]`;break}return n}function $y(t,e){switch(e){case At:return`${t}"~~":"~~"`;case cc:return`${t}:"~~"`;case qa:return`${t}~~":"~~"`;case pt:return Yy(t);case Va:return`${t}~~"`;case ar:return`${t},"~~":"~~"`;case ft:return`${t}"~~"`;case Pe:return jy(t);case Ka:return`${t}~~"`;case cr:return`${t},"~~"`}return t}function jy(t){let e=zy(t);if(e>-1){let n=t.slice(e+1);return yf.includes(n.trim())?`${t},"~~"`:`${t.slice(0,e+1)}"~~"`}return t}function zy(t){for(let e=t.length-1;e>=0;e--){let n=t[e];if(n===","||n==="[")return e}return-1}function Yy(t){let e=t.lastIndexOf(":"),n=t.slice(e+1);return yf.includes(n.trim())?`${t},"~~":"~~"`:`${t.slice(0,e+1)}"~~"`}function Wy(t){let e=[];for(let n=0;n<t.length;n++)qy(e,t,n);return e}function qy(t,e,n){let r=t[t.length-1],s=e[n];if(!/\s/.test(s)){if(s==='"'&&!bf(e,n)){Vy(t,r);return}switch(s){case"{":Ky(t,r);break;case"[":Zy(t,r);break;case":":Jy(t,r);break;case",":Xy(t,r);break;case"}":Qy(t,r);break;case"]":eb(t,r);break}}}function Vy(t,e){if(e===Va){t.pop(),t.push(ar);return}if(e===Ka){t.pop(),t.push(cr);return}if(e===pt){t.push(Va);return}if(e===Pe){t.push(Ka);return}if(e===At){t.push(qa);return}if(e===qa){t.pop(),t.push(cc);return}}function Ky(t,e){if(!e){t.push(At);return}if(e===pt){t.push(At);return}if(e===Pe&&t.push(At),e===ft){t.push(At);return}}function Zy(t,e){if(!e){t.push(ft),t.push(Pe);return}if(e===pt){t.push(ft),t.push(Pe);return}if(e===Pe&&(t.push(ft),t.push(Pe)),e===ft){t.push(ft),t.push(Pe);return}}function Jy(t,e){e===cc&&(t.pop(),t.push(pt))}function Xy(t,e){if(e===pt){t.pop();return}if(e===ar){t.pop(),t.pop();return}if(e!==Pe&&e===cr){t.pop();return}}function Qy(t,e){e===At&&t.pop(),e===pt&&(t.pop(),t.pop()),e===ar&&(t.pop(),t.pop(),t.pop()),t[t.length-1]===pt&&t.push(ar),t[t.length-1]===Pe&&t.push(cr)}function eb(t,e){e===ft&&t.pop(),e===Pe&&(t.pop(),t.pop()),e===cr&&(t.pop(),t.pop(),t.pop()),t[t.length-1]===pt&&t.push(ar),t[t.length-1]===Pe&&t.push(cr)}function bf(t,e){return t[e-1]==="\\"&&!bf(t,e-1)}function vf(t){let e=Wy(t);return Hy(t,e)}function $i(t,e){if(t)try{if(typeof t=="string")return e.encode(t).length;if(t instanceof URLSearchParams)return e.encode(t.toString()).length;if(t instanceof FormData){let n=If(t);return e.encode(n).length}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength}catch{}}function Sf(t){if(!t)return;let e=parseInt(t,10);return isNaN(e)?void 0:e}function Ef(t){if(typeof t=="string")return t;if(t instanceof URLSearchParams)return t.toString();if(t instanceof FormData)return If(t)}function wf(t,e){if(!e)return null;let{startTimestamp:n,endTimestamp:r,url:s,method:i,statusCode:o,request:a,response:c}=e;return{type:t,start:n/1e3,end:r/1e3,name:s,data:ue({method:i,statusCode:o,request:a,response:c})}}function fs(t){return{headers:{},size:t,_meta:{warnings:["URL_SKIPPED"]}}}function Nt(t,e,n){if(!e&&Object.keys(t).length===0)return;if(!e)return{headers:t};if(!n)return{headers:t,size:e};let r={headers:t,size:e},{body:s,warnings:i}=tb(n);return r.body=s,i.length>0&&(r._meta={warnings:i}),r}function Za(t,e){return Object.keys(t).reduce((n,r)=>{let s=r.toLowerCase();return e.includes(s)&&t[r]&&(n[s]=t[r]),n},{})}function If(t){return new URLSearchParams(t).toString()}function tb(t){if(!t||typeof t!="string")return{body:t,warnings:[]};let e=t.length>xi;if(nb(t))try{let n=e?vf(t.slice(0,xi)):t;return{body:JSON.parse(n),warnings:e?["JSON_TRUNCATED"]:[]}}catch{return{body:e?`${t.slice(0,xi)}\u2026`:t,warnings:e?["INVALID_JSON","TEXT_TRUNCATED"]:["INVALID_JSON"]}}return{body:e?`${t.slice(0,xi)}\u2026`:t,warnings:e?["TEXT_TRUNCATED"]:[]}}function nb(t){let e=t[0],n=t[t.length-1];return e==="["&&n==="]"||e==="{"&&n==="}"}function ji(t,e){let n=rb(t);return Xe(n,e)}function rb(t,e=G.document.baseURI){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith(G.location.origin))return t;let n=new URL(t,e);if(n.origin!==new URL(e).origin)return t;let r=n.href;return!t.endsWith("/")&&r.endsWith("/")?r.slice(0,-1):r}async function sb(t,e,n){try{let r=await ob(t,e,n),s=wf("resource.fetch",r);Ki(n.replay,s)}catch(r){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] Failed to capture fetch breadcrumb",r)}}function ib(t,e,n){let{input:r,response:s}=e,i=xf(r),o=$i(i,n.textEncoder),a=s?Sf(s.headers.get("content-length")):void 0;o!==void 0&&(t.data.request_body_size=o),a!==void 0&&(t.data.response_body_size=a)}async function ob(t,e,n){let{startTimestamp:r,endTimestamp:s}=e,{url:i,method:o,status_code:a=0,request_body_size:c,response_body_size:l}=t.data,u=ji(i,n.networkDetailAllowUrls)&&!ji(i,n.networkDetailDenyUrls),d=u?ab(n,e.input,c):fs(c),f=await cb(u,n,e.response,l);return{startTimestamp:r,endTimestamp:s,url:i,method:o,statusCode:a,request:d,response:f}}function ab({networkCaptureBodies:t,networkRequestHeaders:e},n,r){let s=ub(n,e);if(!t)return Nt(s,r,void 0);let i=xf(n),o=Ef(i);return Nt(s,r,o)}async function cb(t,{networkCaptureBodies:e,textEncoder:n,networkResponseHeaders:r},s,i){if(!t&&i!==void 0)return fs(i);let o=Tf(s.headers,r);if(!e&&i!==void 0)return Nt(o,i,void 0);try{let a=s.clone(),c=await lb(a),l=c&&c.length&&i===void 0?$i(c,n):i;return t?e?Nt(o,l,c):Nt(o,l,void 0):fs(l)}catch{return Nt(o,i,void 0)}}async function lb(t){try{return await t.text()}catch{return}}function xf(t=[]){if(!(t.length!==2||typeof t[1]!="object"))return t[1].body}function Tf(t,e){let n={};return e.forEach(r=>{t.get(r)&&(n[r]=t.get(r))}),n}function ub(t,e){return t.length===1&&typeof t[0]!="string"?Od(t[0],e):t.length===2?Od(t[1],e):{}}function Od(t,e){if(!t)return{};let n=t.headers;return n?n instanceof Headers?Tf(n,e):Array.isArray(n)?{}:Za(n,e):{}}async function db(t,e,n){try{let r=hb(t,e,n),s=wf("resource.xhr",r);Ki(n.replay,s)}catch(r){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] Failed to capture fetch breadcrumb",r)}}function fb(t,e,n){let{xhr:r,input:s}=e,i=$i(s,n.textEncoder),o=r.getResponseHeader("content-length")?Sf(r.getResponseHeader("content-length")):$i(r.response,n.textEncoder);i!==void 0&&(t.data.request_body_size=i),o!==void 0&&(t.data.response_body_size=o)}function hb(t,e,n){let{startTimestamp:r,endTimestamp:s,input:i,xhr:o}=e,{url:a,method:c,status_code:l=0,request_body_size:u,response_body_size:d}=t.data;if(!a)return null;if(!ji(a,n.networkDetailAllowUrls)||ji(a,n.networkDetailDenyUrls)){let g=fs(u),v=fs(d);return{startTimestamp:r,endTimestamp:s,url:a,method:c,statusCode:l,request:g,response:v}}let f=o[Le],h=f?Za(f.request_headers,n.networkRequestHeaders):{},m=Za(pb(o),n.networkResponseHeaders),p=Nt(h,u,n.networkCaptureBodies?Ef(i):void 0),y=Nt(m,d,n.networkCaptureBodies?e.xhr.responseText:void 0);return{startTimestamp:r,endTimestamp:s,url:a,method:c,statusCode:l,request:p,response:y}}function pb(t){let e=t.getAllResponseHeaders();return e?e.split(`\r
`).reduce((n,r)=>{let[s,i]=r.split(": ");return n[s.toLowerCase()]=i,n},{}):{}}function mb(t){let e=T().getClient();try{let n=new TextEncoder,{networkDetailAllowUrls:r,networkDetailDenyUrls:s,networkCaptureBodies:i,networkRequestHeaders:o,networkResponseHeaders:a}=t.getOptions(),c={replay:t,textEncoder:n,networkDetailAllowUrls:r,networkDetailDenyUrls:s,networkCaptureBodies:i,networkRequestHeaders:o,networkResponseHeaders:a};e&&e.on?e.on("beforeAddBreadcrumb",(l,u)=>_b(c,l,u)):(q("fetch",By(t)),q("xhr",Gy(t)))}catch{}}function _b(t,e,n){if(e.data)try{gb(e)&&bb(n)&&(fb(e,n,t),db(e,n,t)),yb(e)&&vb(n)&&(ib(e,n,t),sb(e,n,t))}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Error when enriching network breadcrumb")}}function gb(t){return t.category==="xhr"}function yb(t){return t.category==="fetch"}function bb(t){return t&&t.xhr}function vb(t){return t&&t.response}var Dd=null;function Sb(t){return!!t.category}var Eb=t=>e=>{if(!t.isEnabled())return;let n=wb(e);n&&qi(t,n)};function wb(t){let e=t.getLastBreadcrumb&&t.getLastBreadcrumb();return Dd===e||!e||(Dd=e,!Sb(e)||["fetch","xhr","sentry.event","sentry.transaction"].includes(e.category)||e.category.startsWith("ui."))?null:e.category==="console"?Ib(e):ht(e)}function Ib(t){let e=t.data&&t.data.arguments;if(!Array.isArray(e)||e.length===0)return ht(t);let n=!1,r=e.map(s=>{if(!s)return s;if(typeof s=="string")return s.length>Ti?(n=!0,`${s.slice(0,Ti)}\u2026`):s;if(typeof s=="object")try{let i=be(s,7),o=JSON.stringify(i);if(o.length>Ti){let a=vf(o.slice(0,Ti)),c=JSON.parse(a);return n=!0,c}return i}catch{}return s});return ht({...t,data:{...t.data,arguments:r,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function xb(t){let e=T().getScope(),n=T().getClient();e.addScopeListener(Eb(t)),q("dom",oy(t)),q("history",Uy(t)),mb(t);let r=Dy(t,!Ld(n));n&&n.addEventProcessor?n.addEventProcessor(r):Hn(r),Ld(n)&&(n.on("afterSendEvent",gf(t)),n.on("createDsc",s=>{let i=t.getSessionId();i&&t.isEnabled()&&t.recordingMode==="session"&&(s.replay_id=i)}),n.on("startTransaction",s=>{t.lastTransaction=s}),n.on("finishTransaction",s=>{t.lastTransaction=s}))}function Ld(t){return!!(t&&t.on)}async function Tb(t){try{return Promise.all(Vi(t,[Cb(G.performance.memory)]))}catch{return[]}}function Cb(t){let{jsHeapSizeLimit:e,totalJSHeapSize:n,usedJSHeapSize:r}=t,s=Date.now()/1e3;return{type:"memory",name:"memory",start:s,end:s,data:{memory:{jsHeapSizeLimit:e,totalJSHeapSize:n,usedJSHeapSize:r}}}}var Ud={resource:Ob,paint:Ab,navigation:Nb,"largest-contentful-paint":Db};function kb(t){return t.map(Rb).filter(Boolean)}function Rb(t){return Ud[t.entryType]===void 0?null:Ud[t.entryType](t)}function lr(t){return((fe||G.performance.timeOrigin)+t)/1e3}function Ab(t){let{duration:e,entryType:n,name:r,startTime:s}=t,i=lr(s);return{type:n,name:r,start:i,end:i+e,data:void 0}}function Nb(t){let{entryType:e,name:n,decodedBodySize:r,duration:s,domComplete:i,encodedBodySize:o,domContentLoadedEventStart:a,domContentLoadedEventEnd:c,domInteractive:l,loadEventStart:u,loadEventEnd:d,redirectCount:f,startTime:h,transferSize:m,type:p}=t;return s===0?null:{type:`${e}.${p}`,start:lr(h),end:lr(i),name:n,data:{size:m,decodedBodySize:r,encodedBodySize:o,duration:s,domInteractive:l,domContentLoadedEventStart:a,domContentLoadedEventEnd:c,loadEventStart:u,loadEventEnd:d,domComplete:i,redirectCount:f}}}function Ob(t){let{entryType:e,initiatorType:n,name:r,responseEnd:s,startTime:i,decodedBodySize:o,encodedBodySize:a,responseStatus:c,transferSize:l}=t;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${e}.${n}`,start:lr(i),end:lr(s),name:r,data:{size:l,statusCode:c,decodedBodySize:o,encodedBodySize:a}}}function Db(t){let{entryType:e,startTime:n,size:r}=t,s=0;if(G.performance){let a=G.performance.getEntriesByType("navigation")[0];s=a&&a.activationStart||0}let i=Math.max(n-s,0),o=lr(s)+i/1e3;return{type:e,name:e,start:o,end:o,data:{value:i,size:r,nodeId:et.mirror.getId(t.element)}}}function Lb(t,e,n){let r,s,i,o=n&&n.maxWait?Math.max(n.maxWait,e):0;function a(){return c(),r=t(),r}function c(){s!==void 0&&clearTimeout(s),i!==void 0&&clearTimeout(i),s=i=void 0}function l(){return s!==void 0||i!==void 0?a():r}function u(){return s&&clearTimeout(s),s=setTimeout(a,e),o&&i===void 0&&(i=setTimeout(a,o)),r}return u.cancel=c,u.flush=l,u}function Ub(t){let e=!1;return(n,r)=>{if(!t.checkAndHandleExpiredSession()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("[Replay] Received replay event after session expired.");return}let s=r||!e;e=!0,t.addUpdate(()=>{if(t.recordingMode==="buffer"&&s&&t.setInitialState(),!ac(t,n,s))return!0;if(!s)return!1;if(Mb(t,s),t.session&&t.session.previousSessionId)return!0;if(t.recordingMode==="buffer"&&t.session&&t.eventBuffer){let i=t.eventBuffer.getEarliestTimestamp();i&&(he(`[Replay] Updating session start time to earliest event in buffer to ${new Date(i)}`,t.getOptions()._experiments.traceInternals),t.session.started=i,t.getOptions().stickySession&&oc(t.session))}return t.recordingMode==="session"&&t.flush(),!0})}}function Pb(t){let e=t.getOptions();return{type:O.Custom,timestamp:Date.now(),data:{tag:"options",payload:{sessionSampleRate:e.sessionSampleRate,errorSampleRate:e.errorSampleRate,useCompressionOption:e.useCompression,blockAllMedia:e.blockAllMedia,maskAllText:e.maskAllText,maskAllInputs:e.maskAllInputs,useCompression:t.eventBuffer?t.eventBuffer.type==="worker":!1,networkDetailHasUrls:e.networkDetailAllowUrls.length>0,networkCaptureBodies:e.networkCaptureBodies,networkRequestHasHeaders:e.networkRequestHeaders.length>0,networkResponseHasHeaders:e.networkResponseHeaders.length>0}}}}function Mb(t,e){!e||!t.session||t.session.segmentId!==0||ac(t,Pb(t),!1)}function Bb(t,e,n,r){return Ue(Zr(t,Bn(t),r,n),[[{type:"replay_event"},t],[{type:"replay_recording",length:typeof e=="string"?new TextEncoder().encode(e).length:e.length},e]])}function Fb({recordingData:t,headers:e}){let n,r=`${JSON.stringify(e)}
`;if(typeof t=="string")n=`${r}${t}`;else{let i=new TextEncoder().encode(r);n=new Uint8Array(i.length+t.length),n.set(i),n.set(t,i.length)}return n}async function Gb({client:t,scope:e,replayId:n,event:r}){let s=typeof t._integrations=="object"&&t._integrations!==null&&!Array.isArray(t._integrations)?Object.keys(t._integrations):void 0,i={event_id:n,integrations:s};t.emit&&t.emit("preprocessEvent",r,i);let o=await es(t.getOptions(),r,i,e,t);if(!o)return null;o.platform=o.platform||"javascript";let a=t.getSdkMetadata&&t.getSdkMetadata(),{name:c,version:l}=a&&a.sdk||{};return o.sdk={...o.sdk,name:c||"sentry.javascript.unknown",version:l||"0.0.0"},o}async function Hb({recordingData:t,replayId:e,segmentId:n,eventContext:r,timestamp:s,session:i}){let o=Fb({recordingData:t,headers:{segment_id:n}}),{urls:a,errorIds:c,traceIds:l,initialTimestamp:u}=r,d=T(),f=d.getClient(),h=d.getScope(),m=f&&f.getTransport(),p=f&&f.getDsn();if(!f||!m||!p||!i.sampled)return;let y={type:A_,replay_start_timestamp:u/1e3,timestamp:s/1e3,error_ids:c,trace_ids:l,urls:a,replay_id:e,segment_id:n,replay_type:i.sampled},g=await Gb({scope:h,client:f,replayId:e,event:y});if(!g){f.recordDroppedEvent("event_processor","replay",y),he("An event processor returned `null`, will not send event.");return}delete g.sdkProcessingMetadata;let v=Bb(g,o,p,f.getOptions().tunnel),I;try{I=await m.send(v)}catch(S){let k=new Error(Qa);try{k.cause=S}catch{}throw k}if(!I)return I;if(typeof I.statusCode=="number"&&(I.statusCode<200||I.statusCode>=300))throw new zi(I.statusCode);return I}var zi=class extends Error{constructor(e){super(`Transport returned status code ${e}`)}};async function Cf(t,e={count:0,interval:P_}){let{recordingData:n,options:r}=t;if(n.length)try{return await Hb(t),!0}catch(s){if(s instanceof zi)throw s;if(yi("Replays",{_retryCount:e.count}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&r._experiments&&r._experiments.captureExceptions&&tn(s),e.count>=M_){let i=new Error(`${Qa} - max retries exceeded`);try{i.cause=s}catch{}throw i}return e.interval*=++e.count,new Promise((i,o)=>{setTimeout(async()=>{try{await Cf(t,e),i(!0)}catch(a){o(a)}},e.interval)})}}var kf="__THROTTLED",$b="__SKIPPED";function jb(t,e,n){let r=new Map,s=a=>{let c=a-n;r.forEach((l,u)=>{u<c&&r.delete(u)})},i=()=>[...r.values()].reduce((a,c)=>a+c,0),o=!1;return(...a)=>{let c=Math.floor(Date.now()/1e3);if(s(c),i()>=e){let u=o;return o=!0,u?$b:kf}o=!1;let l=r.get(c)||0;return r.set(c,l+1),t(...a)}}var Ja=class t{constructor({options:e,recordingOptions:n}){t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this),t.prototype.__init5.call(this),t.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEvents=[],this.recordingMode="session",this.timeouts={sessionIdlePause:N_,sessionIdleExpire:O_},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=n,this._options=e,this._debouncedFlush=Lb(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=jb((o,a)=>xy(this,o,a),300,5);let{slowClickTimeout:r,slowClickIgnoreSelectors:s}=this.getOptions(),i=r?{threshold:Math.min(B_,r),timeout:r,scrollTimeout:F_,ignoreSelector:s?s.join(","):""}:void 0;i&&(this.clickDetector=new Ha(this,i))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}getOptions(){return this._options}initializeSampling(e){let{errorSampleRate:n,sessionSampleRate:r}=this._options;if(!(n<=0&&r<=0)){if(this._initializeSessionForSampling(e),!this.session){this._handleException(new Error("Unable to initialize and create session"));return}this.session.sampled!==!1&&(this.recordingMode=this.session.sampled==="buffer"&&this.session.segmentId===0?"buffer":"session",rr(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording())}}start(){if(this._isEnabled&&this.recordingMode==="session")throw new Error("Replay recording is already in progress");if(this._isEnabled&&this.recordingMode==="buffer")throw new Error("Replay buffering is in progress, call `flush()` to save the replay");rr("[Replay] Starting replay in session mode",this._options._experiments.traceInternals);let e=ka({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=e,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw new Error("Replay recording is already in progress");rr("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);let e=ka({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=e,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{this._stopRecording=et({...this._recordingOptions,...this.recordingMode==="buffer"&&{checkoutEveryNms:U_},emit:Ub(this),onMutation:this._onMutationHandler})}catch(e){this._handleException(e)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(e){return this._handleException(e),!1}}async stop({forceFlush:e=!1,reason:n}={}){if(this._isEnabled){this._isEnabled=!1;try{he(`[Replay] Stopping Replay${n?` triggered by ${n}`:""}`,this._options._experiments.traceInternals),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),e&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,by(this)}catch(r){this._handleException(r)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),he("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){!this._isPaused||!this._checkSession()||(this._isPaused=!1,this.startRecording(),he("[Replay] Resuming replay",this._options._experiments.traceInternals))}async sendBufferedReplayOrFlush({continueRecording:e=!0}={}){if(this.recordingMode==="session")return this.flushImmediate();let n=Date.now();he("[Replay] Converting buffer to session",this._options._experiments.traceInternals),await this.flushImmediate();let r=this.stopRecording();!e||!r||this.recordingMode!=="session"&&(this.recordingMode="session",this.session&&(this._updateUserActivity(n),this._updateSessionActivity(n),this._maybeSaveSession()),this.startRecording())}addUpdate(e){let n=e();this.recordingMode!=="buffer"&&n!==!0&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),!this._stopRecording){if(!this._checkSession())return;this.resume();return}this.checkAndHandleExpiredSession(),this._updateSessionActivity()}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return this.recordingMode==="buffer"?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(this._lastActivity&&Ya(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&this.session.sampled==="session"){this.pause();return}return!!this._checkSession()}setInitialState(){let e=`${G.location.pathname}${G.location.hash}${G.location.search}`,n=`${G.location.origin}${e}`;this.performanceEvents=[],this._clearContext(),this._context.initialUrl=n,this._context.initialTimestamp=Date.now(),this._context.urls.push(n)}throttledAddEvent(e,n){let r=this._throttledAddEvent(e,n);if(r===kf){let s=ht({category:"replay.throttled"});this.addUpdate(()=>!ac(this,{type:wy,timestamp:s.timestamp||0,data:{tag:"breadcrumb",payload:s,metric:!0}}))}return r}getCurrentRoute(){let e=this.lastTransaction||T().getScope().getTransaction();if(!(!e||!["route","custom"].includes(e.metadata.source)))return e.name}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=yy({useCompression:this._options.useCompression}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_handleException(e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay]",e),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this._options._experiments&&this._options._experiments.captureExceptions&&tn(e)}_initializeSessionForSampling(e){let n=this._options.errorSampleRate>0,r=ka({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:n});this.session=r}_checkSession(){if(!this.session)return!1;let e=this.session;return hf(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})?(this._refreshSession(e),!1):!0}async _refreshSession(e){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(e.id))}_addListeners(){try{G.document.addEventListener("visibilitychange",this._handleVisibilityChange),G.addEventListener("blur",this._handleWindowBlur),G.addEventListener("focus",this._handleWindowFocus),G.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(xb(this),this._hasInitializedCoreListeners=!0)}catch(e){this._handleException(e)}"PerformanceObserver"in G&&(this._performanceObserver=my(this))}_removeListeners(){try{G.document.removeEventListener("visibilitychange",this._handleVisibilityChange),G.removeEventListener("blur",this._handleWindowBlur),G.removeEventListener("focus",this._handleWindowFocus),G.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceObserver&&(this._performanceObserver.disconnect(),this._performanceObserver=void 0)}catch(e){this._handleException(e)}}__init(){this._handleVisibilityChange=()=>{G.document.visibilityState==="visible"?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{let e=ht({category:"ui.blur"});this._doChangeToBackgroundTasks(e)}}__init3(){this._handleWindowFocus=()=>{let e=ht({category:"ui.focus"});this._doChangeToForegroundTasks(e)}}__init4(){this._handleKeyboardEvent=e=>{uy(this,e)}}_doChangeToBackgroundTasks(e){!this.session||ff(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(e&&this._createCustomBreadcrumb(e),this.conditionalFlush())}_doChangeToForegroundTasks(e){if(!this.session)return;if(!this.checkAndHandleExpiredSession()){he("[Replay] Document has become active, but session has expired");return}e&&this._createCustomBreadcrumb(e)}_triggerFullSnapshot(e=!0){try{he("[Replay] Taking full rrweb snapshot"),et.takeFullSnapshot(e)}catch(n){this._handleException(n)}}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){this.session&&(this.session.lastActivity=e,this._maybeSaveSession())}_createCustomBreadcrumb(e){this.addUpdate(()=>{this.throttledAddEvent({type:O.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})})}_addPerformanceEntries(){let e=[...this.performanceEvents];return this.performanceEvents=[],Promise.all(Vi(this,kb(e)))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){let{session:e,eventBuffer:n}=this;if(!e||!n||e.segmentId)return;let r=n.getEarliestTimestamp();r&&r<this._context.initialTimestamp&&(this._context.initialTimestamp=r)}_popEventContext(){let e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),e}async _runFlush(){let e=this.getSessionId();if(!this.session||!this.eventBuffer||!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] No session or eventBuffer found to flush.");return}if(await this._addPerformanceEntries(),!(!this.eventBuffer||!this.eventBuffer.hasEvents)&&(await Tb(this),!!this.eventBuffer&&e===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();let n=Date.now();if(n-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");let r=this._popEventContext(),s=this.session.segmentId++;this._maybeSaveSession();let i=await this.eventBuffer.finish();await Cf({replayId:e,recordingData:i,segmentId:s,eventContext:r,session:this.session,options:this.getOptions(),timestamp:n})}catch(n){this._handleException(n),this.stop({reason:"sendReplay"});let r=T().getClient();r&&r.recordDroppedEvent("send_error","replay")}}__init5(){this._flush=async({force:e=!1}={})=>{if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession()){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] Attempting to finish replay event after session expired.");return}if(!this.session){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error("[Replay] No session found to flush.");return}let n=this.session.started,s=Date.now()-n;this._debouncedFlush.cancel();let i=s<this._options.minReplayDuration,o=s>this._options.maxReplayDuration+5e3;if(i||o){he(`[Replay] Session duration (${Math.floor(s/1e3)}s) is too ${i?"short":"long"}, not sending replay.`,this._options._experiments.traceInternals),i&&this._debouncedFlush();return}let a=this.eventBuffer;if(a&&this.session.segmentId===0&&!a.hasCheckout&&he("[Replay] Flushing initial segment without checkout.",this._options._experiments.traceInternals),!this._flushLock){this._flushLock=this._runFlush(),await this._flushLock,this._flushLock=void 0;return}try{await this._flushLock}catch(c){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.error(c)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&oc(this.session)}__init6(){this._onMutationHandler=e=>{let n=e.length,r=this._options.mutationLimit,s=this._options.mutationBreadcrumbLimit,i=r&&n>r;if(n>s||i){let o=ht({category:"replay.mutations",data:{count:n,limit:i}});this._createCustomBreadcrumb(o)}return i?(this.stop({reason:"mutationLimit",forceFlush:this.recordingMode==="session"}),!1):!0}}};function ss(t,e,n,r){let s=typeof r=="string"?r.split(","):[],i=[...t,...s,...e];return typeof n<"u"&&(typeof n=="string"&&i.push(`.${n}`),console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")),i.join(",")}function zb({mask:t,unmask:e,block:n,unblock:r,ignore:s,blockClass:i,blockSelector:o,maskTextClass:a,maskTextSelector:c,ignoreClass:l}){let u=['base[href="/"]'],d=ss(t,[".sentry-mask","[data-sentry-mask]"],a,c),f=ss(e,[".sentry-unmask","[data-sentry-unmask]"]),h={maskTextSelector:d,unmaskTextSelector:f,blockSelector:ss(n,[".sentry-block","[data-sentry-block]",...u],i,o),unblockSelector:ss(r,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:ss(s,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],l)};return i instanceof RegExp&&(h.blockClass=i),a instanceof RegExp&&(h.maskTextClass=a),h}function Pd(){return typeof window<"u"&&(!Yr()||Yb())}function Yb(){return typeof process<"u"&&process.type==="renderer"}function Wb({el:t,key:e,maskAttributes:n,maskAllText:r,privacyOptions:s,value:i}){return!r||s.unmaskTextSelector&&t.matches(s.unmaskTextSelector)?i:n.includes(e)||e==="value"&&t.tagName==="INPUT"&&["submit","button"].includes(t.getAttribute("type")||"")?i.replace(/[\S]/g,"*"):i}var Md='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',qb=["content-length","content-type","accept"],Bd=!1,ur=class t{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:e=D_,flushMaxDelay:n=L_,minReplayDuration:r=G_,maxReplayDuration:s=gd,stickySession:i=!0,useCompression:o=!0,_experiments:a={},sessionSampleRate:c,errorSampleRate:l,maskAllText:u=!0,maskAllInputs:d=!0,blockAllMedia:f=!0,mutationBreadcrumbLimit:h=750,mutationLimit:m=1e4,slowClickTimeout:p=7e3,slowClickIgnoreSelectors:y=[],networkDetailAllowUrls:g=[],networkDetailDenyUrls:v=[],networkCaptureBodies:I=!0,networkRequestHeaders:S=[],networkResponseHeaders:k=[],mask:C=[],maskAttributes:E=["title","placeholder"],unmask:R=[],block:B=[],unblock:w=[],ignore:N=[],maskFn:j,beforeAddRecordingEvent:ie,blockClass:ce,blockSelector:Se,maskInputOptions:H,maskTextClass:Ce,maskTextSelector:te,ignoreClass:ke}={}){this.name=t.id;let Re=zb({mask:C,unmask:R,block:B,unblock:w,ignore:N,blockClass:ce,blockSelector:Se,maskTextClass:Ce,maskTextSelector:te,ignoreClass:ke});if(this._recordingOptions={maskAllInputs:d,maskAllText:u,maskInputOptions:{...H||{},password:!0},maskTextFn:j,maskInputFn:j,maskAttributeFn:(Dt,Lt,_r)=>Wb({maskAttributes:E,maskAllText:u,privacyOptions:Re,key:Dt,value:Lt,el:_r}),...Re,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:Dt=>{try{Dt.__rrweb__=!0}catch{}}},this._initialOptions={flushMinDelay:e,flushMaxDelay:n,minReplayDuration:Math.min(r,H_),maxReplayDuration:Math.min(s,gd),stickySession:i,sessionSampleRate:c,errorSampleRate:l,useCompression:o,blockAllMedia:f,maskAllInputs:d,maskAllText:u,mutationBreadcrumbLimit:h,mutationLimit:m,slowClickTimeout:p,slowClickIgnoreSelectors:y,networkDetailAllowUrls:g,networkDetailDenyUrls:v,networkCaptureBodies:I,networkRequestHeaders:Fd(S),networkResponseHeaders:Fd(k),beforeAddRecordingEvent:ie,_experiments:a},typeof c=="number"&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysSessionSampleRate: ${c} })`),this._initialOptions.sessionSampleRate=c),typeof l=="number"&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysOnErrorSampleRate: ${l} })`),this._initialOptions.errorSampleRate=l),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${Md}`:Md),this._isInitialized&&Pd())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return Bd}set _isInitialized(e){Bd=e}setupOnce(){Pd()&&(this._setup(),setTimeout(()=>this._initialize()))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:this._replay.recordingMode==="session"}):Promise.resolve()}flush(e){return!this._replay||!this._replay.isEnabled()?Promise.resolve():this._replay.sendBufferedReplayOrFlush(e)}getReplayId(){if(!(!this._replay||!this._replay.isEnabled()))return this._replay.getSessionId()}_initialize(){this._replay&&this._replay.initializeSampling()}_setup(){let e=Vb(this._initialOptions);this._replay=new Ja({options:e,recordingOptions:this._recordingOptions})}};ur.__initStatic();function Vb(t){let e=T().getClient(),n=e&&e.getOptions(),r={sessionSampleRate:0,errorSampleRate:0,...ue(t)};return n?(t.sessionSampleRate==null&&t.errorSampleRate==null&&n.replaysSessionSampleRate==null&&n.replaysOnErrorSampleRate==null&&console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set."),typeof n.replaysSessionSampleRate=="number"&&(r.sessionSampleRate=n.replaysSessionSampleRate),typeof n.replaysOnErrorSampleRate=="number"&&(r.errorSampleRate=n.replaysOnErrorSampleRate),r):(console.warn("SDK client is not available."),r)}function Fd(t){return[...qb,...t.map(e=>e.toLowerCase())]}var M=$;function Rf(){M&&M.document?M.document.addEventListener("visibilitychange",()=>{let t=We();if(M.document.hidden&&t){let e="cancelled";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}}):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("[Tracing] Could not set up background tab detection due to lack of global document")}var fr=(t,e,n)=>{let r,s;return i=>{e.value>=0&&(i||n)&&(s=e.value-(r||0),(s||r===void 0)&&(r=e.value,e.delta=s,t(e)))}};var Af=()=>`v3-${Date.now()}-${Math.floor(Math.random()*8999999999999)+1e12}`;var Kb=()=>{let t=M.performance.timing,e=M.performance.navigation.type,n={entryType:"navigation",startTime:0,type:e==2?"back_forward":e===1?"reload":"navigate"};for(let r in t)r!=="navigationStart"&&r!=="toJSON"&&(n[r]=Math.max(t[r]-t.navigationStart,0));return n},Zi=()=>M.__WEB_VITALS_POLYFILL__?M.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||Kb()):M.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];var Ji=()=>{let t=Zi();return t&&t.activationStart||0};var hr=(t,e)=>{let n=Zi(),r="navigate";return n&&(M.document.prerendering||Ji()>0?r="prerender":r=n.type.replace(/_/g,"-")),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:Af(),navigationType:r}};var mt=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){let r=new PerformanceObserver(s=>{e(s.getEntries())});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}};var Ot=(t,e)=>{let n=r=>{(r.type==="pagehide"||M.document.visibilityState==="hidden")&&(t(r),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)};var Nf=t=>{let e=hr("CLS",0),n,r=0,s=[],i=a=>{a.forEach(c=>{if(!c.hadRecentInput){let l=s[0],u=s[s.length-1];r&&s.length!==0&&c.startTime-u.startTime<1e3&&c.startTime-l.startTime<5e3?(r+=c.value,s.push(c)):(r=c.value,s=[c]),r>e.value&&(e.value=r,e.entries=s,n&&n())}})},o=mt("layout-shift",i);if(o){n=fr(t,e);let a=()=>{i(o.takeRecords()),n(!0)};return Ot(a),a}};var Xi=-1,Zb=()=>M.document.visibilityState==="hidden"&&!M.document.prerendering?0:1/0,Jb=()=>{Ot(({timeStamp:t})=>{Xi=t},!0)},pr=()=>(Xi<0&&(Xi=Zb(),Jb()),{get firstHiddenTime(){return Xi}});var Of=t=>{let e=pr(),n=hr("FID"),r,s=a=>{a.startTime<e.firstHiddenTime&&(n.value=a.processingStart-a.startTime,n.entries.push(a),r(!0))},i=a=>{a.forEach(s)},o=mt("first-input",i);r=fr(t,n),o&&Ot(()=>{i(o.takeRecords()),o.disconnect()},!0)};var Df={},Lf=t=>{let e=pr(),n=hr("LCP"),r,s=o=>{let a=o[o.length-1];if(a){let c=Math.max(a.startTime-Ji(),0);c<e.firstHiddenTime&&(n.value=c,n.entries=[a],r())}},i=mt("largest-contentful-paint",s);if(i){r=fr(t,n);let o=()=>{Df[n.id]||(s(i.takeRecords()),i.disconnect(),Df[n.id]=!0,r(!0))};return["keydown","click"].forEach(a=>{addEventListener(a,o,{once:!0,capture:!0})}),Ot(o,!0),o}};function Qi(t){return typeof t=="number"&&isFinite(t)}function dn(t,{startTimestamp:e,...n}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...n})}function se(t){return t/1e3}function Pf(){return M&&M.addEventListener&&M.performance}var Uf=0,ee={},tt,ps;function Mf(){let t=Pf();if(t&&fe){t.mark&&M.performance.mark("sentry-tracing-init"),ev();let e=Xb(),n=Qb();return()=>{e&&e(),n&&n()}}return()=>{}}function Bf(){mt("longtask",e=>{for(let n of e){let r=We();if(!r)return;let s=se(fe+n.startTime),i=se(n.duration);r.startChild({description:"Main UI thread blocked",op:"ui.long-task",origin:"auto.ui.browser.metrics",startTimestamp:s,endTimestamp:s+i})}})}function Ff(){mt("event",e=>{for(let n of e){let r=We();if(!r)return;if(n.name==="click"){let s=se(fe+n.startTime),i=se(n.duration);r.startChild({description:Ie(n.target),op:`ui.interaction.${n.name}`,origin:"auto.ui.browser.metrics",startTimestamp:s,endTimestamp:s+i})}}},{durationThreshold:0})}function Xb(){return Nf(t=>{let e=t.entries.pop();e&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding CLS"),ee.cls={value:t.value,unit:""},ps=e)})}function Qb(){return Lf(t=>{let e=t.entries.pop();e&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding LCP"),ee.lcp={value:t.value,unit:"millisecond"},tt=e)})}function ev(){Of(t=>{let e=t.entries.pop();if(!e)return;let n=se(fe),r=se(e.startTime);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding FID"),ee.fid={value:t.value,unit:"millisecond"},ee["mark.fid"]={value:n+r,unit:"second"}})}function Gf(t){let e=Pf();if(!e||!M.performance.getEntries||!fe)return;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Tracing] Adding & adjusting spans using Performance API");let n=se(fe),r=e.getEntries(),s,i;if(r.slice(Uf).forEach(o=>{let a=se(o.startTime),c=se(o.duration);if(!(t.op==="navigation"&&n+a<t.startTimestamp))switch(o.entryType){case"navigation":{nv(t,o,n),s=n+se(o.responseStart),i=n+se(o.requestStart);break}case"mark":case"paint":case"measure":{tv(t,o,a,c,n);let l=pr(),u=o.startTime<l.firstHiddenTime;o.name==="first-paint"&&u&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding FP"),ee.fp={value:o.startTime,unit:"millisecond"}),o.name==="first-contentful-paint"&&u&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding FCP"),ee.fcp={value:o.startTime,unit:"millisecond"});break}case"resource":{let l=o.name.replace(M.location.origin,"");sv(t,o,l,a,c,n);break}}}),Uf=Math.max(r.length-1,0),iv(t),t.op==="pageload"){typeof s=="number"&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding TTFB"),ee.ttfb={value:(s-t.startTimestamp)*1e3,unit:"millisecond"},typeof i=="number"&&i<=s&&(ee["ttfb.requestTime"]={value:(s-i)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(a=>{if(!ee[a]||n>=t.startTimestamp)return;let c=ee[a].value,l=n+se(c),u=Math.abs((l-t.startTimestamp)*1e3),d=u-c;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Measurements] Normalized ${a} from ${c} to ${u} (${d})`),ee[a].value=u});let o=ee["mark.fid"];o&&ee.fid&&(dn(t,{description:"first input delay",endTimestamp:o.value+se(ee.fid.value),op:"ui.action",origin:"auto.ui.browser.metrics",startTimestamp:o.value}),delete ee["mark.fid"]),"fcp"in ee||delete ee.cls,Object.keys(ee).forEach(a=>{t.setMeasurement(a,ee[a].value,ee[a].unit)}),ov(t)}tt=void 0,ps=void 0,ee={}}function tv(t,e,n,r,s){let i=s+n,o=i+r;return dn(t,{description:e.name,endTimestamp:o,op:e.entryType,origin:"auto.resource.browser.metrics",startTimestamp:i}),i}function nv(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{eo(t,e,r,n)}),eo(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),eo(t,e,"fetch",n,"cache","domainLookupStart"),eo(t,e,"domainLookup",n,"DNS"),rv(t,e,n)}function eo(t,e,n,r,s,i){let o=i?e[i]:e[`${n}End`],a=e[`${n}Start`];!a||!o||dn(t,{op:"browser",origin:"auto.browser.browser.metrics",description:s||n,startTimestamp:r+se(a),endTimestamp:r+se(o)})}function rv(t,e,n){dn(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"request",startTimestamp:n+se(e.requestStart),endTimestamp:n+se(e.responseEnd)}),dn(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"response",startTimestamp:n+se(e.responseStart),endTimestamp:n+se(e.responseEnd)})}function sv(t,e,n,r,s,i){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;let o={};"transferSize"in e&&(o["http.response_transfer_size"]=e.transferSize),"encodedBodySize"in e&&(o["http.response_content_length"]=e.encodedBodySize),"decodedBodySize"in e&&(o["http.decoded_response_content_length"]=e.decodedBodySize),"renderBlockingStatus"in e&&(o["resource.render_blocking_status"]=e.renderBlockingStatus);let a=i+r,c=a+s;dn(t,{description:n,endTimestamp:c,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",origin:"auto.resource.browser.metrics",startTimestamp:a,data:o})}function iv(t){let e=M.navigator;if(!e)return;let n=e.connection;n&&(n.effectiveType&&t.setTag("effectiveConnectionType",n.effectiveType),n.type&&t.setTag("connectionType",n.type),Qi(n.rtt)&&(ee["connection.rtt"]={value:n.rtt,unit:"millisecond"})),Qi(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),Qi(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}function ov(t){tt&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding LCP Data"),tt.element&&t.setTag("lcp.element",Ie(tt.element)),tt.id&&t.setTag("lcp.id",tt.id),tt.url&&t.setTag("lcp.url",tt.url.trim().slice(0,200)),t.setTag("lcp.size",tt.size)),ps&&ps.sources&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log("[Measurements] Adding CLS Data"),ps.sources.forEach((e,n)=>t.setTag(`cls.source.${n+1}`,Ie(e.node))))}var lc=["localhost",/^\/(?!\/)/],ms={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,tracingOrigins:lc,tracePropagationTargets:lc};function uc(t){let{traceFetch:e,traceXHR:n,tracePropagationTargets:r,tracingOrigins:s,shouldCreateSpanForRequest:i,enableHTTPTimings:o}={traceFetch:ms.traceFetch,traceXHR:ms.traceXHR,...t},a=typeof i=="function"?i:u=>!0,c=u=>uv(u,r||s),l={};e&&q("fetch",u=>{let d=dv(u,a,c,l);o&&d&&Hf(d)}),n&&q("xhr",u=>{let d=hv(u,a,c,l);o&&d&&Hf(d)})}function av(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function Hf(t){let e=t.data.url,n=new PerformanceObserver(r=>{r.getEntries().forEach(i=>{av(i)&&i.name.endsWith(e)&&(lv(i).forEach(a=>t.setData(...a)),n.disconnect())})});n.observe({entryTypes:["resource"]})}function cv(t){let e="unknown",n="unknown",r="";for(let s of t){if(s==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(s))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=s}return r===t&&(e=r),{name:e,version:n}}function nt(t=0){return((fe||performance.timeOrigin)+t)/1e3}function lv(t){let{name:e,version:n}=cv(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),fe?[...r,["http.request.redirect_start",nt(t.redirectStart)],["http.request.fetch_start",nt(t.fetchStart)],["http.request.domain_lookup_start",nt(t.domainLookupStart)],["http.request.domain_lookup_end",nt(t.domainLookupEnd)],["http.request.connect_start",nt(t.connectStart)],["http.request.secure_connection_start",nt(t.secureConnectionStart)],["http.request.connection_end",nt(t.connectEnd)],["http.request.request_start",nt(t.requestStart)],["http.request.response_start",nt(t.responseStart)],["http.request.response_end",nt(t.responseEnd)]]:r}function uv(t,e){return Xe(t,e||lc)}function dv(t,e,n,r){if(!qn()||!t.fetchData)return;let s=e(t.fetchData.url);if(t.endTimestamp&&s){let f=t.fetchData.__span;if(!f)return;let h=r[f];if(h){if(t.response){h.setHttpStatus(t.response.status);let m=t.response&&t.response.headers&&t.response.headers.get("content-length"),p=parseInt(m);p>0&&h.setData("http.response_content_length",p)}else t.error&&h.setStatus("internal_error");h.finish(),delete r[f]}return}let i=T(),o=i.getScope(),a=i.getClient(),c=o.getSpan(),{method:l,url:u}=t.fetchData,d=s&&c?c.startChild({data:{url:u,type:"fetch","http.method":l},description:`${l} ${u}`,op:"http.client",origin:"auto.http.browser"}):void 0;if(d&&(t.fetchData.__span=d.spanId,r[d.spanId]=d),n(t.fetchData.url)&&a){let f=t.args[0];t.args[1]=t.args[1]||{};let h=t.args[1];h.headers=fv(f,a,o,h,d)}return d}function fv(t,e,n,r,s){let i=s||n.getSpan(),o=i&&i.transaction,{traceId:a,sampled:c,dsc:l}=n.getPropagationContext(),u=i?i.toTraceparent():Mn(a,void 0,c),d=o?o.getDynamicSamplingContext():l||xt(a,e,n),f=Kr(d),h=typeof Request<"u"&&we(t,Request)?t.headers:r.headers;if(h)if(typeof Headers<"u"&&we(h,Headers)){let m=new Headers(h);return m.append("sentry-trace",u),f&&m.append(Vr,f),m}else if(Array.isArray(h)){let m=[...h,["sentry-trace",u]];return f&&m.push([Vr,f]),m}else{let m="baggage"in h?h.baggage:void 0,p=[];return Array.isArray(m)?p.push(...m):m&&p.push(m),f&&p.push(f),{...h,"sentry-trace":u,baggage:p.length>0?p.join(","):void 0}}else return{"sentry-trace":u,baggage:f}}function hv(t,e,n,r){let s=t.xhr,i=s&&s[Le];if(!qn()||s&&s.__sentry_own_request__||!s||!i)return;let o=e(i.url);if(t.endTimestamp&&o){let d=s.__sentry_xhr_span_id__;if(!d)return;let f=r[d];f&&(f.setHttpStatus(i.status_code),f.finish(),delete r[d]);return}let a=T(),c=a.getScope(),l=c.getSpan(),u=o&&l?l.startChild({data:{...i.data,type:"xhr","http.method":i.method,url:i.url},description:`${i.method} ${i.url}`,op:"http.client",origin:"auto.http.browser"}):void 0;if(u&&(s.__sentry_xhr_span_id__=u.spanId,r[s.__sentry_xhr_span_id__]=u),s.setRequestHeader&&n(i.url))if(u){let d=u&&u.transaction,f=d&&d.getDynamicSamplingContext(),h=Kr(f);$f(s,u.toTraceparent(),h)}else{let d=a.getClient(),{traceId:f,sampled:h,dsc:m}=c.getPropagationContext(),p=Mn(f,void 0,h),y=m||(d?xt(f,d,c):void 0),g=Kr(y);$f(s,p,g)}return u}function $f(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader(Vr,n)}catch{}}function jf(t,e=!0,n=!0){if(!M||!M.location){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn("Could not initialize routing instrumentation due to invalid location");return}let r=M.location.href,s;e&&(s=t({name:M.location.pathname,startTimestamp:fe?fe/1e3:void 0,op:"pageload",origin:"auto.pageload.browser",metadata:{source:"url"}})),n&&q("history",({to:i,from:o})=>{if(o===void 0&&r&&r.indexOf(i)!==-1){r=void 0;return}o!==i&&(r=void 0,s&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Finishing current transaction with op: ${s.op}`),s.finish()),s=t({name:M.location.pathname,op:"navigation",origin:"auto.navigation.browser",metadata:{source:"url"}}))})}var Yf="BrowserTracing",pv={...Wn,markBackgroundTransactions:!0,routingInstrumentation:jf,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,_experiments:{},...ms},mr=class{constructor(e){this.name=Yf,this._hasSetTracePropagationTargets=!1,gi(),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(this._hasSetTracePropagationTargets=!!(e&&(e.tracePropagationTargets||e.tracingOrigins))),this.options={...pv,...e},this.options._experiments.enableLongTask!==void 0&&(this.options.enableLongTask=this.options._experiments.enableLongTask),e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins),this._collectWebVitals=Mf(),this.options.enableLongTask&&Bf(),this.options._experiments.enableInteractions&&Ff()}setupOnce(e,n){this._getCurrentHub=n;let s=n().getClient(),i=s&&s.getOptions(),{routingInstrumentation:o,startTransactionOnLocationChange:a,startTransactionOnPageLoad:c,markBackgroundTransactions:l,traceFetch:u,traceXHR:d,shouldCreateSpanForRequest:f,enableHTTPTimings:h,_experiments:m}=this.options,p=i&&i.tracePropagationTargets,y=p||this.options.tracePropagationTargets;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this._hasSetTracePropagationTargets&&p&&_.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used."),o(g=>{let v=this._createRouteTransaction(g);return this.options._experiments.onStartRouteTransaction&&this.options._experiments.onStartRouteTransaction(v,g,n),v},c,a),l&&Rf(),m.enableInteractions&&this._registerInteractionListener(),uc({traceFetch:u,traceXHR:d,tracePropagationTargets:y,shouldCreateSpanForRequest:f,enableHTTPTimings:h})}_createRouteTransaction(e){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}let n=this._getCurrentHub(),{beforeNavigate:r,idleTimeout:s,finalTimeout:i,heartbeatInterval:o}=this.options,a=e.op==="pageload",c=a?zf("sentry-trace"):"",l=a?zf("baggage"):"",{traceparentData:u,dynamicSamplingContext:d,propagationContext:f}=ta(c,l),h={...e,...u,metadata:{...e.metadata,dynamicSamplingContext:u&&!d?{}:d},trimEnd:!0},m=typeof r=="function"?r(h):h,p=m===void 0?{...h,sampled:!1}:m;p.metadata=p.name!==h.name?{...p.metadata,source:"custom"}:p.metadata,this._latestRouteName=p.name,this._latestRouteSource=p.metadata&&p.metadata.source,p.sampled===!1&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Will not send ${p.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.log(`[Tracing] Starting ${p.op} transaction on scope`);let{location:y}=M,g=_i(n,p,s,i,!0,{location:y},o),v=n.getScope();return a&&u?v.setPropagationContext(f):v.setPropagationContext({traceId:g.traceId,spanId:g.spanId,parentSpanId:g.parentSpanId,sampled:g.sampled}),g.registerBeforeFinishCallback(I=>{this._collectWebVitals(),Gf(I)}),g}_registerInteractionListener(){let e,n=()=>{let{idleTimeout:r,finalTimeout:s,heartbeatInterval:i}=this.options,o="ui.action.click",a=We();if(a&&a.op&&["navigation","pageload"].includes(a.op)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Did not create ${o} transaction because a pageload or navigation transaction is in progress.`);return}if(e&&(e.setFinishReason("interactionInterrupted"),e.finish(),e=void 0),!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Did not create ${o} transaction because _getCurrentHub is invalid.`);return}if(!this._latestRouteName){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&_.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}let c=this._getCurrentHub(),{location:l}=M,u={name:this._latestRouteName,op:o,trimEnd:!0,metadata:{source:this._latestRouteSource||"url"}};e=_i(c,u,r,s,!0,{location:l},i)};["click"].forEach(r=>{addEventListener(r,n,{once:!1,capture:!0})})}};function zf(t){let e=Po(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}var Wf={};D.Sentry&&D.Sentry.Integrations&&(Wf=D.Sentry.Integrations);var DR={...Wf,...nn,...xa};function dc(t){let e={_metadata:{},...t};e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.react",packages:[{name:"npm:@sentry/react",version:Tt}],version:Tt},Ia(e)}async function qf(t,e,n){let{data:r,error:s}=await t.functions.invoke("pages",{method:"POST",body:{type:"GET_PAGE",pageId:n}});if(s)throw new Error(s.message);return r===null?null:Vf(r)}function Vf(t){return{userId:t.user_id,pageId:t.page_id,content:t.content,encryptedContent:t.encrypted_content,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}}async function _v(t,e,n,r){let{data:s,error:i}=await t.functions.invoke("pages",{method:"POST",body:{type:"UPDATE_PAGE",content:r,pageId:n}});if(i)throw new Error(i.message);return Vf(s)}var to=class{supabase;writeSheet;pageId;pageContextTextarea;onUpdated;debouncedSavePage;channel=null;state={type:"INITIAL"};constructor({supabase:e,writeSheet:n,pageId:r,onUpdated:s}){this.supabase=e,this.writeSheet=n,this.pageContextTextarea=n.el(),this.pageId=r,this.onUpdated=s,this.debouncedSavePage=window._.debounce(this.savePage.bind(this),500)}async signOut(){this.setState({type:"LOADING_AUTH"}),await this.supabase.auth.signOut()}async savePage(){if(this.state.type!=="MODIFIED_PAGE")throw new Error("Invalid state, expected MODIFIED_PAGE");this.setState({type:"SAVING_PAGE",user:this.state.user,page:this.state.page,newContent:this.state.newContent});try{let e=await _v(this.supabase,this.state.user.id,this.pageId,this.state.newContent);this.state.type==="SAVING_PAGE"&&this.setState({type:"SYNCED_PAGE",user:this.state.user,page:{...e,content:this.state.newContent}})}catch(e){console.error(e),this.setState({type:"SAVING_ERROR",user:this.state.user,page:this.state.page,errorMessage:typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"?e.message:"Unknown error"})}}async onModified(e){if("page"in this.state&&"user"in this.state)this.setState({type:"MODIFIED_PAGE",user:this.state.user,page:this.state.page,newContent:e}),this.debouncedSavePage();else throw new Error("Invalid state for onModified")}async refreshPage(){if(this.state.type!=="SYNCED_PAGE")return;this.setState({type:"FETCHING_PAGE",user:this.state.user,page:this.state.page});let e=await qf(this.supabase,this.state.user.id,this.pageId);if(e===null)throw new Error("Page not found");this.state.type==="FETCHING_PAGE"&&(this.updatePageContent(e.content),this.setState({type:"SYNCED_PAGE",user:this.state.user,page:e}))}updatePageContent(e){if(e!==this.pageContextTextarea.value){let n=this.pageContextTextarea.selectionStart,r=this.pageContextTextarea.selectionEnd;return this.writeSheet.setContent(e),state.set("pageContent",e),this.pageContextTextarea.setSelectionRange(n,r),!0}return!1}async acceptMergeResolution(){if(this.state.type!=="MERGE_CONFLICT")throw new Error("Invalid state, expected MERGE_CONFLICT");let e=`${this.pageContextTextarea.value}

-----------------

${this.state.page.content}`;this.updatePageContent(e),this.setState({type:"MODIFIED_PAGE",user:this.state.user,page:this.state.page,newContent:e}),this.savePage()}async load(e){this.setState({type:"LOADING_PAGE",user:e});let n=await qf(this.supabase,e.id,this.pageId);if(this.channel=this.supabase.channel("any").on("postgres_changes",{event:"UPDATE",schema:"public",table:"pages"},async r=>{r.new&&r.new.page_id===this.pageId&&this.state.type==="SYNCED_PAGE"&&this.state.page.encryptedContent!==r.new.encrypted_content&&await this.refreshPage()}).subscribe(),n===null){let r={userId:e.id,pageId:this.pageId,content:this.pageContextTextarea.value,encryptedContent:"",createdAt:new Date,updatedAt:new Date};this.setState({type:"SYNCED_PAGE",user:e,page:r}),this.savePage();return}if(this.pageContextTextarea.value.trim().length>0&&this.pageContextTextarea.value!==n.content){this.setState({type:"MERGE_CONFLICT",user:e,page:n});return}this.updatePageContent(n.content),this.setState({type:"SYNCED_PAGE",user:e,page:n})}async unload(){this.channel&&this.channel?.unsubscribe(),this.setState({type:"INITIAL"})}start(){let{data:{subscription:e}}=this.supabase.auth.onAuthStateChange(async(r,s)=>{r==="SIGNED_OUT"?(this.updatePageContent(""),this.unload()):s!==null&&this.state.type==="INITIAL"&&this.load({id:s.user.id,email:s.user.email??""})}),n=()=>{"user"in this.state&&this.onModified(this.pageContextTextarea.value)};return this.pageContextTextarea.addEventListener("input",n),()=>{this.pageContextTextarea.removeEventListener("input",n),this.channel?.unsubscribe(),e.unsubscribe()}}setState(e){this.state.type!==e.type&&console.log("sync state change",this.state.type,"=>",e.type),this.state=e,this.onUpdated(e)}};document.location.hostname==="blank.page"&&dc({dsn:"https://72f60a927c8555bcc4de92fa40fb6c1d@o4506088787410944.ingest.sentry.io/4506088789311488",integrations:[new mr({tracePropagationTargets:["localhost",/^https:\/\/blank.page/]}),new ur],tracesSampleRate:1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1});function Kf(t){let e=document.createElement("div");return e.classList.add("tw"),t.appendChild(e),e}function gv({supabase:t,writeSheet:e,pageId:n}){let[r,s]=J(!1),[i,o]=J(!1),{current:a}=Kt(new to({supabase:t,writeSheet:e,pageId:n,onUpdated(m){l(m)}})),[c,l]=J(a.state),[u,d]=J(!1),f=document.getElementById("page-status");if(!f)throw new Error("Could not find page status element");Ge(()=>{let m=a.start();return()=>{m()}},[]),Ge(()=>{let m=p=>{c?.type==="MODIFIED_PAGE"&&(p.preventDefault(),p.returnValue="Please wait a few seconds for the page to sync")};return window.addEventListener("beforeunload",m),()=>{window.removeEventListener("beforeunload",m)}},[c]);let h=c?.type==="MERGE_CONFLICT";return b(le,{children:[b(Et,{show:r,className:"max-w-sm",title:"Before you leave...",allowClose:!0,content:b(le,{children:[b("p",{className:"leading-relaxed",children:"To keep your content private, we will clear the page content after you log out. You can always sign in again to continue where you left off."}),b("div",{className:"mt-8 flex",children:b("button",{className:"ml-auto bg-blue-600 text-white ml-auto py-2 px-5 rounded-lg text-md font-medium hover:cursor-pointer hover:bg-black",onClick:async()=>{await a.signOut(),s(!1),d(!0)},children:"I understand, log me out"})})]})}),h&&b(Et,{show:!0,className:"max-w-sm",title:"Heads up!",allowClose:!1,content:b(le,{children:[b("p",{className:"leading-relaxed",children:"Looks like you already have existing content in your account page. To avoid a possible conflict, we will merge all contents into the same page."}),b("div",{className:"pt-6 flex",children:[b("a",{type:"submit",rel:"noreferrer",target:"_blank",href:"https://blank.page/cafe/channels/support",className:"ml-auto text-gray-500 py-2 pr-5 text-md font-medium hover:cursor-pointer",children:"Need help?"}),b("button",{type:"submit",className:"disabled:opacity-50 disabled:pointer-events-none ml-1 bg-blue-600 text-white py-2 px-5 rounded-lg text-md font-medium hover:cursor-pointer hover:bg-black",onClick:()=>{a.acceptMergeResolution()},children:"Merge and continue"})]})]})}),b(Xl,{supabase:t,show:i,onLogin:()=>o(!1),onClose:()=>o(!1)}),b(ko,{message:"Logged out successfully.",show:u,onClose:()=>d(!1),dissapearAfter:3e3}),")",Zl(b("div",{children:b(Ql,{state:c,handleSignIn:()=>{Oe("Sign in to save clicked"),o(!0)},handleSignOut:()=>{s(!0)}})}),f)]})}function yv(){let[t,e]=J(!1),[n,r]=J(!1);return Ge(()=>{localStorage.getItem("newBlankPageTopbarClosed")!=="true"&&document.body.classList.add("topbar-open");let s=document.getElementById("topbar-close-button"),i=document.getElementById("topbar-cta");s&&s.addEventListener("click",o=>{o.preventDefault(),document.body.classList.remove("topbar-open"),localStorage.setItem("newBlankPageTopbarClosed","true"),Oe("SC Topbar Close Clicked")}),i&&i.addEventListener("click",()=>{localStorage.setItem("topbarClosed","true"),document.body.classList.remove("topbar-open"),Oe("SC Topbar CTA Clicked")})},[]),b("div",{children:[b(Et,{show:t,onClose:()=>e(!1),className:"w-[640px]",allowClose:!1,title:"Before you keep writing...",content:b(le,{children:[b("p",{className:"pt-2 leading-relaxed",children:"This page is made possible by people like you. We believe the Internet deserves an open, beautiful, blank page to write what matters in our lives. Support us in keeping it this way with as little as $1."}),b("p",{className:"pt-6 text-sm text-gray-500",children:"Once or monthly, we\u2019ll thank from the heart."}),b("div",{className:"pt-6 mt-6 flex border-t dark:border-gray-800",children:[b("div",{className:"flex gap-x-5 items-center",children:[b("a",{onClick:()=>{Oe("SC First Modal CTA Clicked"),e(!1)},href:"https://www.buymeacoffee.com/blankpage",target:"_blank",rel:"noreferrer",className:"bg-[#474B55] hover:bg-[#363840] py-2 px-4 rounded-lg text-white no-underline text-sm",children:"Support"}),b("div",{className:"max-w-[120px]",children:b("a",{onClick:()=>{Oe("SC First Modal BMCA Logo Clicked"),e(!1)},href:"https://www.buymeacoffee.com/blankpage",target:"_blank",rel:"noreferrer",children:[b("img",{className:"block dark:hidden",src:"/img/bmc.svg"}),b("img",{className:"hidden dark:block",src:"/img/bmc_dark.svg"})]})})]}),b("a",{href:"#",onClick:s=>{s.preventDefault(),e(!1),r(!0),Oe("SC First Modal Maybe Later Clicked")},className:"ml-auto text-gray-500 hover:text-gray-600 py-2 pr-5 text-sm font-medium hover:cursor-pointer",children:"Maybe later"})]})]})}),b(Et,{show:n,onClose:()=>{r(!1),Oe("SC Second Modal Close Clicked")},className:"max-w-xl",allowClose:!0,title:"There are more ways to support!",content:b(le,{children:[b("p",{className:"leading-relaxed",children:"If you are unable to donate, you can still help us by taking a quick survey or by joining our community forum."}),b("p",{className:"pt-6 text-sm text-gray-500",children:"Thanks for your time \u{1F64C}"}),b("div",{className:"pt-6 mt-6 flex border-t dark:border-gray-800",children:b("div",{className:"flex gap-x-4 items-center",children:b("a",{onClick:()=>{r(!1),Oe("SC Second Modal CTA Clicked")},href:"https://forms.reform.app/ZCfKMr/feedback-2024/ud25nv",target:"_blank",rel:"noreferrer",className:"bg-[#474B55] hover:bg-[#363840] py-2 px-4 rounded-lg text-white no-underline text-sm",children:"Take 1-min survey"})})})]})})]})}function bv(){let e=new URLSearchParams(window.location.search).has("sync"),r=localStorage.getItem("syncEnabled")==="true";return e||r}var vv={development:{url:"https://uhkrtcirqzojuyybjkty.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoa3J0Y2lycXpvanV5eWJqa3R5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTcyMTk4NjgsImV4cCI6MjAxMjc5NTg2OH0.32iCqvaPqQ2YR7GTKDbba3r3UCckY7fRaYDpze55vNM"},production:{url:"https://uhkrtcirqzojuyybjkty.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoa3J0Y2lycXpvanV5eWJqa3R5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTcyMTk4NjgsImV4cCI6MjAxMjc5NTg2OH0.32iCqvaPqQ2YR7GTKDbba3r3UCckY7fRaYDpze55vNM"}};async function Sv(t){let e=document.location.hostname==="localhost"?"development":"production",n=vv[e],r=ll(n.url,n.key,{global:{fetch:fetch.bind(globalThis)}}),s=window.location.pathname==="/"?null:window.location.pathname.split("/")[1],i=bv();localStorage.setItem("syncEnabled",i.toString()),i&&An(b(gv,{writeSheet:t,supabase:r,pageId:s}),Kf(document.body)),An(b(yv,{}),Kf(document.body))}return nh(Ev);})();
/*! Bundled license information:

classnames/index.js:
  (*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  *)

@sentry/replay/esm/index.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
//# sourceMappingURL=ts-bundle.js.map
